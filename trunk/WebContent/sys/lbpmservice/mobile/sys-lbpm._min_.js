require({cache:{"sys/lbpmservice/mobile/freeflow/freeflowNodeAttrGw":function(){define(["dojo/dom-construct","dojo/_base/declare","dijit/_WidgetBase","dojo/parser","dojox/mobile/sniff","dojo/topic"],function(a,f,g,h,d,c){var b=f("sys.lbpmservice.mobile.freeflow.freeflowNodeAttrGw",[g],{type:ORG_TYPE_POSTORPERSON,attType:"",title:"",isMul:true,showStatus:"edit",idField:"__freeflowNodeImissiveAttr__",_cateDialogPrefix:"__freeflowNodeAttrGw__",rtn:{},buildRendering:function(){this.inherited(arguments);this._cateDialogPrefix=this._cateDialogPrefix+this.attType;a.empty(this.domNode);var j=this.getTitle();var i=this;this.defer(function(){c.publish("/sys/lbpmservice/freeflow/attrValGw",this.rtn)},100);if(this.attType=="ruleSelect"){h.parse(this.domNode).then(function(){win.doc.dojoClick=!d("ios")||d("ios")>13})}},buildSelectDom:function(){var i=this.selectTemp.replace("!{name}",this.idFieldRule).replace("!{value}",this.value).replace("!{mul}",this.mul).replace("!{store}",this.store).replace("!{showStatus}",this.showStatus).replace("!{state}",this.state).replace("!{nodeId}",this.nodeId);var j=a.toDom(i);a.place(j,this.domNode,"last")},buildSelectType:function(){var i=this.selectType.replace("!{name}",this.idFieldType).replace("!{value}",this.value).replace("!{mul}",this.mul).replace("!{storeType}",this.storeType).replace("!{showStatus}",this.showStatus).replace("!{state}",this.state).replace("!{nodeId}",this.nodeId);var j=a.toDom(i);a.place(j,this.domNode,"last")},buildSelectPosen:function(){var i=this.showHead;var j=a.toDom(i);a.place(j,this.domNode,"last")},getNodes:function(k){var j=document.getElementById("WF_IFrame");var i=j.contentWindow.FlowChartObject;return i.Nodes.GetNodeById(k)},getTitle:function(){var n=this.nodeId;n=n.split(";");for(var k in n){var r=n[k];var m=this.getNodes(r);var q="";var j=Lbpm_SettingInfo=new KMSSData().AddBeanData("lbpmSettingInfoService").GetHashMapArray()[0];if(m&&m.Type=="reviewNode"){if(this.attType=="ruleSelect"){var l=this.handlerType;var p=m.Data.handlerIds;if(l=="0"||l=="1"){this.idFieldRule="_freeflowNodeGwRule_"+k;this.idFieldType="_freeflowNodeGwType_"+k;this.showHead="<div class='free_flow_nodeAttribute_item'><div class='free_flow_nodeAttribute_area'><div class='free_flow_nodeAttribute_left'><img src='"+Com_Parameter.ContextPath+"sys/lbpmservice/mobile/freeflow/image.jsp?orgId="+p+"' alt='' style='width: 80px;height: 80px;'/></div><div class='free_flow_nodeAttribute_right'>"+m.Data.name+"</div></div></div>";this.buildSelectPosen();this.selectTemp="<div class='free_flow_nodeAttribute_item'><div class='free_flow_nodeAttribute_area'><div class='free_flow_nodeAttribute_left'>业务权限：</div><div class='free_flow_nodeAttribute_right'><div data-dojo-type='mui/form/Select'  data-dojo-props='name:\"!{name}\",value:\"!{value}\",mul:!{mul},store:!{store},state:\"!{state}\",nodeId:\"!{nodeId}\"'></div></div></div></div>",this.ruleNode(l,p,m,k);if(j&&j.isOpinionTypeEnabled=="true"){this.selectType="<div class='free_flow_nodeAttribute_item'><div class='free_flow_nodeAttribute_area'><div class='free_flow_nodeAttribute_left'>意见类型：</div><div class='free_flow_nodeAttribute_right'><div data-dojo-type='mui/form/Select' id='gw_Select_"+k+'\' data-dojo-props=\'name:"!{name}",value:"!{value}",mul:!{mul},store:!{storeType},state:"!{state}",nodeId:"!{nodeId}"\'></div></div></div></div><div class=\'free_flow_nodeAttribute_split\'></div>',this.ImNodeType(m)}this._selectGwShow(m)}else{if(l=="3"){this.idFieldRule="_freeflowNodeGwRule_";this.idFieldType="_freeflowNodeGwType_";this.showHead="<div class='free_flow_nodeAttribute_item'><div class='free_flow_nodeAttribute_area'><div class='free_flow_nodeAttribute_left'>"+m.Data.name+"</div></div></div>";this.buildSelectPosen();this.selectTemp="<div class='free_flow_nodeAttribute_item'><div class='free_flow_nodeAttribute_area'><div class='free_flow_nodeAttribute_left'>业务权限：</div><div class='free_flow_nodeAttribute_right'><div data-dojo-type='mui/form/Select' data-dojo-props='name:\"!{name}\",value:\"!{value}\",mul:!{mul},store:!{store},state:\"!{state}\",nodeId:\"!{nodeId}\"'></div></div></div></div>",this.ruleNode(l,p,m);if(j&&j.isOpinionTypeEnabled=="true"){this.selectType="<div class='free_flow_nodeAttribute_item'><div class='free_flow_nodeAttribute_area'><div class='free_flow_nodeAttribute_left'>意见类型：</div><div class='free_flow_nodeAttribute_right'><div data-dojo-type='mui/form/Select' id='gw_Select_' data-dojo-props='name:\"!{name}\",value:\"!{value}\",mul:!{mul},store:!{storeType},state:\"!{state}\",nodeId:\"!{nodeId}\"'></div></div></div></div>",this.ImNodeType(m)}this._selectGwShow(m)}}}}}return q},ruleNode:function(t,k,l,n){var q=lbpm.modelName;var m=Com_Parameter.ContextPath+"km/imissive/km_imissive_rule/kmImissiveRule.do?method=findRuleListMobile";var s="";$.ajax({url:m,async:false,data:{fdImissiveType:q,handlerIds:k,handlerType:t},type:"POST",dataType:"json",success:function(i){if(i){s=i}},error:function(i){}});if(s[0]){var r=s[0].value;this.value=r;if(r){var j=this.getRuleSource(r);var p=j[0][0].ruleVal[0].fdNodeRule;p=JSON.parse(p);this.opinionTypeGw=p.opinionType}var u=l.Data.processType;this.store=JSON.stringify(s);this.mul=false;this.state=n;this.nodeId=l.Data.id;this.buildSelectDom()}},ImNodeType:function(k){var j="";var i=Com_Parameter.ContextPath+"sys/lbpmservice/support/lbpm_audit_note_type/lbpmAuditNoteType.do?method=queryAllAuditNoteTypeByName";$.ajax({url:i,data:{keyName:"text",valueName:"value"},async:false,type:"POST",dataType:"json",success:function(m){if(m){j=m}},error:function(m){}});var l=k.Data.processType;this.storeType=JSON.stringify(j);if(this.opinionTypeGw){this.value=this.opinionTypeGw;this.opinionTypeGw=""}this.mul=false;this.nodeId=k.Data.id;this.buildSelectType()},getNode:function(){var j=document.getElementById("WF_IFrame");var i=j.contentWindow.FlowChartObject;return i.Nodes.GetNodeById(this.nodeId)},getRuleSource:function(j){var k="";var i=Com_Parameter.ContextPath+"km/imissive/km_imissive_rule/kmImissiveRule.do?method=getRuleSource";$.ajax({url:i,data:{ruleId:j},async:false,type:"POST",dataType:"json",success:function(l){if(l){k=l}},error:function(l){}});return k},_selectGwShow:function(i){var n=i.Data.id;var m=this.getNodes(n);if(!this.rtn){this.rtn={}}if(!this.rtn[n]){this.rtn[n]={}}if(!m){return}var j=this.store;if(j){j=JSON.parse(j);var l=j[0].value;if(l){var q=this.getRuleSource(l);var p=q[0][0].ruleVal[0].fdNodeRule;this.rtn[n]["handlerRule"]=l;this.rtn[n]["handlerRuleTitle"]=j[0].text;var k=JSON.parse(p);this.rtn[n]["opinionType"]=k.opinionType}}}});return b})},"sys/lbpmservice/mobile/common/_MaxApprovalMixin":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/dom-class","dojo/query","dojo/dom"],function(b,d,c,f,g){var a=b("sys/lbpmservice/mobile/common/_MaxApprovalMixin",null,{buildRendering:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments);this.connect(f(".textarea_dropbox")[0],"click","_handleOpenMax");this.connect(f(".textarea_dropbox_icon")[0],"click","_handleCloseMax");this.connect(f(".textarea_dropbox_content")[0],"click","_handleStopEvent")},_handleOpenMax:function(j){var i=f(".muiOriginalTextarea")[0].value;var h=f(".muiDialogElementMask")[0];if(!c.contains(h,"show")){c.add(h,"show");if(i){f(".muiScaleTextarea")[0].value=i}}},_handleCloseMax:function(i){var h=f(".muiScaleTextarea")[0].value;if(h){f(".muiOriginalTextarea")[0].value=h;c.remove(f(".muiDialogElementMask")[0],"show")}},_handleStopEvent:function(h){dojo.stopEvent(h)}});return a})},"sys/lbpmservice/mobile/operation/ExtOperationButton":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/_base/window","dojo/dom-construct","dojo/query","dojox/mobile/TransitionEvent","dojox/mobile/ViewController","dojox/mobile/viewRegistry","mui/util","mui/dialog/Dialog","mui/tabbar/TabBarButton","dojo/Deferred","mui/device/adapter","mui/history/listener","dojo/html","dojo/dom","dojo/dom-style","dijit/registry","dojo/topic"],function(u,l,w,g,j,h,r,v,t,c,i,d,a,n,f,m,s,p,k,q){var b=u("sys.lbpmservice.mobile.operation.ExtOperationButton",[d],{icon1:"",extOptUrl:"/sys/lbpmservice/mobile/operation/extOperationViewer.jsp",processId:"",modelName:"",modelId:"",handleView:"",showType:"dialog",tmpl:"<div data-dojo-type=\"mui/form/RadioGroup\" data-dojo-props=\"showStatus:'edit',name:'_lbpm_opt_radio',mul:'false',store:{store},orient:'vertical'\"></div>",buildRendering:function(){if(!this.domNode){this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div")}this.icon1="";var A=[];var y=[];var B=0;var z=0;this.tasks={};var x=this;l.forEach(window.LBPM_CurOperationCfg,function(G,D){if(G.taskFrom=="workitem"){l.forEach(G.operations,function(I,J){if(I.operationHandlerType=="handler"){var H="处理人:";A.push({text:H+I.operationName,value:G.taskId+":"+I.operationType,optName:I.operationType+":"+I.operationName})}});var F=null;l.forEach(window.LBPM_CurNodeCfg,function(H){if(G.nodeId==H.nodeId){F=H}});var C=(G.parentHandlerName)?(G.parentHandlerName+":"):"";C=G.nodeId+"."+C+F.nodeName+"("+G.expectedName+")";var E={text:C,value:G.taskId,optView:x.handleView,nodeInfo:G.nodeId+"."+F.nodeName,taskFrom:"workitem"};x.tasks[G.taskId]=E;B++}if(G.taskFrom=="node"){l.forEach(G.operations,function(I,J){if(I.operationHandlerType=="drafter"||I.operationHandlerType=="historyhandler"||I.operationHandlerType=="branchadmin"){var H=I.operationHandlerType=="drafter"?"起草人:":(I.operationHandlerType=="branchadmin"?"分支特权人:":"已处理:");y.push({text:H+I.operationName,value:G.taskId+":"+I.operationType,optName:I.operationType+":"+I.operationName})}});var F=null;l.forEach(window.LBPM_CurNodeCfg,function(H){if(G.nodeId==H.nodeId){F=H}});var E={text:G.nodeId+"."+F.nodeName,value:G.taskId,optView:"OperationView",nodeInfo:G.nodeId+"."+F.nodeName,taskFrom:"node"};x.tasks[G.taskId]=E;z++}});if(A.length>0||y.length>0){this.label="流程处理";if(B>1){l.forEach(A,function(D,C){var E=D.value.split(":");D.text=x.tasks[E[0]].text+"."+D.text})}if(z>1){l.forEach(y,function(D,C){var E=D.value.split(":");D.text=x.tasks[E[0]].text+"."+D.text})}this.options=A.concat(y);this.dialogDom=j.toDom(w.replace(this.tmpl,{store:JSON.stringify(this.options).replace(/\"/g,"'")}))}this.inherited(arguments)},_onClick:function(x){x.preventDefault();x.stopPropagation();this.defer(function(){var y=this;this.dialog=i.element({canClose:false,showClass:"muiDialogElementShow muiFormSelect",element:this.dialogDom,position:"bottom",scrollable:false,parseable:true,onDrawed:function(){y.initDialog()}})},500)},initDialog:function(){var x=this;this._curTime=0;h(".muiRadioItem",this.dialogDom).on("click",function(y){y.preventDefault();y.stopPropagation();var B=new Date();if(B-x._curTime<500){return}x._curTime=B;var z=y.target;var A;if(z.className!=""&&z.className.indexOf("muiRadioItem")>-1){A=z}else{A=h(y.target).parents(".muiRadioItem")[0]}x.selOperation=h("input",A).val();x._afterSelect(function(){x.dialog.hide()})})},_afterSelect:function(I){if(!this.selOperation){return}var y=this.selOperation.split(":");var E=y[0];var B=y[1];var H=this.tasks[E].optView;var G=null;var J=this;if(this.showType!="dialog"){if(this.backTo!=null){G=t.hash[this.backTo]}else{G=t.getEnclosingView(this.domNode);G=t.getParentView(G)||G;this.backTo=G.id}}else{G=t.getEnclosingView(this.domNode);G=t.getParentView(G)||G;if(this.showType=="dialog"){if(G.validate&&!G.validate()){return}}}var A=t.hash[H];if(A==null){var z=c.formatUrl(this.extOptUrl);z=c.setUrlParameter(z,"backTo",G.id);z=c.setUrlParameter(z,"processId",this.processId);z=c.setUrlParameter(z,"modelName",this.modelName);z=c.setUrlParameter(z,"modelId",this.modelId);var J=this;if(this.showType=="dialog"){z="dojo/text!"+z;this.viewNode=j.create("div");j.place(this.viewNode,G.domNode.parentNode,"last");require([z],function(L){var K=new m._ContentSetter({node:J.viewNode,parseContent:true,cleanContent:false});K.set(L);K.parseDeferred.then(function(N){var M=t.hash.OperationView;if(M&&M.initExtOpertion){M.initExtOpertion(J);if(I){I()}}}).then(function(){J.defer(function(){J.showOperationDialog()},300)});K.tearDown()})}else{var D=v.getInstance();D.openExternalView({url:z,transition:"slide"},G.domNode.parentNode).then(function(){var K=t.hash.OperationView;if(K&&K.initExtOpertion){K.initExtOpertion(J);if(I){I()}}})}}else{if(this.showType!="dialog"){G.performTransition(A.id,1,"slide")}if(H=="OperationView"){if(A.initExtOpertion){A.initExtOpertion(this);if(I){I()}}}else{var C="";l.forEach(this.options,function(K){if(K.value==J.selOperation){C=K.optName}});h("#operationMethodsGroup")[0].value=C;lbpm.globals.clickOperation(C);l.forEach(lbpm.processorInfoObj,function(L,K){if(E==L.id){lbpm.nowProcessorInfoObj=L;h("#operationItemsRow .detailNode").html(J.tasks[E].text);h("#operationItemsSelect")[0].value=K}});var x=C.split(":");h("#lbpmOperationMethodTable .detailNode").html(this.tasks[E].nodeInfo+":"+x[1]);if(I){I()}}if(this.showType=="dialog"){this.showOperationDialog()}}var F=this;window.Com_BeforeSubmitDeferred=w.hitch(this,this.defaultDeferred);if(this.showType!="dialog"){f.add({callback:function(){new r(g.body(),{moveTo:F.backTo,transition:"slide",transitionDir:-1}).dispatch()}})}},showOperationDialog:function(){var A=this.selOperation.split(":");var y=A[0];var x=A[1];this.operationView=this.tasks[y].optView;this.dialogContentNode=j.create("div");var B="lbpmOperContent";if(this.tasks[y].taskFrom=="node"){B="lbpmExtOperContent"}j.place(s.byId(B),this.dialogContentNode,"first");var z=[];this.dialog=i.element({title:this.currentOprText||"",canClose:false,element:this.dialogContentNode,buttons:z,position:"bottom",appendTo:this.operationView,scrollable:false,parseable:false,showClass:"muiLbpmDialog",callback:w.hitch(this,function(D,C){p.set(this.operationView,{display:"none",position:"","z-index":""});p.set(h("body")[0],{"overflow-y":""});j.place(h("#"+B,C.element)[0],this.operationView,"first");this.lastDialog=this.dialog;this.dialog=null}),onDrawed:w.hitch(this,function(C){p.set(this.operationView,{display:"block",position:"fixed",bottom:"0","z-index":"100"});p.set(h("body")[0],{"overflow-y":"hidden"});var D=document.documentElement.clientHeight*0.9;if(C.privateHeight){D=C.privateHeight}if(C.divNode){D=D-C.divNode.offsetHeight}if(C.buttonsNode){D=D-C.buttonsNode.offsetHeight}p.set(C.contentNode,{"max-height":D+"px","overflow-x":"hidden"});C.scrollViewNode=C.contentNode;var E=k.byId("lbpmViewOperationTabBar");E.resize()})})},defaultDeferred:function(){var x=new a();x.resolve();if(this.showType!="dialog"){history.back()}else{this._hideDialog()}return x},postCreate:function(){this.inherited(arguments);if(this.showType=="dialog"){this.subscribe("/lbpm/operation/hideDialog","_hideDialog");this.subscribe("/lbpm/operation/showDialog","_showDialog");this.subscribe("/lbpm/extOperation/destroyDialog","_destroyDialog");this.subscribe("/mui/Category/valueChange","_toHandlerValChange");this.subscribe("/lbpm/operation/toHandlerAddress/parseFinish","_toSelectCate")}},_toSelectCate:function(){if(this.showType=="dialog"){var x=t.getEnclosingView(this.domNode);x=t.getParentView(x)||x;if(x.validate&&!x.validate()){return}}var y=k.byId("toHandlerAddress");y._selectCate()},_toHandlerValChange:function(x,z){var y=k.byId("toHandlerAddress");if(y&&y==x&&this.dialog==null){this.showOperationDialog(this.currentOperationData)}},_showDialog:function(x,y){this.defer(function(){p.set(s.byId(this.handleView),{display:"block"});if(y&&y.handwriting){var z=this._getDomOffsetTop(h("#handwriting")[0]);var A=window;if(this.showType=="dialog"){A=h(".muiLbpmDialog .muiDialogElementContent_bottom")[0]}this._scrollTo(A,{y:0-z+110})}},500)},_hideDialog:function(x){if(this.handleView&&s.byId(this.handleView)){p.set(s.byId(this.handleView),{display:"none"})}else{if(this.dialog){p.set(this.dialog.domNode,{display:"none"})}}},_destroyDialog:function(x){if(this.dialog&&this.dialog.callback){this.dialog.callback(window,this.dialog)}this.lastDialog.hide();this.lastDialog=null},startup:function(){this.inherited(arguments)}});window.closeExtDialog=function(x){x=x||window.event||arguments[0];x.cancelBubble=true;if(x.preventDefault){x.preventDefault()}if(x.stopPropagation){x.stopPropagation()}var z=new Date().getTime();var y=window.ctime;if(y!="undefined"&&z-y<500){return false}window.ctime=z;q.publish("/lbpm/extOperation/destroyDialog")};return b})},"sys/lbpmservice/mobile/freeflow/freeflowNodes":function(){define(["dojo/_base/declare","mui/form/Category","mui/address/AddressMixin","dojo/parser","dijit/registry","dojo/query","dojo/dom-construct","dojo/dom-style","dojo/dom-class","dojo/dom-attr","dojo/on","mui/util","dojo/dom-attr","dojo/_base/lang","dojo/_base/array","dojo/topic","mui/dialog/Dialog","mui/dialog/Tip","mui/i18n/_i18n!sys/mobile/js/mui/mui-common","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/dialog/Confirm","sys/lbpmservice/mobile/freeflow/freeflowNodeAttributeGw","sys/lbpmservice/mobile/freeflow/freeflowNodeAttribute"],function(declare,Category,AddressMixin,parser,registry,query,domConstruct,domStyle,domClass,domAttr,on,util,domAttr,lang,array,topic,Dialog,Tip,msg,Msg,Confirm,freeflowNodeAttributeGw,freeflowNodeAttribute){var freeflowNodes=declare("sys.lbpmservice.mobile.freeflow.freeflowNodes",[Category,AddressMixin],{subject:"选人添加节点",isMul:true,type:ORG_TYPE_POSTORPERSON,idField:"_freeflowNodes_",id:"freeflowNodes",showHeadImg:true,_cateDialogPrefix:"__freeflowNodes__",isNew:true,deptLimit:"",exceptValue:"",maxPageSize:300,dataUrl:"/sys/organization/mobile/address.do?method=addressList&parentId=!{parentId}&orgType=!{selType}&deptLimit=!{deptLimit}&maxPageSize=!{maxPageSize}",iconUrl:"/sys/lbpmservice/mobile/freeflow/image.jsp?orgId=!{orgId}",searchUrl:"/sys/organization/mobile/address.do?method=searchList&keyword=!{keyword}&orgType=!{orgType}&deptLimit=!{deptLimit}",nodeTmpl:"<div data-dojo-type=\"sys/lbpmservice/mobile/freeflow/freeflowNodeSplit\" data-dojo-props=\"nodeId:'!{nodeId}'\" style='display:none'></div>",addNodeTmpl:'<div data-dojo-type="sys/lbpmservice/mobile/freeflow/freeflowNodeType"></div>',buildRendering:function(){this.inherited(arguments);domClass.add(this.domNode,"muiAddressForm");if(this.showHeadImg){domClass.add(this.domNode,"freeFlowShowHeadImg")}this.maximizeDom=domConstruct.create("div",{className:"MuiFreeflowMaximizeDom"});domConstruct.place(this.maximizeDom,query("#freeflowRowTitle")[0],"first");this.returnDom=domConstruct.create("div",{className:"MuiFreeflowMaximizeReturn"},this.domNode.parentNode);domConstruct.create("span",{innerHTML:"返回"},this.returnDom)},postCreate:function(){this.inherited(arguments);this.subscribe("mui/form/select/callback",lang.hitch(this,function(evt){if(evt.id=="rolesSelectObj"&&evt.key=="handlerId"){this.curDraftorId=evt.value;this.curDraftorName=evt.text;var nodes=query(this.draftOrgDom).closest(".freeFlowOrg");nodes.forEach(function(orgDom){var id=orgDom.getAttribute("data-id");if(id=="N2"){var orgIconDom=query(orgDom).children(".freeFlowOrgIcon")[0];var icon=util.formatUrl(util.urlResolver(this.iconUrl,{orgId:this.curDraftorId}));domStyle.set(orgIconDom,"background","url("+icon+") center center / cover no-repeat");var nameDom=query(orgDom).children(".name")[0];nameDom.innerText=this.curDraftorName}},this)}}));this.subscribe("/sys/lbpmservice/freeflow/viewTransitionOut",lang.hitch(this,function(view){if(view.id=="freeflowChartView"){this.buildValue(this.contentNode)}}));this.subscribe("/sys/lbpmservice/freeflow/nodeTypeCancel","_nodeTypeCancel");this.subscribe("/sys/lbpmservice/freeflow/nodeTypeSelect","_nodeTypeSelect");this.subscribe("/sys/lbpmservice/freeflow/updateNode","_updateNode");this.subscribe("/sys/lbpmservice/freeflow/_delteNode","_delteNode");this.connect(this.maximizeDom,"click","_maximize");this.connect(this.returnDom,"click","_cancelMaximize");this.subscribe("/sys/lbpmservice/freeflow/___addNode","___addNodeImissive");this.subscribe("/sys/lbpmservice/freeflow/imissiveokMsg","_imissiveMsgChange");var self=this;lbpm.events.addListener(lbpm.constant.EVENT_CHANGEWORKITEM,function(){self.buildValue(self.contentNode)})},_checkImissiveFlag:function(){var isBusinessAuthEnabled=Lbpm_SettingInfo.isBusinessAuthEnabled;if(isBusinessAuthEnabled=="true"){return true}else{return false}},___addNodeImissive:function(thisVal,nodeVal){if(this._checkImissiveFlag()){var self=this;this.defer(function(){var handlerType=nodeVal.handlerType;var nodes=nodeVal.nodes;var noId="";for(var i in nodes){var nodeId=nodes[i].Data.id;noId+=nodeId+";"}noId=noId.substr(0,noId.length-1);if(self.freeflowNodeAttributeGwDialog==null){self.freeflowNodeAttributeGwDialog=new freeflowNodeAttributeGw()}self.freeflowNodeAttributeGwDialog._selectCate({nodeId:noId,handlerType:handlerType})},100)}},_imissiveMsgChange:function(thisVal){if(this._checkImissiveFlag()){var FlowChartObject=this.getFlowChartObject();for(var nodeId in thisVal){if(FlowChartObject){var endNodeObj=FlowChartObject.Nodes.GetNodeById(nodeId);if(!endNodeObj){continue}}var nameDom=query(".freeFlowOrg[data-id='"+nodeId+"']").children(".nameGw")[0];var ruleTitle=thisVal[nodeId]["handlerRuleTitle"];if(ruleTitle){nameDom.innerText="("+ruleTitle+")"}}}},startup:function(){this.containerNode=this.contentNode;this.inherited(arguments)},_maximize:function(){var nowTime=new Date().getTime();var clickTime=this.ctime;if(clickTime!="undefined"&&(nowTime-clickTime<500)){return false}this.ctime=nowTime;domClass.add(this.domNode,"muiFreeflowMaximize");domClass.add(this.domNode.parentNode,"muiFreeflowMaximizeParent")},_cancelMaximize:function(){var nowTime=new Date().getTime();var clickTime=this.ctime;if(clickTime!="undefined"&&(nowTime-clickTime<500)){return false}this.ctime=nowTime;domClass.remove(this.domNode,"muiFreeflowMaximize");domClass.remove(this.domNode.parentNode,"muiFreeflowMaximizeParent")},domNodeClick:function(){if(query(".nodeAddIcon").indexOf(arguments[0].target)>=0){return}this.currentStartNodeId=null;this.currentNodeType=null;if(this.showHeadImg){var evtNode=query(arguments[0].target).closest(".muiCategoryAdd");if(evtNode.length<=0){return}}var evtNode=query(arguments[0].target).closest(".freeFlowOrg");if(evtNode.length>0){return}this.defer(function(){this._selectCate()},350)},buildValue:function(domContainer){domClass.replace(domContainer,"freeFlowFiledShow",domContainer.className);if(this.curIds!=null&&this.curIds!=""){var ids=this.curIds.split(this.splitStr);var names=this.curNames.split(this.splitStr);if(ids.length>0){this.addNodeInFreeFlow()}}this.updateFreeFlowNodes(domContainer);this.disconnect(this.orgIconClickHandle);if(this.cateFieldShowConnect){this.cateFieldShowConnect.remove();this.cateFieldShowConnect=null}var self=this;this.cateFieldShowConnect=this.connect(this.cateFieldShow,on.selector(".freeFlowOrgIcon","click"),function(evt){if(evt.stopPropagation){evt.stopPropagation()}if(evt.cancelBubble){evt.cancelBubble=true}if(evt.preventDefault){evt.preventDefault()}if(evt.returnValue){evt.returnValue=false}var nodes=query(evt.target).closest(".freeFlowOrg");nodes.forEach(function(orgDom){var id=orgDom.getAttribute("data-id");var node=lbpm.nodes[id];if(id=="N2"||node.handlerSelectType!="org"){return}var canEdit=false;if(node.Status=="1"&&node.isFixedNode!="true"){if(lbpm.nowNodeFlowPopedom=="2"){canEdit=true}else{if(lbpm.nowNodeFlowPopedom=="1"){if(lbpm.myAddedNodes.contains(node.id)){canEdit=true}}}}if(!canEdit){return}if(!lbpm.globals.canAddOtherNode(id)){return}if(!lbpm.globals.isCanEdit()){return}var nowTime=new Date().getTime();var clickTime=self.ctime;if(clickTime!="undefined"&&(nowTime-clickTime<500)){return false}self.ctime=nowTime;if(self.freeflowNodeAttributeDialog==null){self.freeflowNodeAttributeDialog=new freeflowNodeAttribute()}self.freeflowNodeAttributeDialog._selectCate({nodeId:id,state:"_update",template:false})},this)})},_buildOneOrg:function(domContainer,node){var isMulHandlers=false;if(node.handlerNames){if(node.handlerNames.split(";").length>1){isMulHandlers=true}}if(isMulHandlers){var icon=util.formatUrl(util.urlResolver(this.iconUrl,{orgId:""}));this.buildOrgNode(domContainer,node,icon)}else{var icon=util.formatUrl(util.urlResolver(this.iconUrl,{orgId:node.handlerSelectType=="org"?node.handlerIds:""}));this.buildOrgNode(domContainer,node,icon)}},buildOrgNode:function(domContainer,node,icon){var tmpOrgDom=this.buildNodeIcon(domContainer,node,icon);if(node.XMLNODENAME!="endNode"){if(node.XMLNODENAME!="splitNode"&&node.XMLNODENAME!="joinNode"&&node.XMLNODENAME!="robotNode"){this.buildNodeTypeIcon(tmpOrgDom,node)}if(node.XMLNODENAME!="joinNode"){this.buildDeleteIcon(tmpOrgDom,node)}this.buildArrowIcon(tmpOrgDom,node)}},buildDraftorNode:function(domContainer){var draftorId=$("[name='sysWfBusinessForm.fdDraftorId']")[0].value;if(this.curDraftorId){draftorId=this.curDraftorId}var draftorName=$("[name='sysWfBusinessForm.fdDraftorName']")[0].value;if(this.curDraftorName){draftorName=this.curDraftorName}var icon=util.formatUrl(util.urlResolver(this.iconUrl,{orgId:draftorId}));var tmpOrgDom=domConstruct.create("div",{className:"freeFlowOrg","data-id":"N2"},domContainer);domConstruct.create("div",{style:{background:"url("+icon+") center center no-repeat",backgroundSize:"cover",display:"inline-block"},className:"freeFlowOrgIcon"},tmpOrgDom);domConstruct.create("div",{className:"name",innerHTML:draftorName},tmpOrgDom);var iconUrl=util.formatUrl("/sys/lbpmservice/mobile/resource/image/draftNode.png");domConstruct.create("div",{style:{background:"url("+iconUrl+") center center no-repeat",backgroundSize:"cover",display:"block"},className:"nodeTypeIcon"},tmpOrgDom);if(lbpm.nowNodeId=="N2"){this.isPassedRoute=false}this.buildArrowIcon(tmpOrgDom,lbpm.nodes.N2);this.draftOrgDom=tmpOrgDom},_delteNode:function(srcObj){if(srcObj.nodeId&&srcObj.state=="_update"){this._delOneOrg(null,srcObj.nodeId)}},_delOneOrg:function(orgDom,id){this.inherited(arguments);this.deleteFreeFlowNode(id)},_queryImissiveAuthName:function(processId,nodeId){var imissiveTitle="";$.ajax({url:Com_Parameter.ContextPath+"sys/lbpmservice/support/lbpmNoteImissiveAuth.do?method=queryNodeImissiveAuth",type:"GET",async:false,data:{nodeId:nodeId,processId:processId},success:function(res){res=eval("("+res+")");if(res.nodeAuthName){imissiveTitle=res.nodeAuthName}}});return imissiveTitle},buildNodeIcon:function(domContainer,node,icon){if(node.XMLNODENAME=="endNode"){icon=util.formatUrl("/sys/lbpmservice/mobile/resource/image/endNode.png")}else{if(node.XMLNODENAME=="splitNode"){icon=util.formatUrl("/sys/lbpmservice/mobile/resource/image/splitNode.png")}else{if(node.XMLNODENAME=="joinNode"){icon=util.formatUrl("/sys/lbpmservice/mobile/resource/image/joinNode.png")}else{if(node.XMLNODENAME=="robotNode"){icon=util.formatUrl("/sys/lbpmservice/mobile/resource/image/robotNode.png")}}}}var tmpOrgDom=domConstruct.create("div",{className:"freeFlowOrg","data-id":node.id},domContainer);var freeFlowOrgIconNode=domConstruct.create("div",{style:{background:"url("+icon+") center center no-repeat",backgroundSize:"cover",display:"inline-block"},className:"freeFlowOrgIcon"},tmpOrgDom);if(node.XMLNODENAME=="robotNode"){domStyle.set(freeFlowOrgIconNode,"border","1px solid")}if(node.XMLNODENAME!="endNode"&&node.XMLNODENAME!="splitNode"&&node.XMLNODENAME!="joinNode"&&node.XMLNODENAME!="robotNode"){var nodeTitle=this._getNodeTitle(node);domConstruct.create("div",{className:"name",innerHTML:nodeTitle},tmpOrgDom);if(this._checkImissiveFlag()){var ruleSelectTitle=node.ruleSelectTitle;if(!ruleSelectTitle){ruleSelectTitle="";ruleSelectTitle=this._queryImissiveAuthName(lbpm.modelId,node.id);if(ruleSelectTitle){ruleSelectTitle="("+ruleSelectTitle+")"}}domConstruct.create("div",{className:"nameGw",innerHTML:ruleSelectTitle},tmpOrgDom)}}return tmpOrgDom},buildNodeTypeIcon:function(domContainer,node){var iconUrl=util.formatUrl("/sys/lbpmservice/mobile/resource/image/"+node.XMLNODENAME+".png");domConstruct.create("div",{style:{background:"url("+iconUrl+") center center no-repeat",backgroundSize:"cover",display:"block"},className:"nodeTypeIcon"},domContainer)},buildDeleteIcon:function(domContainer,node){var canDelete=false;if(node.Status=="1"&&node.isFixedNode!="true"){if(lbpm.nowNodeFlowPopedom=="2"){canDelete=true}else{if(lbpm.nowNodeFlowPopedom=="1"){if(lbpm.myAddedNodes.contains(node.id)){canDelete=true}}}}if(canDelete&&lbpm.globals.canAddOtherNode(node.id)){var delOrgDom=domConstruct.create("div",{className:"del mui mui-close"},domContainer);this.connect(delOrgDom,"touchend",function(evt){if(evt.stopPropagation){evt.stopPropagation()}if(evt.cancelBubble){evt.cancelBubble=true}if(evt.preventDefault){evt.preventDefault()}if(evt.returnValue){evt.returnValue=false}if(!lbpm.globals.isCanEdit()){return}var nodes=query(evt.target).closest(".freeFlowOrg");nodes.forEach(function(orgDom){var id=orgDom.getAttribute("data-id");this.defer(function(){var node=lbpm.nodes[id];if(!node){return}if(node.XMLNODENAME=="splitNode"){var self=this;Confirm(Msg["mui.freeFlow.splitNode.deleteMsg"],null,function(data){if(data){self._delOneOrg(orgDom,id)}},false)}else{this._delOneOrg(orgDom,id)}},300)},this)})}},buildArrowIcon:function(domContainer,node){var arrowUrl=util.formatUrl("/sys/lbpmservice/mobile/resource/image/arrowGoto.png");if(this.isPassedRoute){arrowUrl=util.formatUrl("/sys/lbpmservice/mobile/resource/image/arrowGone.png")}this.lastLineIcon=domConstruct.create("div",{style:{display:"block"},className:"nodeAddLine"},domContainer);if(node.Status!=lbpm.constant.STATUS_PASSED&&(lbpm.nowNodeFlowPopedom=="1"||lbpm.nowNodeFlowPopedom=="2")&&lbpm.globals.canAddOtherNode(node.id)){var className="nodeAddIcon mui mui-plus";this.lastNodeAddIcon=domConstruct.create("div",{style:{display:"block"},className:className},domContainer);this.connect(this.lastNodeAddIcon,"click",lang.hitch(this,function(evt){if(!lbpm.globals.isCanEdit()){return}var freeFlowOrgElem=query(evt.target).closest(".freeFlowOrg")[0];this.currentStartNodeId=domAttr.get(freeFlowOrgElem,"data-id");if(!this.nodeTypeDialog){this.dialogNode=domConstruct.toDom(this.addNodeTmpl);this.nodeTypeDialog=Dialog.element({canClose:false,showClass:"muiDialogElementShow muiFormSelect free_flow_NodeType",element:this.dialogNode,position:"bottom",scrollable:false,parseable:true,callback:lang.hitch(this,function(){this.nodeTypeDialog=null})})}}))}var nextNodeId=node.endLines[0].endNode.id;if(nextNodeId==lbpm.nowNodeId){this.isPassedRoute=false;query(".nodeAddIcon",query(".freeFlowFiledShow")[0]).style({display:"none"})}},_nodeTypeCancel:function(){if(this.nodeTypeDialog){this.nodeTypeDialog.hide();this.nodeTypeDialog=null}},_nodeTypeSelect:function(val){if(this.nodeTypeDialog){this.nodeTypeDialog.hide();this.nodeTypeDialog=null;this.currentNodeType=val;this._selectCate()}},buildOptIcon:function(optContainer){if(!this.showHeadImg){this.inherited(arguments)}this.muiCategoryAddNode=optContainer},_getNodeTitle:function(node){var handlerName=node.handlerNames;var dataNextNodeHandler;var nextNodeHandlerNames4View="";if(node.handlerSelectType=="formula"){dataNextNodeHandler=lbpm.globals.formulaNextNodeHandler(node.handlerIds,true,false)}else{if(node.handlerSelectType=="matrix"){dataNextNodeHandler=lbpm.globals.matrixNextNodeHandler(node.handlerIds,true,false)}else{if(node.handlerSelectType=="rule"){dataNextNodeHandler=lbpm.globals.ruleNextNodeHandler(node.id,node.handlerIds,true,false)}else{dataNextNodeHandler=lbpm.globals.parseNextNodeHandler(node.handlerIds,true,false)}}}for(var j=0;j<dataNextNodeHandler.length;j++){if(nextNodeHandlerNames4View==""){nextNodeHandlerNames4View=dataNextNodeHandler[j].name}else{nextNodeHandlerNames4View+=";"+dataNextNodeHandler[j].name}}if(nextNodeHandlerNames4View==""&&node.handlerIds!=null){nextNodeHandlerNames4View=lbpm.constant.COMMONNODEHANDLERORGNULL}if(nextNodeHandlerNames4View){handlerName=nextNodeHandlerNames4View}var handlerSize=handlerName.split(";").length;var nodeTitle=handlerName;if(handlerSize>1){if(node.XMLNODENAME=="reviewNode"){if(node.processType=="0"){nodeTitle=lang.replace(Msg["mui.freeFlow.reviewNode.processType_0.nodeTitle"],[handlerSize])}else{if(node.processType=="1"){nodeTitle=lang.replace(Msg["mui.freeFlow.reviewNode.processType_1.nodeTitle"],[handlerSize])}else{if(node.processType=="2"){nodeTitle=lang.replace(Msg["mui.freeFlow.reviewNode.processType_2.nodeTitle"],[handlerSize])}}}}else{if(node.XMLNODENAME=="signNode"){if(node.processType=="0"){nodeTitle=lang.replace(Msg["mui.freeFlow.signNode.processType_0.nodeTitle"],[handlerSize])}else{if(node.processType=="1"){nodeTitle=lang.replace(Msg["mui.freeFlow.signNode.processType_1.nodeTitle"],[handlerSize])}else{if(node.processType=="2"){nodeTitle=lang.replace(Msg["mui.freeFlow.signNode.processType_2.nodeTitle"],[handlerSize])}}}}else{if(node.XMLNODENAME=="sendNode"){nodeTitle=Msg["mui.freeFlow.sendNode.nodeTitle"]}}}}return nodeTitle},_updateNode:function(srcObj){if(srcObj.nodeId&&srcObj.state=="_update"){var FlowChartObject=this.getFlowChartObject();this.updateFlowXml(FlowChartObject);var node=lbpm.nodes[srcObj.nodeId];if(!node){return}var icon="";var isMulHandlers=false;if(node.handlerNames){if(node.handlerNames.split(";").length>1){isMulHandlers=true}}if(isMulHandlers){var icon=util.formatUrl(util.urlResolver(this.iconUrl,{orgId:""}))}else{var icon=util.formatUrl(util.urlResolver(this.iconUrl,{orgId:node.handlerSelectType=="org"?node.handlerIds:""}))}var orgIconDom=query(".freeFlowOrg[data-id='"+srcObj.nodeId+"']").children(".freeFlowOrgIcon")[0];domStyle.set(orgIconDom,"background","url("+icon+") center center / cover no-repeat");var nameDom=query(".freeFlowOrg[data-id='"+srcObj.nodeId+"']").children(".name")[0];nameDom.innerText=this._getNodeTitle(lbpm.nodes[srcObj.nodeId])}},returnDialog:function(srcObj,evt){if(srcObj.key==this.idField){this.inherited(arguments);this.curIds="";this.curNames=""}},addNodeInFreeFlow:function(){var FlowChartObject=this.getFlowChartObject();if(FlowChartObject){var endNodeObj=FlowChartObject.Nodes.GetNodeById("N3");var newNodeObj,beginNode;beginNode=endNodeObj.LineIn[0].StartNode;if(this.currentStartNodeId){beginNode=FlowChartObject.Nodes.GetNodeById(this.currentStartNodeId)}var ids=this.curIds.split(this.splitStr);var names=this.curNames.split(this.splitStr);if(ids.length>0){if(lbpm.freeFlow.defOperRefIds.length==0||!lbpm.freeFlow.defFlowPopedom){var data=new KMSSData();data.AddBeanData("getOperTypesByNodeService&nodeType=freeFlowReviewNode");data=data.GetHashMapArray();for(var j=0;j<data.length;j++){if(data[j].isDefault=="true"){lbpm.freeFlow.defOperRefIds.reviewNode=data[j].value;break}}data=new KMSSData().AddBeanData("getOperTypesByNodeService&nodeType=freeFlowSignNode");data=data.GetHashMapArray();for(var j=0;j<data.length;j++){if(data[j].isDefault=="true"){lbpm.freeFlow.defOperRefIds.signNode=data[j].value;break}}lbpm.freeFlow.defFlowPopedom=(Lbpm_SettingInfo.defaultFlowPopedom>lbpm.nodes[lbpm.nowNodeId].flowPopedom)?lbpm.nodes[lbpm.nowNodeId].flowPopedom:Lbpm_SettingInfo.defaultFlowPopedom}var nodeList=[];if(beginNode.Type=="splitNode"){nodeList=FlowChartObject.Nodes.spitNodecreateFreeFlow(beginNode,"reviewNode",true,{handlerType:this.currentNodeType,handlerIds:this.curIds,handlerNames:this.curNames})}else{nodeList=FlowChartObject.Nodes._CreateFreeFlowSpitMore({handlerType:this.currentNodeType,handlerIds:this.curIds,handlerNames:this.curNames},beginNode,"reviewNode",true)}for(var i=0;i<nodeList.length;i++){var newNodeObj=nodeList[i];lbpm.myAddedNodes.push(newNodeObj.Data.id);if(newNodeObj.Type=="reviewNode"||newNodeObj.Type=="signNode"){newNodeObj.Data.operations["refId"]=lbpm.freeFlow.defOperRefIds[newNodeObj.Type];newNodeObj.Data.flowPopedom=lbpm.freeFlow.defFlowPopedom;newNodeObj.Data.canAddAuditNoteAtt=Lbpm_SettingInfo.isCanAddAuditNoteAtt;newNodeObj.Data.canModifyMainDoc=Lbpm_SettingInfo.isEditMainDocument;newNodeObj.Data.processType="2"}newNodeObj.Data.notifyType=Lbpm_SettingInfo.defaultNotifyType}beginNode=newNodeObj}this.updateFlowXml(FlowChartObject);topic.publish("/sys/lbpmservice/freeflow/___addNode",this,{nodes:nodeList,handlerType:this.currentNodeType})}},updateFreeFlowNodes:function(domContainer){this.getChildren().forEach(function(wgt,index){wgt.destroy()});domConstruct.empty(domContainer);lbpm.freeFlow.nextNodes=[];this.isPassedRoute=true;this.buildDraftorNode(domContainer);this.appendFreeFlowNode(domContainer,lbpm.nodes.N2,[]);this.validation.validateElement(this);var self=this;parser.parse(domContainer).then(function(){self.formatNodes()})},appendFreeFlowNode:function(domContainer,nodeObj,nodeIds){for(var i=0;i<nodeObj.endLines.length;i++){var nodeId=nodeObj.endLines[i].endNode.id;if((nodeIds.join(";")+";").indexOf(nodeId+";")>-1){return}nodeIds.push(nodeId);var node=lbpm.nodes[nodeId];this._buildOneOrg(domContainer,node);if(!this.edit){domConstruct.create("span",{innerHTML:this.splitStr},domContainer)}if(node.XMLNODENAME=="splitNode"||node.XMLNODENAME=="joinNode"){var tmpl=this.nodeTmpl.replace("!{nodeId}",nodeId);var addAreaDom=domConstruct.toDom(tmpl);domConstruct.place(addAreaDom,domContainer,"last")}this.appendFreeFlowNode(domContainer,node,nodeIds)}},formatNodes:function(){var self=this;var FlowChartObject=this.getFlowChartObject();if(FlowChartObject&&FlowChartObject.Nodes&&FlowChartObject.Nodes.GetNodeById&&FlowChartObject.Nodes.GetNodeById("N2")){if(FlowChartObject.Nodes.all&&FlowChartObject.Nodes.all[FlowChartObject.Nodes.all.length-1]&&FlowChartObject.Nodes.all[FlowChartObject.Nodes.all.length-1].Level==0){FlowChartObject.Nodes.FlowChart_formatNodes()}var heights=this.getNodeHeight(FlowChartObject.Nodes.all);for(var i=0;i<FlowChartObject.Nodes.all.length;i++){var node=FlowChartObject.Nodes.all[i];var nodeDom=query(".freeFlowOrg[data-id='"+node.Data.id+"']");if(nodeDom.length>0){var x=node.Data.y-140<=0?0:(node.Data.y-140)/80*95;domStyle.set(nodeDom[0],{left:x+"px",top:node.Data.x/2-heights.minHeight+"px"});domAttr.set(nodeDom[0],"data-left",x);domAttr.set(nodeDom[0],"data-top",node.Data.x/2-heights.minHeight)}}domStyle.set(this.containerNode,{height:heights.maxHeight+10+"px"});topic.publish("/sys/lbpmservice/freeflow/formatNodeFinish",this)}else{this.defer(function(){self.formatNodes()},100)}},getNodeHeight:function(nodes){var maxHeight=0;var minHeight=999999;for(var i=0;i<nodes.length;i++){var node=nodes[i];if(maxHeight<node.Data.x/2){maxHeight=node.Data.x/2}if(minHeight>node.Data.x/2){minHeight=node.Data.x/2}}return{maxHeight:maxHeight,minHeight:minHeight}},deleteFreeFlowNode:function(id){this.delNodeInFreeFlow(id);this.validation.validateElement(this)},delNodeInFreeFlow:function(nodeId){var FlowChartObject=this.getFlowChartObject();var delNodeObj=FlowChartObject.Nodes.GetNodeById(nodeId);if(delNodeObj){FlowChartObject.Nodes.deleteNodeInFreeFlow(delNodeObj,true);this.updateFlowXml(FlowChartObject);this.updateFreeFlowNodes(this.cateFieldShow)}},getFlowChartObject:function(){var iframe=document.getElementById("WF_IFrame");return iframe.contentWindow.FlowChartObject},updateFlowXml:function(FlowChartObject){var flowXml=FlowChartObject.BuildFlowXML();if(!flowXml){return}var processXMLObj=document.getElementsByName("sysWfBusinessForm.fdFlowContent")[0];processXMLObj.value=flowXml;lbpm.globals.parseXMLObj();lbpm.modifys={};$("input[name='sysWfBusinessForm.fdIsModify']")[0].value="1";lbpm.events.mainFrameSynch()},onTouchEnd:function(e){}});return freeflowNodes})},"sys/lbpmservice/mobile/import/script":function(){define(["dojo/dom-construct","dojo/query","mui/util","dojo/request","dijit/registry","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","dojo/query","dojo/dom-construct"],function(b,i,a,f,c,h,d,i,b){function g(m,k){var n=a.getUrlParameter(m,"fdId");var j=a.formatUrl("/sys/lbpmservice/support/lbpmHistoryWorkitemAction.do?method=updateIsLook");f.post(j,{handleAs:"json",data:{fdModelId:n}});function l(){$("#operationsRow_Scope").closest("div.actionCenter").show();if($("#assignOprRow").length==0){var q='<div id="assignOprRow">';q+='<div class="titleNode" id="assignOprTitle" lbpmdetail="operation">'+d["lbpmAssign.fdOperType.assign"]+"</div>";q+='<div class="detailNode" id="assignOprContent" lbpmdetail="operation">';q+="</div></div>";$("#operationsRow_Scope").after(q);var p={mulSelect:true,idField:"assigneeIds",nameField:"assigneeNames",splitStr:";",selectType:ORG_TYPE_PERSON|ORG_TYPE_POST,notNull:false,exceptValue:document.getElementById("sysWfBusinessForm.fdHandlerRoleInfoIds").value.split(";"),text:lbpm.constant.SELECTORG};var r="";r+=lbpm.address.html_build(p);r+="<div class='canMultiAssign'>";r+='<div id="canMultiAssign" alertText="" key="canMultiAssign" data-dojo-type="mui/form/CheckBox"';r+=" data-dojo-props=\"name:'canMultiAssign', value:'true', mul:false, text:'";r+=h["lbpmNode.processingNode.operationsTDTitle_Scope.allow.muti"]+d["lbpmAssign.fdOperType.assign"];r+="'\"></div>";r+="</div>";i("#assignOprContent").html(r,{parseContent:true})}}lbpm.events.addListener(lbpm.constant.EVENT_CHANGEOPERATION,function(){if(lbpm.nowNodeId&&(lbpm.nodes[lbpm.nowNodeId]["canAssign"]!="true"||lbpm.nodes[lbpm.nowNodeId].endLines[0].endNode.id=="N3")){return}if(lbpm.currentOperationType=="handler_pass"){l();lbpm.globals.hiddenObject($("#assignOprRow")[0],false)}else{lbpm.globals.hiddenObject($("#assignOprRow")[0],true)}});lbpm.events.addListener(lbpm.constant.EVENT_SETOPERATIONPARAM,function(){if(lbpm.nowNodeId&&(lbpm.nodes[lbpm.nowNodeId]["canAssign"]!="true"||lbpm.nodes[lbpm.nowNodeId].endLines[0].endNode.id=="N3")){return}if(lbpm.currentOperationType=="handler_pass"){if(i("#assigneeIds")[0].value){var p={};p.toAssigneeIds=$("#assigneeIds")[0].value;var q=c.byId("canMultiAssign");if(q){p.canMultiAssign=q.get("checked")}lbpm.globals.setOperationParameterJson(JSON.stringify(p),"assignParam","param")}}});k()}return{load:function(l,j,k){g(l,k)}}})},"sys/lbpmservice/mobile/freeflow/NodeHandlersListItem":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/dom-attr","dojo/dom-style","dijit/_WidgetBase","dojo/topic","mui/util","dojo/dom","dojo/query"],function(j,f,a,m,b,l,i,d,h,g,c,k){return f("sys.lbpmservice.mobile.freeflow.NodeHandlersListItem",[d],{key:null,text:"",value:"",nodeId:"",canEdit:false,iconUrl:"/sys/lbpmservice/mobile/freeflow/image.jsp?orgId=!{orgId}",buildRendering:function(){this.inherited(arguments);this.optionContainerNode=b.create("label",{className:"muiListItem",innerHTML:g.formatText(this.text)},this.domNode);var p=g.formatUrl(g.urlResolver(this.iconUrl,{orgId:this.value}));b.create("div",{style:{background:"url("+p+") center center no-repeat",backgroundSize:"cover"},className:"muiAddressOrgIcon"},this.optionContainerNode,"first");if(this.canEdit){var q=b.create("div",{style:{cssFloat:"right",width:"2.2rem",textAlign:"center"}},this.optionContainerNode,"last");var n=b.create("div",{className:"del mui mui-close"},q,"last");this.connect(q,"click",function(r){if(r.stopPropagation){r.stopPropagation()}if(r.cancelBubble){r.cancelBubble=true}if(r.preventDefault){r.preventDefault()}if(r.returnValue){r.returnValue=false}if(k("._nodeHandlerListItem").length<=1){return}this.destroy()})}},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments)}})})},"sys/lbpmservice/mobile/workitem/TransactionTabBarBtn":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/dom-construct","dojo/dom-class","dojo/dom-style","dojo/dom-prop","dojo/topic","dojo/_base/lang","dojo/query","dojo/_base/array"],function(f,d,c,l,h,a,g,b,k,i){var j=f("sys.lbpmservice.mobile.workitem.TransactionTabBarBtn",[d],{tabBar:null,options:[],isExpand:false,curTaskId:"",buildRendering:function(){this.inherited(arguments);c.place(this.domNode,this.tabBar.domNode,"before");l.add(this.domNode,"transactionBar");this.headNode=c.create("div",{className:"transactionHead"},this.domNode);this.renderHead(this.headNode);this.contentNode=c.create("div",{className:"transactionContent"},this.domNode);this.ulContentNode=c.create("ul",{},this.contentNode);this.renderContent();this.expand(this.isExpand);var p=k("li",this.ulContentNode);if(p.length>0){for(var m=0;m<p.length;m++){var n=a.get(p[m],"data-transactionid");if(this.curTaskId==n){this.chooseItem(p[m])}}}},postCreate:function(){this.inherited(arguments);this.subscribe("/mui/navitem/_selected","packUp");this.subscribe("/mui/tabbar/switch","packUp")},renderHead:function(m){var n=c.create("span",{},m);n.innerHTML="事务(<span class='striking'>"+this.options.length+"</span>):";this.textNode=c.create("span",{className:"text"},m);this.expandNode=c.create("span",{className:"striking icon mui"},m);this.connect(this.expandNode,"click",b.hitch(this,function(p){this.isExpand=!this.isExpand;this.expand(this.isExpand)}))},renderContent:function(s){for(var p=0;p<this.options.length;p++){var r=this.options[p];var m=c.create("li",{},this.ulContentNode);var t=false;var u=r.text;var q=new RegExp("^N.");if(q.test(u)){var n=u.substring(u.indexOf("N"),u.indexOf(".")+1);u=u.replace(n,"");if(lbpm&&lbpm.settingInfo){if(lbpm.settingInfo.isHideNodeIdentifier==="true"&&lbpm.settingInfo.hideNodeIdentifierType==="isHideAllNodeIdentifier"){t=true}}}m.innerHTML=t?u:r.text;this.connect(m,"click",b.hitch(this,function(v){var w=v.target;this.chooseItem(w)}));a.set(m,"data-transactionid",r.value)}},expand:function(m){if(m){this.expandNode.innerHTML="收起";l.remove(this.expandNode,"mui-up-n");l.add(this.expandNode,"mui-down-n");h.set(this.textNode,"display","none");l.add(this.contentNode,"expand")}else{this.expandNode.innerHTML="伸展";l.remove(this.expandNode,"mui-down-n");l.add(this.expandNode,"mui-up-n");h.set(this.textNode,"display","inline-block");l.remove(this.contentNode,"expand")}},chooseItem:function(n){this.packUp();var m=n.innerHTML;var p=k("li",this.ulContentNode);i.forEach(p,function(q){l.remove(q,"active")});l.add(n,"active");this.textNode.innerHTML=m;g.publish("/lbpm/operation/switch",this,{methodSwitch:false,value:a.get(n,"data-transactionid"),label:m})},packUp:function(){this.isExpand=false;this.expand(this.isExpand)}});return j})},"sys/lbpm/engine/node/splitnode/node_desc":function(){(function(b){b.splitNodeDesc.getLines=a;function a(d,f,c){return f.endLines}})(lbpm.nodedescs)},"sys/lbpmservice/mobile/freeflow/freeflowNodeOkBtnGw":function(){define(["dojo/_base/declare","mui/tabbar/TabBarButton","dojo/topic","dojo/query","sys/lbpmservice/mobile/freeflow/freeflowNodeAttrGw"],function(f,a,c,g,b){var d=f("sys.lbpmservice.mobile.freeflow.freeflowNodeOkBtnGw",[a],{rtn:{},onClick:function(){var q=this.getFlowChartObject();var v=this.handlerType;for(var k in this.rtn){var j=this.getNodes(k);if(!j){continue}var u=this.rtn[k]["handlerRule"];if(u=="0"){c.publish("/sys/lbpmservice/freeflow/imissiveok",this);return}var h=this.getRuleSource(u);var p=h[0][0].ruleVal[0].fdAdditionRule;if(p){p=JSON.parse(p);for(var m in p){var r=new Array();if(p[m].key){r.XMLNODENAME="variant";r.name=p[m].key;r.value="true";if(!j.Data.variants){j.Data.variants=[]}j.Data.variants[m]=r}}}var t=h[0][0].ruleVal[0].fdNodeRule;if(t){t=JSON.parse(t);this.imissiveNodeRule(t,j)}j.Data.opinionType=this.rtn[k]["opinionType"];var n=this.rtn[k]["handlerRuleTitle"];if(n){if(j.Data.name.indexOf(n)==-1){j.Data.name="("+n+") "+j.Data.name}if(j.Data.langs){var l=JSON.parse(j.Data.langs);if(l.nodeName&&_userLang){for(var s=0;s<l.nodeName.length;s++){if(l.nodeName[s]["lang"]==_userLang){l.nodeName[s]["value"]=j.Data.name;break}}j.Data.langs=JSON.stringify(l)}}j.Data.ruleSelectTitle="("+n+")"}}this.updateFlowXml(q);if(!this._CLICK_FLAG){return}c.publish("/sys/lbpmservice/freeflow/imissiveokMsg",this.rtn);c.publish("/sys/lbpmservice/freeflow/imissiveok",this)},postCreate:function(){this.subscribe("mui/form/select/callback","_selectChangeGw");this.subscribe("/sys/lbpmservice/freeflow/attrValGw","_attrValGw");this.subscribe("/sys/lbpmservice/freeflow/imissiveChangeVal","_imissiveChangeVal")},_imissiveChangeVal:function(n,j){var r=n.value;var h=this.getRuleSource(r);var q=h[0][0].ruleVal[0].fdNodeRule;var p="";if(n.state!="undefined"){p=n.state}var l="#gw_Select_"+p;if(q){q=JSON.parse(q);var i=q.opinionType;var k=g(l)[0];if(i){g("[name='_freeflowNodeGwType_"+p+"']",k).val(i);var m=this.ImNodeTypeText(i);g(".muiSelInput",k).html(m);this.rtn[j]["opinionType"]=i}else{g("[name='_freeflowNodeGwType_"+p+"']",k).val("");g(".muiSelInput",k).html("");this.rtn[j]["opinionType"]=""}}},ImNodeTypeText:function(j){var i="";var h=Com_Parameter.ContextPath+"sys/lbpmservice/support/lbpm_audit_note_type/lbpmAuditNoteType.do?method=getNodeTypeTextByVal";$.ajax({url:h,data:{value:j},async:false,type:"POST",dataType:"json",success:function(k){if(k){i=k.text}},error:function(k){console.log(k)}});return i},_attrValGw:function(h){this.rtn=h},_selectChangeGw:function(i){var k="_freeflowNodeGwRule_";var h="_freeflowNodeGwType_";if((i.name)&&(i.name.indexOf(k)>-1||i.name.indexOf(h)>-1)){var m=i.nodeId;var j=this.getNodes(m);if(!this.rtn){this.rtn={}}if(!this.rtn[m]){this.rtn[m]={}}if(!j){return}if(i.name.indexOf(k)>-1){var l=$(i).next();this.rtn[m]["handlerRule"]=i.value;this.rtn[m]["handlerRuleTitle"]=i.text;c.publish("/sys/lbpmservice/freeflow/imissiveChangeVal",i,m)}else{if(i.name.indexOf(h)>-1){this.rtn[m]["opinionType"]=i.value}}}},getRuleSource:function(i){var j="";var h=Com_Parameter.ContextPath+"km/imissive/km_imissive_rule/kmImissiveRule.do?method=getRuleSource";$.ajax({url:h,data:{ruleId:i},async:false,type:"POST",dataType:"json",success:function(k){if(k){j=k}},error:function(k){}});return j},getNodes:function(j){var i=document.getElementById("WF_IFrame");var h=i.contentWindow.FlowChartObject;return h.Nodes.GetNodeById(j)},getNode:function(){var i=document.getElementById("WF_IFrame");var h=i.contentWindow.FlowChartObject;return h.Nodes.GetNodeById(this.nodeId)},getFlowChartObject:function(){var h=document.getElementById("WF_IFrame");return h.contentWindow.FlowChartObject},updateFlowXml:function(h){var j=h.BuildFlowXML();if(!j){return}var i=document.getElementsByName("sysWfBusinessForm.fdFlowContent")[0];i.value=j;lbpm.globals.parseXMLObj();lbpm.modifys={};$("input[name='sysWfBusinessForm.fdIsModify']")[0].value="1";lbpm.events.mainFrameSynch()},imissiveNodeRule:function(j,i){if(j.opinionConfig){i.Data.opinionConfig=j.opinionConfig}else{i.Data.opinionConfig="flase"}if(j.canAddAuditNoteAtt){i.Data.canAddAuditNoteAtt=j.canAddAuditNoteAtt}else{i.Data.canAddAuditNoteAtt="false"}if(j.canModifyMainDoc==""){i.Data.canModifyMainDoc="false"}else{i.Data.canModifyMainDoc=j.canModifyMainDoc}i.Data.flowPopedom=j.flowPopedom;i.Data.notifyType=j.notifyType;var h=j.ignoreOnHandlerSame;if(h=="1"){i.Data.ignoreOnHandlerSame="true";i.Data.adjoinHandlerSame="true";i.Data.ignoreOnFutureHandlerSame="false"}else{if(h=="2"){i.Data.ignoreOnHandlerSame="true";i.Data.adjoinHandlerSame="false";i.Data.ignoreOnFutureHandlerSame="false"}else{if(h=="3"){i.Data.ignoreOnHandlerSame="false";i.Data.adjoinHandlerSame="false";i.Data.ignoreOnFutureHandlerSame="true"}else{i.Data.ignoreOnHandlerSame="false";i.Data.adjoinHandlerSame="false";i.Data.ignoreOnFutureHandlerSame="false"}}}}});return d})},"sys/lbpmservice/mobile/workitem/CommonUsageViewMixin":function(){define(["dojo/_base/declare","mui/NativeView","dojox/mobile/ScrollableView","dojo/topic","mui/list/StoreElementScrollableView","dojo/dom-style"],function(f,a,g,c,b,d){return f("sys.lbpmservice.mobile.workitem.CommonUsageView",null,{postCreate:function(){this.subscribe("/lbpm/commonUsageView/changStatus","changeStatus");this.inherited(arguments)},changeStatus:function(){this.status=true},onBeforeTransitionIn:function(){if(!this.status){c.publish("/lbpm/operation/hideDialog");c.publish("/workitem/commonUsage/hideDialog")}else{this.status=false}this.inherited(arguments)},onAfterTransitionOut:function(){if(!this.status){c.publish("/lbpm/operation/showDialog");c.publish("/workitem/commonUsage/showDialog")}else{this.status=false}this.inherited(arguments)}})})},"sys/lbpmservice/mobile/freeflow/freeflowNodeAttr":function(){define(["dojo/dom-construct","dojo/_base/declare","dojo/dom-style","mui/form/Address","dojo/topic","dojo/query","dojo/dom-attr","dojo/parser","mui/dialog/Confirm","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/form/validate/Validation","dojo/_base/window","dojox/mobile/sniff"],function(d,f,j,n,h,l,k,a,m,c,b,i,p){var g=f("sys.lbpmservice.mobile.freeflow.freeflowNodeAttr",[n],{type:ORG_TYPE_POSTORPERSON,attType:"",title:"",isMul:true,showStatus:"edit",_cateDialogPrefix:"__freeflowNodeAttr__",idField:"__freeflowNodeAttribute__",selectTemp:'<div data-dojo-type=\'mui/form/Select\' data-dojo-props=\'name:"!{name}",value:"!{value}",mul:!{mul},store:!{store},state:"!{state}",nodeId:"!{nodeId}"\'></div>',switchTemp:'<div data-dojo-type=\'sys/mobile/js/mui/form/switch/NewSwitch\' data-dojo-props=\'name:"!{name}",leftLabel:"!{leftLabel}",rightLabel:"!{rightLabel}",showStatus:"!{showStatus}",mystate:"!{mystate}",nodeId:"!{nodeId}"\' value=\'!{value}\'></div>',buildRendering:function(){if(this.attType!="delBtn"){this.idField+=this.attType;this.idField+=this.nodeId}this.inherited(arguments);this._cateDialogPrefix=this._cateDialogPrefix+this.attType;d.empty(this.domNode);var q=this.getTitle();if(this.attType=="handler"||this.attType=="delBtn"){this.titleNode=d.create("span",{innerHTML:q},this.domNode);if(this.attType=="handler"){d.create("span",{className:"muiFormRequired muiFormRequiredShow muiFormHandlerRequired",innerHTML:"*"},this.domNode);d.create("i",{className:"fontmuis muis-to-right free_flow_handler_to_right"},this.domNode)}}else{if(this.isNotExitAttr()){return}if(this.attType=="isFixedNode"||this.attType=="canJump"){this.buildSwitchDom()}else{this.buildSelectDom()}}},buildSwitchDom:function(){var q=this.switchTemp.replace("!{name}",this.idField).replace("!{value}",this.value).replace("!{showStatus}",this.showStatus).replace("!{mystate}",this.state).replace("!{nodeId}",this.nodeId).replace("!{leftLabel}",this.leftLabel).replace("!{rightLabel}",this.rightLabel);var r=d.toDom(q);d.place(r,this.domNode,"last");a.parse(this.domNode).then(function(){i.doc.dojoClick=!p("ios")||p("ios")>13})},buildSelectDom:function(){var q=this.selectTemp.replace("!{name}",this.idField).replace("!{value}",this.value).replace("!{mul}",this.mul).replace("!{store}",this.store).replace("!{showStatus}",this.showStatus).replace("!{state}",this.state).replace("!{nodeId}",this.nodeId);var r=d.toDom(q);d.place(r,this.domNode,"last");a.parse(this.domNode).then(function(){i.doc.dojoClick=!p("ios")||p("ios")>13})},startup:function(){if(this.isNotExitAttr()){var q=l(this.domNode).closest(".free_flow_nodeAttribute_item");this.destroy();q.remove();return}this.inherited(arguments);if(this.attType=="handler"){new b().hideWarnHint(this)}},postCreate:function(){if(this.isNotExitAttr()){return}this.inherited(arguments);if(this.attType=="handler"||this.attType=="delBtn"){this.connect(this.domNode,"click",this.domNodeClick)}else{if(this.isNotExitAttr()){return}if(this.attType=="isFixedNode"||this.attType=="canJump"){this.subscribe("mui/switch/statChanged","_statChanged")}else{this.subscribe("mui/form/select/callback","_selectChange")}}},domNodeClick:function(){var t=new Date().getTime();var r=this.ctime;if(r!="undefined"&&(t-r<500)){return false}this.ctime=t;if(this.attType=="handler"){this._selectCate()}else{if(this.attType=="delBtn"){var q=this;var s=this.getNode();if(s&&s.Data.handlerIds){var q=this;m(c["mui.freeFlow.node.deleteMsg"],null,function(u){if(u){h.publish("/sys/lbpmservice/freeflow/_delteNode",q)}},false)}else{h.publish("/sys/lbpmservice/freeflow/_delteNode",q)}}}},buildValue:function(q){d.empty(q);if(this.titleNode&&this.attType=="handler"){k.set(this.titleNode,"innerHTML",this.formatHandlerNames(this.curNames));var r=this.getNode();if(this.curIds!=r.Data.flowPopedom){h.publish("/sys/lbpmservice/freeflow/attrValueChange",this,{handlerIds:this.curIds,handlerNames:this.curNames})}}},getTitle:function(){var q=this.getNode();var y="";if(q){if(this.attType=="isFixedNode"){this.leftLabel="";this.rightLabel="";var r=q.Data.isFixedNode||"false";if(r=="true"){this.value="on"}else{this.value="off"}if(!this.template){this.showStatus="view"}}else{if(this.attType=="handler"){var C=q.Data.handlerNames;if(C){this.curNames=C}if(q.Data.handlerIds){this.curIds=q.Data.handlerIds}y=this.formatHandlerNames(C);if(this.isSendNode()){this.type=ORG_TYPE_ALL}}else{if(this.attType=="processType"){var D=q.Data.processType;var B=[{text:c["mui.freeFlow.lbpm.node.processType_0"],value:"0"},{text:c["mui.freeFlow.lbpm.node.processType_1"],value:"1"},{text:c["mui.freeFlow.lbpm.node.processType_2."+q.Data.XMLNODENAME],value:"2"}];this.store=JSON.stringify(B);this.value=D;this.mul=false}else{if(this.attType=="handlerSameSelect"){var t=q.Data.ignoreOnHandlerSame;var z=q.Data.onAdjoinHandlerSame;var x=q.Data.ignoreOnFutureHandlerSame;if(t==null){t="true"}if(z==null){z="true"}if(x==null){x="false"}var u="1";if(t=="true"){if(z=="true"){u="1"}else{u="2"}}else{if(x=="true"){u="3"}else{u="0"}}var B=[{text:c["mui.freeFlow.node.onAdjoinHandlerSame"],value:"1"},{text:c["mui.freeFlow.node.onSkipHandlerSame"],value:"2"},{text:c["mui.freeFlow.node.ignoreOnHandlerSame"],value:"0"},{text:c["mui.freeFlow.node.ignoreOnFutureHandlerSame"],value:"3"}];this.store=JSON.stringify(B);this.value=u;this.mul=false}else{if(this.attType=="canJump"){this.leftLabel="";this.rightLabel="";var s=q.Data.canJump||"false";if(s=="true"){this.value="on"}else{this.value="off"}}else{if(this.attType=="notifyType"){var v=new KMSSData();v.AddBeanData("getNotifyTypeService");v=v.GetHashMapArray();this.store=v[0]["store"];if(q.Data.notifyType){this.value=q.Data.notifyType}else{this.value=""}this.mul=true}else{if(this.attType=="popedom"){var B=[{text:c["mui.freeFlow.node.canModifyMainDoc"],value:"0"},{text:c["mui.freeFlow.node.canAddAuditNoteAtt"],value:"1"}];this.store=JSON.stringify(B);var A="";if(q.Data.canModifyMainDoc=="true"){A+="0;"}if(q.Data.canAddAuditNoteAtt=="true"){A+="1;"}if(A){this.value=A.substring(0,A.length-1)}this.mul=true}else{if(this.attType=="flowPopedom"){var B=[{text:c["mui.freeFlow.node.flowPopedom_0"],value:"0"},{text:c["mui.freeFlow.node.flowPopedom_1"],value:"1"}];if(this.template||(!this.template&&lbpm.nowNodeFlowPopedom=="2")){B.push({text:c["mui.freeFlow.node.flowPopedom_2"],value:"2"})}this.store=JSON.stringify(B);this.value=q.Data.flowPopedom;this.mul=false}else{if(this.attType=="opinionType"){var B="";var w=Com_Parameter.ContextPath+"sys/lbpmservice/support/lbpm_audit_note_type/lbpmAuditNoteType.do?method=queryAllAuditNoteTypeByName";$.ajax({url:w,data:{keyName:"text",valueName:"value"},async:false,type:"POST",dataType:"json",success:function(E){if(E){B=E}},error:function(E){}});this.store=JSON.stringify(B);this.mul=false;this.value=q.Data.opinionType}else{if(this.attType=="delBtn"){y=c["mui.freeFlow.node.delete"]}}}}}}}}}}}return y},getNode:function(){var r=document.getElementById("WF_IFrame");var q=r.contentWindow.FlowChartObject;return q.Nodes.GetNodeById(this.nodeId)},isSendNode:function(){var q=this.getNode();if(q){return q.Type=="sendNode"}return false},isSignNode:function(){var q=this.getNode();if(q){return q.Type=="signNode"}return false},isImissiveModel:function(){return lbpm.modelName=="com.landray.kmss.km.imissive.model.KmImissiveSendMain"||lbpm.modelName=="com.landray.kmss.km.imissive.model.KmImissiveReceiveMain"||lbpm.modelName=="com.landray.kmss.km.imissive.model.KmImissiveSignMain"},isNotExitAttr:function(){if(this.isImissiveModel()){return this.isSendNodeNoHasAttr()||this.isSignNodeNoHasAttr()}else{return this.isImissiveModelAttr()||this.isSendNodeNoHasAttr()||this.isSignNodeNoHasAttr()}},isImissiveModelAttr:function(){return this.attType=="opinionType"},isSignNodeNoHasAttr:function(){return this.isSignNode()&&(this.attType=="canJump"||this.attType=="opinionType")},isSendNodeNoHasAttr:function(){return this.isSendNode()&&(this.attType=="processType"||this.attType=="canJump"||this.attType=="popedom"||this.attType=="flowPopedom"||this.attType=="handlerSameSelect"||this.attType=="opinionType")},formatHandlerNames:function(s){var q=c["mui.freeFlow.node.select"];if(s){var t=s.split(";");if(t.length>2){var r=t.length;q=t[0]+";"+t[1];if(q.length>10){q=q.substring(0,10)+"..."}q+=c["mui.freeFlow.node.more"]+r+c["mui.freeFlow.node.person"]}else{q=t.join(";");if(q.length>10){q=q.substring(0,10)+"..."}}}return q},_statChanged:function(q,t){if(q.name==this.idField&&q.mystate==this.state){var s=this.getNode();if(!s){return}if(this.attType=="isFixedNode"){var r=t?"true":"false";if(r!=s.Data.isFixedNode){h.publish("/sys/lbpmservice/freeflow/attrValueChange",this,{isFixedNode:r})}}else{if(this.attType=="canJump"){var r=t?"true":"false";if(r!=s.Data.canJump){h.publish("/sys/lbpmservice/freeflow/attrValueChange",this,{canJump:r})}}}}},_selectChange:function(q){if(q.name==this.idField&&q.state==this.state){var x=this.getNode();if(!x){return}if(this.attType=="processType"){if(q.value!=x.Data.processType){h.publish("/sys/lbpmservice/freeflow/attrValueChange",this,{processType:q.value})}}else{if(this.attType=="notifyType"){if(q.value!=x.Data.notifyType){h.publish("/sys/lbpmservice/freeflow/attrValueChange",this,{notifyType:q.value})}}else{if(this.attType=="popedom"){var r=q.value.indexOf("0")>-1?"true":"false";var s=q.value.indexOf("1")>-1?"true":"false";if(r!=x.Data.canModifyMainDoc||s!=x.Data.canAddAuditNoteAtt){var w={canModifyMainDoc:r,canAddAuditNoteAtt:s};h.publish("/sys/lbpmservice/freeflow/attrValueChange",this,w)}}else{if(this.attType=="flowPopedom"){if(q.value!=x.Data.flowPopedom){h.publish("/sys/lbpmservice/freeflow/attrValueChange",this,{flowPopedom:q.value})}}else{if(this.attType=="opinionType"){if(q.value!=x.Data.opinionType){h.publish("/sys/lbpmservice/freeflow/attrValueChange",this,{opinionType:q.value})}}else{if(this.attType=="handlerSameSelect"){var v="true";var u="true";var t="false";if(q.value=="1"){v="true";u="true";t="false"}else{if(q.value=="2"){v="true";u="false";t="false"}else{if(q.value=="3"){v="false";u="false";t="true"}else{v="false";u="false";t="false"}}}if(v!=x.Data.ignoreOnHandlerSame||u!=x.Data.onAdjoinHandlerSame||t!=x.Data.ignoreOnFutureHandlerSame){var w={ignoreOnHandlerSame:v,onAdjoinHandlerSame:u,ignoreOnFutureHandlerSame:t};h.publish("/sys/lbpmservice/freeflow/attrValueChange",this,w)}}}}}}}}}});return g})},"sys/lbpmservice/mobile/freeflow/freeflowSplitArea":function(){define(["dojo/dom-construct","dojo/_base/declare","dojo/dom-style","dijit/_WidgetBase","dojo/topic","dojo/query","mui/dialog/Confirm","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm"],function(b,d,g,c,f,i,j,a){var h=d("sys.lbpmservice.mobile.freeflow.freeflowSplitArea",[c],{buildRendering:function(){this.inherited(arguments);b.create("div",{className:"free_flow_split"},this.domNode);this.canAdd=false;if(!this.template){var l=lbpm.nodes[this.nodeId];if(l.Status!=lbpm.constant.STATUS_PASSED){if(lbpm.nowNodeFlowPopedom=="1"||lbpm.nowNodeFlowPopedom=="2"){this.canAdd=true}}if(!lbpm.globals.canAddOtherNode(this.nodeId)){this.canAdd=false}}else{this.canAdd=true}if(this.canAdd){var k="muiCategoryAdd mui mui-plus free_flow_add";this.addNode=b.create("div",{className:k},this.domNode)}this.canUpdate=false;if(!this.template){var l=lbpm.nodes[this.nodeId];if(l.Status=="1"&&l.isFixedNode!="true"){if(lbpm.nowNodeFlowPopedom=="2"){this.canUpdate=true}else{if(lbpm.nowNodeFlowPopedom=="1"){if(lbpm.myAddedNodes.contains(l.id)){this.canUpdate=true}}}}if(!lbpm.globals.canAddOtherNode(this.nodeId)){this.canUpdate=false}}else{this.canUpdate=true}var m=this.getNode();if(m.Type=="joinNode"){this.canUpdate=false}if(this.canUpdate){this.delNode=b.create("div",{className:"free_flow_delete"},this.domNode);b.create("div",{className:"fontmuis muis-org-delete"},this.delNode)}},startup:function(){this.inherited(arguments)},postCreate:function(){this.inherited(arguments);if(this.canAdd){this.connect(this.addNode,"click",this.addNodeClick)}if(this.canUpdate){this.connect(this.delNode,"click",this.delNodeClick);this.subscribe("/sys/lbpmservice/freeflow/leftSlide","_leftSlide");this.subscribe("/sys/lbpmservice/freeflow/recover","_recover");this.subscribe("/sys/lbpmservice/freeflow/__deleteNode","__deleteNode")}},addNodeClick:function(){var l=new Date().getTime();var k=this.ctime;if(k!="undefined"&&(l-k<500)){return false}if(!lbpm.globals.isCanEdit()){return}this.ctime=l;f.publish("/sys/lbpmservice/freeflow/addNode",this)},__deleteNode:function(k){if(k.nodeId==this.nodeId){if(!lbpm.globals.isCanEdit()){return}f.publish("/sys/lbpmservice/freeflow/deleteNode",this)}},delNodeClick:function(){var n=new Date().getTime();var l=this.ctime;if(l!="undefined"&&(n-l<500)){return false}this.ctime=n;if(!lbpm.globals.isCanEdit()){return}var m=this.getNode();if(m&&(m.Data.handlerIds||m.Type=="splitNode")){var k=this;j(a["mui.freeFlow.node.deleteMsg"],null,function(p){if(p){f.publish("/sys/lbpmservice/freeflow/deleteNode",k)}},false)}else{f.publish("/sys/lbpmservice/freeflow/deleteNode",this)}},_leftSlide:function(k){if(k.nodeId==this.nodeId){g.set(this.delNode,{display:"block"})}},_recover:function(k){if(k.nodeId==this.nodeId){g.set(this.delNode,{display:"none"})}},getNode:function(){var l=document.getElementById("WF_IFrame");var k=l.contentWindow.FlowChartObject;return k.Nodes.GetNodeById(this.nodeId)}});return h})},"sys/lbpmservice/mobile/common/LbpmPanel":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/_base/array","dojo/topic","dojo/ready","dijit/registry","dojo/query","dojo/dom-class","dojo/dom-style","dojo/parser","./syslbpmprocess_event"],function(f,d,i,g,l,a,j,k,h,b,c){return f("sys/lbpmservice/mobile/common/LbpmPanel",[d],{stopParser:true,LBPM_EVENT_INITCOMPLETE:"initComplete",maxHeight:0,startup:function(){this.inherited(arguments);lbpm.globals.destroyOperations=this.destroyOperations;var m=this;l(9999,function(){setTimeout(function(){b.parse(m.domNode).then(function(){var n=[];n=n.concat(["sys/lbpmservice/mobile/common/syslbpmprocess"]);n=n.concat(lbpm.jsfilelists);n=i.map(n,function(p){if(p.substr(0,1)=="/"){p=p.substr(1)}if(p.substr(p.length-3,p.lenghth)==".js"){p=p.substr(0,p.length-3)}return p});require(n,function(){i.forEach(arguments,function(q,p){try{if(q){if(q.init){q.init()}}}catch(r){console.error("流程初始化出错："+r)}});g.publish("initComplete",this)})});m.drawReady()},10)})},postCreate:function(){this.inherited(arguments);this.subscribe("/lbpm/operation/switch","doBackToTop")},destroyOperations:function(){j("#operationsTDContent, #nextNodeTD").forEach(function(m){i.forEach(a.findWidgets(m),function(n){n.destroy&&!n._destroyed&&n.destroy()})})},doBackToTop:function(n,m){if(m&&m.methodSwitch==false){if(this.touchNode){h.set(this.touchNode,"transform","translate3d(0px, 0px, 0px)")}}},drawReady:function(){j(".handingWay").on("click",function(n){var m=this});this.autoSaveDraftAction();g.publish("mui/lbpmservice/drawReady")},autoSaveDraftAction:function(){var m="",q=null;var p=function(){j("[name='fdUsageContent']").forEach(function(r){if(m!=r.value){var s="";s=lbpm.globals.getOperationDefaultUsage(lbpm.currentOperationType);if(s!=r.value){m=r.value;lbpm.globals.saveDraftAction()}}});q=null};var n=function(){if(q){clearTimeout(q);q=null}q=setTimeout(p,10000)};j("[name='fdUsageContent']").on("input",n);Com_Parameter.event.submit.push(function(){if(q){clearTimeout(q);q=null}return true})}})})},"sys/lbpmservice/mobile/freeflow/freeflowNodeAttributeGw":function(){define(["dojo/_base/declare","mui/form/Category","dojo/topic","dojo/_base/window","dojox/mobile/sniff"],function(d,f,c,g,b){var a=d("sys.lbpmservice.mobile.freeflow.freeflowNodeAttributeGw",[f],{templURL:"sys/lbpmservice/mobile/freeflow/freeflowNodeAttributeGw.jsp",_cateDialogPrefix:"__freeflowNodeImissiveAttr__",idField:"__freeflowNodeImissiveAttr__",key:"__freeflowNodeImissiveAttr__",postCreate:function(){this.inherited(arguments);this.subscribe("/sys/lbpmservice/freeflow/imissiveok","_closeAttrIm")},_closeAttrIm:function(h){this.closeDialog(h)},_selectCate:function(h){this._init(h);this.inherited(arguments);g.doc.dojoClick=!b("ios")||b("ios")>13},_init:function(h){this.nodeId=h.nodeId;this.handlerType=h.handlerType}});return a})},"sys/lbpmservice/mobile/operation/historyhandler/operation_history_handler_addOpinion":function(){define(["dojo/query","dijit/registry"],function(b,a){var c={};c.history_handler_addOpinion={click:function(){},check:function(){return true},setOperationParam:function(d){d.notifyLevel=b("#OperationView input[name='ext_notifyLevel']").val();d.auditNote=b("#OperationView textarea[name='ext_usageContent']").val()}};c.init=function(){};return c})},"sys/lbpmservice/mobile/workitem/workitem_common_usage":function(){define(["dojo/store/Memory","dojo/ready","dijit/registry","dojo/request","dojox/mobile/viewRegistry","dojo/query","dojo/dom-style","mui/dialog/Dialog","dojo/_base/array","dojo/topic","dojo/touch","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","dojo/on","dojo/parser","dojo/dom-construct","dojo/_base/array"],function(n,q,l,c,x,d,v,f,k,w,j,g,m,a,h,k){var i={};var r=function(){var z=new KMSSData();z.AddBeanData("lbpmUsageTarget&type=getUsagesInfo");z.GetHashMapArray(function(C){var D=C&&C.data.length>0&&C.data[0].usagesInfo?decodeURIComponent(C.data[0].usagesInfo):null;var B=[];if(D!=null&&D!=""){B=D.split("\n")}p("commonUsages",B)});lbpm.workitem.constant.COMMONUSAGES_ISAPPEND="true";var A=new KMSSData();A.AddBeanData("lbpmUsageTarget&type=getUsagesIsAppend");A.GetHashMapArray(function(B){var C=B&&B.data.length>0&&B.data[0].isAppend?B.data[0].isAppend:null;if(C!=null&&C!=""){lbpm.workitem.constant.COMMONUSAGES_ISAPPEND=C}})};var s=function(){var z=[];var A=Com_Parameter.ContextPath+"sys/lbpmservice/support/lbpm_usage/lbpmUsage.do?method=getUsagesInfo";c.get(A,{handleAs:"text",sync:true}).then(function(B){var C=B?decodeURIComponent(B):null;if(C!=null&&C!=""){z=C.split("\n")}window.currentUsageContents=z});return z};var u=function(z){return k.map(z,function(A){while(A.indexOf("nbsp;")!=-1){A=A.replace("&nbsp;"," ")}A=A.replace(/\'/g,"\\'").replace(/\"/g,"&quot;");return{text:A,value:A}})};var y='<input type="checkbox" data-dojo-type="mui/form/CheckBox" name="_select_box_commonUsageObjName" value="!{value}" data-dojo-props="mul:false,text:\'!{text}\'">';var b=function(z){return y.replace("!{text}",z.text).replace("!{value}",z.value)};var t=function(B){var F=u(B);var C;if(F.length==0){C="<p class='commonUsageNoneElement'>"+g["mui.operation.commonUsage.none"]+"</p>"}else{C=k.map(F,function(G){return b(G)});C=C.join("")}C="<div class='muiFormSelectElement commonUsageSlectElement'>"+C+"</div>";var A=x.getEnclosingView(d("#commonUsages")[0]);var z=null;if(!A){if(window.backToViewId){z=window.backToViewId}}else{var E=x.getParentView(A);if(!E&&window.backToViewId){z=window.backToViewId}else{A=E||A;z=A.id}}var D=[];D.push({id:"addUsageButton",label:g["mui.commonUsage.add"],icon1:"mui mui-plus",backTo:z,viewId:"commonUsageCreateView"});D.push({id:"manageUsageButton",label:g["mui.commonUsage.manage"],icon1:"mui mui-file-rar",backTo:z,viewId:"commonUsageManageView"});D=JSON.stringify(D);C+="<ul fixed='bottom' class='muiViewBottom' data-dojo-type='sys/lbpmservice/mobile/workitem/CommonUsageTabbar' data-dojo-props='buttons:"+D+"'></ul>";return C};var p=function(C,z){var B=null,A=t(z);d("#"+C).on("touchend",function(){setTimeout(function(){B=f.element({element:A,showClass:"muiDialogSelect muiFormSelect commonUsageDialog",position:"bottom",scrollable:true,parseable:true,callback:function(){B=null},onDrawed:function(D){var E=document.documentElement.clientHeight*0.8;if(D.privateHeight){E=D.privateHeight}if(D.divNode){E=E-D.divNode.offsetHeight}if(D.buttonsNode){E=E-D.buttonsNode.offsetHeight}v.set(D.scrollViewNode,{"max-height":E+"px","overflow-x":"hidden"});w.subscribe("/workitem/commonUsage/hideDialog",function(){if(B){v.set(B.domNode,{display:"none"})}});w.subscribe("/workitem/commonUsage/showDialog",function(){if(B){var G=s();A=t(G||[]);k.forEach(B.htmlWdgts,function(H){if(H&&H.destroy){H.destroy()}});B.element=A;h.empty(B.contentNode);var F=B.contentNode;if(B.scrollable){F=h.create("div",{className:"muiDialogScrollView","data-dojo-type":"mui/NativeView"},B.contentNode);isParse=true;B.scrollViewNode=F}h.place(A,F);a.parse(B.contentNode).then(function(H){B.htmlWdgts=H;B.loaded()});v.set(B.domNode,{display:""});v.set(B.scrollViewNode,{"max-height":E+"px","overflow-x":"hidden"})}})}})},300)});w.subscribe("mui/form/checkbox/change",function(E,F){if(F.name!="_select_box_commonUsageObjName"){return}if(B){B.hide()}B=null;lbpm.globals.clearDefaultUsageContent(lbpm.currentOperationType);var D=l.byId("fdUsageContent");if(lbpm.workitem.constant.COMMONUSAGES_ISAPPEND=="true"){D.set("value",D.get("value")+F.value.replace(/\\\'/g,"'"))}else{D.set("value",F.value.replace(/\\\'/g,"'"))}var G=d("textarea[name='"+D.name+"']")[0];m.emit(G,"sys/lbpmservice/mobile/NoticeHandler",{bubbles:true,cancelable:true})})};i.getOperationDefaultUsage=lbpm.globals.getOperationDefaultUsage=function(F){var H="";if(!F||F==null){return H}var K=lbpm.nodes[lbpm.nowNodeId].extAttributes;if(K){for(var E=0;E<K.length;E++){if(K[E]["name"]=="lbpmCustomizeContentJson"){var B=K[E]["value"];if(B){var D=JSON.parse(B);var G=lbpm.globals.customizeUsageName(F);var A=Data_GetResourceString("locale.language");if(JSON.stringify(_langJson.official)=="{}"){if(D.hasOwnProperty(G.handlerContent)){var C=D[G.handlerContent];return C}}else{if(D.hasOwnProperty(G.handlerContent+"_lang")){var C=D[G.handlerContent+"_lang"];if(C){var J=JSON.parse(C);for(var I=0;I<J.length;I++){if(J[I].lang==A){H=J[I].value;return H}}}}}}break}}}if(lbpm.workitem.constant.COMMONHANDLERUSAGECONTENTDEFAULT){H=lbpm.workitem.constant.COMMONHANDLERUSAGECONTENTDEFAULT[F];if(H==null){H=""}}return H};lbpm.globals.getOperationDefaultUsageValidate=function(F){var G="";if(!F||F==null){return G}var K=lbpm.nodes[lbpm.nowNodeId].extAttributes;if(K){for(var E=0;E<K.length;E++){if(K[E]["name"]=="lbpmCustomizeValidateContentJson"){var B=K[E]["value"];if(B){var D=JSON.parse(B);var H=lbpm.globals.customizeUsageNameValidate(F);var A=Data_GetResourceString("locale.language");if(JSON.stringify(_langJson.official)=="{}"){if(D.hasOwnProperty(H.handlerContent)){var C=D[H.handlerContent];return C}}else{if(D.hasOwnProperty(H.handlerContent+"_lang")){var C=D[H.handlerContent+"_lang"];if(C){var J=JSON.parse(C);for(var I=0;I<J.length;I++){if(J[I].lang==A){G=J[I].value;return G}}}}}}break}}}return""};lbpm.globals.customizeUsageName=function(z){var A={};if(z=="handler_pass"){A={handlerContent:"customizeUsageContent",isRequired:"isPassContentRequired",isValidated:"isPassContentValidated"}}if(z=="handler_commission"){A={handlerContent:"customizeUsageContentCommission",isRequired:"isCommissionContentRequired",isValidated:"isCommissionContentValidated"}}if(z=="handler_nodeSuspend"){A={handlerContent:"customizeUsageContentNodeSuspend",isRequired:"isNodeSuspendContentRequired",isValidated:"isNodeSuspendContentValidated"}}if(z=="handler_communicate"){A={handlerContent:"customizeUsageContentCommunicate",isRequired:"isCommunicateContentRequired",isValidated:"isCommunicateContentValidated"}}if(z=="handler_refuse"){A={handlerContent:"customizeUsageContentRefuse",isRequired:"isRefuseContentRequired",isValidated:"isRefuseContentValidated"}}if(z=="handler_additionSign"){A={handlerContent:"customizeUsageContentAdditionSign",isRequired:"isAdditionSignContentRequired",isValidated:"isAdditionSignContentValidated"}}if(z=="handler_superRefuse"){A={handlerContent:"customizeUsageContentSuperRefuse",isRequired:"isSuperRefuseContentRequired",isValidated:"isSuperRefuseContentValidated"}}if(z=="handler_nodeResume"){A={handlerContent:"customizeUsageContentNodeResume",isRequired:"isNodeResumeContentRequired",isValidated:"isNodeResumeContentValidated"}}if(z=="handler_assign"){A={handlerContent:"customizeUsageContentAssign",isRequired:"isAssignContentRequired",isValidated:"isAssignContentValidated"}}if(z=="handler_assignPass"){A={handlerContent:"customizeUsageContentAssignPass",isRequired:"isAssignPassContentRequired",isValidated:"isAssignPassContentValidated"}}if(z=="handler_assignRefuse"){A={handlerContent:"customizeUsageContentAssignRefuse",isRequired:"isAssignRefuseContentRequired",isValidated:"isAssignRefuseContentValidated"}}if(z=="handler_jump"){A={handlerContent:"customizeUsageContentJump",isRequired:"isJumpContentRequired",isValidated:"isJumpContentValidated"}}if(z=="handler_abandon"){A={handlerContent:"customizeUsageContentAandon",isRequired:"isAbandonContentRequired",isValidated:"isAbandonContentValidated"}}if(z=="handler_sign"){A={handlerContent:"customizeUsageContentSign",isRequired:"isSignContentRequired",isValidated:"isSignContentValidated"}}return A};lbpm.globals.customizeUsageNameValidate=function(z){var A={};if(z=="handler_pass"){A={handlerContent:"customizeUsageContentValidated",isExcludeValidated:"isPassContentExcludeValidated",isValidated:"isPassContentValidated"}}if(z=="handler_commission"){A={handlerContent:"customizeUsageContentCommissionValidated",isExcludeValidated:"isCommissionContentExcludeValidated",isValidated:"isCommissionContentValidated"}}if(z=="handler_nodeSuspend"){A={handlerContent:"customizeUsageContentNodeSuspendValidated",isExcludeValidated:"isNodeSuspendContentExcludeValidated",isValidated:"isNodeSuspendContentValidated"}}if(z=="handler_communicate"){A={handlerContent:"customizeUsageContentCommunicateValidated",isExcludeValidated:"isCommunicateContentExcludeValidated",isValidated:"isCommunicateContentValidated"}}if(z=="handler_refuse"){A={handlerContent:"customizeUsageContentRefuseValidated",isExcludeValidated:"isRefuseContentExcludeValidated",isValidated:"isRefuseContentValidated"}}if(z=="handler_additionSign"){A={handlerContent:"customizeUsageContentAdditionSignValidated",isExcludeValidated:"isAdditionSignContentExcludeValidated",isValidated:"isAdditionSignContentValidated"}}if(z=="handler_superRefuse"){A={handlerContent:"customizeUsageContentSuperRefuseValidated",isExcludeValidated:"isSuperRefuseContentExcludeValidated",isValidated:"isSuperRefuseContentValidated"}}if(z=="handler_nodeResume"){A={handlerContent:"customizeUsageContentNodeResumeValidated",isExcludeValidated:"isNodeResumeContentExcludeValidated",isValidated:"isNodeResumeContentValidated"}}if(z=="handler_assign"){A={handlerContent:"customizeUsageContentAssignValidated",isExcludeValidated:"isAssignContentExcludeValidated",isValidated:"isAssignContentValidated"}}if(z=="handler_assignPass"){A={handlerContent:"customizeUsageContentAssignPassValidated",isExcludeValidated:"isAssignPassContentExcludeValidated",isValidated:"isAssignPassContentValidated"}}if(z=="handler_assignRefuse"){A={handlerContent:"customizeUsageContentAssignRefuseValidated",isExcludeValidated:"isAssignRefuseContentExcludeValidated",isValidated:"isAssignRefuseContentValidated"}}if(z=="handler_jump"){A={handlerContent:"customizeUsageContentJumpValidated",isExcludeValidated:"isJumpContentExcludeValidated",isValidated:"isJumpContentValidated"}}if(z=="handler_abandon"){A={handlerContent:"customizeUsageContentAandonValidated",isExcludeValidated:"isAbandonContentExcludeValidated",isValidated:"isAbandonContentValidated"}}if(z=="handler_sign"){A={handlerContent:"customizeUsageContentSignValidated",isExcludeValidated:"isSignContentExcludeValidated",isValidated:"isSignContentValidated"}}return A};i.isUsageContenRequired=lbpm.globals.isUsageContenRequired=function(B){if(!B||B==null){return null}if(!lbpm.workitem.constant.COMMONHANDLERUSAGECONTENTDEFAULT_ISREQUIRED||lbpm.workitem.constant.COMMONHANDLERUSAGECONTENTDEFAULT_ISREQUIRED==null){return null}var E=lbpm.nodes[lbpm.nowNodeId].extAttributes;if(E){for(var C=0;C<E.length;C++){if(E[C]["name"]=="lbpmCustomizeContentJson"){var D=E[C]["value"];if(D){var A=JSON.parse(D);var z=lbpm.globals.customizeUsageName(B);if(z){if(A[z.isRequired]=="true"){return true}else{if(A[z.isRequired]=="false"){return false}}}}break}}}if(lbpm.workitem.constant.COMMONHANDLERUSAGECONTENTDEFAULT_ISREQUIRED[B]=="true"){return true}else{if(lbpm.workitem.constant.COMMONHANDLERUSAGECONTENTDEFAULT_ISREQUIRED[B]=="false"){return false}else{return null}}};lbpm.globals.isUsageContenValidated=function(B){if(!B||B==null){return null}var E=lbpm.nodes[lbpm.nowNodeId].extAttributes;if(E){for(var C=0;C<E.length;C++){if(E[C]["name"]=="lbpmCustomizeValidateContentJson"){var D=E[C]["value"];if(D){var A=JSON.parse(D);var z=lbpm.globals.customizeUsageNameValidate(B);if(z){if(A[z.isValidated]=="true"){return true}else{if(A[z.isValidated]=="false"){return false}}}}break}}}return null};lbpm.globals.isUsageContenExcludeValidated=function(B){if(!B||B==null){return null}var E=lbpm.nodes[lbpm.nowNodeId].extAttributes;if(E){for(var D=0;D<E.length;D++){if(E[D]["name"]=="lbpmCustomizeValidateContentJson"){var A=E[D]["value"];if(A){var C=JSON.parse(A);var z=lbpm.globals.customizeUsageNameValidate(B);if(z){if(C[z.isExcludeValidated]=="true"){return true}else{if(C[z.isExcludeValidated]=="false"){return false}}}}break}}}return null};i.clearDefaultUsageContent=lbpm.globals.clearDefaultUsageContent=function(A){var C="";C=lbpm.globals.getOperationDefaultUsage(A);var z=l.byId("fdUsageContent");var B=z.get("value");if(C==null||B.replace(/\s*/ig,"")==C.replace(/\s*/ig,"")){z.set("value","")}};i.setDefaultUsageContent=lbpm.globals.setDefaultUsageContent=function(B,C,E){var A="";A=lbpm.globals.getOperationDefaultUsage(B);var z=null;if(C!=null){z=l.byNode(C)}else{z=l.byId("fdUsageContent")}var D=z.get("value");if(z!=null&&!D.replace(/\s*/ig,"")){z.set("value",A)}};i.init=function(){r();w.subscribe("/dojox/mobile/beforeTransitionIn",function(){var z=l.byId("fdUsageContent");if(z){z.resizeHeight(z.textareaNode)}})};return i})},"sys/lbpmservice/mobile/opthandler/OptHandler":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/topic","dojo/dom-construct","mui/form/Address","mui/util"],function(d,g,c,b,f,a){return d("sys.lbpmservice.mobile.opthandler.OptHandler",[f],{type:ORG_TYPE_POSTORPERSON,text:"备选列表",showHeadImg:false,isMul:true,templURL:"sys/lbpmservice/mobile/opthandler/opthandler.jsp",_cateDialogPrefix:"__opthandler__",isFormatText:true,handlerIdentity:null,optHandlerSelectType:null,fdModelName:null,fdModelId:null,deptLimit:"",dataUrl:"/sys/lbpmservice/mobile/opthanlder.do?method=handlers&deptLimit=!{deptLimit}&handlerIdentity=!{handlerIdentity}&optHandlerSelectType=!{optHandlerSelectType}&fdModelName=!{fdModelName}&fdModelId=!{fdModelId}",startup:function(){this.inherited(arguments);this.dataUrl=a.urlResolver(this.dataUrl,{handlerIdentity:this.handlerIdentity,optHandlerIds:encodeURIComponent(this.optHandlerIds),optHandlerSelectType:this.optHandlerSelectType,fdModelName:this.fdModelName,fdModelId:this.fdModelId,deptLimit:this.deptLimit});this.templURL="sys/lbpmservice/mobile/opthandler/opthandler.jsp?isMul="+this.isMul;this.searchUrl=this.dataUrl+"&keyword=!{keyword}"},_selectCate$1:function(){if(this.isFormatText){this.optHandlerIds=a.formatText(this.optHandlerIds);this.isFormatText=false}this.inherited(arguments)}})})},"sys/lbpmservice/mobile/workitem/CommonUsageItemMixin":function(){define(["dojo/_base/declare","dojo/dom-construct","dojo/topic","mui/openProxyMixin","dojox/mobile/_ItemBase","dojo/dom-class","dojo/_base/lang","dojox/mobile/_ScrollableMixin","dojo/dom-style","dijit/registry","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm"],function(h,d,i,f,l,k,b,g,j,a,c){return h("sys.lbpmservice.mobile.workitem.CommonUsageItemMixin",[l,f,g],{tag:"li",baseClass:"commonUsageItem",scrollDir:"h",width:"100%",height:"auto",scrollBar:false,appBars:false,buildRendering:function(){this.inherited(arguments);this.domNode=d.create(this.tag);this.containerNode=d.create("div",{className:"commonUsageItemContainer"},this.domNode);k.add(this.domNode,this.baseClass);this.buildContent()},buildContent:function(){this.contentNode=d.create("div",{className:"commonUsageItemContent"},this.containerNode);j.set(this.contentNode,{width:document.body.offsetWidth+"px"});var n=d.create("div",{className:"commonUsageItemInfo"},this.contentNode);var p=d.create("div",{className:"commonUsageItemText",innerHTML:this.fdContent.replaceAll("<","&lt;").replaceAll(">","&gt;")},n);var m=d.create("div",{className:"commonUsageItemEditBtn",innerHTML:c["mui.commonUsage.edit"]},n);this.connect(m,"click","_updateItem");this.delBtnNode=d.create("div",{className:"commonUsageItemDelBtn",innerHTML:c["mui.commonUsage.del"]},this.containerNode);this.connect(this.delBtnNode,"click","_deleteItem")},startup:function(){this.inherited(arguments);var n=this.contentNode.offsetWidth;var m=this.delBtnNode.offsetWidth;var p=n+m;j.set(this.containerNode,{width:p+"px"})},_setLabelAttr:function(m){if(m){this._set("label",m)}},_updateItem:function(){var m=a.getEnclosingWidget(this.domNode.parentNode);if(!m){m=a.byId("commonUsageList")}i.publish("/lbpm/commonUsageItem/edit",this,{listDatas:m.listDatas})},_deleteItem:function(){i.publish("/lbpm/commonUsageItem/delete",this)}})})},"sys/lbpmservice/mobile/operation/operation_common_passtype":function(){define(["sys/lbpmservice/mobile/common/syslbpmprocess_nodes_filter","mui/dialog/Tip","dijit/registry","sys/authentication/identity/js/mobile/auth"],function(k,m,a,f){var j={};var p=function(){if($("input[name='futureNode']").length==0||lbpm.noValidateFutureNode==true){return true}var t=$("input[name='futureNode'][type='checkbox']");if(t.length>0){var s;require(["dojo/topic","dijit/registry"],function(v,u){s=u.byId("sys_lbpmservice_mobile_workitem_FutureNodesChekBoxGroup")});if(s.value&&s.value!=""){return true}}else{if($("input[name='futureNode']:checked").length>0){return true}}m.warn({text:lbpm.constant.CHKNEXTNODENOTNULL});return false};var i=function(){if($("input[name='nextAdHocRouteId']").length==0){return true}if($("input[name='nextAdHocRouteId']:checked").length>0){return true}m.warn({text:lbpm.constant.CHKNEXTNODENOTNULL});return false};var r=function(t){var u=new Array();var s=false;if(!t){s=true}var v=function(w){$.each(w,function(x,y){if(s){u.push(y.id)}if(t&&(y.id==t||(y.targetId&&y.targetId==t))){s=true}})};lbpm.globals.getThroughNodes(v,null,null,false,t);return u};var c=function(A,B){var v=lbpm.globals.getCurrentNodeObj();var t=lbpm.constant.ROLETYPE;for(var w=0;w<A.length;w++){if(t==""&&lbpm.globals.checkModifyNodeAuthorization(v,A[w])){var u=lbpm.globals.getNodeObj(A[w]);if(u.XMLNODENAME!="embeddedSubFlowNode"){if(u.handlerIds==null||u.handlerIds==""){if(v.processType==lbpm.constant.PROCESSTYPE_SERIAL){var y=lbpm.globals.getOperationParameterJson("currNodeNextHandlersId");var s=lbpm.globals.getOperationParameterJson("toRefuseThisNodeId");if(!y&&!s&&(lbpm.operations[lbpm.currentOperationType].isPassType)){if(lbpm.globals.judgeIsNecessaryAlert(u)&&u.ignoreOnHandlerEmpty!="true"){var x=WorkFlow_getLangLabel(u.name,u.langs,"nodeName");m.warn({text:u.id+"."+x+" "+lbpm.constant.MUSTMODIFYHANDLERNODEIDSISNULL});return false}}}else{if(lbpm.operations[lbpm.currentOperationType].isPassType){if(lbpm.globals.judgeIsNecessaryAlert(u)&&u.ignoreOnHandlerEmpty!="true"){var x=WorkFlow_getLangLabel(u.name,u.langs,"nodeName");m.warn({text:u.id+"."+x+" "+lbpm.constant.MUSTMODIFYHANDLERNODEIDSISNULL});return false}}}}else{var z=_getNextNodeHandlerNames(u);if(z==""||z.indexOf("postEmpty")!=-1||z.indexOf("elementDisabled")!=-1||z.indexOf("parseError")!=-1){if(v.processType==lbpm.constant.PROCESSTYPE_SERIAL){var y=lbpm.globals.getOperationParameterJson("currNodeNextHandlersId");var s=lbpm.globals.getOperationParameterJson("toRefuseThisNodeId");if(!y&&!s&&(lbpm.operations[lbpm.currentOperationType].isPassType)){if(lbpm.globals.judgeIsNecessaryAlert(u)){var x=WorkFlow_getLangLabel(u.name,u.langs,"nodeName");if(z.indexOf("elementDisabled")!=-1){m.warn({text:u.id+"."+x+lbpm.constant.MUSTMODIFYHANDLERNODEIDSPARSEELEMENTDISABLED,width:"260",height:"150"});return false}if(z.indexOf("postEmpty")!=-1){m.warn({text:u.id+"."+x+lbpm.constant.MUSTMODIFYHANDLERNODEIDSPARSEPOSTEMPTY,width:"260",height:"150"});return false}if(z==""&&u.ignoreOnHandlerEmpty!="true"){m.warn({text:u.id+"."+x+" "+lbpm.constant.MUSTMODIFYHANDLERNODEIDSISNULL,width:"260",height:"150"});return false}}}}else{if(lbpm.operations[lbpm.currentOperationType].isPassType){if(lbpm.globals.judgeIsNecessaryAlert(u)){var x=WorkFlow_getLangLabel(u.name,u.langs,"nodeName");if(z.indexOf("elementDisabled")!=-1){m.warn({text:u.id+"."+x+lbpm.constant.MUSTMODIFYHANDLERNODEIDSPARSEELEMENTDISABLED,width:"260",height:"150"});return false}if(z.indexOf("postEmpty")!=-1){m.warn({text:u.id+"."+x+lbpm.constant.MUSTMODIFYHANDLERNODEIDSPARSEPOSTEMPTY,width:"260",height:"150"});return false}if(z==""&&u.ignoreOnHandlerEmpty!="true"){m.warn({text:u.id+"."+x+" "+lbpm.constant.MUSTMODIFYHANDLERNODEIDSISNULL,width:"260",height:"150"});return false}}}}}}}}}return true};window._getNextNodeHandlerNames=function(v){var u;var s=v.handlerIds==null?"":v.handlerIds;var w="";if(v.handlerSelectType){if(v.handlerSelectType=="formula"){u=lbpm.globals.formulaNextNodeHandler(s,true,lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_SEND,v),undefined,v.id)}else{if(v.handlerSelectType=="matrix"){u=lbpm.globals.matrixNextNodeHandler(s,true,lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_SEND,v),undefined,v.id)}else{if(v.handlerSelectType=="rule"){u=lbpm.globals.ruleNextNodeHandler(v.id,s,true,lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_SEND,v))}else{u=lbpm.globals.parseNextNodeHandler(s,true,lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_SEND,v),undefined,v.id)}}}for(var t=0;t<u.length;t++){if(w==""){w=u[t].parseResult}else{w+=";"+u[t].parseResult}}}return w};var b=function(u,y,A){if(!y){return}var w=lbpm.globals.getNodeObj(y);if(w){if(lbpm.nowNodeId!=y&&w.mustModifyHandlerNodeIds!=null&&w.mustModifyHandlerNodeIds!=""&&w.ignoreOnHandlerEmpty=="false"){var v=w.mustModifyHandlerNodeIds.split(";");for(var t=0;t<v.length;t++){if(v[t]&&$.inArray(v[t],A)==-1){u.push(v[t])}}}A.push(y);if(lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_SPLIT,w)&&w.relatedNodeIds){b(u,w.relatedNodeIds,A)}else{var s=lbpm.globals.getNextNodeObjs(w.id);if(lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_MANUALBRANCH,w)){for(var x=0;x<s.length;x++){if($.inArray(s[x].id,A)==-1&&s[x].id!=lbpm.nowNodeId){b(u,s[x].id,A)}}}if(s.length==1){b(u,s[0].id,A)}}}};var n=window.getAllNextNodeArrayExclude=function(x){var v=[];var z=r(x);var u=[];var y=[];b(u,x,y);for(var t=0;t<z.length;t++){var w=false;for(var s=0;s<u.length;s++){if(z[t]==u[s]){w=true;break}}if(!w){v.push(z[t])}}return v};var l=function(){if(lbpm.noValidateFutureNode==true){return true}var y=null;var E=document.getElementsByName("futureNode");for(var v=0;v<E.length;v++){var w=E[v];var s=a.byNode(w);if(w.checked||(s&&s.checked)){y=lbpm.globals.getNodeObj(w.value);var B=document.getElementsByName("handlerIds["+w.getAttribute("index")+"]")[0];if(B==null){B=document.getElementsByName("handlerIds_"+w.value)[0]}if(B!=null&&B.value==""&&y&&y.ignoreOnHandlerEmpty=="false"){m.warn({text:lbpm.constant.VALIDATENEXTNODEHANDLERISNULL});return false}}}var x=[];if(y&&y.id){if(lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_END,y)){return true}x=n(y.id);x.unshift(y.id)}else{x=n(lbpm.nowNodeId)}for(var v=0;v<E.length;v++){var w=E[v];if(w.checked){continue}for(var u=0;u<x.length;u++){var z=x[u];if(w.value==z){var B=document.getElementsByName("handlerIds["+w.getAttribute("index")+"]")[0];var t=lbpm.globals.getNodeObj(w.value);if(B!=null&&B.value==""&&t&&t.ignoreOnHandlerEmpty=="false"){var A=WorkFlow_getLangLabel(t.name,t.langs,"nodeName");var C=WorkFlow_getLangLabel(y.name,y.langs,"nodeName");m.warn({text:lbpm.constant.FLOWCONTENTMUSTMODIFYNODENEXTHANDLER.replace("{0}",t.id).replace("{1}",A).replace("{2}",y.id).replace("{3}",C)});return false}}}}var D=lbpm.globals.analysisProcessorInfoToObject();if(!c(x,D)){return false}return true};j.common_operationCheckForPassType=lbpm.globals.common_operationCheckForPassType=function(){if(!p()){return false}else{if(!l()){return false}else{if(!i()){return false}else{if(!d()){var s=a.byId("process_review_button");s.setDisabled(true);identityValidate();return false}}}}return true};j.judgeIsNecessaryAlert=lbpm.globals.judgeIsNecessaryAlert=function(t){var s=false;if(lbpm.globals.getThroughNodesCache){var u;lbpm.globals.getThroughNodes(function(){u=arguments[0]},null,null,false,lbpm.nowNodeId);if(u){var v=lbpm.globals.getIdsByNodes(u);v=v+",";if(t.groupNodeId){if(v.indexOf(t.groupNodeId+",")==-1){s=true}}else{if(v.indexOf(t.id+",")==-1){s=true}}}}return !s};var g=false;function d(){if(g==true){return true}var t=lbpm.globals.getCurrentNodeObj();if(t){extAttributes=t.extAttributes;if(extAttributes&&extAttributes.length>0){for(var s=0;s<extAttributes.length;s++){attr=extAttributes[s];if(attr.name.indexOf("identity_")==0){if(attr.value=="true"){return false}}}}}return true}var h=a.byId("process_review_button");window.identityValidate=function(){var s={};var t=document.getElementsByName("modelPath");var u="lbpm";if(t&&t.length>0){u=t[0]}s.modelPath=u;s.modelName=lbpm.modelName;s.modelId=lbpm.modelId;s.callback=identityValidate_calback;s.validateType=q();f.validate(s)};window.identityValidate_calback=function(s,v,u){var t=a.byId("process_review_button");t.setDisabled(false);if(s){g=true;Com_Parameter.isSubmit=false;t.onClick()}};function q(){var s="";var u=lbpm.globals.getCurrentNodeObj();if(u){extAttributes=u.extAttributes;if(extAttributes&&extAttributes.length>0){for(var t=0;t<extAttributes.length;t++){attr=extAttributes[t];if(attr.name.indexOf("identity_")==0){if(attr.value=="true"){s+=attr.name.substring(9)+";"}}}}}return s}return j})},"sys/lbpmservice/mobile/common/_RecordBackToMixin":function(){define(["dojo/_base/declare","dojox/mobile/viewRegistry","dijit/_WidgetBase"],function(b,a,c){return b("sys.lbpmservice.mobile.common._RecordBackToMixin",[c],{startup:function(){this.recordBackTo();this.inherited(arguments)},recordBackTo:function(){var d=this.bakcTo;if(!d){var f=a.getEnclosingView(this.domNode);f=a.getParentView(f)||f;d=f.id}window.backToViewId=d}})})},"sys/lbpmservice/mobile/freeflow/freeflowNode":function(){define(["dojo/dom-construct","dojo/_base/declare","dojo/dom-style","dojox/mobile/_ScrollableMixin","dijit/_WidgetBase","dojo/topic","dojo/query","dojo/dom-class","sys/lbpmservice/mobile/freeflow/freeflowNodeAttribute","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm"],function(c,g,i,f,d,h,j,k,l,b){var a=g("sys.lbpmservice.mobile.freeflow.freeflowNode",[d,f],{scrollDir:"h",buildRendering:function(){this.inherited(arguments);this.canUpdate=false;if(!this.template){var p=lbpm.nodes[this.nodeId];if(p.Status=="1"&&p.isFixedNode!="true"){if(lbpm.nowNodeFlowPopedom=="2"){this.canUpdate=true}else{if(lbpm.nowNodeFlowPopedom=="1"){if(lbpm.myAddedNodes.contains(p.id)){this.canUpdate=true}}}}if(!lbpm.globals.canAddOtherNode(this.nodeId)){this.canUpdate=false}}else{this.canUpdate=true}this.containerNode=c.create("div",{className:"free_flow_node"},this.domNode);var p=this.getNode();var t=WorkFlow_getLangLabel(p.Data.name,p.Data.langs,"nodeName");var v=c.create("div",{className:"free_flow_left"},this.containerNode);if(this.canUpdate){this.upDom=c.create("div",{className:"free_flow_move free_flow_move_up"},v);this.upNode=c.create("i",{className:"fontmuis muis-org-moveup"},this.upDom);this.downDom=c.create("div",{className:"free_flow_move free_flow_move_down"},v);this.downNode=c.create("i",{className:"fontmuis muis-org-movedown"},this.downDom)}var s=c.create("div",{className:"free_flow_center"},this.containerNode);var m="fontmuis muis-org-approve";var n="free_flow_center_icon_review";if(p.Type=="signNode"){m="fontmuis muis-org-signature";n="free_flow_center_icon_sign"}else{if(p.Type=="sendNode"){m="fontmuis muis-org-copy-to";n="free_flow_center_icon_send"}}if(p.Data.isFixedNode=="true"){m="fontmuis muis-org-locked"}if(p.Type!="splitNode"&&p.Type!="joinNode"){var u=c.create("span",{className:"free_flow_center_icon "+n},s);this.stateDom=c.create("i",{className:m},u)}this.nodeNameDom=c.create("span",{className:"free_flow_sortName",innerHTML:t},s);var q=c.create("div",{className:"free_flow_right"},this.containerNode);var r=this.formatHandlerNames(this._getHandlerName());if(p.Type=="robotNode"||p.Type=="splitNode"||p.Type=="joinNode"){r=""}this.setDom=c.create("span",{className:"free_flow_set_tip"},q);this.handlerNameDom=c.create("span",{innerHTML:r},this.setDom);if(this.canUpdate&&p.Data.handlerSelectType=="org"){c.create("i",{className:"mui mui-forward"},this.setDom)}},startup:function(){this.inherited(arguments);i.set(this.domNode,{height:""})},postCreate:function(){this.inherited(arguments);if(this.canUpdate){var p=this.getNode();var n=this.isCanUpMove();var m=this.isCanDownMove();if(n){this.upMoveConnect=this.connect(this.upNode,"click",this.upNodeClick)}else{i.set(this.upNode,{display:"none"})}if(m){this.downMoveConnect=this.connect(this.downNode,"click",this.downNodeClick)}else{i.set(this.downNode,{display:"none"})}if(!n||!m){if(n){k.add(this.upDom,"free_flow_move_up_margin")}if(m){k.add(this.downDom,"free_flow_move_down_margin")}}if(p.Data.handlerSelectType=="org"){this.connect(this.setDom,"click",this.setNodeClick)}this.subscribe("/sys/lbpmservice/freeflow/refreshNode","refreshNode");this.subscribe("/sys/lbpmservice/freeflow/deleteNode","_deleteNode");this.subscribe("/sys/lbpmservice/freeflow/updateNode","_updateNode");this.subscribe("/sys/lbpmservice/freeflow/___updateNode","___updateNode")}},refreshNode:function(){var n=this.isCanUpMove();var m=this.isCanDownMove();k.remove(this.upDom,"free_flow_move_up_margin");k.remove(this.downDom,"free_flow_move_down_margin");if(n){if(!this.upMoveConnect){this.upMoveConnect=this.connect(this.upNode,"click",this.upNodeClick)}i.set(this.upNode,{display:""})}else{if(this.upMoveConnect){this.upMoveConnect.remove();this.upMoveConnect=null}i.set(this.upNode,{display:"none"})}if(m){if(!this.downMoveConnect){this.downMoveConnect=this.connect(this.downNode,"click",this.downNodeClick)}i.set(this.downNode,{display:""})}else{if(this.downMoveConnect){this.downMoveConnect.remove();this.downMoveConnect=null}i.set(this.downNode,{display:"none"})}if(!n||!m){if(n){k.add(this.upDom,"free_flow_move_up_margin")}if(m){k.add(this.downDom,"free_flow_move_down_margin")}}},isCanUpMove:function(){var n=false;if(!this.template){var q=lbpm.nodes[this.nodeId];if(q.XMLNODENAME=="joinNode"){return false}var p=q.startLines[0].startNode;if(p.XMLNODENAME=="splitNode"){return false}else{if(p.XMLNODENAME=="joinNode"){p=lbpm.nodes[p.relatedNodeIds]}}if(p.Status=="1"){n=true}}else{var q=this.getNode();if(q.Type=="joinNode"){return false}var m=q.LineIn[0].StartNode;if(m.Type=="splitNode"){return false}else{if(m.Type=="joinNode"){p=this.getNode(m.Data.relatedNodeIds)}}if(m&&m.Data.id!="N2"){n=true}}return n},isCanDownMove:function(){var p=false;if(!this.template){var q=lbpm.nodes[this.nodeId];if(q.XMLNODENAME=="joinNode"){return p}else{if(q.XMLNODENAME=="splitNode"){q=lbpm.nodes[q.relatedNodeIds]}}var n=q.endLines[0].endNode;if(n.XMLNODENAME=="joinNode"){return false}if(n.id!="N3"&&n.Status=="1"){p=true}}else{var q=this.getNode();if(q.Type=="joinNode"){return p}else{if(q.Type=="splitNode"){q=this.getNode(q.Data.relatedNodeIds)}}var m=q.LineOut[0].EndNode;if(m.Type=="joinNode"){return false}if(m&&m.Data.id!="N3"){p=true}}return p},upNodeClick:function(){var n=new Date().getTime();var m=this.ctime;if(m!="undefined"&&(n-m<500)){return false}this.ctime=n;if(!lbpm.globals.isCanEdit()){return}h.publish("/sys/lbpmservice/freeflow/moveNode",this,"up")},downNodeClick:function(){var n=new Date().getTime();var m=this.ctime;if(m!="undefined"&&(n-m<500)){return false}this.ctime=n;if(!lbpm.globals.isCanEdit()){return}h.publish("/sys/lbpmservice/freeflow/moveNode",this,"down")},setNodeClick:function(){var n=new Date().getTime();var m=this.ctime;if(m!="undefined"&&(n-m<500)){return false}this.ctime=n;if(!lbpm.globals.isCanEdit()){return}if(this.freeflowNodeAttributeDialog==null){this.freeflowNodeAttributeDialog=new l()}this.freeflowNodeAttributeDialog._selectCate({nodeId:this.nodeId,state:"update",template:this.template})},_deleteNode:function(m){if(m.nodeId==this.nodeId){this.destroy()}},_updateNode:function(n){if(n.nodeId==this.nodeId){var p=this.getNode();this.handlerNameDom.innerText=this.formatHandlerNames(this._getHandlerName());this.nodeNameDom.innerText=WorkFlow_getLangLabel(p.Data.name,p.Data.langs,"nodeName");var m="fontmuis muis-org-approve";if(p.Type=="signNode"){m="fontmuis muis-org-signature"}else{if(p.Type=="sendNode"){m="fontmuis muis-org-copy-to"}}if(p.Data.isFixedNode=="true"){m="fontmuis muis-org-locked"}k.replace(this.stateDom,m,this.stateDom.className)}},___updateNode:function(n,m){if(m&&m.nodeId==this.nodeId){var p=this.getNode();this.handlerNameDom.innerText=this.formatHandlerNames(this._getHandlerName())}},getNode:function(p){var n=document.getElementById("WF_IFrame");var m=n.contentWindow.FlowChartObject;return m.Nodes.GetNodeById(p||this.nodeId)},_getHandlerName:function(){var r=this.getNode();var p=r.Data.handlerNames;if(this.template){return p}var q;var m="";if(r.Data.handlerSelectType=="formula"){q=lbpm.globals.formulaNextNodeHandler(r.Data.handlerIds,true,false)}else{if(r.Data.handlerSelectType=="matrix"){q=lbpm.globals.matrixNextNodeHandler(r.Data.handlerIds,true,false)}else{if(r.Data.handlerSelectType=="rule"){q=lbpm.globals.ruleNextNodeHandler(r.Data.id,r.Data.handlerIds,true,false)}else{q=lbpm.globals.parseNextNodeHandler(r.Data.handlerIds,true,false)}}}for(var n=0;n<q.length;n++){if(m==""){m=q[n].name}else{m+=";"+q[n].name}}if(m==""&&r.Data.handlerIds!=null){m=lbpm.constant.COMMONNODEHANDLERORGNULL}if(m){p=m}return p},formatHandlerNames:function(p){var m=b["mui.freeFlow.node.set"];if(p){var q=p.split(";");if(q.length>2){var n=q.length;m=q[0]+";"+q[1];if(m.length>10){m=m.substring(0,10)+"..."}m+=b["mui.freeFlow.node.more"]+n+b["mui.freeFlow.node.person"]}else{m=q.join(";");if(m.length>10){m=m.substring(0,10)+"..."}}}return m},onTouchMove:function(m){this.inherited(arguments);if(this.canUpdate){if(this.getPos().x<=-60){h.publish("/sys/lbpmservice/freeflow/leftSlide",this)}else{h.publish("/sys/lbpmservice/freeflow/recover",this)}}},onTouchEnd:function(m){this.inherited(arguments);if(this.canUpdate){if(this.getPos().x<=-60){this.slideTo({x:-60,y:0},0.3,"ease-out")}}}});return a})},"sys/lbpmservice/mobile/signature/signatrueHtml":function(){define(["dojo/query","mui/dialog/Dialog","dojo/_base/array","dojo/topic","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","dojo/dom-construct","dojo/dom-class","dojo/dom","dojo/dom-style"],function(query,Dialog,array,topic,msg,domConstruct,domClass,dom,domStyle){var signatrueHtml={dialogSignatureList:function(commonUsageObjName,usageContents){var dialog=null,html=null;query("#"+commonUsageObjName).on("click",function(){html=buildContentHtml(usageContents);setTimeout(function(){dialog=Dialog.element({element:html,showClass:"muiDialogSelect muiFormSelect",position:"bottom",scrollable:false,parseable:true,onDrawed:function(){query(".muiRadioGroupPopList .muiCheckBoxContainer").forEach(function(rowNode,rowIndex,rowNodeArray){var cbxNodeArray=query("input[type='checkbox'][name='_select_box_signatureObjName']",rowNode);if(cbxNodeArray.length>0){var node=cbxNodeArray[0];var results=eval("("+usageContents+")");for(var i=0;i<results.length;i++){if(results[i].id==query(node)[0].defaultValue&&!results[i].fdIsFreeSign){domClass.add(rowNode,"mui-signature-lock-row");var lockHtml='<div class="mui mui-signature mui-todo_lock" ></div>';query(node).after(lockHtml)}}}})},callback:function(){dialog=null}})},300)});topic.subscribe("mui/form/checkbox/change",function(box,data){if(data.name=="_select_box_signatureObjName"){if(dialog){dialog.hide()}confirmSignature(data,null,true)}})},showDefaultSignature:function(signatureId){var data={value:signatureId,pwd:""};confirmSignature(data,null,true)},confirm:function(auditNoteFdId,modelId,modelName){Com_Parameter.event.confirm.push(function(){var flag=false;var fdAttIds="";query("#signaturePicUL li").forEach(function(node){var id=query(node)[0].id;if(id){if(fdAttIds){fdAttIds+=";"}fdAttIds+=id}});if(fdAttIds){var fdKey=auditNoteFdId+"_qz";var fdModelId=modelId;var fdModelName=modelName;dojo.xhrPost({url:Com_Parameter.ContextPath+"km/signature/km_signature_main/kmSignatureMain.do?method=submitSignature",postData:{fdAttIds:fdAttIds,fdKey:fdKey,fdModelId:fdModelId,fdModelName:fdModelName},sync:true,load:function(data){var results=eval("("+data+")");flag=results.flag},error:function(error){alert(error)}})}else{flag=true}return flag})}};function buildContentHtml(usageContents){var selectSignature=findSelectSignature();if(null==usageContents||usageContents.length==0){return"<p>"+msg["mui.operation.commonUsage.none"]+"</p>"}var html='<ul class="muiRadioGroupPopList">';var temp='<input type="checkbox" data-dojo-type="mui/form/CheckBox" name="_select_box_signatureObjName" value="!{value}" data-dojo-props="tag:\'li\',mul:false,text:\'!{text}\',checked:!{checked},pop:true">';var results=eval("("+usageContents+")");for(var i=0;i<results.length;i++){var checked=false;if(array.indexOf(selectSignature,results[i].id)!="-1"){checked=true}html+=temp.replace("!{text}",results[i].name).replace("!{value}",results[i].id).replace("!{checked}",checked)}html+="</ul>";return"<div class='muiFormSelectElement'>"+html+"</div>"}function confirmSignature(data,dialog,flag){dojo.xhrPost({url:Com_Parameter.ContextPath+"km/signature/km_signature_main/kmSignatureMain.do?method=confirmSignature",postData:{fdMainId:data.value,confirmPassword:data.pwd},load:function(res){var results=eval("("+res+")");if((results.flag=="0"||results.isFreeSign==false)&&flag){showSignaturePwd(data.value)}if(results.flag=="0"&&!flag){var warnMsg='<div class="muiSignatureDialogWarningTip">'+msg["mui.signature.warn.msg"]+"</div>";if(query(".muiSignatureDialogWarningTip").length==0){query("#signaturePwd").after(warnMsg)}domClass.add(dom.byId("signaturePwd"),"has-warning")}if(results.flag=="1"){if(dialog){dialog.hide()}if(array.indexOf(findSelectSignature(),data.value)=="-1"){signatureImgShow(results.attId,data.value)}}},error:function(error){console.log(error)}})}function signatureImgShow(fdAttId,signatureId){if(null==fdAttId||fdAttId==""){return}var imageUl=query("#signaturePicUL");var html='<li id="'+fdAttId+'" signatureid="'+signatureId+'"><img width="70" height="70" src="'+Com_Parameter.ContextPath+"sys/attachment/sys_att_main/sysAttMain.do?method=download&fdId="+fdAttId+'"/>';html+='<span id="del_'+fdAttId+'" class="btn_canncel_img"></span></li>';if(lbpm.nowNodeId=="N2"&&Lbpm_SettingInfo.isDraftNodeDisplayOpinion=="true"){if(lbpm.constant.DOCSTATUS!="11"&&Lbpm_SettingInfo.isNewPageAndDraftsManRecallPage=="true"){return}else{if(lbpm.constant.DOCSTATUS=="11"&&Lbpm_SettingInfo.isRejectPage=="true"){return}else{if(imageUl.length>0){if(imageUl[0].innerHTML==""){imageUl.html(html);query("li","signaturePicUL").forEach(function(domObj){domClass.remove(domObj,"many")})}else{imageUl.append(html);query("li","signaturePicUL").forEach(function(domObj){domClass.add(domObj,"many")});query(".btn_canncel_img").forEach(function(domObj){domClass.add(domObj,"many")})}}else{var rowhtml='<kmss:ifModuleExist path="/km/signature/">';rowhtml+='<tr id="showSignature"><td class="td_normal_title" width="15%"></td>';rowhtml+='<td colspan="3" width="85%" id="signaturePic"><div class="titleNode" id="signatureTitleDiv">'+msg["mui.lbpmNode.signature"]+'</div><ul id="signaturePicUL" class="clearfloat lui_sns_signatureList">'+html+"</ul></td></tr>";rowhtml+="</kmss:ifModuleExist>";query("#signatureRow").append(rowhtml);domStyle.set(query("#signatureRow")[0],{display:"block"})}domStyle.set(query("#signatureTitleDiv")[0],"display","block")}}}else{if(imageUl.length>0){if(imageUl[0].innerHTML==""){imageUl.html(html);query("li","signaturePicUL").forEach(function(domObj){domClass.remove(domObj,"many")})}else{imageUl.append(html);query("li","signaturePicUL").forEach(function(domObj){domClass.add(domObj,"many")});query(".btn_canncel_img").forEach(function(domObj){domClass.add(domObj,"many")})}}else{var rowhtml='<kmss:ifModuleExist path="/km/signature/">';rowhtml+='<tr id="showSignature"><td class="td_normal_title" width="15%"></td>';rowhtml+='<td colspan="3" width="85%" id="signaturePic"><div class="titleNode" id="signatureTitleDiv">'+msg["mui.lbpmNode.signature"]+'</div><ul id="signaturePicUL" class="clearfloat lui_sns_signatureList">'+html+"</ul></td></tr>";rowhtml+="</kmss:ifModuleExist>";query("#signatureRow").append(rowhtml);domStyle.set(query("#signatureRow")[0],{display:"block"})}domStyle.set(query("#signatureTitleDiv")[0],"display","block")}deleteSignature(fdAttId)}function showSignaturePwd(signatureId){var contentNode=domConstruct.create("div",{className:"muiSignatureDialogElement",innerHTML:'<div class="muiSignatureDialogTitle">'+msg["mui.signature.input.password"]+'</div><input class="muiSignatureDialogFormInput" type="password" id="signaturePwd">'});Dialog.element({showClass:"muiBackDialogShow",element:contentNode,scrollable:false,parseable:false,buttons:[{title:msg["mui.signature.cancel"],fn:function(dialog){dialog.hide()}},{title:msg["mui.signature.ok"],fn:function(dialog){var data={value:signatureId,pwd:query("#signaturePwd")[0].value};confirmSignature(data,dialog,false)}}]})}function deleteSignature(fdAttId){query("#del_"+fdAttId).on("click",function(){query("li[id='"+fdAttId+"']").remove();var liDiv=query("li","signaturePicUL");if(liDiv.length==1){query("li","signaturePicUL").forEach(function(domObj){domClass.remove(domObj,"many")})}if(liDiv.length==0){domStyle.set(query("#signatureTitleDiv")[0],"display","none")}})}function findSelectSignature(){var selectSignature=[];query("#signaturePicUL li").forEach(function(node,index,array){selectSignature.push(query(node).attr("signatureid")[0])});return selectSignature}return signatrueHtml})},"sys/lbpmservice/mobile/operation/other/SaveFormDataButton":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/_base/window","dojo/dom-construct","dojo/query","dojox/mobile/TransitionEvent","dojox/mobile/ViewController","dojox/mobile/viewRegistry","mui/util","mui/dialog/Dialog","mui/tabbar/TabBarButton","dojo/Deferred","mui/history/listener","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/dialog/Tip","dojo/html","dojo/dom","dojo/dom-style","dijit/registry","dojo/topic"],function(w,m,y,h,k,i,s,x,u,c,j,f,a,g,p,d,v,n,t,q,l,r){var b=w("sys.lbpmservice.mobile.operation.other.SaveFormDataButton",[f],{label:p["mui.button.savedraft"],processId:"",modelName:"",modelId:"",buildRendering:function(){this.inherited(arguments)},_onClick:function(A){var z=i("[id='sysWfBusinessForm.canStartProcess']");if(typeof z!="undefined"&&z.length>0){z[0].value="false"}if(lbpm){lbpm.saveFormData=true}this.beforeSubmit();if(this.docStatus==="11"){Com_Submit(document[this.formName]||document.forms[0],"update",null,{saveDraft:true})}if(this.docStatus==="20"){var B=l.byId("process_review_button");B._onClick(A)}},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments)},beforeSubmit:function(){if(this.backTo==null){view=u.getEnclosingView(this.domNode);view=u.getParentView(view)||view;this.backTo=view.id}var z=l.byId(this.backTo);if(z){z.notValRequired=true}var A=i("[id='operationMethodsGroup']");if(typeof A!="undefined"&&A.length>0){A[0].value="handler_pass:通过"}}});return b})},"sys/lbpmservice/mobile/operation/OperationButton":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/_base/window","dojo/dom-construct","dojo/query","dojox/mobile/TransitionEvent","dojox/mobile/ViewController","dojox/mobile/viewRegistry","mui/util","mui/dialog/Dialog","mui/tabbar/TabBarButton","dojo/Deferred","mui/history/listener","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/dialog/Tip","dojo/html","dojo/dom","dojo/dom-style","dijit/registry","dojo/topic"],function(w,m,y,h,k,i,s,x,u,c,j,f,a,g,p,d,v,n,t,q,l,r){var b=w("sys.lbpmservice.mobile.operation.OperationButton",[f],{icon1:"",extOptUrl:"/sys/lbpmservice/mobile/operation/extOperationViewer.jsp",processId:"",modelName:"",modelId:"",showType:"dialog",tmpl:"<div data-dojo-type=\"mui/form/RadioGroup\" data-dojo-props=\"showStatus:'edit',renderType:'table',name:'_lbpm_opt_radio',mul:'false',store:{store},orient:'vertical'\"></div>",buildRendering:function(){if(!this.domNode){this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div")}var D=[];var z=[];var C=[];var B=[];this.tasks=[];var F={};var A=this;var E=false;if(lbpm&&lbpm.settingInfo){if(lbpm.settingInfo.isHideNodeIdentifier==="true"&&lbpm.settingInfo.hideNodeIdentifierType==="isHideAllNodeIdentifier"){E=true}}m.forEach(window.LBPM_CurOperationCfg,function(K,H){if(K.taskFrom=="node"){m.forEach(K.operations,function(L,N){if(L.operationHandlerType=="drafter"||L.operationHandlerType=="historyhandler"||L.operationHandlerType=="branchadmin"){if(L.operationHandlerType=="historyhandler"){var O=p["mui.operation.processed"]+":";if(L.operationType=="history_handler_back"){C.push({text:O+L.operationName,value:K.taskId+":"+L.operationType})}else{z.push({text:O+L.operationName,value:K.taskId+":"+L.operationType})}}else{var M=L.operationHandlerType=="drafter"?p["mui.operation.drafter"]+":":p["mui.operation.branchadmin"]+":";B.push({text:M+L.operationName,value:K.taskId+":"+L.operationType})}}});var J=null;m.forEach(window.LBPM_CurNodeCfg,function(L){if(K.nodeId==L.nodeId){J=L}});var G=K.nodeId+"."+J.nodeName;if(E){G=J.nodeName}var I={text:G,value:K.taskId};A.tasks.push(I);F[K.taskId]=I}});D=C.concat(z.concat(B));if(D.length>0){this.label=p["mui.operation.process"];this.icon1="";if(this.tasks.length>1){m.forEach(D,function(H,G){var I=H.value.split(":");H.text=F[I[0]].text+"."+H.text})}this.dialogDom=k.toDom(y.replace(this.tmpl,{store:JSON.stringify(D).replace(/\"/g,"'")}))}this.inherited(arguments)},_onClick:function(z){if(this.dialog){return}z.preventDefault();z.stopPropagation();var B=new Date().getTime();var A=this.cbtime;if(A!="undefined"&&B-A<500){return false}this.cbtime=B;this.defer(function(){var C=this;this.dialog=j.element({canClose:false,showClass:"muiDialogElementShow muiFormSelect",element:this.dialogDom,position:"bottom",scrollable:false,parseable:true,callback:y.hitch(this,function(){this.dialog=null}),onDrawed:function(){this.defer(function(){C.initDialog()},200)}})},500)},initDialog:function(){var z=this;this._curTime=0;i(".muiRadioTableItem",this.dialogDom).on("click",function(F){F.preventDefault();F.stopPropagation();var B=new Date();if(B-z._curTime<500){return}z._curTime=B;var H=F.target;var E;if(H.className=="muiRadioTableItem"){E=H}else{E=i(F.target).parents(".muiRadioTableItem")[0]}var C=i("input",E).val();z.currentOprText=i(".muiRadioTableText",E).text();if(C&&C!=""){var I=C.split(":");if(I.length>1){var G=I[1];var D=I[0];if(G=="history_handler_press"||G=="drafter_press"){var A=false;$.ajax({url:Com_Parameter.ContextPath+"sys/lbpmservice/support/lbpmHistoryWorkitemAction.do?method=pressNodeIdJson",async:false,data:{workItemId:D},type:"POST",dataType:"json",success:function(J){if(J.pressTimes>0){A=true}else{A=false}},error:function(J){if(console){console.log(J)}}});if(A){v.warn({text:d["lbpmSetting.approve.ReminderCooldown.noPress"]});return false}}}}z.selOperation=C;z._afterSelect(function(){z.dialog.hide()})});if(dojoConfig.dingXForm==="true"){$(".muiDialogElementContent_bottom").children().removeClass("muiFormLeft")}},_afterSelect:function(G){var B=null;if(this.showType!="dialog"){if(this.backTo!=null){B=u.hash[this.backTo]}else{B=u.getEnclosingView(this.domNode);B=u.getParentView(B)||B;this.backTo=B.id}}else{B=u.getEnclosingView(this.domNode);B=u.getParentView(B)||B}var A=u.hash.OperationView;var E=l.byId("OperationView");if(E){if(this.selOperation!=E.selOperation){E.destroy();A=null}}if(A==null){var C=c.formatUrl(this.extOptUrl);C=c.setUrlParameter(C,"backTo",B.id);C=c.setUrlParameter(C,"processId",this.processId);C=c.setUrlParameter(C,"modelName",this.modelName);C=c.setUrlParameter(C,"modelId",this.modelId);var F=this;if(this.showType=="dialog"){C="dojo/text!"+C;this.viewNode=k.create("div");k.place(this.viewNode,B.domNode.parentNode,"last");require([C],function(I){var H=new n._ContentSetter({node:F.viewNode,parseContent:true,cleanContent:false});H.set(I);H.parseDeferred.then(function(K){var J=u.hash.OperationView;if(J&&J.initExtOpertion){J.selOperation=F.selOperation;J.initExtOpertion(F);if(G){G()}}}).then(function(){F.defer(function(){F.showOperationDialog()},300)});H.tearDown()})}else{var D=x.getInstance();D.openExternalView({url:C,transition:"slide"},B.domNode.parentNode).then(function(){var H=u.hash.OperationView;if(H&&H.initExtOpertion){H.initExtOpertion(F);if(G){G()}}})}}else{if(this.showType=="dialog"){if(A.initExtOpertion){A.initExtOpertion(this);if(G){G()}}this.showOperationDialog()}else{B.performTransition(A.id,1,"slide");if(A.initExtOpertion){A.initExtOpertion(this);if(G){G()}}}}var z=this;window.Com_BeforeSubmitDeferred=y.hitch(this,this.defaultDeferred);if(this.showType!="dialog"){g.add({callback:function(){new s(h.body(),{moveTo:z.backTo,transition:"slide",transitionDir:-1}).dispatch();window.Com_BeforeSubmitDeferred=null}})}},showOperationDialog:function(){this.operationView=t.byId("OperationView");this.dialogContentNode=k.create("div");k.place(t.byId("lbpmExtOperContent"),this.dialogContentNode,"first");var z=[];this.dialog=j.element({title:this.currentOprText||"",canClose:false,element:this.dialogContentNode,buttons:z,position:"bottom",appendTo:this.operationView,scrollable:false,parseable:false,showClass:"muiLbpmDialog",callback:y.hitch(this,function(B,A){q.set(this.operationView,{display:"none",position:"","z-index":""});q.set(i("body")[0],{"overflow-y":""});k.place(i("#lbpmExtOperContent",A.element)[0],this.operationView,"first");window.Com_BeforeSubmitDeferred=null;this.lastDialog=this.dialog;this.dialog=null}),onDrawed:y.hitch(this,function(A){q.set(this.operationView,{display:"block",position:"fixed",bottom:"0","z-index":"100"});q.set(i("body")[0],{"overflow-y":"hidden"});var D=document.documentElement.clientHeight*0.9;if(A.privateHeight){D=A.privateHeight}if(A.divNode){D=D-A.divNode.offsetHeight}if(A.buttonsNode){D=D-A.buttonsNode.offsetHeight}q.set(A.contentNode,{"max-height":D+"px","overflow-x":"hidden"});A.scrollViewNode=A.contentNode;var E=l.byId("lbpmExtOperationTabBar");if(E){E.resize()}var B=l.byId("lbpmViewOperationTabBar");if(B){B.resize()}var C=l.byId("OperationView");if(C){C.resize()}})})},_destroyDialog:function(z){if(this.dialog&&this.dialog.callback){this.dialog.callback(window,this.dialog)}this.lastDialog.hide();this.lastDialog=null},_hideDialog:function(z){if(this.dialog){q.set(this.dialog.domNode,{display:"none"})}if(t.byId("OperationView")){q.set(t.byId("OperationView"),{display:"none"})}},defaultDeferred:function(){var z=new a();z.resolve();if(this.showType!="dialog"){history.back()}else{this._hideDialog()}return z},_showDialog:function(){if(this.dialog){q.set(this.dialog.domNode,{display:"block"})}if(t.byId("OperationView")){q.set(t.byId("OperationView"),{display:"block"})}},postCreate:function(){this.inherited(arguments);if(this.showType=="dialog"){this.subscribe("/lbpm/extOperation/destroyDialog","_destroyDialog");this.subscribe("/lbpm/operation/hideDialog","_hideDialog");this.subscribe("/lbpm/operation/showDialog","_showDialog")}},startup:function(){this.inherited(arguments)}});window.closeExtDialog=function(z){z=z||window.event||arguments[0];z.cancelBubble=true;if(z.preventDefault){z.preventDefault()}if(z.stopPropagation){z.stopPropagation()}var B=new Date().getTime();var A=window.ctime;if(A!="undefined"&&B-A<500){return false}window.ctime=B;r.publish("/lbpm/extOperation/destroyDialog")};return b})},"sys/lbpmservice/mobile/node/votenode/operation_handler_agree":function(){define(["sys/lbpmservice/mobile/workitem/workitem_common"],function(d){var a={};var f=function(g){};var b=function(){return true};var c=function(){};a.handler_abstain=lbpm.operations.handler_abstain={click:f,check:b,setOperationParam:c};a.init=function(){};return a})},"sys/lbpmservice/mobile/common/syslbpmprocess_event":function(){define(["dijit/registry","dojo/_base/array","dojo/query","mui/dialog/Tip","sys/lbpmservice/mobile/import/constant"],function(a,g,f,d,c){var b={};b.addListener=lbpm.events.addListener=function(j,i){var h=lbpm.events[j];if(h==null){h=[];lbpm.events[j]=h}h.push(i)};b.removeListener=lbpm.events.removeListener=function(k,j){var h=lbpm.events[k];if(h!=null){for(var l=0;l<h.length;l++){if(j===h[l]){h.splice(l,1);return}}}};b.fireListener=lbpm.events.fireListener=function(j,m,n){var h=lbpm.events[j];if(h!=null){for(var l=0;l<h.length;l++){var k=h[l](m);if(n&&k){n(k)}}}};b.modifyNodeAttributeListener=lbpm.events.modifyNodeAttributeListener=function(q){if(!q){return}var n=false;for(var m=0,j=q.nodeInfos.length;m<j;m++){var p=q.nodeInfos[m].id;var l=q.nodeInfos[m];for(nodeField in q.nodeInfos[m]){if(lbpm.nodes[p][nodeField]!=l[nodeField]){n=true;if(nodeField=="handlerIds"){var h=lbpm.globals.analysisProcessorInfoToObject();if(h!=null&&h.toRefuseThisNodeId&&p==h.toRefuseThisNodeId){if(l.handlerIds!=lbpm.nodesInit[p]["handlerIds"]){lbpm.globals.toRefuseThisNodeHandlerChange=true;d.warn({text:lbpm.constant.MODIFYRETURNBACKHANDLER})}else{lbpm.globals.toRefuseThisNodeHandlerChange=false}}}}}}if(!n){return}if(!lbpm.modifys){lbpm.modifys={}}for(var m=0,j=q.nodeInfos.length;m<j;m++){var p=q.nodeInfos[m].id;var l=q.nodeInfos[m];for(nodeField in q.nodeInfos[m]){if(!lbpm.modifys[p]){lbpm.modifys[p]=new Object()}if(nodeField=="orgattr"){lbpm.events.setOrgAttr(l[nodeField],p)}else{lbpm.modifys[p][nodeField]=l[nodeField];lbpm.nodes[p][nodeField]=l[nodeField]}if(nodeField=="handlerIds"){lbpm.events.setOrgAttr("handlerIds:handlerNames",p)}}}if(!q.isChangeHandlerAddress){lbpm.events.mainFrameSynch()}};b.setOrgAttr=lbpm.events.setOrgAttr=function(h,i){if(lbpm.modifys[i]["orgAttributes"]&&lbpm.modifys[i]["orgAttributes"]!=""){if((lbpm.modifys[i]["orgAttributes"]).indexOf(h)==-1){lbpm.modifys[i]["orgAttributes"]=lbpm.modifys[i]["orgAttributes"]+";"+h}}else{lbpm.modifys[i]["orgAttributes"]=h}};b.modifyProcessListener=lbpm.events.modifyProcessListener=function(i){if(!i){return}var h=document.getElementsByName("sysWfBusinessForm.fdFlowContent")[0];h.value=i.xml;lbpm.globals.parseXMLObj();lbpm.events.fireListener(lbpm.constant.EVENT_FILLLBPMOBJATTU,null);lbpm.modifys={};$("input[name='sysWfBusinessForm.fdIsModify']")[0].value="1";lbpm.events.mainFrameSynch()};b.selectedManualListener=lbpm.events.selectedManualListener=function(l){l=$(l);var q=lbpm.globals.getNextNodeObj(lbpm.nowNodeId);if(l.attr("manualBranchNodeId")!=q.id){return}var m=lbpm.nodes[l.val()].startLines;var h=new Array();for(var n=0,r=m.length;n<r;n++){if(m[n].startNode.id==l.attr("manualBranchNodeId")){h[0]=m[n];break}}if(h.length==0){return}var p=lbpm.globals.getNextRouteInfo(h);var k=f("#nextNodeTD");if(k.length>0){k.forEach(function(i){g.forEach(a.findWidgets(i),function(s){s.destroy&&!s._destroyed&&s.destroy()})}).html(p,{parseContent:true})}var j=$("input[value='"+l.val()+"'][key='futureNodeId']");if(j.length>0){j[0].click()}};lbpm.events.addListener(lbpm.constant.EVENT_MODIFYNODEATTRIBUTE,lbpm.events.modifyNodeAttributeListener);lbpm.events.addListener(lbpm.constant.EVENT_MODIFYPROCESS,lbpm.events.modifyProcessListener);lbpm.events.addListener(lbpm.constant.EVENT_SELECTEDMANUAL,lbpm.events.selectedManualListener);b.mainFrameSynch=lbpm.events.mainFrameSynch=function(p){var j=lbpm.currentOperationType;if(j){if(lbpm.operations[j].isPassType){var i=lbpm.globals.analysisProcessorInfoToObject();var m=document.getElementById("operationsTDContent");var k=document.getElementById("nextNodeTD");var n=lbpm.globals.getNextNodeObj(lbpm.nowNodeId);var l=lbpm.globals.generateNextNodeInfo();if(i!=null){var h=function(q){};if(k!=null){lbpm.globals.innerHTMLGenerateNextNodeInfo(l,k,h)}else{if(m!=null){lbpm.globals.innerHTMLGenerateNextNodeInfo(l,m,h)}}}}}};return b})},"sys/lbpmservice/mobile/operation/handler/operation_handler_communicate":function(){define(["dijit/registry","mui/form/Address","sys/lbpmservice/mobile/common/syslbpmprocess","dojo/query","dojo/topic","dojo/_base/array","mui/dialog/Tip","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","dojo/NodeList-html"],function(a,h,i,k,g,j,n,c){var m={};var d="";var l=function(){lbpm.globals.clearDefaultUsageContent("handler_communicate")};var p=function(q){lbpm.globals.setDefaultUsageContent("handler_communicate");lbpm.globals.getOperationParameterJson("relationWorkitemId:relationScope:relations:isMutiCommunicate",true);m.handlerOperationTypeCommunicate(q)};var b=function(){var q=$("#toOtherHandlerIds")[0];if(q&&q.value==""){n.warn({text:q.getAttribute("alertText")});return false}if(lbpm.globals.isUsageContenRequired(lbpm.currentOperationType)){return lbpm.globals.validateMustSignYourSuggestion()}return true};var f=function(){var q=$("#toOtherHandlerIds")[0];lbpm.globals.setOperationParameterJson(q,null,"param");q=$("#toOtherHandlerNames")[0];lbpm.globals.setOperationParameterJson(q,null,"param");var r=a.byId("isMutiCommunicate");if(r){lbpm.globals.setOperationParameterJson(r.get("checked"),"isMutiCommunicate","param")}q=$("input[key='communicateScopeHandlerIds']")[0];if(q){lbpm.globals.setOperationParameterJson(q,"communicateScopeHandlerIds","param")}r=a.byId("isHiddenNoteCheckbox");if(r){lbpm.globals.setOperationParameterJson(r.get("checked"),"isHiddenNote","param")}};m.handlerOperationTypeCommunicate=function(H,G){var F="";var w=lbpm.globals.getCurrRelationInfo();var O="";var I="";if(w.length>0){for(var R=0;R<w.length;R++){O+=w[R].userId+";";I+=w[R].userName+";"}if(O){O=O.substr(0,O.lastIndexOf(";"))}if(I){I=I.substr(0,I.lastIndexOf(";"))}F+="<input type='hidden' name='currentCommunicateIds' value='"+O+"'/>";F+="<label>"+I+"</label><br/>"}var q=document.getElementById("operationsRow");var z=document.getElementById("operationsTDTitle");var D=document.getElementById("operationsTDContent");z.innerHTML=H+lbpm.constant.opt.CommunicatePeople;var N=lbpm.globals.getOperationParameterJson("relationWorkitemId:relationScope");var t=document.getElementById("sysWfBusinessForm.fdHandlerRoleInfoIds");var Q=lbpm.globals.stringConcat(t.value,O);var A=c["lbpmNode.toOtherHandler.address.subject.select"]+H+c["lbpmNode.toOtherHandler.address.subject.person"];var v={mulSelect:true,idField:"toOtherHandlerIds",nameField:"toOtherHandlerNames",splitStr:";",selectType:ORG_TYPE_POSTORPERSON,notNull:O.length<1,alertText:(lbpm.constant.opt.CommunicateIsNull+H+lbpm.constant.opt.CommunicatePeople),text:lbpm.constant.SELECTORG,exceptValue:Q.split(";"),validate:"communicateHandlerRequired required",id:"toHandlerAddress",subject:A,isShowSubject:true};var r=lbpm.nodes[lbpm.nowNodeId];if(r.operationScope&&r.operationScope.handler_communicate&&r.operationScope.handler_communicate!="all"){var K=r.operationScope.handler_communicate==null?"":r.operationScope.handler_communicate;var M=r.handlerIds==null?"":r.handlerIds;var y=r.operationScope.handler_communicate_customHandlerSelectType==null?"org":r.operationScope.handler_communicate_customHandlerSelectType;var P=r.handlerSelectType==null?"org":r.handlerSelectType;var E=r.operationScope.handler_communicate_customIds==null?"":r.operationScope.handler_communicate_customIds;var S=$("input[name='sysWfBusinessForm.fdHandlerRoleInfoIds']").val().split(";")[0];var C="&currentId="+lbpm.nowProcessorInfoObj.expectedId+"&handlerIdentity="+S+"&customHandlerSelectType="+y+"&customHandlerIds="+encodeURIComponent(E)+"&scopeType="+K+"&fdModelName="+lbpm.modelName+"&fdModelId="+lbpm.modelId+"&exceptValue="+Q;d="";d+="<input type='hidden' name='toOtherHandlerIds' id='toOtherHandlerIds'/>";d+="<input type='hidden' name='toOtherHandlerNames' id='toOtherHandlerNames'/>";d+="<div id='toHandlerAddress' data-dojo-type=\"sys/lbpmservice/mobile/opthandler/OptHandler\" data-dojo-props=\"subject:'"+A+"',validate:'communicateHandlerRequired required',required:true,showHeadImg:true,idField:'toOtherHandlerIds',isMul:"+v.mulSelect+",dataUrl:'/sys/lbpmservice/mobile/opthanlder.do?method=scopeHandlers"+C+"',nameField:'toOtherHandlerNames'\"></div>"}if(d==""){if(r.operationScope&&r.operationScope.handler_communicate=="all"&&r.operationScope.handler_communicate_defaultHandlerIds&&r.operationScope.handler_communicate_defaultHandlerIds!=""){var u=r.operationScope.handler_communicate_defaultHandlerIds;var L=r.operationScope.handler_communicate_defaultHandlerNames;var B=u.split(";");var J=L.split(";");var x=true;u="";L="";for(var R=0;R<B.length;R++){if(N.relationScope){if(N.relationScope.indexOf(B[R])==-1){x=false}}if(!x){continue}if(Q){if(Q.indexOf(B[R])!=-1){x=false}}if(x){if(u==""){u=B[R];L=J[R]}else{u+=";"+B[R];L+=";"+J[R]}}}v.idValue=u;v.nameValue=L}else{if(Lbpm_SettingInfo&&Lbpm_SettingInfo.isCommunicateWithCreatorDefault=="true"){var s=$("[name='sysWfBusinessForm.fdDraftorId']").val();var x=true;if(N.relationScope){if(N.relationScope.indexOf(s)==-1){x=false}}if(x&&(Q&&Q.indexOf(s)==-1)){v.idValue=s;v.nameValue=$("[name='sysWfBusinessForm.fdDraftorName']").val()}}}}if(N.relationWorkitemId&&N.relationScope){F+="<input type='hidden' name='toOtherHandlerIds' id='toOtherHandlerIds'/>";F+="<input type='hidden' name='toOtherHandlerNames' id='toOtherHandlerNames'/>";F+="<div id='toHandlerAddress' data-dojo-type=\"sys/lbpmservice/mobile/opthandler/OptHandler\" data-dojo-props=\"subject:'"+A+"',validate:'communicateHandlerRequired required',required:true,showHeadImg:true,idField:'toOtherHandlerIds',optHandlerIds:'"+N.relationScope+"',dataUrl:'/sys/lbpmservice/mobile/opthanlder.do?method=communicateHandlers&scopeHandles=!{optHandlerIds}',nameField:'toOtherHandlerNames'\"></div>"}else{if(d!=""){F+=d}else{F+=lbpm.address.html_build(v)}}if(!G&&(N.isMutiCommunicate==true||N.isMutiCommunicate==null)){if(Lbpm_SettingInfo&&Lbpm_SettingInfo.isMultiCommunicateConfigurable=="true"&&lbpm.flowcharts.multiCommunicateEnabled!="false"){F+="<div class='isMutiCommunicateCheckbox'>";F+='<div id="isMutiCommunicate" alertText="" key="isMutiCommunicate" data-dojo-type="mui/form/CheckBox"';F+=" data-dojo-props=\"name:'isMutiCommunicate', value:'true', mul:false, text:'";F+=lbpm.constant.opt.CommunicateScopeAllowMuti+H+"'";F+='"></div></div>';if(!lbpm.globals.setCommunicateScope.listener){require(["dojo/topic"],function(T){lbpm.globals.setCommunicateScope.listener=T.subscribe("mui/form/checkbox/valueChange",function(V,U){if(U.name=="isMutiCommunicate"){lbpm.globals.setCommunicateScope({checked:V.checked,operationName:H})}})})}lbpm.globals.setCommunicateScope({checked:false})}}if(!N.relationWorkitemId){if(Lbpm_SettingInfo&&Lbpm_SettingInfo.isHiddenCommunicateNoteConfigurable=="true"&&lbpm.flowcharts.hiddenCommunicateNoteEnabled!="false"){F+="<div class='isHiddenNoteCheckbox'>";F+='<div id="isHiddenNoteCheckbox" alertText="" key="isHiddenNoteCheckbox" data-dojo-type="mui/form/CheckBox"';F+=" data-dojo-props=\"name:'isHiddenNoteCheckbox', value:'true', mul:false, text:'";F+=lbpm.constant.opt.CommunicateHiddenNote+"'";F+='"></div></div>'}}k("#operationsTDContent").html(F,{parseContent:true,onEnd:function(){this.inherited("onEnd",arguments);if(this.parseDeferred){this.parseDeferred.then(function(){g.publish("/lbpm/operation/toHandlerAddress/parseFinish")})}}});lbpm.globals.hiddenObject(q,false);if(!G&&(N.isMutiCommunicate==true||N.isMutiCommunicate==null)){if(Lbpm_SettingInfo&&Lbpm_SettingInfo.isMultiCommunicateConfigurable=="true"&&lbpm.flowcharts.multiCommunicateEnabled!="false"&&Lbpm_SettingInfo.isMultiCommunicateDefault=="true"){setTimeout(function(){var T=a.byId("isMutiCommunicate");T.set("checked",true);lbpm.globals.setCommunicateScope({checked:true,operationName:H})},100)}}};m.hidden_Communicate_Scope=lbpm.globals.hidden_Communicate_Scope=function(){var q=document.getElementById("operationsRow_Scope");if(q){q.style.display="none"}};m.setCommunicateScope=lbpm.globals.setCommunicateScope=function(t){var v=document.getElementById("operationsRow_Scope");if(!t.checked){v.style.display="none";lbpm.globals.handlerOperationClearOperationsRow_Scope()}else{v.style.display="";var x=document.getElementById("operationsTDTitle_Scope");var s=document.getElementById("operationsTDContent_Scope");x.innerHTML=lbpm.constant.opt.CommunicateScopeLimitSub+($(t).attr("operationName")||t.operationName)+lbpm.constant.opt.CommunicateScopeLimitScope+"<span style='color:#999'>"+lbpm.constant.opt.CommunicateScopeIsNullNoLimit+"</span>";var w="";var u=document.getElementById("sysWfBusinessForm.fdHandlerRoleInfoIds");var r=u.value;if(document.getElementById("currentCommunicateIds")){r=lbpm.globals.stringConcat(r,document.getElementById("currentCommunicateIds").value)}r=lbpm.globals.stringConcat(r,document.getElementById("toOtherHandlerIds").value);var q={mulSelect:true,idField:"communicateScopeHandlerIds",nameField:"communicateScopeHandlerNames",splitStr:";",selectType:ORG_TYPE_POSTORPERSON,notNull:false,exceptValue:r.split(";"),text:lbpm.constant.SELECTORG};if(d!=""){w+=d.replace(/toOtherHandlerIds/g,"communicateScopeHandlerIds").replace(/toOtherHandlerNames/g,"communicateScopeHandlerNames").replace(/id='toHandlerAddress'/g,"").replace(/id="toHandlerAddress"/g,"")}else{q.id="";w+=lbpm.address.html_build(q)}k(s).html(w,{parseContent:true})}};m.getCurrRelationInfo=lbpm.globals.getCurrRelationInfo=function(){var q=m.getRelationInfoByWorkitemId(lbpm.nowProcessorInfoObj.id);return q};m.getRelationInfoByWorkitemId=function(t){var s=m.getRelationInfo();if(s==null){return[]}var r=[];for(var q=0;q<s.length;q++){if(s[q].srcId==t){r.push(s[q])}}return r};m.getRelationInfo=function(){var q=lbpm.globals.getOperationParameterJson("relations",true);if(q==null){return null}var r=WorkFlow_LoadXMLData(q);return r};m.handlerOperationClearOperationsRow_Scope=lbpm.globals.handlerOperationClearOperationsRow_Scope=function(){var r=document.getElementById("operationsTDTitle_Scope");var q=document.getElementById("operationsTDContent_Scope");if(r){r.innerHTML=""}if(q){q.innerHTML=""}};m.stringConcat=lbpm.globals.stringConcat=function(r,q,t){var r;var q;var t;if(!r){r=";a;c"}if(!q){q=";b;"}if(!t){t=";"}if(r.lastIndexOf(t)==r.length-1&&r){r=r.substr(0,r.lastIndexOf(t))}if(q.indexOf(t)==0&&q){q=q.substr(1)}var s=r+t+q;if(s==t){s="";return s}if(s.lastIndexOf(t)==s.length-1){s=s.substr(0,s.lastIndexOf(t))}if(s.indexOf(t)==0){s=s.substr(1)}return s};m.handler_communicate=lbpm.operations.handler_communicate={click:p,check:b,blur:l,setOperationParam:f};m.init=function(){};return m})},"sys/lbpmservice/mobile/workitem/workitem_constant":function(){define(["mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","dojo/topic"],function(h,g,f,b,a,c){window.defaultUsageContent="";window.defaultUsageContent_refuse="";window.defaultUsageContent_commission="";window.defaultUsageContent_communicate="";window.defaultUsageContent_abandon="";window.defaultUsageContent_superRefuse="";window.defaultUsageContent_sign="";window.defaultUsageContent_additionSign="";window.defaultUsageContent_assign="";window.defaultUsageContent_assignPass="";window.defaultUsageContent_assignRefuse="";window.defaultUsageContent_jump="";window.defaultUsageContent_nodeSuspend="";window.defaultUsageContent_nodeResume="";window.isPassContentRequired="false";window.isRefuseContentRequired="true";window.isCommissionContentRequired="false";window.isCommunicateContentRequired="true";window.isAbandonContentRequired="true";window.isSuperRefuseContentRequired="true";window.isSignContentRequired="true";window.isAdditionSignContentRequired="false";window.isAssignContentRequired="false";window.isAssignPassContentRequired="false";window.isAssignRefuseContentRequired="false";window.isJumpContentRequired="false";window.isNodeSuspendContentRequired="false";window.isNodeResumeContentRequired="false";window.isPassContentValidated="false";window.isRefuseContentValidated="false";window.isCommissionContentValidated="false";window.isCommunicateContentValidated="false";window.isAbandonContentValidated="false";window.isSuperRefuseContentValidated="false";window.isSignContentValidated="false";window.isAdditionSignContentValidated="false";window.isAssignContentValidated="false";window.isAssignPassContentValidated="false";window.isAssignRefuseContentValidated="false";window.isJumpContentValidated="false";window.isNodeSuspendContentValidated="false";window.isNodeResumeContentValidated="false";var j=lbpm.workitem.constant;j.COMMONHANDLERISFORMULA=g["lbpmSupport.HandlerIsFormula"];j.COMMONHANDLERISMATRIX=g["lbpmSupport.HandlerIsMatrix"];j.COMMONSELECTADDRESS=g["lbpmSupport.selectAddress"];j.COMMONSELECTFORMLIST=g["lbpmSupport.selectFormList"];j.COMMONSELECTALTERNATIVE=g["lbpmSupport.selectOptList"];j.COMMONLABELFORMULASHOW=f["label.formula.show"];j.COMMONCHANGEPROCESSORSELECT=b["lbpmNode.processingNode.changeProcessor.select"];j.COMMONNODEHANDLERORGEMPTY=b["lbpmNode.nodeHandler.orgEmpty"];j.COMMONHANDLERISRULE=g["lbpmSupport.HandlerIsRule"];j.COMMONPAGEFIRSTOPTION="==请选择==";var i=(j.COMMONHANDLERUSAGECONTENTDEFAULT=new Array());var k=(j.COMMONHANDLERUSAGECONTENTDEFAULT_ISREQUIRED=new Array());var d=(j.COMMONHANDLERUSAGECONTENTDEFAULT_ISVALIDATED=new Array());c.subscribe("mui/lbpmservice/drawReady",function(){setTimeout(function(){var l=new KMSSData();l.AddBeanData("lbpmUsageContentService");l=l.GetHashMapArray();if(l.length>0){if(l[0].defaultUsageContent){defaultUsageContent=unescape(l[0].defaultUsageContent)}if(l[0].defaultUsageContent_refuse){defaultUsageContent_refuse=unescape(l[0].defaultUsageContent_refuse)}if(l[0].defaultUsageContent_commission){defaultUsageContent_commission=unescape(l[0].defaultUsageContent_commission)}if(l[0].defaultUsageContent_communicate){defaultUsageContent_communicate=unescape(l[0].defaultUsageContent_communicate)}if(l[0].defaultUsageContent_abandon){defaultUsageContent_abandon=unescape(l[0].defaultUsageContent_abandon)}if(l[0].defaultUsageContent_superRefuse){defaultUsageContent_superRefuse=unescape(l[0].defaultUsageContent_superRefuse)}if(l[0].defaultUsageContent_sign){defaultUsageContent_sign=unescape(l[0].defaultUsageContent_sign)}if(l[0].defaultUsageContent_additionSign){defaultUsageContent_additionSign=unescape(l[0].defaultUsageContent_additionSign)}if(l[0].defaultUsageContent_assign){defaultUsageContent_assign=unescape(l[0].defaultUsageContent_assign)}if(l[0].defaultUsageContent_assignPass){defaultUsageContent_assignPass=unescape(l[0].defaultUsageContent_assignPass)}if(l[0].defaultUsageContent_assignRefuse){defaultUsageContent_assignRefuse=unescape(l[0].defaultUsageContent_assignRefuse)}if(l[0].defaultUsageContent_jump){defaultUsageContent_jump=unescape(l[0].defaultUsageContent_jump)}if(l[0].defaultUsageContent_nodeSuspend){defaultUsageContent_nodeSuspend=unescape(l[0].defaultUsageContent_nodeSuspend)}if(l[0].defaultUsageContent_nodeResume){defaultUsageContent_nodeResume=unescape(l[0].defaultUsageContent_nodeResume)}if(l[0].isPassContentRequired){isPassContentRequired=l[0].isPassContentRequired}if(l[0].isRefuseContentRequired){isRefuseContentRequired=l[0].isRefuseContentRequired}if(l[0].isCommissionContentRequired){isCommissionContentRequired=l[0].isCommissionContentRequired}if(l[0].isCommunicateContentRequired){isCommunicateContentRequired=l[0].isCommunicateContentRequired}if(l[0].isAbandonContentRequired){isAbandonContentRequired=l[0].isAbandonContentRequired}if(l[0].isSuperRefuseContentRequired){isSuperRefuseContentRequired=l[0].isSuperRefuseContentRequired}if(l[0].isSignContentRequired){isSignContentRequired=l[0].isSignContentRequired}if(l[0].isAdditionSignContentRequired){isAdditionSignContentRequired=l[0].isAdditionSignContentRequired}if(l[0].isAssignContentRequired){isAssignContentRequired=l[0].isAssignContentRequired}if(l[0].isAssignPassContentRequired){isAssignPassContentRequired=l[0].isAssignPassContentRequired}if(l[0].isAssignRefuseContentRequired){isAssignRefuseContentRequired=l[0].isAssignRefuseContentRequired}if(l[0].isJumpContentRequired){isJumpContentRequired=l[0].isJumpContentRequired}if(l[0].isNodeSuspendContentRequired){isNodeSuspendContentRequired=l[0].isNodeSuspendContentRequired}if(l[0].isNodeResumeContentRequired){isNodeResumeContentRequired=l[0].isNodeResumeContentRequired}if(l[0].isPassContentValidated){isPassContentValidated=l[0].isPassContentValidated}if(l[0].isRefuseContentValidated){isRefuseContentValidated=l[0].isRefuseContentValidated}if(l[0].isCommissionContentValidated){isCommissionContentValidated=l[0].isCommissionContentValidated}if(l[0].isCommunicateContentValidated){isCommunicateContentValidated=l[0].isCommunicateContentValidated}if(l[0].isAbandonContentValidated){isAbandonContentValidated=l[0].isAbandonContentValidated}if(l[0].isSuperRefuseContentValidated){isSuperRefuseContentValidated=l[0].isSuperRefuseContentValidated}if(l[0].isSignContentValidated){isSignContentValidated=l[0].isSignContentValidated}if(l[0].isAdditionSignContentValidated){isAdditionSignContentValidated=l[0].isAdditionSignContentValidated}if(l[0].isAssignContentValidated){isAssignContentValidated=l[0].isAssignContentValidated}if(l[0].isAssignPassContentValidated){isAssignPassContentValidated=l[0].isAssignPassContentValidated}if(l[0].isAssignRefuseContentValidated){isAssignRefuseContentValidated=l[0].isAssignRefuseContentValidated}if(l[0].isJumpContentValidated){isJumpContentValidated=l[0].isJumpContentValidated}if(l[0].isNodeSuspendContentValidated){isNodeSuspendContentValidated=l[0].isNodeSuspendContentValidated}if(l[0].isNodeResumeContentValidated){isNodeResumeContentValidated=l[0].isNodeResumeContentValidated}i.handler_pass=defaultUsageContent;i.handler_refuse=defaultUsageContent_refuse;i.handler_commission=defaultUsageContent_commission;i.handler_communicate=defaultUsageContent_communicate;i.handler_abandon=defaultUsageContent_abandon;i.handler_superRefuse=defaultUsageContent_superRefuse;i.handler_sign=defaultUsageContent_sign;i.handler_additionSign=defaultUsageContent_additionSign;i.handler_assign=defaultUsageContent_assign;i.handler_assignPass=defaultUsageContent_assignPass;i.handler_assignRefuse=defaultUsageContent_assignRefuse;i.handler_jump=defaultUsageContent_jump;i.handler_nodeSuspend=defaultUsageContent_nodeSuspend;i.handler_nodeResume=defaultUsageContent_nodeResume;k.handler_pass=isPassContentRequired;k.handler_refuse=isRefuseContentRequired;k.handler_commission=isCommissionContentRequired;k.handler_communicate=isCommunicateContentRequired;k.handler_cancelCommunicate=isCommunicateContentRequired;k.handler_abandon=isAbandonContentRequired;k.handler_superRefuse=isSuperRefuseContentRequired;k.handler_sign=isSignContentRequired;k.handler_additionSign=isAdditionSignContentRequired;k.handler_assign=isAssignContentRequired;k.handler_assignPass=isAssignPassContentRequired;k.handler_assignRefuse=isAssignRefuseContentRequired;k.handler_jump=isJumpContentRequired;k.handler_nodeSuspend=isNodeSuspendContentRequired;k.handler_nodeResume=isNodeResumeContentRequired;d.handler_pass=isPassContentValidated;d.handler_refuse=isRefuseContentValidated;d.handler_commission=isCommissionContentValidated;d.handler_communicate=isCommunicateContentValidated;d.handler_cancelCommunicate=isCommunicateContentValidated;d.handler_abandon=isAbandonContentValidated;d.handler_superRefuse=isSuperRefuseContentValidated;d.handler_sign=isSignContentValidated;d.handler_additionSign=isAdditionSignContentValidated;d.handler_assign=isAssignContentValidated;d.handler_assignPass=isAssignPassContentValidated;d.handler_assignRefuse=isAssignRefuseContentValidated;d.handler_jump=isJumpContentValidated;d.handler_nodeSuspend=isNodeSuspendContentValidated;d.handler_nodeResume=isNodeResumeContentValidated}},1)});j.COMMONUSAGECONTENTNOTNULL=a["lbpmProcess.handler.usageContent.notNull"];j.COMMONUSAGES=b["lbpmNode.createDraft.commonUsages"];j.handlerOperationTypepass=b["lbpmNode.processingNode.operationsTDTitle.handlerOperationTypepass"];j.FUTURENODESTIP=b["lbpmNode.futureNodes.tip"];(function(l){l.MUSTMODIFYHANDLERNODEIDSISNULL=b["lbpmNode.flowContent.mustModifyHandlerNodeIds.mobile.isNull"];l.VALIDATENEXTNODEHANDLERISNULL=b["lbpmNode.validate.nextNodeHandler.mobile.isNull"]})(lbpm.constant)})},"sys/lbpmservice/mobile/node/group/freesubflownode/freeSubFlowNodes":function(){define(["dojo/_base/declare","mui/form/Category","mui/address/AddressMixin","dojo/query","dojo/dom-construct","dojo/dom-style","dojo/dom-class","dojo/on","mui/util","dojo/_base/lang","dojo/_base/array","mui/dialog/Dialog","mui/i18n/_i18n!sys/mobile/js/mui/mui-common","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm"],function(g,q,a,m,f,i,n,k,h,b,j,l,c,d){var p=g("sys.lbpmservice.mobile.node.group.freesubflownode.freeSubFlowNodes",[q,a],{subject:"设置下一步",isMul:true,type:ORG_TYPE_POSTORPERSON,idField:"_freeSubFlowNodes_",id:"freeSubFlowNodes",groupNodeId:"",showHeadImg:true,_cateDialogPrefix:"__freeSubFlowNodes__",isNew:true,deptLimit:"",exceptValue:"",maxPageSize:300,dataUrl:"/sys/organization/mobile/address.do?method=addressList&parentId=!{parentId}&orgType=!{selType}&deptLimit=!{deptLimit}&maxPageSize=!{maxPageSize}",iconUrl:"/sys/lbpmservice/mobile/freeflow/image.jsp?orgId=!{orgId}",searchUrl:"/sys/organization/mobile/address.do?method=searchList&keyword=!{keyword}&orgType=!{orgType}&deptLimit=!{deptLimit}",buildRendering:function(){this.inherited(arguments);n.add(this.domNode,"muiAddressForm");if(this.showHeadImg){n.add(this.domNode,"freeFlowShowHeadImg")}},postCreate:function(){this.inherited(arguments)},domNodeClick:function(){if(this.showHeadImg){var r=m(arguments[0].target).closest(".muiCategoryAdd");if(r.length<=0){return}}var r=m(arguments[0].target).closest(".freeFlowOrg");if(r.length>0){return}this.defer(function(){this._selectCate()},350)},buildValue:function(r){f.empty(r);n.replace(r,"freeFlowFiledShow",r.className);if(this.curIds!=null&&this.curIds!=""){var t=this.curIds.split(this.splitStr);if(t.length>0){this.addSubNodeToGroup()}}this.updateFreeSubFlowNodes(r);if(lbpm.myAddedSubNodes.length==0){var u=lbpm.nodes[lbpm.nowFreeSubFlowNodeId];if(lbpm.nodes[lbpm.nowNodeId].groupNodeId==lbpm.nowFreeSubFlowNodeId||!u.initSubNodeId){var s="muiCategoryAdd mui mui-plus";this.muiCategoryAddNode=f.create("div",{className:s},r);i.set(this.muiCategoryAddNode,"display","inline-block");i.set(this.muiCategoryAddNode,"margin-left","0.3rem")}}else{this.muiCategoryAddNode=null}this.disconnect(this.orgIconClickHandle);this.connect(this.cateFieldShow,k.selector(".freeFlowOrgIcon","click"),function(v){if(v.stopPropagation){v.stopPropagation()}if(v.cancelBubble){v.cancelBubble=true}if(v.preventDefault){v.preventDefault()}if(v.returnValue){v.returnValue=false}var w=m(v.target).closest(".freeFlowOrg");w.forEach(function(B){var D=B.getAttribute("data-id");var A=lbpm.nodes[D];if(A.handlerIds.split(";").length<=1){return}this.operatingNode=A;this.operatingNodeDom=B;var y=j.map(A.handlerIds.split(";"),function(F,E){return{text:h.formatText(A.handlerNames.split(";")[E]),value:F}});var x=false;if(A.Status=="1"){if(lbpm.myAddedSubNodes.contains(A.id)){x=true}}var C=j.map(y,function(F){var E='<div data-dojo-type="sys/lbpmservice/mobile/freeflow/NodeHandlersListItem" class="_nodeHandlerListItem" name="_listItem_nodeHandlers" value="!{value}" data-dojo-props="mul:false,text:\'!{text}\',nodeId:\''+A.id+"',canEdit:"+x+'"></div>';return E.replace("!{text}",F.text).replace("!{value}",F.value)});var z="<div class='muiFormSelectElement'>"+C.join("")+"</div>";this.defer(function(){if(this.dialog!=null){return}var E=[];if(x){E=[{title:c["mui.button.cancel"],fn:function(H){H.hide()}},{title:c["mui.button.ok"],fn:b.hitch(this,this._modifyNodeHandlers)}]}else{E=[{title:"",fn:null},{title:"",fn:null}]}this.dialog=l.element({showClass:"muiDialogElementShow muiFormSelect",element:z,position:"bottom",scrollable:false,parseable:true,buttons:E,onDrawed:function(){i.set(this.containerNode,"min-height","7%");i.set(this.contentNode,"height","auto")},callback:b.hitch(this,function(){this.dialog=null})});var G=m(B).children(".name")[0];var F=f.toDom("<div class='muiDialogElementButton_bottom' style='width:100%'>"+G.innerText+"</div>");f.place(F,this.dialog.buttonsDom[0],"after");if(x){i.set(this.dialog.buttonsDom[0],"width","15%");i.set(this.dialog.buttonsDom[1],"width","15%");i.set(F,{width:"70%","float":"left"})}},300)},this)})},_buildOneOrg:function(s,v,r,u){var w=false;if(v.handlerNames){if(v.handlerNames.split(";").length>1){w=true}}if(w){var t=h.formatUrl(h.urlResolver(this.iconUrl,{orgId:""}));this.buildOrgNode(s,v,t)}else{var t=h.formatUrl(h.urlResolver(this.iconUrl,{orgId:v.handlerIds}));this.buildOrgNode(s,v,t,r,u)}},buildOrgNode:function(s,w,v,r,u){var t=this.buildNodeIcon(s,w,v);this.buildNodeTypeIcon(t,w);this.buildDeleteIcon(t,w,r,u);this.buildArrowIcon(t,w)},_delOneOrg:function(s,u){this.inherited(arguments);this.deleteFreeSubFlowNode(u);if(lbpm.myAddedSubNodes.length==0&&this.muiCategoryAddNode==null){var t=lbpm.nodes[lbpm.nowFreeSubFlowNodeId];if(lbpm.nodes[lbpm.nowNodeId].groupNodeId==lbpm.nowFreeSubFlowNodeId||t.initSubNodeId==null||t.initSubNodeId==""){var r="muiCategoryAdd mui mui-plus";this.muiCategoryAddNode=f.create("div",{className:r},this.contentNode);i.set(this.muiCategoryAddNode,"display","inline-block");i.set(this.muiCategoryAddNode,"margin-left","0.3rem")}}},buildNodeIcon:function(r,w,v){var s=f.create("div",{className:"freeFlowOrg","data-id":w.id},r);var u={style:{background:"url("+v+") center center no-repeat",backgroundSize:"cover",display:"inline-block",border:"1px solid"},className:"freeFlowOrgIcon"};if(lbpm.nowNodeId==w.id){u.style.border="1px solid #ffcccc"}f.create("div",u,s);var t=this._getNodeTitle(w);f.create("div",{className:"name",innerHTML:t},s);return s},buildNodeTypeIcon:function(r,t){var s=h.formatUrl("/sys/lbpmservice/mobile/resource/image/"+t.XMLNODENAME+".png");f.create("div",{style:{background:"url("+s+") center center no-repeat",backgroundSize:"cover",display:"block"},className:"nodeTypeIcon"},r)},buildDeleteIcon:function(s,w,r,u){var t=false;if(w.Status=="1"){if(lbpm.myAddedSubNodes.contains(w.id)){t=true}}if(w.Status!="3"){if((r&&u==null)||lbpm.nowNodeId==u){t=true}}if(t){var v=f.create("div",{className:"del mui mui-close"},s);this.connect(v,"touchend",function(x){if(x.stopPropagation){x.stopPropagation()}if(x.cancelBubble){x.cancelBubble=true}if(x.preventDefault){x.preventDefault()}if(x.returnValue){x.returnValue=false}var y=m(x.target).closest(".freeFlowOrg");y.forEach(function(z){var A=z.getAttribute("data-id");this.defer(function(){this._delOneOrg(z,A)},300)},this)})}},buildArrowIcon:function(s,u){if(u.id==lbpm.nowNodeId){this.isPassedRoute=false}var t=u.endLines[0].endNode.id;var r=lbpm.nodes[t];if(r.endLines.length==0){if(lbpm.myAddedSubNodes.length==0){var v=lbpm.nodes[lbpm.nowFreeSubFlowNodeId];if(lbpm.nodes[lbpm.nowNodeId].groupNodeId==lbpm.nowFreeSubFlowNodeId||v.initSubNodeId==null||v.initSubNodeId==""){var w=h.formatUrl("/sys/lbpmservice/mobile/resource/image/arrowGoto.png");f.create("div",{style:{background:"url("+w+") center center no-repeat",backgroundSize:"cover",display:"block"},className:"arrowGoIcon"},s)}}return}if(lbpm.myAddedSubNodes.contains(t)){this.isPassedRoute=false}var w=h.formatUrl("/sys/lbpmservice/mobile/resource/image/arrowGoto.png");if(this.isPassedRoute){w=h.formatUrl("/sys/lbpmservice/mobile/resource/image/arrowGone.png")}f.create("div",{style:{background:"url("+w+") center center no-repeat",backgroundSize:"cover",display:"block"},className:"arrowGoIcon"},s)},buildOptIcon:function(r){if(!this.showHeadImg){this.inherited(arguments)}this.muiCategoryAddNode=r},_getNodeTitle:function(u){var r=u.handlerNames;var s=r.split(";").length;var t=r;if(s>1){if(u.XMLNODENAME=="reviewNode"){if(u.processType=="0"){t=b.replace(d["mui.freeFlow.reviewNode.processType_0.nodeTitle"],[s])}else{if(u.processType=="1"){t=b.replace(d["mui.freeFlow.reviewNode.processType_1.nodeTitle"],[s])}else{if(u.processType=="2"){t=b.replace(d["mui.freeFlow.reviewNode.processType_2.nodeTitle"],[s])}}}}else{if(u.XMLNODENAME=="signNode"){if(u.processType=="0"){t=b.replace(d["mui.freeFlow.signNode.processType_0.nodeTitle"],[s])}else{if(u.processType=="1"){t=b.replace(d["mui.freeFlow.signNode.processType_1.nodeTitle"],[s])}else{if(u.processType=="2"){t=b.replace(d["mui.freeFlow.signNode.processType_2.nodeTitle"],[s])}}}}else{if(u.XMLNODENAME=="sendNode"){t=d["mui.freeFlow.sendNode.nodeTitle"]}}}}return t},_modifyNodeHandlers:function(r){var w="";var v="";var u=false;j.forEach(r.htmlWdgts,function(y){if(y&&y.name=="_listItem_nodeHandlers"){if(y._destroyed){u=true}else{w+=";"+y.value;v+=";"+y.text}}});if(!u){r.hide();return}w=w.slice(1);v=v.slice(1);this.modifyNodeHandlersInFreeFlow(this.operatingNode.id,w,v);var t=m(this.operatingNodeDom).children(".freeFlowOrgIcon")[0];if(w.split(";").length==1){var s=h.formatUrl(h.urlResolver(this.iconUrl,{orgId:w}));i.set(t,"background","url("+s+") center center / cover no-repeat")}var x=m(this.operatingNodeDom).children(".name")[0];x.innerText=this._getNodeTitle(lbpm.nodes[this.operatingNode.id]);r.hide()},returnDialog:function(s,r){if(s.key==this.idField){this.inherited(arguments);this.curIds="";this.curNames=""}},addSubNodeToGroup:function(){var r=this.getFlowChartObject();if(r){var u=this.curIds.split(this.splitStr);var w=this.curNames.split(this.splitStr);if(u.length>0){lbpm.subNodeHandlerIds=new Array();lbpm.subNodeHandlerNames=new Array();for(var t=0;t<u.length;t++){lbpm.subNodeHandlerIds.push(u[t]);lbpm.subNodeHandlerNames.push(w[t])}if(lbpm.myAddedSubNodes.length==0){var y=r.Nodes.createSubNode("reviewNode",lbpm.nowFreeSubFlowNodeId,"freeSubFlowNode");y.Data.handlerIds=lbpm.subNodeHandlerIds.join(";");y.Data.handlerNames=lbpm.subNodeHandlerNames.join(";");var v=new KMSSData();v.AddBeanData("getOperTypesByNodeService&nodeType=freeFlowReviewNode");v=v.GetHashMapArray();for(var s=0;s<v.length;s++){if(v[s].isDefault=="true"){y.Data.operations["refId"]=v[s].value;break}}if(lbpm.globals.defOperRefId){y.Data.operations["refId"]=lbpm.globals.defOperRefId}if(r.ProcessData.opinionSortIds){var x=r.ProcessData.opinionSortIds.split(";");if(Com_ArrayGetIndex(x,lbpm.nowFreeSubFlowNodeId)>-1){x.push(y.Data.id)}r.ProcessData.opinionSortIds=x.join(";")}lbpm.myAddedSubNodes.push(y.Data.id)}else{var y=r.Nodes.GetNodeById(lbpm.myAddedSubNodes[0]);y.Data.handlerIds=lbpm.subNodeHandlerIds.join(";");y.Data.handlerNames=lbpm.subNodeHandlerNames.join(";")}}this.updateFlowXml(r)}},updateFreeSubFlowNodes:function(s){f.empty(s);var u=lbpm.nodes[lbpm.nowFreeSubFlowNodeId];if(u!=null){var t=lbpm.nodes[u.startNodeId];var r=lbpm.globals.getNextNodeObj(lbpm.nowNodeId).id==lbpm.nowFreeSubFlowNodeId?true:false;this.isPassedRoute=true;this.appendFreeSubFlowNode(s,t,r,u.initSubNodeId)}},appendFreeSubFlowNode:function(s,v,r,t){var u=v.endLines[0].endNode;if(u.endLines.length==0){return}if(lbpm.nowNodeId=="N2"&&t==null){if(u.XMLNODENAME!="groupEndNode"&&u.XMLNODENAME!="groupStartNode"){lbpm.myAddedSubNodes.push(u.id)}}this._buildOneOrg(s,u,r,t);if(!this.edit){f.create("span",{innerHTML:this.splitStr},s)}this.appendFreeSubFlowNode(s,u,r,t)},deleteFreeSubFlowNode:function(t){var s=lbpm.nodes[t];if(!s){return}var r=this.getFlowChartObject();r.Nodes.deleteSubNode(t);if(lbpm.myAddedSubNodes.contains(t)){lbpm.myAddedSubNodes=new Array();lbpm.subNodeHandlerIds=new Array();lbpm.subNodeHandlerNames=new Array()}this.updateFlowXml(r)},modifyNodeHandlersInFreeFlow:function(v,s,u){var r=this.getFlowChartObject();var t=r.Nodes.GetNodeById(v);t.Data.handlerNames=u;t.Data.handlerIds=s;this.updateFlowXml(r)},getFlowChartObject:function(){var r=document.getElementById("WF_IFrame");return r.contentWindow.FlowChartObject},updateFlowXml:function(r){var t=r.BuildFlowXML();if(!t){return}var s=document.getElementsByName("sysWfBusinessForm.fdFlowContent")[0];s.value=t;lbpm.globals.parseXMLObj();lbpm.modifys={};$("input[name='sysWfBusinessForm.fdIsModify']")[0].value="1";lbpm.events.mainFrameSynch()}});return p})},"sys/lbpmservice/mobile/operation/handler/operation_handler_cancelcommunicate":function(){define(["dojo/query","dijit/registry","dojo/store/Memory","mui/dialog/Tip"],function(g,c,h,f){var i={};var d=function(j){lbpm.globals.getOperationParameterJson("relationWorkitemId:relationScope:relations:isMutiCommunicate",true);var k=document.getElementById("operationsRow");var q=lbpm.globals.getCurrRelationInfo();if(q.length>0){var n=document.getElementById("operationsTDTitle");n.innerHTML=lbpm.constant.opt.CommunicatePeople;var m='<div data-dojo-type="mui/form/CheckBoxGroup" id="WorkFlow_CelRelationWorkitemsGroup" data-dojo-props="name:\'WorkFlow_CelRelationWorkitemsGroup\',validate:\'cancelCommunicateHandlerRequired required\',required:true"></div>';var p=[];for(var l=0;l<q.length;l++){p.push({value:q[l].itemId,text:q[l].userName})}g("#operationsTDContent").html(m,{parseContent:true,onEnd:function(){this.inherited("onEnd",arguments);if(this.parseDeferred){this.parseDeferred.then(function(){var r=c.byId("WorkFlow_CelRelationWorkitemsGroup");r.setStore(new h({data:p}))})}}});lbpm.globals.hiddenObject(k,false)}else{lbpm.globals.hiddenObject(k,true)}};var a=function(){var j=dijit.registry.byId("WorkFlow_CelRelationWorkitemsGroup");var k=j.get("value");if(k==null||k==""){f.warn({text:lbpm.constant.opt.CommunicateNeedSelectCanceler});return false}if(lbpm.globals.isUsageContenRequired(lbpm.currentOperationType)){return lbpm.globals.validateMustSignYourSuggestion()}return true};var b=function(){var j=dijit.registry.byId("WorkFlow_CelRelationWorkitemsGroup");var k=j.get("value");lbpm.globals.setOperationParameterJson(k,"cancelHandlerIds","param")};i.handler_cancelCommunicate=lbpm.operations.handler_cancelCommunicate={click:d,check:a,setOperationParam:b};i.init=function(){};return i})},"sys/lbpmservice/mobile/node/reviewnode/operation_handler_refuse":function(){define(["dojo/query","dojo/store/Memory","dijit/registry","dojo/request","dojo/dom-construct","mui/dialog/Tip"],function(f,l,i,d,h,m){lbpm.operations.handler_refuse={click:j,check:p,blur:n,setOperationParam:c};function n(){lbpm.globals.clearDefaultUsageContent("handler_refuse")}function j(C){lbpm.globals.setDefaultUsageContent("handler_refuse");var z=document.getElementById("operationsRow");var E=document.getElementById("operationsTDTitle");E.innerHTML=lbpm.workitem.constant.handlerOperationTypeRefuse.replace("{refuse}",C);var D=lbpm.globals.getCurrentNodeObj();var v=D.id;var x=lbpm.nodes[lbpm.nowNodeId].extAttributes;var A=[];var B=0;for(var y=0;x&&y<x.length;y++){if(x[y].name=="refuse_types"){A=x[y].value.split(";");break}}var u=Com_Parameter.ContextPath+"sys/lbpm/engine/jsonp.jsp";var w={s_bean:"lbpmRefuseRuleDataBean",processId:f("[name='sysWfBusinessForm.fdProcessId']").val(),nodeId:v,_d:new Date().toString()};d.post(u,{handleAs:"json",data:w}).then(function(S){if(S&&S.length){var F=0;var J=[];var I=false;$.each(S,function(U,W){if(W.indexOf("#")>-1){var V=W.split("#");W=V[0];F=V[1];I=true}J.push(W)});S=J;var M='<div id="jumpToNodeIdSelectObj" data-dojo-type="mui/form/Select" key="jumpToNodeId" data-dojo-props="validate:\'jumpToNodeRequired required\',required:true,name:\'jumpToNodeIdSelectObj\', value:\'\', mul:false" ></div>';M+='<div id="triageHandler"></div>';lbpm.rejectOptionsEnabled=true;if(Lbpm_SettingInfo&&Lbpm_SettingInfo.isShowRefuseOptonal==="false"){lbpm.rejectOptionsEnabled=false}if(lbpm.rejectOptionsEnabled){var T=0;if(lbpm.flowcharts&&lbpm.flowcharts.rejectReturn=="true"){T=1}if(g("refusePassedToSequenceFlowNodeLabel",A)){M+='<div class="refusePassedToSequenceFlowNode refuseNode">';M+='<div id="refusePassedToSequenceFlowNode" alertText="" key="refusePassedToSequenceFlowNode" data-dojo-type="mui/form/CheckBox"';M+=" data-dojo-props=\"name:'refusePassedToSequenceFlowNode', value:'true', mul:false, text:'";M+=lbpm.workitem.constant.handlerOperationTypeRefuse_sequenceFlow.replace("{refuse}",C)+"'";M+=",checked:"+(B==T?true:false);M+='"></div></div>';B+=1}if(g("refusePassedToThisNodeLabel",A)){M+='<div class="refusePassedToThisNode refuseNode">';M+='<div id="refusePassedToThisNode" alertText="" key="refusePassedToThisNode" data-dojo-type="mui/form/CheckBox"';M+=" data-dojo-props=\"name:'refusePassedToThisNode', value:'true', mul:false, text:'";M+=lbpm.workitem.constant.handlerOperationTypeRefuse_returnBackMe.replace("{refuse}",C)+"'";M+=",checked:"+(B==T?true:false);M+='"></div></div>';B+=1}if(g("refusePassedToThisNodeOnNodeLabel",A)){M+='<div class="refusePassedToThisNodeOnNode refuseNode">';M+='<div id="refusePassedToThisNodeOnNode" alertText="" key="refusePassedToThisNodeOnNode" data-dojo-type="mui/form/CheckBox"';M+=" data-dojo-props=\"name:'refusePassedToThisNodeOnNode', value:'true', mul:false, text:'";M+=lbpm.workitem.constant.handlerOperationTypeRefuse_returnBack.replace("{refuse}",C)+"'";M+=",checked:"+(B==T?true:false);M+='"></div></div>';B+=1}if(g("refusePassedToTheNodeLabel",A)){M+='<div class="refusePassedToTheNode refuseNode">';M+='<div id="refusePassedToTheNode" alertText="" key="refusePassedToTheNode" data-dojo-type="mui/form/CheckBox"';M+=" data-dojo-props=\"name:'refusePassedToTheNode', value:'true', mul:false, text:'";M+=lbpm.workitem.constant.handlerOperationTypeRefuse_returnBackTheNode.replace("{refuse}",C)+"'";M+=",checked:"+(B==T?true:false);M+='"></div></div>';M+='<div id="returnBackToNodeIdSelectObj" data-dojo-type="mui/form/Select" key="returnBackToNodeId" style="display:none" data-dojo-props="name:\'returnBackToNodeIdSelectObj\', value:\'\', mul:false"></div>';B+=1}}var N=lbpm.globals.isPassedSubprocessNode();if(N){M+="<div class='isRecoverPassedSubprocessLabel refuseNode'>";M+='<div id="isRecoverPassedSubprocess" alertText="" key="isRecoverPassedSubprocess" data-dojo-type="mui/form/CheckBox"';M+=" data-dojo-props=\"name:'isRecoverPassedSubprocess', value:'true', mul:false, text:'";M+=lbpm.workitem.constant.handlerOperationTypeRefuse_abandonSubprocess.replace("{refuse}",C)+"'";M+='"></div></div>'}var O=[];O=t(S,true);var L=[];for(var K=0;K<S.length;K++){var R=lbpm.nodes[S[K]];var P=WorkFlow_getLangLabel(R.name,R.langs,"nodeName");var H=(lbpm.globals.lbpmIsRemoveNodeIdentifier()||lbpm.globals.lbpmIsHideAllNodeIdentifier())?P:(R.id+"."+P);H+=O[R.id];L.push({text:H,value:S[K]})}f("#operationsTDContent").html(M,{parseContent:true,onEnd:function(){this.inherited("onEnd",arguments);if(this.parseDeferred){this.parseDeferred.then(function(Y){var aa=i.byId("jumpToNodeIdSelectObj");aa.setStore(new l({data:L}));if(!I&&Lbpm_SettingInfo&&Lbpm_SettingInfo.isRefuseToPrevNodeDefault=="true"){aa.set("value",S[S.length-1]);q(S[S.length-1])}else{aa.set("value",S[F]);q(S[F])}if(lbpm.rejectOptionsEnabled){var ab=i.byId("refusePassedToSequenceFlowNode");var ac=f(".refusePassedToSequenceFlowNode");var ad=i.byId("refusePassedToThisNode");var X=f(".refusePassedToThisNode");var W=i.byId("refusePassedToThisNodeOnNode");var U=f(".refusePassedToThisNodeOnNode");var V=i.byId("refusePassedToTheNode");var Z=f(".refusePassedToTheNode");if(ab){ab.watch("checked",function(ah,af,ai){if(ai){if(ad){ad.set("checked",false)}if(W){W.set("checked",false)}if(V){V.set("checked",false)}}else{var ae=false;if(ad&&ad.checked){ae=true}if(W&&W.checked){ae=true}if(V&&V.checked){ae=true}if(!ae){ab.set("checked",true)}}var ag=i.byId("isRecoverPassedSubprocess");if(ag){if(this.checked){ag.set("checked",false);f(".isRecoverPassedSubprocessLabel").style("display","")}else{ag.set("checked",false);f(".isRecoverPassedSubprocessLabel").style("display","none")}}})}if(ad){ad.watch("checked",function(ah,af,ai){if(ai){if(W){W.set("checked",false)}if(V){V.set("checked",false)}if(ab){ab.set("checked",false)}}else{var ae=false;if(W&&W.checked){ae=true}if(V&&V.checked){ae=true}if(ab&&ab.checked){ae=true}if(!ae){ad.set("checked",true)}}var ag=i.byId("isRecoverPassedSubprocess");if(ag){if(ai){ag.set("checked",false);f(".isRecoverPassedSubprocessLabel").style("display","none")}else{ag.set("checked",false);f(".isRecoverPassedSubprocessLabel").style("display","")}}})}if(W){W.watch("checked",function(ah,af,ai){if(ai){if(ad){ad.set("checked",false)}if(V){V.set("checked",false)}if(ab){ab.set("checked",false)}}else{var ae=false;if(ad&&ad.checked){ae=true}if(V&&V.checked){ae=true}if(ab&&ab.checked){ae=true}if(!ae){W.set("checked",true)}}var ag=i.byId("isRecoverPassedSubprocess");if(ag){if(ai){ag.set("checked",false);f(".isRecoverPassedSubprocessLabel").style("display","none")}else{ag.set("checked",false);f(".isRecoverPassedSubprocessLabel").style("display","")}}})}if(V){V.watch("checked",function(ah,af,ai){if(ai){if(ad){ad.set("checked",false)}if(ab){ab.set("checked",false)}if(W){W.set("checked",false)}}else{var ae=false;if(ad&&ad.checked){ae=true}if(W&&W.checked){ae=true}if(ab&&ab.checked){ae=true}if(!ae){lbpm.buildReturnBackToNodeId=true;V.set("checked",true);return}}if(ai){if(!lbpm.buildReturnBackToNodeId){lbpm.globals.buildReturnBackToNodeIdSelectOption(aa)}lbpm.buildReturnBackToNodeId=false;f("#returnBackToNodeIdSelectObj").style("display","")}else{f("#returnBackToNodeIdSelectObj").style("display","none")}var ag=i.byId("isRecoverPassedSubprocess");if(ag){if(ai){ag.set("checked",false);f(".isRecoverPassedSubprocessLabel").style("display","none")}else{ag.set("checked",false);f(".isRecoverPassedSubprocessLabel").style("display","")}}})}aa.watch("value",function(){var ae=i.byId("refusePassedToTheNode");if(ae&&ae.checked){if(ab){ab.set("checked",true)}else{if(ad){ad.set("checked",true)}else{if(W){W.set("checked",true)}}}ae.set("checked",false);f("#returnBackToNodeIdSelectObj").style("display","none");U.style("display","");X.style("display","")}if(N){if(!((ad&&ad.checked)||(W&&W.checked)||(ae&&ae.checked))){f(".isRecoverPassedSubprocessLabel").style("display","")}}q(this.value)});if(N){if((ad&&ad.checked)||(W&&W.checked)||(V&&V.checked)){f(".isRecoverPassedSubprocessLabel").style("display","none")}}}})}}})}else{f("#operationsTDContent").html(lbpm.workitem.constant.noRefuseNode.replace("{refuse}",C).replace("{jump}",C)+'<input type="hidden" alertText="'+lbpm.workitem.constant.noRefuseNode.replace("{refuse}",C).replace("{jump}",C)+'" key="jumpToNodeId">');var Q=h.create("div",{id:"noRefuseNodeEmptyDiv",style:"position:relative"});h.place(Q,f("#operationsTDContent")[0],"last");var G='<div data-dojo-type=\'mui/form/Input\' data-dojo-props=\'"name":"jumpToNodeIdEmpty","showStatus":"edit","validate":"jumpToNodeRequired"\' id=\'jumpToNodeIdEmpty\' style=\'display:none;\'></div>';f("#noRefuseNodeEmptyDiv").html(G,{parseContent:true})}});lbpm.globals.hiddenObject(z,false)}function p(){var u=f("#operationsTDContent [name='jumpToNodeIdSelectObj']").val();if(u==null||u==""){m.warn({text:lbpm.workitem.constant.noRefuseNode.replace("{refuse}",lbpm.currentOperationName)});return false}if(lbpm.globals.isUsageContenRequired(lbpm.currentOperationType)){return lbpm.globals.validateMustSignYourSuggestion()}return true}function c(){var v=f("#operationsTDContent [name='jumpToNodeIdSelectObj']").val();var w=v.split(":");lbpm.globals.setOperationParameterJson(w[0],"jumpToNodeId","param");if(w.length>1){lbpm.globals.setOperationParameterJson(w[1],"jumpToNodeInstanceId","param")}else{lbpm.globals.setOperationParameterJson("","jumpToNodeInstanceId","param")}var A=i.byId("refusePassedToThisNode");if(A){lbpm.globals.setOperationParameterJson(A.checked,"refusePassedToThisNode","param")}else{lbpm.globals.setOperationParameterJson(false,"refusePassedToThisNode","param")}var z=i.byId("refusePassedToThisNodeOnNode");if(z){lbpm.globals.setOperationParameterJson(z.checked,"refusePassedToThisNodeOnNode","param")}else{lbpm.globals.setOperationParameterJson(false,"refusePassedToThisNodeOnNode","param")}var y=i.byId("refusePassedToTheNode");if(y){lbpm.globals.setOperationParameterJson(y.checked,"refusePassedToTheNode","param");if(y.checked){lbpm.globals.setOperationParameterJson(i.byId("returnBackToNodeIdSelectObj").value,"returnBackToNodeId","param")}}else{lbpm.globals.setOperationParameterJson(false,"refusePassedToTheNode","param")}var x=f("[name='trialStaffPeople']").val();lbpm.globals.setOperationParameterJson(x,"lbpmHandlerTriage","param");var u=i.byId("isRecoverPassedSubprocess");if(u){lbpm.globals.setOperationParameterJson(u.checked,"isRecoverPassedSubprocess","param")}}lbpm.globals.getHistoryPreviousNodeInfo=function(){var y=lbpm.globals.getAvailableHistoryRoute();var x=y.split(";");for(var w=x.length-1;w>=0;w--){var u=x[w].split(":");var v=lbpm.nodes[u[0]];if(lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_START,v)||lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_END,v)||lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_AUTOBRANCH,v)||lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_MANUALBRANCH,v)||lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_SEND,v)){continue}if(v.id==lbpm.nowNodeId){continue}return x[w]}};lbpm.globals.getAvailableHistoryRoute=function(){var x=document.getElementById("sysWfBusinessForm.fdTranProcessXML");var w=WorkFlow_GetStatusObjectByXML(x.value);for(var v=0;v<w.runningNodes.length;v++){var u=w.runningNodes[v];if(u.id==lbpm.nowNodeId){return u.routePath}}return""};lbpm.globals.buildReturnBackToNodeIdSelectOption=function(B){if(B==null){B=i.byId("jumpToNodeIdSelectObj")}var x=B.store.data;var y=B.value;var u=a(lbpm.globals.getNodeObj(y));var A=[];for(var v=0;v<x.length;v++){var w=lbpm.globals.getNodeObj(x[v].value);if(!s(u,w)){continue}A.push({text:x[v].text,value:x[v].value})}A.push({text:lbpm.workitem.constant.thisNode,value:lbpm.nowNodeId});var z=i.byId("returnBackToNodeIdSelectObj");z.setStore(new l({data:A}));z.set("value",A[0].value)};function a(v){var u=[];u=k(v,u);return u}function k(y,u){var x=lbpm.globals.getNextNodeObjs(y.id);for(var w=0;w<x.length;w++){var v=x[w];if(lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_END,v)){continue}if(s(u,v)){continue}u.push(v);if(v.id==lbpm.nowNodeId){continue}if(lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_SPLIT,v)){v=lbpm.globals.getNodeObj(v.relatedNodeIds);u.push(v)}k(v,u)}return u}function s(u,v){for(var w=0;w<u.length;w++){if(v.id==u[w].id){return true}}return false}function g(w,u){if(!u||u.length==0){return true}for(var v=0;v<u.length;v++){if(w==u[v]){return true}}return false}function t(z,w){var v=[];if(w){var u=[];$.each(z,function(C,D){var B=lbpm.nodes[D];if(B.handlerIds){u.push({nodeId:B.id,handlerIds:B.handlerIds,handlerSelectType:B.handlerSelectType,distinct:false})}});v=r(u)}for(var y=0;y<z.length;y++){var A=v[z[y]];if(A==null||A==""){var x=lbpm.nodes[z[y]];if(x.handlerNames!=null&&x.handlerSelectType=="org"){v[z[y]]="("+x.handlerNames+")"}else{if(x.handlerSelectType!=null){v[z[y]]="("+lbpm.workitem.constant.COMMONLABELFORMULASHOW+")"}else{v[z[y]]=""}}}else{v[z[y]]="("+A+")"}}return v}function r(v){var u=[];if(v&&v.length>0){var x="lbpmHandlerParseService&modelId="+lbpm.globals.getWfBusinessFormModelId()+"&modelName="+lbpm.globals.getWfBusinessFormModelName();for(var y=0;y<v.length;y++){var z=v[y];if(!z.handlerIds){continue}x+="&nodeId="+z.nodeId;x+="&handlerIds="+encodeURIComponent(z.handlerIds);x+="&isFormula="+(z.handlerSelectType=="formula"?"true":"false");x+="&isMatrix="+(z.handlerSelectType=="matrix"?"true":"false");x+="&isRule="+(z.handlerSelectType=="rule"?"true":"false");x+="&distinct="+(z.distinct?"true":"false")}var A=new KMSSData();var B=A.AddBeanData(x).GetHashMapArray();if(B&&B.length>0){for(var w=0;w<B.length;w++){u[B[w].nodeId]=lbpm.globals.htmlUnEscape(B[w].name)}}}return u}function b(x){var u="lbpmHandlerTriageService&modelId="+lbpm.modelId+"&fdFactId="+x;var w=[];var v=new KMSSData();w=v.AddBeanData(u).GetHashMapArray();return w}function q(x){var z=i.byId("mobile_controls_trialStaffPeople");if(z){z.destroy()}var w=WorkFlow_LoadXMLData(lbpm.globals.getProcessXmlString());if(lbpm.workitem.constant.isRefuseSelectPeople=="true"&&w&&w.refuseSelectPeople&&w.refuseSelectPeople=="true"){var B=b(x);var u="&quot;store&quot;:[";if(B.length>0){for(var y=0;y<B.length;y++){if(y==0){u+="{&quot;text&quot;:&quot;"+B[y].handlerName+"&quot;,&quot;value&quot;:&quot;"+B[y].handlerId+"&quot;}"}else{u+=",{&quot;text&quot;:&quot;"+B[y].handlerName+"&quot;,&quot;value&quot;:&quot;"+B[y].handlerId+"&quot;}"}}}u+="],";var C="&quot;name&quot;:&quot;trialStaffPeople&quot;,"+u+"&quot;mul&quot;:true,&quot;showPleaseSelect&quot;:true,&quot;leastNItem&quot;:null,&quot;showStatus&quot;:&quot;edit&quot;,&quot;subject&quot;:&quot;"+lbpm.workitem.constant.refuseSelectPeopleMessage+"&quot;,&quot;orient&quot;:&quot;none&quot;,&quot;onValueChange&quot;:&quot;__xformDispatch&quot;";var A='<xformflag id="_xform_trialStaffPeople" _xform_type="fSelect"><div data-dojo-type="sys/xform/mobile/controls/fSelect/FSelect" data-dojo-props="'+C+'" class="oldMui muiFormEleWrap popup muiFormStatusEdit muiFormRight showTitle trialStaffPeople" style="width:100%;margin-top:4px;" id="mobile_controls_trialStaffPeople"></div></xformflag>';var v=lbpm.nodes[x];if(v.processType&&v.processType=="2"){f("#triageHandler").html(A,{parseContent:true})}else{f("#triageHandler").html("")}}}})},"sys/lbpmservice/mobile/workitem/FutureNodes":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/query","dojo/_base/array","dojo/dom-class","dojo/dom-construct","dojo/dom-style","mui/form/RadioGroup","mui/form/Radio","mui/form/Select","mui/util","dijit/registry","dojo/parser","dojo/store/Memory","mui/i18n/_i18n!sys/mobile/js/mui/mui-common"],function(i,f,q,n,r,h,m,l,d,k,j,b,c,p,g){var s=i("sys.lbpmservice.mobile.workitem.Radio",[d],{rightText:null,handlerIds:null,handlerSelectType:null,isManualBranch:true,selectTemp:'<div data-dojo-type=\'sys.lbpmservice.mobile.workitem.Select\' data-dojo-props=\'name:"!{name}",value:"!{value}",mul:!{mul},placeholder:"!{placeholder}",nodeId:"!{nodeId}"\'></div>',buildRendering:function(){this.inherited(arguments);if(this.handlerIds){this.handlerIds=this.handlerIds.replace(/&#35;/g,"\\")}if(this.rightText!=null&&this.rightText!="none"){var x=this.rightText=="";var B=this;var w=function(D){var E=B.rightText="",C=D.GetHashMapArray();if(C.length>0){n.forEach(C,function(F){E=E+";"+F.name});if(E!=""){E=E.substring(1)}}B.rightTextNode=h.create("div",{className:x?"handlerNamesLabel noHandlerNamesLabel":"handlerNamesLabel",innerHTML:x?"(未设置)":"("+j.formatText(E)+")",id:"handlerShowNames["+B.index+"]"},B.fieldOptions,"last")};if(this.handlerSelectType=="formula"){lbpm.globals.formulaNextNodeHandler(this.handlerIds,true,this.distinct,w,this.value)}else{if(this.handlerSelectType=="matrix"){lbpm.globals.matrixNextNodeHandler(this.handlerIds,true,this.distinct,w,this.value)}else{if(this.handlerSelectType=="rule"){lbpm.globals.ruleNextNodeHandler(this.value,this.handlerIds,true,this.distinct,w)}else{lbpm.globals.parseNextNodeHandler(this.handlerIds,true,this.distinct,w,this.value)}}}}if(!this.isManualBranch){this.domNode.removeAttribute("key");var u=q("span.muis-form-radio.muiRadioCircle",this.radioNode);if(u&&u.length>0){var z=u[0];m.set(z,"display","none");r.add(this.radioNode,"only")}}if(this.value){var t=lbpm.nodes[this.value];if(t&&t.nodeDescType=="dynamicSubFlowNodeDesc"&&t.splitType=="custom"){lbpm.canHideNextNodeTr=false;var A=this.selectTemp.replace("!{name}","dynamicNextNodeIds_"+this.value).replace("!{value}","").replace("!{mul}",true).replace("!{nodeId}",t.id).replace("!{placeholder}",g["mui.form.please.select"]+(t.dynamicGroupShowName?t.dynamicGroupShowName:t.name));var y=h.toDom(A);var v=h.create("div",{style:{display:"inline-block",marginLeft:"20px",maxWidth:"60%"}});h.place(v,this.radioNode,"last");h.place(y,v,"last");c.parse(v)}}},_onClick:function(){if(!this.__checkFlag){this.__checkFlag=true;this.inherited(arguments);lbpm.events.fireListener(lbpm.constant.EVENT_SELECTEDFUTURENODE,null);this.__checkFlag=false}},_setCheckedAttr:function(t){this.inherited(arguments);if(t){this.defer(function(){lbpm.events.fireListener(lbpm.constant.EVENT_SELECTEDFUTURENODE,null)},420)}}});var a=i("sys.lbpmservice.mobile.workitem.Select",[k],{itemRenderer:'<input type="checkbox" data-dojo-type="mui/form/CheckBox" name="_select_box_!{valueField}" value="!{value}" data-dojo-props="tag:\'li\',mul:!{mul},text:\'!{text}\',checked:!{checked},pop:!{pop}">',_onClick:function(A){lbpm.globals.setDynamicNodeInfo();lbpm.globals.parseXMLObj();lbpm.selectedNextDynamicSubFlowRoute=true;var B=lbpm.nodes[this.nodeId];var D=B.splitNodeId;var t=lbpm.nodes[D];if(t){var C=t.defaultStartBranchIds;if(C&&!this.value){this.value=C}var v=t.canSelectDefaultBranch;var z=[];for(var w=0;w<t.endLines.length;w++){var u=t.endLines[w];var x=WorkFlow_getLangLabel(u.name,u.langs);if(!x){x=WorkFlow_getLangLabel(u.endNode.name,u.endNode.langs,"nodeName")}var y={value:u.endNode.id,text:x};if(C&&Com_ArrayGetIndex(C.split(";"),u.endNode.id)>-1&&v=="false"){y.disabled=true}z.push(y)}z=new p({data:z});this.setStore(z,this.query,this.queryOptions);this.inherited(arguments)}},createListItem:function(v){var t=this.itemRenderer;var x=(typeof(v.text)!="undefined"&&v.text!=null)?j.formatText(v.text.toString().replace("'","&#039;")):"";var u=(typeof(v.value)!="undefined"&&v.value!=null)?j.formatText(v.value.toString()):"";t=t.replace("!{text}",x);t=t.replace("!{checked}",v.selected);t=t.replace("!{value}",u);t=t.replace("!{mul}",this.mul);t=t.replace("!{valueField}",this.valueField);t=t.replace("!{pop}",this.pop);var w=h.toDom(t);if(v.disabled){w.disabled="true"}return w}});lbpm.globals.parseNextNodeHandler=function(y,v,x,A){if(y==""||y==null){return[{name:lbpm.constant.COMMONNODEHANDLERORGEMPTY}]}y=encodeURIComponent(y);var t="&modelId="+lbpm.globals.getWfBusinessFormModelId();var w=document.getElementsByName("rolesSelectObj");if(w!=null&&w.length>0){t+="&drafterId="+w[0].value}var u="lbpmHandlerParseService&handlerIds="+y+t+"&analysis4View="+v;if(x){u+="&distinct=true"}var z=new KMSSData();if(A){z.SendToBean(u,A)}else{return z.AddBeanData(u).GetHashMapArray()}};lbpm.globals.formulaNextNodeHandler=function(A,v,x,z){if(A==""||A==null){return[{name:"("+lbpm.constant.COMMONNODEHANDLERORGEMPTY+")"}]}A=encodeURIComponent(A);var t="&modelId="+lbpm.globals.getWfBusinessFormModelId()+"&modelName="+lbpm.globals.getWfBusinessFormModelName();var w=document.getElementsByName("rolesSelectObj");if(w!=null&&w.length>0){t+="&drafterId="+w[0].value}var u="lbpmHandlerParseService&formula="+A+t+"&analysis4View="+v;if(x){u+="&distinct=true"}var y=new KMSSData();if(z){y.SendToBean(u,z)}else{return y.AddBeanData(u).GetHashMapArray()}};lbpm.globals.matrixNextNodeHandler=function(u,w,y,A){if(u==""||u==null){return[{name:"("+lbpm.constant.COMMONNODEHANDLERORGEMPTY+")"}]}u=encodeURIComponent(u);var t="&modelId="+lbpm.globals.getWfBusinessFormModelId()+"&modelName="+lbpm.globals.getWfBusinessFormModelName();var x=document.getElementsByName("rolesSelectObj");if(x!=null&&x.length>0){t+="&drafterId="+x[0].value}var v="lbpmHandlerParseService&matrix="+u+t+"&analysis4View="+w;if(y){v+="&distinct=true"}var z=new KMSSData();if(A){z.SendToBean(v,A)}else{return z.AddBeanData(v).GetHashMapArray()}};lbpm.globals.ruleNextNodeHandler=function(u,A,B,w,v){if(A==""||A==null){return[{name:"("+lbpm.constant.COMMONNODEHANDLERORGEMPTY+")"}]}A=encodeURIComponent(A);var y="&modelId="+lbpm.globals.getWfBusinessFormModelId()+"&modelName="+lbpm.globals.getWfBusinessFormModelName();var z=document.getElementsByName("rolesSelectObj");if(z!=null&&z.length>0){y+="&drafterId="+z[0].value}var t="lbpmHandlerParseService&nowNodeId="+u+"&rule="+A+y+"&analysis4View="+B;if(w){t+="&distinct=true"}var x=new KMSSData();if(v){x.SendToBean(t,v)}else{return x.AddBeanData(t).GetHashMapArray()}};lbpm.globals.parseNodeHandler4CalcType=function(w){if(!w||(lbpm.nodeParseHandlers&&lbpm.nodeParseHandlers[w.id])){return}var y=null;var u=lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_SEND,w);if(w.handlerSelectType=="formula"){y=lbpm.globals.formulaNextNodeHandler(w.handlerIds,true,u)}else{if(w.handlerSelectType=="matrix"){y=lbpm.globals.matrixNextNodeHandler(w.handlerIds,true,u)}else{if(w.handlerSelectType=="rule"){y=lbpm.globals.ruleNextNodeHandler(w.id,w.handlerIds,true,u)}}}if(y&&y.length>0){var v="",x="";for(var t=0;t<y.length;t++){v+=y[t].id+";";x+=y[t].name+";"}v=v?v.substring(0,v.length-1):v;x=x?x.substring(0,x.length-1):x;if(!lbpm.nodeParseHandlers){lbpm.nodeParseHandlers={}}lbpm.nodeParseHandlers[w.id]={id:v,name:x}}};lbpm.globals.setNodeParseHandler=function(t){lbpm.globals.parseNodeHandler4CalcType(t);if(lbpm.nodeParseHandlers&&lbpm.nodeParseHandlers[t.id]){var u=lbpm.nodeParseHandlers[t.id];lbpm.nodeParseHandlerId=u.id?{value:u.id}:null;lbpm.nodeParseHandlerName=u.name?{value:u.name}:null}};return i("sys.lbpmservice.mobile.workitem.FutureNodes",[l],{routeLineInfo:null,tmpl:"<input type=\"radio\" id=\"futureNodeId[!{index}]\" data-dojo-type=\"sys.lbpmservice.mobile.workitem.Radio\" manualBranchNodeId=\"!{manualBranchNodeId}\" key=\"futureNodeId\" index=\"!{index}\"data-dojo-props=\"checked:!{checked},showStatus:'!{showStatus}',name:'!{name}',text:'!{text}',value:'!{value}',rightText:'!{rightText}',index:'!{index}',handlerSelectType:'!{handlerSelectType}',distinct:!{distinct},handlerIds:'!{handlerIds}',isManualBranch:!{isManualBranch}\">",onComplete:function(u){var v=this.generateList(u);var t=this;if(v&&v.then){v.then(function(){if(u&&u.length==1){q(".muiFieldText",t.domNode).style({"margin-left":"0","padding-left":"5px"});q(".muiFormRadio",t.domNode).style("display","none");q(".muiRadioCircle",t.domNode).style("display","none");r.add(q(".muiRadioItem",t.domNode)[0],"only")}})}},startup:function(){var u=[];if(this.routeLineInfo!=""&&this.routeLineInfo!=null){var v=this.routeLineInfo.split(";");n.forEach(v,function(y){u.push(lbpm.lines[y])})}else{var x=lbpm.globals.getNextNodeObj(lbpm.nowNodeId);u=lbpm.nodedescs[x.nodeDescType].getLines(lbpm.globals.getCurrentNodeObj(),x,true)}if(u.length==1){this.set("value",u[0].endNode.id)}var t=this;var w=false;if(Lbpm_SettingInfo&&Lbpm_SettingInfo.isHideNodeIdentifier==="true"&&(Lbpm_SettingInfo.hideNodeIdentifierType==="isHideAllNodeIdentifier"||Lbpm_SettingInfo.hideNodeIdentifierType==="isRemoveNodeIdentifier")){w=true}this.store=n.map(u,function(D,C){var y=D.endNode;var F=WorkFlow_getLangLabel(D.name,D.langs);var H=F||"";var A=lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_MANUALBRANCH,D.startNode);var E=WorkFlow_getLangLabel(y.name,y.langs,"nodeName");var B="";if(w){B=E}else{B=y.id+"."+E}var G="";if(y.nodeDescType=="freeSubFlowNodeDesc"){if(lbpm.nodes[y.startNodeId].endLines[0].endNode.nodeDescType!="groupEndNodeDesc"){var z=lbpm.nodes[y.startNodeId].endLines[0].endNode;G+="&nbsp;&rarr;&nbsp;[";if(Lbpm_SettingInfo.isRemoveNodeIdentifier!="true"){G+=z.id+"."}G+=z.name+"("+z.handlerNames+")]"}}return{text:j.formatText(H+B)+G,checked:t.value==y.id,value:y.id,manualBranchNodeId:D.startNode.id,index:C,rightText:y.handlerNames==null?"none":j.formatText(y.handlerNames),handlerIds:y.handlerIds==null?"none":j.formatText(y.handlerIds.replace(/\\/g,"&#35;")),distinct:lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_SEND,y),handlerSelectType:y.handlerSelectType,isManualBranch:A,name:A?"futureNode":"__futureNode__",showStatus:t.isEditStatus==false?"readOnly":"edit"}});this.inherited(arguments);this._doValidate()},createListItem:function(u){if(this.isConcentrate(u)){return null}var t=this.tmpl.replace("!{value}",u.value).replace("!{text}",u.text.replace(/&#39;/g,"\\'").replace(/\$/g,"$$$")).replace("!{manualBranchNodeId}",u.manualBranchNodeId).replace(/!{index}/g,u.index).replace("!{checked}",u.checked?true:false).replace("!{distinct}",u.distinct).replace("!{handlerIds}",u.handlerIds.replace(/&#39;/g,"\\'").replace(/\$/g,"$$$")).replace("!{handlerSelectType}",u.handlerSelectType).replace("!{isManualBranch}",u.isManualBranch).replace("!{name}",u.name).replace("!{rightText}",u.rightText.replace(/&#39;/g,"\\'").replace(/\$/g,"$$$")).replace("!{showStatus}",u.showStatus);var v=h.toDom(t);return v},_doValidate:function(){if(!this.validation){return}this.validation.validateElement(this)}})})},"sys/lbpmservice/mobile/change_process/AddressButtonGroup":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojox/mobile/Container","dojo/dom-class","dojo/dom-style","dojox/mobile/Tooltip","dojo/dom-construct","dojo/query","dijit/registry","dojo/_base/lang","dojo/dom-attr","dojo/_base/array","mui/dialog/Dialog"],function(g,f,c,n,h,m,d,l,a,b,k,i,j){return g("sys.lbpmservice.AddressButtonGroup",[f,c],{tmpl:"<div data-dojo-type=\"mui/form/RadioGroup\" data-dojo-props=\"showStatus:'edit',name:'_lbpm_address_button_radio',mul:'false',store:{store},orient:'vertical'\"></div>",buildRendering:function(){this.inherited(arguments);n.add(this.domNode,"muiAddressButtonGroup")},startup:function(){if(this._started){return}this.inherited(arguments);this.store=[];this.childrenMap={};i.forEach(this.getChildren(),function(q){var p={text:q.text,value:q.id};this.childrenMap[q.id]=q;this.store.push(p)},this);this.dialogNode=d.toDom(b.replace(this.tmpl,{store:JSON.stringify(this.store).replace(/\"/g,"'")}));n.add(this.dialogNode,"newMui");this.connect(this.domNode,"click","_onClick")},_onClick:function(p){var q=this;if(this.dialog!=null){return}this.dialog=j.element({canClose:false,showClass:"muiDialogElementShow muiFormSelect",element:this.dialogNode,position:"bottom",scrollable:false,parseable:true,onDrawed:function(){q.attachClick()},callback:b.hitch(this,function(){this.dialog=null})})},attachClick:function(){var p=this;p._curTime=0;l(".muiRadioItem",this.dialogNode).on("click",function(q){q.preventDefault();q.stopPropagation();var u=new Date();if(u-p._curTime<500){return}p._curTime=u;var r=q.target;var s;if(r.className=="muiRadioItem"){s=r}else{s=l(r).parents(".muiRadioItem")[0]}p.dialog.hide();p.dialog=null;var t=p.childrenMap[l("input",s).val()];if(t&&t._selectCate){t._selectCate()}})}})})},"sys/lbpmservice/mobile/freeflow/freeflowNodeSplit":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/query","dojo/dom-attr"],function(a,c,d,f){var b=a("sys.lbpmservice.mobile.freeflow.freeflowNodeSplit",[c],{buildRendering:function(){this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.subscribe("/sys/lbpmservice/freeflow/formatNodeFinish","buildSplit")},buildSplit:function(){var k=lbpm.nodes[this.nodeId];if(k){if(k.XMLNODENAME=="splitNode"){var t=d(".freeFlowOrg[data-id='"+this.nodeId+"']",d(".freeFlowFiledShow")[0]);t.addClass("freeflowSplit");var p=this.getNextPoint();var s=this.getPoint();var g=p.maxTop-p.minTop;var q=p.minTop+g/2-s.top+18.5;var j=95-g/2;t.append("<style>.freeFlowFiledShow .freeflowSplit[data-id='"+this.nodeId+"']:before{width:"+g+"px;top:"+q+"px;left:"+j+"px}</style>");for(var m=0;m<k.endLines.length;m++){var n=k.endLines[m].endNode.id;var t=d(".freeFlowOrg[data-id='"+n+"']",d(".freeFlowFiledShow")[0]);t.addClass("freeflowSplitNodeLeft")}}else{if(k.XMLNODENAME=="joinNode"){var t=d(".freeFlowOrg[data-id='"+this.nodeId+"']",d(".freeFlowFiledShow")[0]);t.addClass("freeflowSplit");var l=this.getNextPoint();var s=this.getPoint();var g=l.maxTop-l.minTop;var q=l.minTop+g/2-s.top+18.5;var j=-g/2;t.append("<style>.freeFlowFiledShow .freeflowSplit[data-id='"+this.nodeId+"']:before{width:"+g+"px;top:"+q+"px;left:"+j+"px}</style>");t.addClass("freeflowSplitNodeLeft");for(var m=0;m<k.startLines.length;m++){var h=k.startLines[m].startNode.id;var t=d(".freeFlowOrg[data-id='"+h+"']",d(".freeFlowFiledShow")[0]);t.addClass("freeflowSplitNodeRight");var r=f.get(t[0],"data-left");if(r){qleft=parseInt(r)}t.append("<style>.freeFlowFiledShow .freeflowSplitNodeRight[data-id='"+h+"'] .nodeAddLine:after{width:"+(s.left-qleft-97)+"px;}</style>")}}}}},getNextPoint:function(){var n=0;var l=999999;var h=0;var j=lbpm.nodes[this.nodeId];if(j){if(j.XMLNODENAME=="splitNode"){for(var m=0;m<j.endLines.length;m++){var p=j.endLines[m].endNode.id;var r=d(".freeFlowOrg[data-id='"+p+"']",d(".freeFlowFiledShow")[0]);if(r.length>0){var q=f.get(r[0],"data-left");if(q){h=parseInt(q)}var k=f.get(r[0],"data-top");if(k){k=parseInt(k);if(n<k){n=k}if(l>k){l=k}}}}}else{if(j.XMLNODENAME=="joinNode"){for(var m=0;m<j.startLines.length;m++){var g=j.startLines[m].startNode.id;var r=d(".freeFlowOrg[data-id='"+g+"']",d(".freeFlowFiledShow")[0]);if(r.length>0){var q=f.get(r[0],"data-left");if(q){h=parseInt(q)}var k=f.get(r[0],"data-top");if(k){k=parseInt(k);if(n<k){n=k}if(l>k){l=k}}}}}}}return{maxTop:n,minTop:l,left:h}},getPoint:function(){var k=0;var j=0;var i=d(".freeFlowOrg[data-id='"+this.nodeId+"']",d(".freeFlowFiledShow")[0]);if(i.length>0){var g=f.get(i[0],"data-left");if(g){k=parseInt(g)}var h=f.get(i[0],"data-top");if(h){j=parseInt(h)}}return{top:j,left:k}}});return b})},"sys/lbpmservice/mobile/workitem/CommonUsageButton":function(){define(["dojo/_base/declare","mui/tabbar/TabBarButton","dojo/_base/window","dojox/mobile/TransitionEvent","dojox/mobile/ViewController","dojox/mobile/viewRegistry","mui/util","dijit/registry","dojo/topic","dojo/dom-style","dojo/query","mui/history/listener","dojo/html","dojo/dom-construct"],function(f,p,k,m,b,n,i,a,h,j,l,c,g,d){return f("sys.lbpmservice.mobile.workitem.CommonUsageButton",[p],{viewId:"commonUsageAddView",viewUrl:"/sys/lbpmservice/mobile/workitem/commonUsageView.jsp",startup:function(){this.inherited(arguments)},getBackToView:function(){var q=null;if(this.backTo){q=n.hash[this.backTo]}if(!q){q=n.getEnclosingView(this.domNode);q=n.getParentView(q)||q}return q},onClick:function(){var q=this;if(!n.hash[this.viewId]){this.initView()}else{this.transitionView()}},initView:function(){var q=this;var s=this.getBackToView();var r=i.formatUrl(this.viewUrl);r="dojo/text!"+r;require([r],function(v){var u=d.create("div");d.place(u,s.domNode.parentNode,"last");var t=new g._ContentSetter({node:u,parseContent:true,cleanContent:false});t.set(v);t.parseDeferred.then(function(x){var w=n.hash.commonUsageCreateView;if(w){j.set(w.domNode,{display:"none"})}}).then(function(){q.transitionView()});t.tearDown()})},transitionView:function(){var q=this;var s=this.getBackToView();if(s){s.performTransition(this.viewId,1,"slide")}else{new m(k.body(),{moveTo:this.viewId,transition:"slide",transitionDir:1}).dispatch()}if(this.viewId=="commonUsageManageView"){h.publish("/lbpm/commonUsageView/move")}var r=n.hash[this.viewId];c.add({callback:function(){if(s){r.performTransition(q.backTo,-1,"slide")}else{new m(k.body(),{moveTo:q.backTo,transition:"slide",transitionDir:-1}).dispatch()}}})}})})},"sys/lbpmservice/mobile/common/LbpmView":function(){define(["dojo/_base/declare","./LbpmPanel","dojo/topic","dojo/dom-class","dojo/dom-style","dojox/mobile/ScrollableView","mui/NativeView","dojo/query"],function(c,b,d,j,f,i,h,g){var a=dojoConfig._native?h:i;return c("sys/lbpmservice/mobile/common/LbpmView",[a,b],{postCreate:function(){this.inherited(arguments);if(this.showType=="dialog"){this.subscribe("/lbpm/validate/toTop","_scrollToTop")}},resize:function(k){this.inherited(arguments);if(dojoConfig._native){return}try{if(navigator.userAgent.indexOf("UCBrowser")>-1||navigator.userAgent.indexOf("DingTalk")>-1){if(this.maxHeight<parseInt(this.domNode.style.height)){this.maxHeight=parseInt(this.domNode.style.height)}else{this.domNode.style.height=this.maxHeight+"px"}}}catch(k){}},onBeforeTransitionIn:function(){this.inherited(arguments);if(lbpm&&lbpm.events){this.defer(function(){lbpm.events.mainFrameSynch()},100)}return true},onAfterTransitionIn:function(){d.publish("mui/view/currentView",this)},doBackToTop:function(l,k){if(k&&k.methodSwitch==false){if(this.touchNode){f.set(this.touchNode,"transform","translate3d(0px, 0px, 0px)")}}},_scrollToTop:function(q,x){if(this.showType=="dialog"){var u=g(".muiLbpmDialog .muiDialogElementContent_bottom")[0];var v=0;if(x){v=x.y||0}var n=-v;var l=this._getDomPos().y;var w=n-l;var z=300;var s=30;var r=10;var m=w/r;var p=0;var k=window.setInterval(function(){if(p<=r-1){l+=m;p++;u.scrollTo(0,l)}else{window.clearInterval(k)}},s)}},_getDomPos:function(){if(this.showType=="dialog"){var k=g(".muiLbpmDialog .muiDialogElementContent_bottom")[0];return{y:k.scrollTop}}}})})},"sys/lbpmservice/mobile/common/LbpmFolder":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/query","dojo/dom","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojox/mobile/_css3","dojo/fx","mui/folder/_Folder","dojo/topic","dojo/_base/lang","dojo/Deferred","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm"],function(g,f,m,d,n,j,c,q,b,p,h,a,l,k,i){return g("sys/lbpmservice/mobile/common/LbpmFolder",[f,p],{expandDomId:null,isExpand:false,hideStyle:{},showStyle:{},showType:null,buildRendering:function(){this.inherited(arguments);this.boxNode=c.create("div",{className:"mui-lbpm-foldOrUnfold-box"},this.domNode);this.textNode=c.create("span",{className:"mui-lbpm-foldOrUnfold-box-text",innerHTML:k["lbpmservice.view.openMorenActionView"]},this.boxNode);this.downIconNode=c.create("i",{className:"mui-lbpm-foldOrUnfold-box-icon icon-drop-down"},this.boxNode);this.upIconNode=c.create("i",{className:"mui-lbpm-foldOrUnfold-box-icon icon-drop-up"},this.boxNode);j.set(this.upIconNode,{display:"none"})},startup:function(){this.inherited(arguments)},show:function(r){if(this.isExpand){b.wipeOut({node:d.byId(this.expandDomId),duration:10}).play();j.set(this.upIconNode,{display:"none"});j.set(this.downIconNode,{display:""});this.textNode.innerHTML=k["lbpmservice.view.openMorenActionView"]}else{var s=new l();s.then(a.hitch(this,function(){var t=this._getDomOffsetTop(this.domNode);var u=window;if(this.showType=="dialog"){u=m(".muiLbpmDialog .muiDialogElementContent_bottom")[0]}this._scrollTo(u,{y:0-t+110})}));b.wipeIn({node:d.byId(this.expandDomId),duration:100}).play();j.set(this.downIconNode,{display:"none"});j.set(this.upIconNode,{display:""});this.textNode.innerHTML=i["lbpmservice.view.closeMorenActionView"];this.defer(function(){s.resolve()},150)}this.isExpand=!this.isExpand},_scrollTo:function(x,D){var B=0;if(D){B=D.y||0}var v=-B;var s=this.getPos(x).y;var C=v-s;if(C<=20){return}var E=300;var A=30;var z=10;var u=C/z;var w=0;var r=window.setInterval(function(){if(w<=z-1){s+=u;w++;x.scrollTo(0,s)}else{window.clearInterval(r)}},A)},getPos:function(r){if(r==window){return{y:document.documentElement.scrollTop||document.body.scrollTop}}else{return{y:r.scrollTop}}},_getDomOffsetTop:function(t){var s=t;var r=0;while(s!=null&&s!=document.body){r+=s.offsetTop;s=s.offsetParent}return r}})})},"sys/lbpmservice/mobile/node/reviewnode/operation_handler_nodeSuspend":function(){define(["sys/lbpmservice/mobile/workitem/workitem_common"],function(d){var a={};var g=function(){lbpm.globals.clearDefaultUsageContent("handler_nodeSuspend")};var f=function(h){lbpm.globals.setDefaultUsageContent("handler_nodeSuspend")};var b=function(){if(lbpm.globals.isUsageContenRequired(lbpm.currentOperationType)){return lbpm.globals.validateMustSignYourSuggestion()}return true};var c=function(){};a.handler_nodeSuspend=lbpm.operations.handler_nodeSuspend={click:f,check:b,blur:g,setOperationParam:c}})},"sys/lbpmservice/node/autobranchnode/node_desc":function(){(function(b){b.autoBranchNodeDesc.getLines=a;function a(d,f,c){if(c==false){return d.endLines}return f.endLines}})(lbpm.nodedescs)},"sys/lbpmservice/mobile/freeflow/freeflowNodeAttribute":function(){define(["dojo/_base/declare","mui/form/Category","dojo/topic","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","dijit/registry","dojo/_base/window","dojox/mobile/sniff"],function(d,h,c,f,a,i,b){var g=d("sys.lbpmservice.mobile.freeflow.freeflowNodeAttribute",[h],{templURL:"sys/lbpmservice/mobile/freeflow/freeflowNodeAttribute.jsp",_cateDialogPrefix:"__freeflowNodeAttribute__",subject:f["mui.freeFlow.lbpm.node.attrSet"],nodeName:"",idField:"__freeflowNodeAttribute__",key:"__freeflowNodeAttribute__",attrFileds:["name","langs","handlerIds","handlerNames","processType","notifyType","canModifyMainDoc","canAddAuditNoteAtt","flowPopedom","opinionType","isFixedNode","canJump","ignoreOnHandlerSame","onAdjoinHandlerSame","ignoreOnFutureHandlerSame"],postCreate:function(){this.inherited(arguments);this.subscribe("/sys/lbpmservice/freeflow/ok","_saveAttr");this.subscribe("/sys/lbpmservice/freeflow/_delteNode","_delteNode");this.subscribe("/sys/lbpmservice/freeflow/attrValueChange","_attrValueChange");this.subscribe("/mui/form/valueChanged","_nodeNameChange")},_delteNode:function(j){if(j.nodeId==this.nodeId&&j.state==this.state){c.publish("/sys/lbpmservice/freeflow/__deleteNode",this);this.closeDialog(j)}},_saveAttr:function(j){if(j.nodeId==this.nodeId&&j.state==this.state){var m=a.byId("lbpm_free_validate");if(m.validate()){var l=this.getNode();if(l){for(var k=0;k<this.attrFileds.length;k++){var n=this.attrFileds[k];if(this[n]){l.Data[n]=this[n]}}c.publish("/sys/lbpmservice/freeflow/updateNode",this);lbpm.globals.saveOrUpdateFreeflowVersion()}this.closeDialog(j)}}},_attrValueChange:function(j,l){if(j.nodeId==this.nodeId&&j.state==this.state){for(var k in l){this[k]=l[k]}}},_nodeNameChange:function(j,n){if(j.name=="nodeName_"+this.nodeId+"_"+this.state){var m=this.getNode();if(!m){return}if(j.value!=this.name){this.name=j.value;if(this.langs){var l=JSON.parse(this.langs);if(l.nodeName&&_userLang){for(var k=0;k<l.nodeName.length;k++){if(l.nodeName[k]["lang"]==_userLang){l.nodeName[k]["value"]=j.value;break}}this.langs=JSON.stringify(l)}}}}},_selectCate:function(j){this._init(j);this.inherited(arguments);i.doc.dojoClick=!b("ios")||b("ios")>13},_init:function(j){this.nodeId=j.nodeId;this.state=j.state;this.template=j.template;var k=this.getNode();if(k){this.name=k.Data.name;this.langs=k.Data.langs}},getNode:function(){var k=document.getElementById("WF_IFrame");var j=k.contentWindow.FlowChartObject;return j.Nodes.GetNodeById(this.nodeId)}});return g})},"sys/lbpmservice/mobile/node/checknode/operation_handler_giveup":function(){define(["sys/lbpmservice/mobile/operation/operation_common_passtype","dijit/registry"],function(d,c){function h(){lbpm.globals.clearDefaultUsageContent("handler_giveup");lbpm.globals.hiddenObject(document.getElementById("freeSubFlowNodeRow"),true);if(lbpm.myAddedSubNodes.length>0){var k=document.getElementById("WF_IFrame");var i=k.contentWindow.FlowChartObject;i.Nodes.deleteSubNode(lbpm.myAddedSubNodes[0]);lbpm.myAddedSubNodes=new Array();lbpm.subNodeHandlerIds=new Array();lbpm.subNodeHandlerNames=new Array();var l=i.BuildFlowXML();if(!l){return}var j=document.getElementsByName("sysWfBusinessForm.fdFlowContent")[0];j.value=l;lbpm.globals.parseXMLObj();lbpm.modifys={};$("input[name='sysWfBusinessForm.fdIsModify']")[0].value="1";var m=c.byId("freeSubFlowNodes");if(m){m.buildValue(m.contentNode)}}}function f(j){lbpm.globals.setDefaultUsageContent("handler_giveup");var k=document.getElementById("operationsRow");var m=document.getElementById("operationsTDTitle");var n=document.getElementById("operationsTDContent");if(n){m.innerHTML=lbpm.workitem.constant.handlerOperationTypepass;lbpm.globals.hiddenObject(k,false);var i=lbpm.globals.analysisProcessorInfoToObject();if(i!=null){var l=lbpm.globals.generateNextNodeInfo();lbpm.globals.innerHTMLGenerateNextNodeInfo(l,n)}}}function a(i){if(lbpm.globals.common_operationCheckForPassType(i)){if(lbpm.globals.isUsageContenRequired(lbpm.currentOperationType)){return lbpm.globals.validateMustSignYourSuggestion()}return true}else{return false}}function b(){}var g={};g.handler_giveup=lbpm.operations.handler_giveup={isPassType:true,isHideOperationsRow:true,click:f,check:a,blur:h,setOperationParam:b};return g})},"sys/lbpmservice/mobile/operation/handler/operation_handler_assignrefuse":function(){define(["sys/lbpmservice/mobile/workitem/workitem_common"],function(c){var f={};var g=function(){lbpm.globals.clearDefaultUsageContent("handler_assignRefuse")};var d=function(h){lbpm.globals.setDefaultUsageContent("handler_assignRefuse")};var a=function(){if(lbpm.nowProcessorInfoObj.type!="assignWorkitem"){return false}if(lbpm.globals.isUsageContenRequired(lbpm.currentOperationType)){return lbpm.globals.validateMustSignYourSuggestion()}return true};var b=function(){};f.handler_assignRefuse=lbpm.operations.handler_assignRefuse={click:d,check:a,blur:g,setOperationParam:b};f.init=function(){};return f})},"sys/lbpmservice/mobile/node/signnode/operation_handler_sign":function(){define(["sys/lbpmservice/mobile/operation/operation_common_passtype"],function(c){lbpm.operations.handler_sign={isPassType:true,isHideOperationsRow:true,click:d,check:a,blur:f,setOperationParam:b};function f(){lbpm.globals.clearDefaultUsageContent("handler_sign")}function d(h){lbpm.globals.setDefaultUsageContent("handler_sign");var i=document.getElementById("operationsRow");var k=document.getElementById("operationsTDTitle");var l=document.getElementById("operationsTDContent");k.innerHTML=lbpm.workitem.constant.handlerOperationTypepass;lbpm.globals.hiddenObject(i,false);var g=lbpm.globals.analysisProcessorInfoToObject();if(g!=null){var j=lbpm.globals.generateNextNodeInfo();lbpm.globals.innerHTMLGenerateNextNodeInfo(j,l)}}function a(){if(lbpm.globals.isUsageContenRequired(lbpm.currentOperationType)){if(lbpm.globals.validateMustSignYourSuggestion()){return lbpm.globals.common_operationCheckForPassType()}return false}return lbpm.globals.common_operationCheckForPassType()}function b(){}})},"sys/lbpmservice/mobile/node/votenode/operation_handler_disagree":function(){define(["sys/lbpmservice/mobile/workitem/workitem_common"],function(c){var f={};var d=function(g){};var a=function(){return true};var b=function(){};f.handler_disagree=lbpm.operations.handler_disagree={click:d,check:a,setOperationParam:b};f.init=function(){};return f})},"sys/lbpmservice/mobile/node/draftnode/Radio":function(){define(["dojo/_base/declare","mui/form/Radio","dojo/topic"],function(c,b,a){var d=c("sys.lbpmservice.mobile.node.draftnode.Radio",[b],{_onClick:function(){this.inherited(arguments);lbpm.events.fireListener(lbpm.constant.EVENT_SELECTEDFUTURENODE);lbpm.globals.setNextBranchNodes(this.domNode);a.publish("/sys/lbpmservice/mobile/draftnode/radio/change",this)},_setCheckedAttr:function(f){this.inherited(arguments);if(f){lbpm.events.fireListener(lbpm.constant.EVENT_SELECTEDFUTURENODE)}}});return d})},"sys/lbpmservice/mobile/workitem/CommonUsageList":function(){define(["dojo/_base/declare","dojo/topic","mui/list/JsonStoreList","mui/util","mui/dialog/Tip","dojo/request","dojo/_base/lang","mui/i18n/_i18n!sys/mobile/js/mui/mui-common"],function(d,c,h,a,b,g,i,f){return d("sys.lbpmservice.mobile.workitem.CommonUsageList",[h],{dataUrl:"/sys/lbpmservice/support/lbpm_usage/lbpmUsage.do?method=getUsagesInfo&mobile=true",updateUrl:"/sys/lbpmservice/support/lbpm_usage/lbpmUsage.do?method=update4Mobile",baseClass:"commonUsageList",lazy:false,buildRendering:function(){this.url=a.urlResolver(this.dataUrl,this);this.inherited(arguments)},startup:function(){this.inherited(arguments)},postCreate:function(){this.subscribe("/lbpm/commonUsageView/move","_reload");this.subscribe("/lbpm/commonUsageItem/delete","_deleteItem");this.subscribe("/lbpm/commonUsageItem/update","_updateItem")},_reload:function(){this.reload()},_deleteItem:function(j){this.type="delete";var k=this.getUsage(j);this.updateUsage(k)},_updateItem:function(j){this.type="update";var k=this.getUsage(j);this.updateUsage(k)},getUsage:function(n){var k=this.listDatas||[];var j="";for(var l=0;l<k.length;l++){var q=k[l];if(q.fdId!=n.fdId){continue}if(q.fdId==n.fdId&&q.index!=n.index&&this.type=="delete"){if(j){j+="\n"+q.fdContent}else{j+=q.fdContent}}if(q.fdId==n.fdId&&this.type=="update"){var m="";if(q.index==n.index){m+=n.fdContent}else{m+=q.fdContent}if(j){j+="\n"+m}else{j+=m}}}var p={};p.fdId=n.fdId;p.fdUsageContent=j;return p},updateUsage:function(m){var j=this;var l=b.processing();l.show();var k=a.formatUrl(this.updateUrl);var n=g.post(k,{data:m,headers:{Accept:"application/json"},handleAs:"json"}).then(function(p){l.hide();if(p.status===false){var q=f["mui.return.failure"];b.fail({text:q,cover:true});return}b.success({text:f["mui.return.success"],callback:i.hitch(j,j.doBack),cover:true})},function(p){l.hide();var q=f["mui.return.failure"];b.fail({text:q,cover:true})})},doBack:function(){if(this.type=="update"){c.publish("/lbpm/commonUsageItem/updateFinish")}this.reload()}})})},"sys/lbpmservice/mobile/operation/ExtOperationView":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-class","dojox/mobile/ViewController","dojox/mobile/viewRegistry","dojo/query","dojo/request","dojo/topic","dijit/registry","mui/util","mui/dialog/Dialog","mui/dialog/Tip","mui/device/device","mui/device/adapter","dojox/mobile/ScrollableView","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","dojo/dom-style","dojo/parser","dojo/dom-construct"],function(u,j,w,l,v,s,f,d,q,k,b,g,t,r,m,n,h,p,c,i){var a=u("sys.lbpmservice.mobile.operation.ExtOperationView",[n],{processId:"",buildRendering:function(){this.inherited(arguments);window.showFlowChartView=this.showFlowChartView},showFlowChartView:function(x){location=b.formatUrl("/sys/lbpmservice/mobile/lbpm_audit_note/flowchart.jsp?processId="+x)},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments)},initExtOpertion:function(z){this.initOtherInfo();if(z.selOperation){var A=z.selOperation.split(":");if(this.curTaskId==A[0]&&this.curOperationType==A[1]){return}if(this.curOperationMod){if(this.curOperationMod.blur){this.curOperationMod.blur()}}this.curTaskId=A[0];this.curOperationType=A[1];var y=this;this.resetViewInfo();j.forEach(window.LBPM_CurOperationCfg,function(D,C){if(D.taskId==y.curTaskId){y.curTask=D;j.forEach(D.operations,function(E,F){if(E.operationType==y.curOperationType){y.curOperation=E}})}});var B=this.curOperation.operationHandlerType=="drafter"?"起草人:":(this.curOperation.operationHandlerType=="branchadmin"?"分支特权人:":"已处理:");B=B+this.curOperation.operationName;f("#OperationMethodTable .detailNode").html(B);var x=null;if(y.curOperation.operationHandlerType=="drafter"){x=window.LBPM_DrafterJs}else{if(y.curOperation.operationHandlerType=="branchadmin"){x=window.LBPM_BranchAdminJs}else{x=window.LBPM_HistoryJs}}x=j.map(x,function(C){if(C.substr(0,1)=="/"){C=C.substr(1)}if(C.substr(C.length-3,C.lenghth)==".js"){C=C.substr(0,C.length-3)}return C});require(x,function(){for(var D=0;D<arguments.length;D++){var E=arguments[D];if(E[y.curOperationType]){if(E.init){E.init()}else{console.warn(x[D]+" 没有init方法 ")}var C=E[y.curOperationType];y.curOperationMod=C;if(C.click){if(y.curOperation.operationHandlerType=="branchadmin"){var F={};F.curTask=y.curTask;C.click(F)}else{C.click()}}}}})}},resetViewInfo:function(){f("#OperationView .actionArea").style({display:""});if(Lbpm_SettingInfo.isShowCurrentHandlers=="false"){f("#curNodeInfoArea .actionView").style({display:"none"})}},initOtherInfo:function(x){if(!this.initEvent){this.initSubmitButton(x);this.initCommonUsage(x);this.initEvent=true}},initSubmitButton:function(z){var y=this;var x=k.byId("OperationSubmit");w.mixin(x,{_onClick:function(){var C=new Date().getTime();if(y._curTime&&C-y._curTime<500){return}y._curTime=C;if(!y.curOperationMod.check()){return}var D={taskId:y.curTaskId,processId:y.processId,activityType:y.curTask.activityType,operationType:y.curOperationType};D.param={operationName:y.curOperation.operationName,notifyOnFinish:true,auditNoteFrom:(""+r.getClientType())};if(y.curOperationMod.setOperationParam){y.curOperationMod.setOperationParam(D.param)}var A={};f("#updateInfo input",y.domNode).forEach(function(E){A[E.name]=E.value});A.param=JSON.stringify(D);var B=window.Com_BeforeSubmitDeferred();B.then(w.hitch(this,function(){d.post(b.formatUrl("/sys/lbpmservice/mobile/extOperation.do?method=update"),{data:A,handleAs:"json"}).then(function(E){if(E.sucess){t.success({text:lbpm.constant.OPRSUCCESS,callback:function(){var F=m.goBack();if(F==null){history.back()}y.defer(function(){if(y.curOperationType=="drafter_return"){document.location.reload()}},500)}})}else{if(E.msg!=""||E.msg!=="处理出错."){t.fail({text:E.msg})}else{t.fail({text:lbpm.constant.OPRFAILURE})}}},function(E){t.fail({text:lbpm.constant.OPRFAILURE})})}),w.hitch(this,function(){t.fail({text:lbpm.constant.OPRFAILURE})}))}})},buildContentHtml:function(z){var A='<input type="checkbox" data-dojo-type="mui/form/CheckBox" name="_ext_box_commonUsageObjName" value="!{value}" data-dojo-props="mul:false,text:\'!{text}\'">';var D=j.map(z,function(F){while(F.indexOf("nbsp;")!=-1){F=F.replace("&nbsp;"," ")}F=F.replace(/\'/g,"\\'").replace(/\"/g,"&quot;");return{text:F,value:F}});var B="";if(D.length==0){B="<p>"+h["mui.operation.commonUsage.none"]+"</p>"}else{B=j.map(D,function(F){return A.replace("!{text}",F.text).replace("!{value}",F.value)});B="<div class='muiFormSelectElement commonUsageSlectElement'>"+B.join("")+"</div>";var y=s.getEnclosingView(f("#commonUsagesArea")[0]);var E=s.getParentView(y);var x=null;if(!E&&window.backToViewId){x=window.backToViewId}else{y=E||y;x=y.id}var C=[];C.push({id:"addUsageButton",label:"添加审批语",icon1:"mui mui-plus",backTo:x,viewId:"commonUsageCreateView"});C.push({id:"manageUsageButton",label:"管理",icon1:"mui mui-file-rar",backTo:x,viewId:"commonUsageManageView"});C=JSON.stringify(C);B+="<ul fixed='bottom' class='muiViewBottom' data-dojo-type='sys/lbpmservice/mobile/workitem/CommonUsageTabbar' data-dojo-props='buttons:"+C+"'></ul>"}return B},getNewestCommonUsages:function(){var x=[];var y=Com_Parameter.ContextPath+"sys/lbpmservice/support/lbpm_usage/lbpmUsage.do?method=getUsagesInfo";d.get(y,{handleAs:"text",sync:true}).then(function(z){var A=z?decodeURIComponent(z):null;if(A!=null&&A!=""){x=A.split("\n")}window.currentUsageContents=x});return x},initCommonUsage:function(B){var A=this;var z=new KMSSData();z.AddBeanData("lbpmUsageTarget&type=getUsagesInfo");var x=z.GetHashMapArray();if(x&&x[0]){var E=x[0].usagesInfo?decodeURIComponent(x[0].usagesInfo):null;var y=[];if(E!=null&&E!=""){y=E.split("\n")}var D=A.buildContentHtml(y);var C=null;f("#"+A.id+" #commonExtUsages").on("touchend",function(){setTimeout(function(){C=g.element({element:D,showClass:"muiDialogSelect muiFormSelect commonUsageDialog",position:"bottom",scrollable:false,parseable:true,callback:function(){C=null},onDrawed:function(F){var G=document.documentElement.clientHeight*0.8;if(F.privateHeight){G=F.privateHeight}if(F.divNode){G=G-F.divNode.offsetHeight}if(F.buttonsNode){G=G-F.buttonsNode.offsetHeight}p.set(F.scrollViewNode,{"max-height":G+"px","overflow-x":"hidden"});q.subscribe("/workitem/commonUsage/hideDialog",function(){if(C){p.set(C.domNode,{display:"none"})}});q.subscribe("/workitem/commonUsage/showDialog",function(){if(C){var I=A.getNewestCommonUsages();D=A.buildContentHtml(I||[]);j.forEach(C.htmlWdgts,function(J){if(J&&J.destroy){J.destroy()}});C.element=D;i.empty(C.contentNode);var H=C.contentNode;if(C.scrollable){H=i.create("div",{className:"muiDialogScrollView","data-dojo-type":"mui/NativeView"},C.contentNode);isParse=true;C.scrollViewNode=H}i.place(D,H);c.parse(C.contentNode).then(function(J){C.htmlWdgts=J;C.loaded()});p.set(C.domNode,{display:""});p.set(C.scrollViewNode,{"max-height":G+"px","overflow-x":"hidden"})}})}})},300)});q.subscribe("mui/form/checkbox/change",function(I,J){if(J.name!="_ext_box_commonUsageObjName"){return}if(C){C.hide()}C=null;if(typeof lbpm.workitem.constant.COMMONUSAGES_ISAPPEND=="undefined"){var H=new KMSSData();H.AddBeanData("lbpmUsageTarget&type=getUsagesIsAppend");var G=H.GetHashMapArray();if(G&&G[0]){var K=G[0].isAppend?G[0].isAppend:null;if(K!=null&&K!=""){lbpm.workitem.constant.COMMONUSAGES_ISAPPEND=K}else{lbpm.workitem.constant.COMMONUSAGES_ISAPPEND=true}}}var F=f("#"+A.id+" textarea[name='ext_usageContent']");if(lbpm.workitem.constant.COMMONUSAGES_ISAPPEND=="true"){F.val(F.val()+J.value.replace(/\\\'/g,"'"))}else{F.val(J.value.replace(/\\\'/g,"'")+"\r\n")}})}}});return a})},"sys/lbpmservice/mobile/workitem/workitem_common":function(){define(["dojo/_base/lang","dijit/registry","dojo/topic","sys/lbpmservice/mobile/common/syslbpmprocess","mui/dialog/Tip","mui/util","dojo/request"],function(b,a,d,g,k,f,c){var i={};var j=function(l,p,n){if(p==null){return l}for(var m=0;m<p.length;m++){if(n==p[m]["lang"]){return p[m]["value"]||l}}return l};var h=function(){var q=$("#operationMethodsGroup");if(q.length==0){return}var m=q.attr("view-type");if(m=="input"){return}var v=g.analysisProcessorInfoToObject();var u={};if(_isLangSuportEnabled){var x=lbpm.globals.getCurrentNodeObj();if(x.operations&&x.operations.refId!=null){var n=new KMSSData();n.AddBeanData("getOperationsByDefinitionService&fdId="+x.operations.refId);n=n.GetHashMapArray();if(n.length>0){var l=n[0].operation;l=$.parseJSON(l);for(var p=0;p<l.length;p++){if(typeof l[p].langs!="undefined"){u[l[p].type+"-"+l[p].name]=$.parseJSON(l[p].langs)}}}}else{if(typeof x.langs!="undefined"){if(x.langs!=""){var t=$.parseJSON(x.langs);u=t.nodeOpr||{}}}}}var s=m=="select"?(function(C,B,y,A){var z="<option value='"+C+":"+B+"' ";if(C==lbpm.defaultOperationType){z+="selected='true' "}z+=">"+B+"</option>";return z}):(function(C,B,y,A){var z="<nobr><label style='padding-right:5px;'><input type='radio' alertText='' key='operationType' name='oprGroup' value='"+C+":"+B+"' ";if(C==lbpm.defaultOperationType){z+="checked='true' "}z+=" onclick='lbpm.globals.clickOperation(this);'>"+B+"</label></nobr>";z+=" ";return z});var w=m=="select"?(function(){$("#operationMethodsGroup").change(function(){lbpm.globals.clickOperation(this)});$("#operationMethodsGroup  option").each(function(){var z=this;var y=lbpm.operations[z.value.split(":")[0]];if(y&&y.isPassType){$(z).attr("selected",true);return false}});lbpm.globals.clickOperation($("#operationMethodsGroup")[0].value)}):(function(){var y=$("#operationMethodsGroup input[name='oprGroup']");if(y.length==1){y.attr("disabled",false);y.attr("checked",true);y.attr("onclick","return;")}if(y.length==0){return}y.each(function(){var A=this;if(this.checked){lbpm.globals.clickOperation(A);return false}var z=lbpm.operations[A.value.split(":")[0]];if(z&&z.isPassType){$(A).attr("checked",true);lbpm.globals.clickOperation(A);return false}})});var r="";$.each(v.operations,function(y,z){var A=u[z.id];var B=z.name;if(typeof A=="undefined"){A=u[z.id+"-"+B]}if(typeof A!="undefined"){B=j(B,A,_userLang)}r+=s(z.id,Com_HtmlEscape(B),z,v)});q.html(r);w()};i.saveDraftAction=lbpm.globals.saveDraftAction=function(p){var w=lbpm.nowProcessorInfoObj;if(!w){return}var r=lbpm.operations.getfdUsageContent();if(!r){return}if(r.value!=""){var n=4000;if(r.value.length>n){var q=lbpm.constant.ERRORMAXLENGTH;var v=lbpm.constant.CREATEDRAFTCOMMONUSAGES;q=q.replace(/\{0\}/,v).replace(/\{1\}/,n);return}}else{return}if(p){p.disabled=true}try{var m=Com_Parameter.ContextPath+"sys/lbpmservice/support/lbpm_process/lbpmProcess.do?method=saveDraft&ajax=true";var y=new KMSSData();var t={};t.taskId=g.getOperationParameterJson("id");t.processId=$("[name='sysWfBusinessForm.fdProcessId']")[0].value;t.auditNote=r.value;t.auditNoteFdId=$("input[name='sysWfBusinessForm.fdAuditNoteFdId']").val();if(lbpm.noticeHandlers){var l="";for(var s=0;s<lbpm.noticeHandlers.length;s++){var x=lbpm.noticeHandlers[s];l+=x.id+";";l+=x.name+";";l+=x.startPos+";";if(s==lbpm.noticeHandlers.length-1){l+=x.endPos}else{l+=x.endPos+"|"}}t.noticeHandlers=l}y.AddHashMap(t);y.SendToUrl(m,function(z){if(p){p.disabled=false;alert(z.responseText)}})}catch(u){throw u;if(p){p.disabled=false}}};i.setHandlerInfoes=lbpm.globals.setHandlerInfoes=function(n){var r;var m;var q;if(!lbpm.nowNodeId){return}r=document.getElementsByName("handlerIds")[0];if(!r){return}m=document.getElementsByName("handlerNames")[0];q=document.getElementById("handlerShowNames");q.innerHTML="("+m.value+")";var p=lbpm.globals.getCurrentNodeObj();var t=lbpm.globals.getNextNodeObj(p.id);t.handlerIds=r.value;t.handlerNames=m.value;if(n!=null){t.handlerSelectType=n}var l=new Array();l.push({id:t.id,handlerIds:t.handlerIds,handlerNames:t.handlerNames});var s={};s.nodeInfos=l;lbpm.events.fireListener(lbpm.constant.EVENT_MODIFYNODEATTRIBUTE,s)};i.checkModifyNextNodeAuthorization=lbpm.globals.checkModifyNextNodeAuthorization=function(m){if(lbpm.nowNodeId==null){return false}var n=lbpm.globals.getCurrentNodeObj();if(n.canModifyHandlerNodeIds!=null&&n.canModifyHandlerNodeIds!=""){var l=(n.canModifyHandlerNodeIds+";").indexOf(m+";");if(l!=-1){return true}}if(n.mustModifyHandlerNodeIds!=null&&n.mustModifyHandlerNodeIds!=""){var l=(n.mustModifyHandlerNodeIds+";").indexOf(m+";");if(l!=-1){return true}}return false};i.getCurrentNodeDescription=lbpm.globals.getCurrentNodeDescription=function(){var n=lbpm.globals.getCurrentNodeObj();if(n&&n.description){var m=n.description;var m=WorkFlow_getLangLabel(n.description,n.langs,"nodeDesc");var l=/\[url=([^\]]+)\]([^\[]*)\[\/url\]/ig;m=m.replace(l,function(q,p,r){if(r){return"<span><a href="+p+" target=_blank>"+r+"</a></span>"}else{return"<span><a href="+p+" target=_blank>"+p+"</a></span>"}});m=m.replace(/\r\n/ig,"<br/>").replace(/\n/ig,"<br/>");if(m.indexOf("<a href=")!=-1&&m.indexOf("script")!=-1){m=m.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}$("#currentNodeDescription").html(m);$("#nodeDescriptionRow").show();$("#lbpmOtherInfo").show();lbpm.isShowLbpmOtherInfo=true}else{$("#currentNodeDescription").html("");$("#nodeDescriptionRow").hide();if(!lbpm.isShowLbpmOtherInfo){$("#lbpmOtherInfo").hide();lbpm.isShowLbpmOtherInfo=false}}};i.operationItemsChanged=lbpm.globals.operationItemsChanged=function(r,q){if(r){lbpm.nowProcessorInfoObj=lbpm.processorInfoObj[r.selectedIndex]}var m=lbpm.nowProcessorInfoObj;lbpm.nowNodeId=m.nodeId;lbpm.globals.handlerOperationClearOperationsRow();h();var p=WorkFlow_LoadXMLData($("input[name='sysWfBusinessForm.fdCurNodeSavedXML']")[0].value);if(p.tasks&&p.tasks.length>0){var n=$.grep(p.tasks,function(t,s){return t.id==m.id});if(n.length>0){var l=a.byId("fdUsageContent");if(l){l.set("value",lbpm.globals.htmlUnEscape(n[0].data));lbpm.globals.initNoticeHandlersDataAction()}}}if(!q){lbpm.events.fireListener(lbpm.constant.EVENT_CHANGEWORKITEM,null);lbpm.events.fireListener("updateShowLimitTimeOperation",null)}};i.updateShowLimitTimeOperation=lbpm.globals.updateShowLimitTimeOperation=function(){if(!lbpm.nowProcessorInfoObj){return}var m=lbpm.nowProcessorInfoObj.nodeId;var s=lbpm.modelId;var p=lbpm.nowProcessorInfoObj.type;var t="lbpmProcessLimitTimeOperationLogService&processId="+s+"&nodeFactId="+m+"&type="+p;var q=new KMSSData().AddBeanData(t).GetHashMapArray()[0];if(q&&q.status){var l=parseInt(q.status);var r;if(l==0){r=Data_GetResourceString("sys-lbpmservice:lbpmNode.processingNode.timeoutRow");lbpm.isTimeoutTotal="true"}else{if(l==1){r=Data_GetResourceString("sys-lbpmservice:lbpmNode.processingNode.limitTimeRow");lbpm.isTimeoutTotal="false"}else{$("#lbpmLimitTimeMethodTable").hide();$(".limitOptionsSplitLine").removeClass("optionsSplitLine");$(".limitOptionsSplitLine").hide();lbpm.limitTotalTime=null}}if(l==0||l==1){var n='<span class="limit_time_span" style="border-radius: 2px; padding: 2px 7px;">'+q.day+"</span> "+Data_GetResourceString("sys-lbpmservice:FlowChartObject.Lang.Node.day")+' <span class="limit_time_span" style="border-radius: 2px; padding: 2px 7px;">'+q.hour+'</span> : <span class="limit_time_span" style="border-radius: 2px; padding: 2px 7px;">'+q.minute+'</span> : <span class="limit_time_span" style="border-radius: 2px; padding: 2px 7px;">'+q.second+"</span>";$("#lbpmLimitTimeMethodTable").show();$(".limitOptionsSplitLine").show();$(".limitOptionsSplitLine").addClass("optionsSplitLine");$("#limitTimeMethodRowTitle .titleNode").html(r);$("#limitTimeMethodRow .detailNode").html(n);lbpm.limitTotalTime=q.total?q.total:null}}else{$("#lbpmLimitTimeMethodTable").hide();$(".limitOptionsSplitLine").removeClass("optionsSplitLine");$(".limitOptionsSplitLine").hide()}};i.clickOperation=lbpm.globals.clickOperation=function(n){var r=(typeof(n)=="string"?n:n.value).split(":");if(!r){return}var m=r[0];var s=lbpm.currentOperationType;if(s){var q=lbpm.operations[s];if(q&&q.blur){q.blur()}}var t=lbpm.operations[m];lbpm.globals.handlerOperationClearOperationsRow();if(t){t.click(r[1],n);var p=document.getElementById("operationsRow");if(t.isHideOperationsRow&&lbpm.canHideNextNodeTr&&Lbpm_SettingInfo.isHideOperationsRow=="true"){lbpm.globals.hiddenObject(p,true);var u=$(".actionTop").offset();var l=$(".optionsSplitLine").eq(0).offset();if(u&&l&&l.top-u.top<=20){$(".optionsSplitLine").eq(0).hide();$(".actionCenter").hide()}}else{if(p&&p.style.display!="none"){$(".optionsSplitLine").eq(0).show();$(p).closest("div.actionCenter").show()}}}lbpm.currentOperationType=m;lbpm.events.fireListener(lbpm.constant.EVENT_CHANGEOPERATION,lbpm.currentOperationType)};i.setOperationParameterJson=lbpm.globals.setOperationParameterJson=function(q,p,m,l){if(q==null){return}var t,n;if(l){if(typeof(l)=="string"){if(l==""){t=null}else{t=$.parseJSON(l)}}else{if(l==null||l.value==""){t=null}else{t=$.parseJSON(l.value)}}}else{l=$("input[name='sysWfBusinessForm.fdParameterJson']")[0];if(l==null||l.value==""){t=null}else{t=$.parseJSON(l.value)}}if(!t){t={}}if(q==null){n=null}else{if(typeof(q)=="object"){var s=$(q);p=p||(s.attr("key")?s.attr("key"):s.attr("name"));if(q.type=="checkbox"){n=q.checked}else{if(q.type=="select-one"){if(q.options.length>0){n=q.options[q.selectedIndex].value}else{n=""}}else{n=q.value}}}else{n=q}}if(p==null){return}if(m){var r="if(!jsonObj."+m+") jsonObj."+m+"=new Object();jsonObj."+m+"."+p+"=objValue;";(new Function("jsonObj","objValue",r))(t,n)}else{var r="jsonObj."+p+"=objValue;";(new Function("jsonObj","objValue",r))(t,n)}if(typeof(l)=="string"){l=lbpm.globals.objectToJSONString(t)}else{l.value=lbpm.globals.objectToJSONString(t)}};i.getRolesSelectObj=lbpm.globals.getRolesSelectObj=function(){var n="";var m=function(){var q=document.getElementById("sysWfBusinessForm.fdHandlerRoleInfoIds");var p=q.value.split(";");return p[0]};var l=a.byId("rolesSelectObj");if(!l){return m()}n=l.get("value");if(n!=null&&n!=""){return n}return m()};i.validateMustSignYourSuggestion=lbpm.globals.validateMustSignYourSuggestion=function(l){var m=false;lbpm.events.fireListener(lbpm.constant.EVENT_validateMustSignYourSuggestion,null,function(n){if(n){m=true}});if(!m){if(!l){k.warn({text:lbpm.constant.opt.MustSignYourSuggestion})}return false}return true};i.getHandlerRoleInfoNamesByOrgConfig=lbpm.globals.getHandlerRoleInfoNamesByOrgConfig=function(n){if(!n){return null}var l;var m=f.formatUrl("/sys/lbpmservice/support/lbpm_process/lbpmProcess.do?method=getHandlerRoleInfoNamesByOrgConfig");c.post(m,{sync:true,data:{handlerRoleInfoIds:n}}).then(function(p){if(p.indexOf("<error>")==-1){l=p}});return l};i.isLastHandler=lbpm.globals.isLastHandler=function(){var l=Com_Parameter.ContextPath+"sys/lbpm/engine/jsonp.jsp";var m={s_bean:"lbpmIsLastHandlerService",processId:lbpm.modelId,nodeFactId:lbpm.nowNodeId,_d:new Date().toString()};c.post(l,{data:m,handleAs:"json",sync:true}).then(function(n){if(n&&n.isLastHandler&&n.isLastHandler==true){lbpm.isLastHandler=true}else{lbpm.isLastHandler=false}},function(n){lbpm.isLastHandler=false});return lbpm.isLastHandler};i.init=function(){lbpm.events.addListener(lbpm.constant.EVENT_validateMustSignYourSuggestion,function(){var l=lbpm.operations.getfdUsageContent();if(l&&b.trim(l.value)!=""){return true}return false})};return i})},"sys/lbpmservice/mobile/workitem/OperationSwitchButton":function(){define(["dojo/_base/declare","mui/tabbar/TabBar","mui/tabbar/TabBarButton","mui/dialog/Dialog","dijit/registry","dojo/dom-construct","dojo/dom-class","dojo/_base/array","dojo/_base/lang","dojo/topic","dojo/query","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","dojo/NodeList-traverse"],function(f,h,m,j,a,d,l,i,b,g,k,c){return f("sys.lbpmservice.mobile.workitem.OperationSwitchButton",[m],{methodSwitch:true,options:[],tmpl:"<div data-dojo-type=\"mui/form/RadioGroup\" data-dojo-props=\"showStatus:'edit',name:'_lbpm_switch_radio',renderType:'table',mul:'false',store:{store},orient:'vertical'\"></div>",buildRendering:function(){if(this.methodSwitch){if(!this.label){this.label=c["mui.workitem.operation.other"]}}else{if(!this.icon1){this.icon1="mui mui-attr"}if(!this.label){this.label=c["mui.workitem.operation.transaction"]}}if(this.options.length>0){this.label=this.label+(this.methodSwitch?"":("("+this.options.length+")"))}this.inherited(arguments);if(!this.methodSwitch){l.add(this.domNode,"lbpmSwitchButton muiSplitterButton")}},startup:function(){if(this._started){return}this.inherited(arguments)},onClick:function(n){if(this.dialog){return false}n.preventDefault();n.stopPropagation();var q=new Date().getTime();var p=this.cbtime;if(p!="undefined"&&q-p<500){return false}this.cbtime=q;if(this.options.length>0){this.dialogDom=d.toDom(b.replace(this.tmpl,{store:JSON.stringify(this.options).replace(/\"/g,"'")}))}this.defer(function(){if(this.dialogDom){var r=this;this.dialog=j.element({canClose:false,showClass:"muiDialogElementShow muiFormSelect",element:this.dialogDom,position:"bottom",scrollable:false,parseable:true,onDrawed:function(){r.initOptionsEvent()},callback:function(){r.dialog=null}})}},500)},initOptionsEvent:function(){var p=this;var n=k(".muiRadioTableItem",this.dialogDom);if(!this.methodSwitch){var q=null;var r=null;i.forEach(this.options,function(s){if(s.checked){q=s.value}});n.forEach(function(s){if(k("input",s).val()==q){r=s}});l.add(r,"lbpmSwitchOption")}p._curTime=0;n.on("click",function(s){s.preventDefault();s.stopPropagation();var v=new Date();if(v-p._curTime<500){return}p._curTime=v;var t=s.target;var u;if(t.className!=""&&t.className.indexOf("muiRadioTableItem")>-1){u=t}else{u=k(s.target).parents(".muiRadioTableItem")[0]}g.publish("/lbpm/operation/switch",p,{methodSwitch:p.methodSwitch,value:k("input",u).val(),label:a.byNode(k("input",u)[0]).text});p.dialog.hide();p.dialog=null})}})})},"sys/lbpmservice/mobile/workitem/workitem_common_load":function(){define(["dojo/query","dojo/_base/array","dijit/registry","dojo/topic","dojo/store/Memory","sys/lbpmservice/mobile/common/syslbpmprocess"],function(i,f,a,c,h,d){var k={};var j=function(){var p=lbpm.globals.getProcessorInfoObj();if(p!=null){var n=i("#operationItemsRow")[0];if(n!=null){var q=a.byId("operationItemsSelect");if(q!=null){var r=[];f.forEach(p,function(w,t){var v="";var s=(w.parentHandlerName?w.parentHandlerName+"：":"");var u=WorkFlow_getLangLabel(lbpm.nodes[w.nodeId].name,lbpm.nodes[w.nodeId]["langs"],"nodeName");if(w.expectedName){if(b()){v=s+u+"("+w.expectedName+")"}else{if(b()){v=s+u}else{v=w.nodeId+"."+s+u}}}else{v=w.nodeId+"."+s+u}r.push({text:v,value:t+""})});q.setStore(new h({data:r}));q.on("attrmodified-value",function(s){var t=s.detail.newValue;lbpm.globals.operationItemsChanged({selectedIndex:parseInt(t)},false)})}else{q=i("#operationItemsSelect")[0];if(q!=null){var l=0;for(var m=0;m<p.length;m++){if(p[m]==lbpm.nowProcessorInfoObj){l=m;break}}q.value=l}}if(p.length==1){lbpm.globals.hiddenObject(n,true)}else{lbpm.globals.hiddenObject(n,false)}}}};var g=function(){var l=lbpm.globals.getProcessorInfoObj();if(l==null){lbpm.globals.validateControlItem();return}lbpm.globals.getCurrentNodeDescription();var m=a.byId("operationItemsSelect")||i("#operationItemsSelect")[0];if(m&&m.value&&m.value!=""){lbpm.globals.operationItemsChanged({selectedIndex:parseInt(m.value)},false)}};var b=function(){var l=false;if(lbpm&&lbpm.settingInfo){if(lbpm.settingInfo.isHideNodeIdentifier==="true"&&lbpm.settingInfo.hideNodeIdentifierType==="isHideAllNodeIdentifier"){l=true}}return l};k.init=function(){if(lbpm.nowProcessorInfoObj==null){return}j();setTimeout(function(){g()},0);c.subscribe("/lbpm/operation/switch",function(m,l){if(l&&!l.methodSwitch){g()}});setTimeout("lbpm.globals.getThroughNodes(null,null,null,null,null,true)",1)};return k})},"sys/lbpmservice/mobile/opthandler/OptHandlerAddressList":function(){define(["dojo/_base/declare","mui/address/AddressList","dojo/_base/lang","mui/util"],function(b,d,c,a){return b("mui.sys.lbpmservice.OptHandlerAddressList",[d],{optHandlerIds:"",buildQuery:function(){var f=this.inherited(arguments);return c.mixin(f,{exceptValue:this.exceptValue,optHandlerIds:this.optHandlerIds})}})})},"sys/lbpmservice/mobile/node/joinnode/operation_handler_restartconbranch":function(){define(["dijit/registry","mui/form/Address","dojo/query","sys/lbpmservice/mobile/common/syslbpmprocess","dojo/store/Memory","mui/dialog/Tip"],function(a,f,i,g,h,k){var j=function(){};var l=function(w){var s=document.getElementById("operationsRow");var x=document.getElementById("operationsTDTitle");var p=document.getElementById("operationsTDContent");x.innerHTML=lbpm.constant.opt.RestartconbranchTDTitle;var u="";var v=lbpm.nodes[lbpm.nowNodeId].relatedNodeIds;var m=lbpm.nodes[v];var n=[];for(var r=0;r<m.endLines.length;r++){var t=m.endLines[r];if(lbpm.nodes[t.endNodeId].Status!=1){continue}var q=t.endNodeId+"."+lbpm.nodes[t.endNodeId].name;n.push({value:t.endNodeId,text:q})}var u='<div data-dojo-type="mui/form/CheckBoxGroup" id="restartConbranchsGroup" data-dojo-props="validate:\'restartConbranchRequired required\',required:true,name:\'restartConbranchsGroup\'"></div>';i("#operationsTDContent").html(u,{parseContent:true,onEnd:function(){this.inherited("onEnd",arguments);if(this.parseDeferred){this.parseDeferred.then(function(){var y=a.byId("restartConbranchsGroup");y.setStore(new h({data:n}))})}}});lbpm.globals.hiddenObject(s,false)};var b=function(){var m=a.byId("restartConbranchsGroup");var n=m.get("value");if(n==null||n==""){k.warn({text:lbpm.constant.opt.RestartconbranchIsNull});return false}return true};var d=function(){var m=a.byId("restartConbranchsGroup");var n=m.get("value");lbpm.globals.setOperationParameterJson(n,"restartConbranchs","param")};var c={};c.handler_restartconbranch=lbpm.operations.handler_restartconbranch={click:l,check:b,blur:j,setOperationParam:d};c.init=function(){};return c})},"sys/lbpmservice/mobile/node/reviewnode/operation_handler_abandon":function(){define(["sys/lbpmservice/mobile/workitem/workitem_common"],function(c){var f={};var g=function(){lbpm.globals.clearDefaultUsageContent("handler_abandon")};var d=function(h){lbpm.globals.setDefaultUsageContent("handler_abandon")};var a=function(){if(lbpm.globals.isUsageContenRequired(lbpm.currentOperationType)){return lbpm.globals.validateMustSignYourSuggestion()}return true};var b=function(){};f.handler_abandon=lbpm.operations.handler_abandon={click:d,check:a,blur:g,setOperationParam:b}})},"sys/lbpmservice/mobile/operation/drafter/operation_drafter_return":function(){define(["dojo/query","dojo/NodeList-manipulate"],function(a){var b={};b.drafter_return={click:function(){},check:function(){return true},setOperationParam:function(c){c.notifyLevel=a("#OperationView input[name='ext_notifyLevel']").val();c.auditNote=a("#OperationView textarea[name='ext_usageContent']").val()}};b.init=function(){};return b})},"sys/lbpmservice/mobile/import/constant":function(){define(["mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/i18n/_i18n!sys/mobile/js/mui/mui-common","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm"],function(h,g,f,d,c,b,a,k,j,i){constant.ADDRESS_SELECT_POSTPERSONROLE="ORG_TYPE_POSTORPERSON | ORG_TYPE_ROLE";constant.ADDRESS_SELECT_ALLROLE="ORG_TYPE_ALL | ORG_TYPE_ROLE";constant.SELECTORG=j["mui.dialog.selectOrg"];constant.METHODEDIT="edit";constant.METHODVIEW="view";constant.IDENTITY_PROCESSOR="processor";constant.STATE_COMPLETED="30";constant.STATE_ACTIVATED="20";constant.STATE_CREATED="10";constant.STATUS_UNINIT=0;constant.STATUS_NORMAL=1;constant.STATUS_PASSED=2;constant.STATUS_RUNNING=3;constant.IS_ADMIN=constant.PRIVILEGERFLAG;constant.DRAFTERROLETYPE="drafter";constant.HANDLER_IDENTITY_DRAFT=1;constant.PROCESSORROLETYPE="processor";constant.HANDLER_IDENTITY_HANDLER=2;constant.AUTHORITYROLETYPE="authority";constant.HANDLER_IDENTITY_SPECIAL=3;constant.HISTORYHANDLERROLETYPE="historyhandler";constant.HANDLER_IDENTITY_HISTORYHANDLER=4;constant.BRANCHADMINROLETYPE="branchadmin";constant.HANDLER_IDENTITY_BRANCHADMINROLETYPE=5;constant.SUCCESS="success";constant.FAILURE="failure";constant.VALIDATEISNULL=h["validate.isNull"];constant.VALIDATEISNAN=g["validate.isNaN"];constant.NODETYPE_START="startNodeDesc";constant.NODETYPE_END="endNodeDesc";constant.NODETYPE_STARTSUBPROCESS="startSubProcessNodeDesc";constant.NODETYPE_DRAFT="draftNodeDesc";constant.NODETYPE_JOIN="joinNodeDesc";constant.NODETYPE_SIGN="signNodeDesc";constant.NODETYPE_SPLIT="isSplitNode";constant.NODETYPE_REVIEW="isReviewNode";constant.NODETYPE_HANDLER="isHandler";constant.NODETYPE_SEND="isSendNode";constant.NODETYPE_CANREFUSE="canRefuse";constant.NODETYPE_AUTOBRANCH="isAutoBranch";constant.NODETYPE_MANUALBRANCH="isManualBranch";constant.NODETYPE_RECOVERSUBPROCESS="isRecoverSubProcess";constant.NODETYPE_ROBOT="isRobot";constant.NODETYPE_GROUPSTART="groupStartNodeDesc";constant.NODETYPE_GROUPEND="groupEndNodeDesc";constant.EVENT_MODIFYNODEATTRIBUTE="modifyNodeAttribute";constant.EVENT_MODIFYPROCESS="modifyProcess";constant.EVENT_SELECTEDMANUAL="selectedManual";constant.EVENT_SELECTEDFUTURENODE="selectedFutureNode";constant.EVENT_FILLLBPMOBJATTU="fillLbpmObjAttu";constant.EVENT_CHANGEWORKITEM="changeWorkitem";constant.EVENT_validateMustSignYourSuggestion="validateMustSignYourSuggestion";constant.EVENT_HANDLERTYPECHANGE="handlerChange";constant.EVENT_CHANGEOPERATION="changeOperation";constant.EVENT_SETOPERATIONPARAM="setOperationParam";constant.EVENT_BEFORELBPMSUBMIT="beforeLbpmSubmit";constant.COMMONNODEHANDLERPARSEERROR=i["lbpmNode.nodeHandler.parseError"];constant.COMMONNODEHANDLERPROCESSTYPESERIAL=i["lbpmNode.nodeHandler.processtypeSerial"];constant.COMMONNODEHANDLERPROCESSTYPEALL=i["lbpmNode.nodeHandler.processtypeAll"];constant.COMMONNODEHANDLERPROCESSTYPESINGLE=i["lbpmNode.nodeHandler.processtypeSingle"];constant.COMMONNODENAME=i["lbpmNode.nodeHandler.nodeName"];constant.COMMONNODEHANDLER=i["lbpmNode.nodeHandler.nodeHandler"];constant.COMMONNODEHANDLERHINT=i["lbpmNode.nodeHandler.hint"];constant.CHKNEXTNODENOTNULL=i["lbpmNode.validate.nextNode.isNull"];constant.LOADINGMSG=k["WorkFlow.Loading.Msg"];constant.CONCURRENCYBRANCHSELECT=d["lbpmSupport.concurrencyBranchSelect"];constant.CONCURRENCYBRANCHTITLE=d["lbpmSupport.concurrencyBranchTitle"];constant.VALIDATENOTIFYTYPEISNULL=i["lbpmNode.validate.notifyType.isNull"];constant.VALIDATEOPERATIONTYPEISNULL=i["lbpmNode.validate.operationType.isNull"];constant.ERRORMAXLENGTH=j["mui.errors.maxLength.simple"];constant.OPINION=i["lbpmNode.createDraft.opinion"];constant.ERROR_FDUSAGECONTENT_MAXLENGTH=i["lbpmNode.createDraft.opinion.maxLength"].replace("{0}","{name}").replace("{1}","{maxLength}");constant.CREATEDRAFTCOMMONUSAGES=i["lbpmNode.createDraft.commonUsages"];constant.MUSTMODIFYHANDLERNODEIDSISNULL=i["lbpmNode.flowContent.mustModifyHandlerNodeIds.isNull"];constant.MUSTMODIFYHANDLERNODEIDSPARSEISNULL=i["lbpmNode.flowContent.mustModifyHandlerNodeIds.parse.isNull"];constant.MUSTMODIFYHANDLERNODEIDSPARSEPOSTEMPTY=i["lbpmNode.flowContent.mustModifyHandlerNodeIds.parse.postEmpty"];constant.MUSTMODIFYHANDLERNODEIDSPARSEELEMENTDISABLED=i["lbpmNode.flowContent.mustModifyHandlerNodeIds.parse.elementDisabled"];constant.VALIDATENEXTNODEHANDLERISNULL=i["lbpmNode.validate.nextNodeHandler.isNull"];constant.FLOWCONTENTMUSTMODIFYNODENEXTHANDLER=i["lbpmNode.flowContent.mustModifyNodeNextHandlerNodeIds.isNull"];constant.COMMONNODEHANDLERORGEMPTY=i["lbpmNode.nodeHandler.orgEmpty"];constant.COMMONNODEHANDLERORGNULL=i["lbpmNode.nodeHandler.orgNull"];constant.opt.EnvironmentUnsupportOperation=d["lbpmSupport.environmentUnsupportOperation"];constant.opt.MustSignYourSuggestion=i["lbpmNode.mustSignYourSuggestion"];constant.NOCALCBRANCHCRESULT=i["lbpmNode.noCalcBranchResult"];constant.MODIFYRETURNBACKHANDLER=i["lbpmNode.processingNode.operationsTDTitle.handlerOperationTypeRefuse.modifyRefuseBackHandler"];constant.BTNSAVEDRAFT=j["mui.button.savedraft"];constant.OPRSUCCESS=f["mui.return.success"];constant.OPRFAILURE=f["mui.return.failure"];constant.FREEFLOW=c["lbpmTemplate.fdType.free"];constant.FREEFLOW_MUSTAPPENDNODE=b["lbpm.freeFlow.mustAppendSomeNode"];constant.SETNEXTSTEP=a["lbpm.group.setNextStep"];constant.UPDATENEXTSTEP=a["lbpm.group.updateNextStep"];constant.COMMONNODEREPLAYCAL=i["lbpmNode.recalculation.handler"]})},"sys/lbpmservice/mobile/operation/historyhandler/operation_history_handler_back":function(){define(["dojo/query","dojo/NodeList-dom"],function(a){var b={};b.history_handler_back={click:function(){if(Lbpm_SettingInfo){if(Lbpm_SettingInfo.forceKeepAuditNote=="true"){$("input[name='keepAuditNote']")[0].value="true"}else{if(Lbpm_SettingInfo.isKeepAuditNoteOptional=="true"){a("#OperationView #keepAuditNoteArea").style({display:""})}}}},check:function(){return true},setOperationParam:function(c){c.notifyLevel="3";c.auditNote="";if($("input[name='keepAuditNote']")[0]&&$("input[name='keepAuditNote']")[0].value=="true"){c.Back_keepAuditNote=true}else{c.Back_keepAuditNote=false}},blur:function(){a("#OperationView #keepAuditNoteArea").style({display:"none"})}};b.init=function(){};return b})},"sys/lbpmservice/mobile/node/draftnode/operation_drafter_refuse_abandon":function(){define(["sys/lbpmservice/mobile/operation/operation_common_passtype"],function(a){var b={};b.drafter_refuse_abandon=lbpm.operations.drafter_refuse_abandon={click:function(){},check:function(){return true},setOperationParam:function(){}};b.drafterRefuseAbandonOpt=lbpm.globals.drafterRefuseAbandonOpt=function(){if(lbpm.globals.validateMustSignYourSuggestion()){if(confirm(lbpm.workitem.constant.draft_opr_abandon_confirm)){var d=$("#operationMethodsGroup");if(d.attr("view-type")=="select"){var c=d.data("drafter_refuse_abandon");if(c){d.append(c);d.removeData("drafter_refuse_abandon")}d.find("option[value^='drafter_refuse_abandon']").attr("selected",true)}else{d.find("input[name='oprGroup'][value^='drafter_refuse_abandon']").click()}$("#process_review_button").click()}}};return b})},"sys/lbpmservice/mobile/workitem/SubFormSwitchButton":function(){define(["dojo/_base/declare","mui/tabbar/TabBar","mui/tabbar/TabBarButton","mui/dialog/Dialog","dijit/registry","dojo/dom-construct","dojo/dom-class","dojo/_base/array","dojo/_base/lang","dojo/topic","dojo/query","sys/lbpmservice/mobile/common/workflow","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm"],function(f,h,n,j,a,d,m,i,b,g,k,l,c){return f("sys.lbpmservice.mobile.workitem.SubFormSwitchButton",[n],{options:[],isInit:false,nowSubFormId:"default",tmpl:"<div data-dojo-type=\"mui/form/RadioGroup\" data-dojo-props=\"showStatus:'edit',name:'_subform_switch_radio',mul:'false',store:{store},orient:'vertical'\"></div>",buildRendering:function(){if(!this.label){this.label=c["mui.subform.switchForm"]}this.inherited(arguments)},startup:function(){if(this._started){return}this.inherited(arguments)},onClick:function(q){q.preventDefault();q.stopPropagation();var u=null;if(window.lbpm){if(lbpm.subFormInfoObj){u=lbpm.subFormInfoObj}if(lbpm.nowSubFormId){this.nowSubFormId=lbpm.nowSubFormId}}if(u==null){var p=WorkFlow_LoadXMLData(k("input[name='sysWfBusinessForm.fdSubFormXML']")[0].value);if(p&&p.subforms){u=$.extend(true,[],p.subforms)}}if(u&&u.length>0&&!this.isInit){var s=false;for(var r=0;r<u.length;r++){if(u[r]["id"]=="default"){s=true}this.isInit=true;var t={};t.text=u[r]["name"];if(u[r]["id"]==this.nowSubFormId){t.text+="("+c["mui.subform.currForm"]+")"}else{if(u[r]["task"]=="1"){t.text+="("+c["mui.subform.transaction"]+")"}}t.value=u[r]["id"];this.options.push(t)}if(!s){if("default"==this.nowSubFormId){this.options.push({text:c["mui.subform.defaultCurrForm"],value:"default"})}else{this.options.push({text:c["mui.subform.defaultForm"],value:"default"})}}}if(this.options.length>0){this.dialogDom=d.toDom(b.replace(this.tmpl,{store:JSON.stringify(this.options).replace(/\"/g,"'")}))}this.defer(function(){if(this.dialogDom){var v=this;this.dialog=j.element({canClose:false,showClass:"muiDialogElementShow muiFormSelect",element:this.dialogDom,position:"bottom",scrollable:false,parseable:true,onDrawed:function(){v.initOptionsEvent()}})}},500)},initOptionsEvent:function(){var p=this;this.defer(function(){var q=k("label.muiRadioItem",this.dialogDom);p._curTime=0;q.on("click",function(r){r.preventDefault();r.stopPropagation();var w=new Date();if(w-p._curTime<500){return}p._curTime=w;var t=r.target;var u;if(t.className!=""&&t.className.indexOf("muiRadioItem")>-1){u=t}else{u=k(r.target).parents(".muiRadioItem")[0]}q.forEach(function(x){m.remove(x,"lbpmSwitchOption")});m.add(u,"lbpmSwitchOption");var v=k("input",u).val();if(p.nowSubFormId!=v){var s=window.location.href;s=Com_SetUrlParameter(s,"s_xform",v);window.location.replace(s)}p.dialog.hide()})},500)}})})},"sys/lbpmservice/mobile/node/draftnode/operation_drafter_submit":function(){define(["sys/lbpmservice/mobile/operation/operation_common_passtype","mui/dialog/Tip"],function(d,g){var c={};var f=function(h){var j=lbpm.globals.analysisProcessorInfoToObject();if(j!=null){var k=document.getElementById("nextNodeTD");var n=document.getElementById("handlerIdentityRow");var i=document.getElementById("handlerIdentityRowTr");if(n){if(Lbpm_SettingInfo.isShowDraftsmanStatus=="false"){lbpm.globals.hiddenObject(i,true);lbpm.globals.hiddenObject(n,true)}else{lbpm.globals.hiddenObject(i,false);lbpm.globals.hiddenObject(n,false)}}if(k!=null){lbpm.globals.generateNextNodeInfo(function(p){lbpm.globals.innerHTMLGenerateNextNodeInfo(p,k);lbpm.globals.hiddenObject(k.parentNode,false);if(Lbpm_SettingInfo.isHideOperationsRow=="true"&&lbpm.canHideNextNodeTr){lbpm.globals.hiddenObject(k.parentNode,true)}})}else{var m=document.getElementById("operationsTDContent");if(m){var l=document.getElementById("operationsTDTitle");l.innerHTML="即将流向";lbpm.globals.generateNextNodeInfo(function(p){lbpm.globals.innerHTMLGenerateNextNodeInfo(p,m);lbpm.globals.hiddenObject(m.parentNode,false)})}}}};var a=function(h,k,i,j){if(j&&j.saveDraft){return true}if(!lbpm.globals.isSelectAllManualNode()){g.warn({text:"请选择分支节点走向！"});return false}return lbpm.globals.common_operationCheckForPassType()};var b=function(){if(window.require){var h=dijit.registry.byId("rolesSelectObj");if(h){lbpm.globals.setOperationParameterJson(h.get("value"),"identityId","param")}}else{var i=document.getElementsByName("rolesSelectObj")[0];lbpm.globals.setOperationParameterJson(i,"identityId","param")}$("#notifyDraftOnFinish").each(function(l){lbpm.globals.setOperationParameterJson(this,"notifyOnFinish","param")});$("#dayOfNotifyDrafter").each(function(l){lbpm.globals.setOperationParameterJson(this,"dayOfNotifyDrafter","param")});$("#hourOfNotifyDrafter").each(function(l){lbpm.globals.setOperationParameterJson(this,"hourOfNotifyDrafter","param")});$("#minuteOfNotifyDrafter").each(function(l){lbpm.globals.setOperationParameterJson(this,"minuteOfNotifyDrafter","param")});var k=lbpm.globals.getSelectedManualNode();if(k.length>0){var j=lbpm.globals.objectToJSONString(k);lbpm.globals.setOperationParameterJson(j,"draftDecidedFactIds","param")}};c.drafter_submit=lbpm.operations.drafter_submit={click:f,check:a,isPassType:true,setOperationParam:b};return c})},"sys/lbpmservice/mobile/workitem/CommonUsageAddButton":function(){define(["dojo/_base/declare","mui/tabbar/TabBarButton","dojo/dom-class","dojo/topic","mui/history/listener","dojo/_base/window","dojox/mobile/TransitionEvent","dojo/dom-style","dojo/query"],function(b,j,i,c,a,d,h,f,g){return b("sys.lbpmservice.mobile.workitem.CommonUsageAddButton",[j],{postCreate:function(){this.subscribe("/lbpm/commonUsageItem/edit","_moveView")},startup:function(){this.inherited(arguments);i.add(this.domNode,"addUsageButton")},onClick:function(){this.moveView()},_moveView:function(k){this.moveView()},moveView:function(){c.publish("/lbpm/commonUsageView/changStatus");new h(d.body(),{moveTo:"commonUsageCreateView",transition:"slide",transitionDir:1}).dispatch();a.add({callback:function(){c.publish("/lbpm/commonUsageView/changStatus");new h(d.body(),{moveTo:"commonUsageManageView",transition:"slide",transitionDir:-1}).dispatch()}})}})})},"sys/lbpmservice/mobile/common/_LbpmValidateMixin":function(){define(["dojo/_base/declare","dojo/topic","dijit/registry","mui/form/_ValidateMixin","mui/form/_FormBase","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","dojo/query","dojo/dom-attr","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm"],function(c,d,a,l,j,b,k,i,h,f){var g={freeflowNodes:{error:lbpm.constant.FREEFLOW_MUSTAPPENDNODE,test:function(m){if(isNotValidate()){return true}if(lbpm.isFreeFlow&&lbpm.globals.getNodeSize()<=3){return false}return true}},optMethodGroup:{error:lbpm.constant.VALIDATEOPERATIONTYPEISNULL,test:function(n){var m=lbpm.globals.analysisProcessorInfoToObject();if(!m){return true}if(n||(optInfo&&optInfo.value)){return true}else{return false}}},fdUsageContent:{error:lbpm.constant.opt.MustSignYourSuggestion,test:function(m){if(isNotValidate()){return true}if(lbpm.globals.isUsageContenRequired(lbpm.currentOperationType)){return lbpm.globals.validateMustSignYourSuggestion(true)}return true}},usageContentMaxLen:{error:lbpm.constant.ERROR_FDUSAGECONTENT_MAXLENGTH.replace(/\{name\}/,lbpm.constant.OPINION).replace(/\{maxLength\}/,4000),test:function(p){var m=lbpm.operations.getfdUsageContent();if(m!=null&&m.value!=""){var q=m.value||"";var n=q.replace(/[^\x00-\xff]/g,"***");if(n.length>4000){return false}}return true}},privateOpinion:{error:b["lbpmservice.auditnote.placeholder"],test:function(m){if(lbpm.isFreeFlow&&Lbpm_SettingInfo.isPrivateOpinion=="true"){var n=a.byId("privateOpinion");if(n&&n.checked==true){var p=a.byId("privateOpinionPerson");if(p&&!p.curIds){return false}}}return true}},futureNodeSelected:{error:lbpm.constant.CHKNEXTNODENOTNULL,test:function(m){if(isNotValidate()||lbpm.noValidateFutureNode==true){return true}if(k("input[name='futureNode']").length>0){var p=k("input[name='futureNode'][type='checkbox']");if(p.length>0){var n=a.byId("sys_lbpmservice_mobile_workitem_FutureNodesChekBoxGroup");if(n.value&&n.value!=""){return true}}else{if(k("input[name='futureNode']:checked").length>0){return true}}}else{if(k("input[name='__futureNode__']").length>0){var p=k("input[name='__futureNode__'][type='checkbox']");if(p.length>0){var n=a.byId("sys_lbpmservice_mobile_workitem_FutureNodesChekBoxGroup");if(n.value&&n.value!=""){return true}}else{if(k("input[name='__futureNode__']:checked").length>0){return true}}}}return false}},manualFutureNodeIdSelect:{error:"请选择分支节点走向！",test:function(n,r,s){if(isNotValidate()){return true}var q=false;if(!n){return false}else{var m=r.values||[];for(var p=0;p<m.length;p++){if(m[p].value==n){q=true;break}}}return q}},futureNodeObjs:{error:"{errorMsg}",test:function(A,n,m){if(isNotValidate()||!lbpm.currentOperationType||lbpm.noValidateFutureNode==true){return true}var t=null;var B=[];var C=document.getElementsByName("futureNode");for(var q=0;q<C.length;q++){var r=C[q];if(r.checked){t=lbpm.globals.getNodeObj(r.value);B.push(t);if(n&&t&&t.id!=n.nodeid){continue}var x=document.getElementsByName("handlerIds["+r.getAttribute("index")+"]")[0];if(x==null){x=document.getElementsByName("handlerIds_"+r.value)[0]}if(x!=null&&x.value==""&&t&&t.ignoreOnHandlerEmpty=="false"){m.errorMsg=lbpm.constant.VALIDATENEXTNODEHANDLERISNULL;return false}}}var s=[];if(t&&t.id){if(lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_END,t)){return true}s=getAllNextNodeArrayExclude(t.id);s.unshift(t.id)}else{s=getAllNextNodeArrayExclude(lbpm.nowNodeId)}for(var q=0;q<B.length;q++){var t=B[q];if(s.indexOf(t.id)==-1){s.push(t.id)}}if(n.nodeid&&s.indexOf(n.nodeid)==-1){return true}for(var q=0;q<C.length;q++){var r=C[q];if(r.checked||n.nodeid){continue}var u=n.nodeid;if(r.value==u){var x=document.getElementsByName("handlerIds["+r.getAttribute("index")+"]")[0];var p=lbpm.globals.getNodeObj(r.value);if(x!=null&&x.value==""&&p&&p.ignoreOnHandlerEmpty=="false"){var w=WorkFlow_getLangLabel(p.name,p.langs,"nodeName");var y=WorkFlow_getLangLabel(t.name,t.langs,"nodeName");m.errorMsg=lbpm.constant.FLOWCONTENTMUSTMODIFYNODENEXTHANDLER.replace("{0}",p.id).replace("{1}",w).replace("{2}",t.id).replace("{3}",y);return false}}}var z=lbpm.globals.analysisProcessorInfoToObject();if(n.nodeid&&!checkMustModifyHandlerNodeIdsNew(n.nodeid,z,m)){return false}return true}},adHocSubFlowNodeSelected:{error:lbpm.constant.CHKNEXTNODENOTNULL,test:function(){if(isNotValidate()){return true}if(k("input[name='nextAdHocRouteId']").length==0){return true}if(k("input[name='nextAdHocRouteId']:checked").length>0){return true}return false}},jumpToNodeRequired:{error:lbpm.workitem.constant.noRefuseNode,test:function(n,p,q){if(isNotValidate()){return true}var m=k("#operationsTDContent [name='jumpToNodeIdSelectObj']")[0];if(n||(m&&m.value)){return true}else{q.refuse=lbpm.currentOperationLabel;return false}}},jumpRequired:{error:lbpm.workitem.constant.noRefuseNode,test:function(n,p,q){if(isNotValidate()){return true}var m=k("#operationsTDContent [name='jumpToNodeIdSelectObj']")[0];if(n||(m&&m.value)){return true}else{q.jump=lbpm.currentOperationLabel;return false}}},commissionHandlerRequired:{error:"{errorMsg}",test:function(n,p,q){if(isNotValidate()){return true}var m=k("#toOtherHandlerIds")[0];if(n||(m&&m.value)){return true}else{q.errorMsg=lbpm.constant.opt.CommissionIsNull;return false}}},additionSignHandlerRequired:{error:"{errorMsg}",test:function(n,p,q){if(isNotValidate()){return true}var m=k("#toOtherHandlerIds")[0];if((m&&m.value)||n){return true}else{q.errorMsg=lbpm.constant.opt.AdditionSignIsNull;return false}}},assignhandlerRequired:{error:"{errorMsg}",test:function(n,p,q){if(isNotValidate()){return true}var m=k("#toAssigneeIds")[0];if(n||(m&&m.value)){return true}else{q.errorMsg=lbpm.constant.opt.AssigneeIsNull+lbpm.currentOperationLabel+lbpm.constant.opt.Assignee;return false}}},assignCancelHandlerRequired:{error:"{errorMsg}",test:function(m,n,q){if(isNotValidate()){return true}var r=a.byId("WorkFlow_CancelAssignWorkitemsGroup");var p=r.get("value");if(p==null||p==""){q.errorMsg=lbpm.constant.opt.AssignNeedSelectCanceler;return false}return true}},communicateHandlerRequired:{error:"{errorMsg}",test:function(n,p,q){if(isNotValidate()){return true}var m=k("#toOtherHandlerIds")[0];if(n||(m&&m.value)){return true}else{q.errorMsg=lbpm.constant.opt.CommunicateIsNull+"沟通"+lbpm.constant.opt.CommunicatePeople;return false}}},cancelCommunicateHandlerRequired:{error:"{errorMsg}",test:function(m,p,r){if(isNotValidate()){return true}var n=a.byId("WorkFlow_CelRelationWorkitemsGroup");var q=n.get("value");if(q==null||q==""){r.errorMsg=lbpm.constant.opt.CommunicateNeedSelectCanceler;return false}return true}},cancelconbranchRequired:{error:"{errorMsg}",test:function(m,p,r){if(isNotValidate()){return true}var n=a.byId("cancelConbranchsGroup");var q=n.get("value");if(q==null||q==""){r.errorMsg=lbpm.constant.opt.CancelbranchIsNull;return false}return true}},restartConbranchRequired:{error:"{errorMsg}",test:function(n,p,r){if(isNotValidate()){return true}var m=a.byId("restartConbranchsGroup");var q=m.get("value");if(q==null||q==""){r.errorMsg=lbpm.constant.opt.RestartconbranchIsNull;return false}return true}},hwSignRequired:{error:h["FlowChartObject.Lang.Node.needHandWritten"],test:function(){var m=k("#imgUl");if(!m||m.length===0||m.innerHTML()==""){return false}return true}},auditPointRequired:{error:f["lbpmExtAuditPoint.important.cannot.benullMobile"],test:function(){if(isNotValidate()){return true}var q=k("#operationMethodsGroup")[0]?k("#operationMethodsGroup")[0].value:"";if(q.indexOf("handler_pass")>-1||q.indexOf("handler_sign")>-1||q.indexOf("drafter_submit")>-1){var m=k("input[type='hidden'][name*='lbpmext_auditpoint_chk_']");for(var n=0;n<m.length;n++){var t=m[n];var u=t.name.substring("lbpmext_auditpoint_chk_".length,t.name.length);var r=k("[id='"+u+"']")[0];var p=i.get(r,"lbpmext-auditpoint-data-important");var s=t.value;if("true"==p&&!"true"==s){return false}}}lbpm.globals.extAuditPointParameter();return true}}};window.isNotValidate=function(){var m=a.byId("saveDraftButton");if(m&&m.saveDraft){return true}else{return false}};window.checkMustModifyHandlerNodeIdsNew=function(v,w,p){var r=lbpm.globals.getCurrentNodeObj();var n=lbpm.constant.ROLETYPE;if(n==""&&lbpm.globals.checkModifyNodeAuthorization(r,v)){var q=lbpm.globals.getNodeObj(v);if(q.XMLNODENAME!="embeddedSubFlowNode"){if(q.handlerIds==null||q.handlerIds==""){if(r.processType==lbpm.constant.PROCESSTYPE_SERIAL){var t=lbpm.globals.getOperationParameterJson("currNodeNextHandlersId");var m=lbpm.globals.getOperationParameterJson("toRefuseThisNodeId");if(!t&&!m&&(lbpm.operations[lbpm.currentOperationType].isPassType)){if(lbpm.globals.judgeIsNecessaryAlert(q)){var s=WorkFlow_getLangLabel(q.name,q.langs,"nodeName");s=s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");p.errorMsg=q.id+"."+s+" "+lbpm.constant.MUSTMODIFYHANDLERNODEIDSISNULL;return false}}}else{if(lbpm.operations[lbpm.currentOperationType].isPassType){if(lbpm.globals.judgeIsNecessaryAlert(q)){var s=WorkFlow_getLangLabel(q.name,q.langs,"nodeName");s=s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");p.errorMsg=q.id+"."+s+" "+lbpm.constant.MUSTMODIFYHANDLERNODEIDSISNULL;return false}}}}else{var u=_getNextNodeHandlerNames(q);if(u==""||u.indexOf("postEmpty")!=-1||u.indexOf("elementDisabled")!=-1||u.indexOf("parseError")!=-1){if(r.processType==lbpm.constant.PROCESSTYPE_SERIAL){var t=lbpm.globals.getOperationParameterJson("currNodeNextHandlersId");var m=lbpm.globals.getOperationParameterJson("toRefuseThisNodeId");if(!t&&!m&&(lbpm.operations[lbpm.currentOperationType].isPassType)){if(lbpm.globals.judgeIsNecessaryAlert(q)){var s=WorkFlow_getLangLabel(q.name,q.langs,"nodeName");s=s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");if(u.indexOf("elementDisabled")!=-1){p.errorMsg=q.id+"."+s+lbpm.constant.MUSTMODIFYHANDLERNODEIDSPARSEELEMENTDISABLED;return false}if(u.indexOf("postEmpty")!=-1){p.errorMsg=q.id+"."+s+lbpm.constant.MUSTMODIFYHANDLERNODEIDSPARSEPOSTEMPTY;return false}if(u==""&&q.ignoreOnHandlerEmpty!="true"){p.errorMsg=q.id+"."+s+" "+lbpm.constant.MUSTMODIFYHANDLERNODEIDSISNULL;return false}}}}else{if(lbpm.operations[lbpm.currentOperationType].isPassType){if(lbpm.globals.judgeIsNecessaryAlert(q)){var s=WorkFlow_getLangLabel(q.name,q.langs,"nodeName");s=s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");if(u.indexOf("elementDisabled")!=-1){p.errorMsg=q.id+"."+s+lbpm.constant.MUSTMODIFYHANDLERNODEIDSPARSEELEMENTDISABLED;return false}if(u.indexOf("postEmpty")!=-1){p.errorMsg=q.id+"."+s+lbpm.constant.MUSTMODIFYHANDLERNODEIDSPARSEPOSTEMPTY;return false}if(u==""&&q.ignoreOnHandlerEmpty!="true"){p.errorMsg=q.id+"."+s+" "+lbpm.constant.MUSTMODIFYHANDLERNODEIDSISNULL;return false}}}}}}}}return true};return c("sys/lbpmservice/mobile/common/LbpmValidateMixin",[l],{postCreate:function(){this.inherited(arguments);this.subscribe("mui/form/validationInitFinish","_addLbpmValidate")},validate:function(m){if(this.showType=="dialog"){var n=[];if(m){n=n.concat(m)}var r=this.getValidateElements();if(r){n=n.concat(r)}if(this.notValRequired!=undefined){if(this.notValRequired){n=this.removeElementValidate(n,"required")}else{n=this.resetElementValidate(n)}}var v=true;var q=null;var t=[];for(var p=0;p<n.length;p++){if(!this._validation.validateElement(n[p])){if(v){q=n[p];v=false}t.push(n[p])}}if(q!=null){var u=q;if(q instanceof j){u=q.domNode}if(u==k("#hwSignEmpty")[0]){u=k("#hwSignEmptyDiv")[0]}var s=this._getDomOffsetTop(u);d.publish("/lbpm/validate/toTop",this,{y:0-s+110})}d.publish("/mui/validate/afterValidate",this,t);d.publish("/mui/list/resize");return v}else{this.inherited(arguments)}},_addLbpmValidate:function(n){for(var m in g){n._validation.addValidator(m,g[m].error,g[m].test)}}})})},"sys/lbpmservice/mobile/workitem/CommonusageTextarea":function(){define(["dojo/_base/declare","mui/form/Textarea"],function(b,a){return b("sys.lbpmservice.mobile.workitem.CommonusageTextarea",[a],{postCreate:function(){this.subscribe("/lbpm/commonUsageView/rest","_setValue")},_setValue:function(c){var d=c.value;this._setValueAttr(d)}})})},"sys/lbpmservice/mobile/freeflow/freeflowChartView":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-class","dojox/mobile/ViewController","dojox/mobile/viewRegistry","dojo/query","dojo/request","dojo/topic","dojox/mobile/TransitionEvent","dijit/registry","dojo/_base/window","mui/util","mui/dialog/Dialog","mui/dialog/Tip","mui/device/adapter","mui/view/NativeDocView","mui/tabbar/TabBarButton","sys/lbpmservice/mobile/operation/ExtOperationButton","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm"],function(u,j,w,l,v,s,h,d,q,r,k,f,b,i,t,p,m,c,n,g){var a=u("sys.lbpmservice.mobile.freeflow.freeflowChartView",[m],{isInit:false,key:"",processId:"",showType:"",buildRendering:function(){this.inherited(arguments)},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments);if(h(".freeflowChartBackButton",this.domNode)[0]){k.byNode(h(".freeflowChartBackButton",this.domNode)[0]).on("click",w.hitch(this,this.hidefreeFlowChartView))}},onAfterTransitionIn:function(){q.publish("mui/view/currentView",this)},onAfterTransitionOut:function(){q.publish("/sys/lbpmservice/freeflow/viewTransitionOut",this)},hidefreeFlowChartView:function(){var x=this;new r(f.body(),{moveTo:x.backTo,transition:"slide",transitionDir:-1}).dispatch();if(this.showType=="dialog"){q.publish("/lbpm/operation/showDialog",this)}}});return a})},"sys/lbpmservice/mobile/operation/historyhandler/operation_history_handler_press":function(){define(["dojo/query","dojo/NodeList-manipulate"],function(a){var b={};b.history_handler_press={click:function(){},check:function(){return true},setOperationParam:function(c){c.notifyLevel=a("#OperationView input[name='ext_notifyLevel']").val();c.auditNote=a("#OperationView textarea[name='ext_usageContent']").val()}};b.init=function(){};return b})},"sys/lbpmservice/mobile/operation/branchadmin/operation_branchadmin_backbranch":function(){define(["dijit/registry","dojo/query","dojo/store/Memory","mui/dialog/Tip","sys/lbpmservice/mobile/common/syslbpmprocess","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm"],function(b,h,i,g,d,f,c){var a={};a.branchadmin_backbranch={click:function(n){var m=n?n.curTask:"";var t=h("td[id='operationsTDTitle']")[0];var l=h("td[id='operationsTDContent']")[0];var r=t.parentNode;t.innerHTML=c["lbpmOperations.fdOperType.processor.backbranch"];if(!window.isInitLbpmNode){lbpm.globals.parseXMLObj()}if(!lbpm.nodes||lbpm.nodes.length==0||!m){return}else{window.isInitLbpmNode=true}this.splitNode=this._getSplitNode(lbpm.nodes[m.nodeId]);var k=[];var u=new KMSSData();u.AddBeanData("getConBranchStatusService&type=runing&splitNode="+this.splitNode.id+"&processId="+lbpm.modelId);var q=u.GetHashMapArray();var s="";for(var p=0;p<q.length;p++){k.push({value:q[p].id,text:q[p].name})}var s='<div data-dojo-type="mui/form/CheckBoxGroup" id="backConbranchsGroup" data-dojo-props="validate:\'required\',required:true,name:\'backConbranchsGroup\'"></div>';if(k.length>0){h("td[id='operationsTDContent']").html(s,{parseContent:true,onEnd:function(){this.inherited("onEnd",arguments);if(this.parseDeferred){this.parseDeferred.then(function(){var j=b.byId("backConbranchsGroup");j.setStore(new i({data:k}))})}}});lbpm.globals.hiddenObject(r,false)}},check:function(){var k=b.byId("backConbranchsGroup");var n=k.get("value");if(n==null||n==""){g.warn({text:f["lbpmOperations.backbranch.msg"]});return false}var j=new KMSSData();j.AddBeanData("getConBranchStatusService&type=isCustom&splitNode="+this.splitNode.id+"&processId="+lbpm.modelId);var m=j.GetHashMapArray();var l=m&&m[0].isCustom=="true";if(!l&&n.split(";").length==k.store.data.length){g.warn({text:f["lbpmOperations.backbranch.msg2"]});return false}return true},setOperationParam:function(l){var j=b.byId("backConbranchsGroup");var k=j.get("value");l.backConbranchs=k},_getSplitNode:function(n){for(var m=0;m<n.startLines.length;m++){var l=n.startLines[m];var k=l.startNode;if(!k){continue}if(k.XMLNODENAME=="splitNode"){if(window.routeJoinNodeRelatedNodeIds&&window.routeJoinNodeRelatedNodeIds.indexOf(k.id)!=-1){var j=this._getSplitNode(k);if(j==null){continue}else{return j}}else{return k}}else{if(k.XMLNODENAME=="joinNode"){if(!window.routeJoinNodeRelatedNodeIds){window.routeJoinNodeRelatedNodeIds=[]}if(window.routeJoinNodeRelatedNodeIds.indexOf(k.relatedNodeIds)==-1){window.routeJoinNodeRelatedNodeIds.push(k.relatedNodeIds)}}var j=this._getSplitNode(k);if(j==null){continue}else{return j}}}return null}};a.init=function(){};return a})},"sys/lbpmservice/mobile/operation/handler/operation_handler_assign":function(){define(["dijit/registry","dojo/topic","mui/form/Address","sys/lbpmservice/mobile/common/syslbpmprocess","dojo/query","dojo/_base/array","mui/dialog/Tip","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm"],function(a,f,g,h,j,i,l,c){var n={};var k=function(){lbpm.globals.clearDefaultUsageContent("handler_assign")};var m=function(p){lbpm.globals.setDefaultUsageContent("handler_assign");lbpm.globals.getOperationParameterJson("relationWorkitemId:relations:isAssignPassSkipChecked",true);n.handlerOperationTypeAssign(p)};var b=function(){var p=$("#toAssigneeIds")[0];if(p&&p.value==""){l.warn({text:p.getAttribute("alertText")});return false}if(lbpm.globals.isUsageContenRequired(lbpm.currentOperationType)){return lbpm.globals.validateMustSignYourSuggestion()}return true};var d=function(){var q=$("#toAssigneeIds")[0];lbpm.globals.setOperationParameterJson(q,null,"param");q=$("#toAssigneeNames")[0];lbpm.globals.setOperationParameterJson(q,null,"param");var s=a.byId("isMultiAssign");if(s){lbpm.globals.setOperationParameterJson(s.get("checked"),"isMultiAssign","param")}var r=a.byId("_assignPassSkip");if(r){lbpm.globals.setOperationParameterJson(r.get("checked"),"isAssignPassSkip","param")}var p=$("input[name='assignType']:checked")[0].value;lbpm.globals.setOperationParameterJson(p,"assignType","param")};n.handlerOperationTypeAssign=function(D){var C="";var t=getCurrAssignRelationInfo();var K="";var G="";if(t.length>0){for(var N=0;N<t.length;N++){K+=t[N].userId+";";G+=t[N].userName+";"}if(K){K=K.substr(0,K.lastIndexOf(";"))}if(G){G=G.substr(0,G.lastIndexOf(";"))}C+="<input type='hidden' name='currentAssigneeIds' value='"+K+"'/>";C+="<label>"+G+"</label><br/>"}var p=document.getElementById("operationsRow");var v=document.getElementById("operationsTDTitle");var A=document.getElementById("operationsTDContent");v.innerHTML=D+lbpm.constant.opt.Assignee;var z=document.getElementById("operationsTDTitle_Scope");var P=document.getElementById("operationsTDContent_Scope");var Q=document.getElementById("operationsRow_Scope");z.innerHTML=D+lbpm.constant.opt.AssignType;var J=lbpm.globals.getOperationParameterJson("relationWorkitemId");var F=lbpm.globals.getOperationParameterJson("isAssignPassSkipChecked");var r=document.getElementById("sysWfBusinessForm.fdHandlerRoleInfoIds");var M=n.stringsConcat(r.value,K);var w=c["lbpmNode.toOtherHandler.address.subject.select"]+D+c["lbpmNode.toOtherHandler.address.subject.person"];var s={mulSelect:true,idField:"toAssigneeIds",nameField:"toAssigneeNames",splitStr:";",selectType:ORG_TYPE_POSTORPERSON,notNull:K.length<1,text:lbpm.constant.SELECTORG,exceptValue:M.split(";"),validate:"assignhandlerRequired required",id:"toHandlerAddress",isShowSubject:true,subject:w};var q=lbpm.nodes[lbpm.nowNodeId];if(q.operationScope&&q.operationScope.handler_assign&&q.operationScope.handler_assign!="all"){var H=q.operationScope.handler_assign==null?"":q.operationScope.handler_assign;var I=q.handlerIds==null?"":q.handlerIds;var u=q.operationScope.handler_assign_customHandlerSelectType==null?"org":q.operationScope.handler_assign_customHandlerSelectType;var L=q.handlerSelectType==null?"org":q.handlerSelectType;var B=q.operationScope.handler_assign_customIds==null?"":q.operationScope.handler_assign_customIds;var O=$("input[name='sysWfBusinessForm.fdHandlerRoleInfoIds']").val().split(";")[0];var y="&currentId="+lbpm.nowProcessorInfoObj.expectedId+"&handlerIdentity="+O+"&customHandlerSelectType="+u+"&customHandlerIds="+encodeURIComponent(B)+"&scopeType="+H+"&fdModelName="+lbpm.modelName+"&fdModelId="+lbpm.modelId+"&exceptValue="+M;var x="";x+="<input type='hidden' name='toAssigneeIds' id='toAssigneeIds'/>";x+="<input type='hidden' name='toAssigneeNames' id='toAssigneeNames'/>";x+="<div id='toHandlerAddress' data-dojo-type=\"sys/lbpmservice/mobile/opthandler/OptHandler\" data-dojo-props=\"subject:'"+w+"',validate:'assignhandlerRequired required',required:true,showHeadImg:true,idField:'toAssigneeIds',isMul:"+s.mulSelect+",dataUrl:'/sys/lbpmservice/mobile/opthanlder.do?method=scopeHandlers"+y+"',nameField:'toAssigneeNames'\"></div>";C+=x}else{C+=lbpm.address.html_build(s)}if(Lbpm_SettingInfo&&Lbpm_SettingInfo.isMultiAssignEnabled=="true"){C+="<div class='isMutiAssignCheckbox'>";C+='<div id="isMultiAssign" alertText="" key="isMultiAssign" data-dojo-type="mui/form/CheckBox"';C+=" data-dojo-props=\"name:'isMultiAssign', value:'true', mul:false, text:'";C+=lbpm.constant.opt.AssignAllowMulti+D+"'";C+='"></div></div>'}if(J!=""&&J){C+="<div class='isMutiAssignCheckbox'>";C+='<div id="_assignPassSkip" alertText="" key="isAssignPassSkip" data-dojo-type="mui/form/CheckBox"';C+=" data-dojo-props=\"name:'isAssignPassSkip', value:'true', mul:false, text:'";C+=D+lbpm.constant.opt.AssignPassSkip+"'";C+='"></div></div>'}j("#operationsTDContent").html(C,{parseContent:true,onEnd:function(){this.inherited("onEnd",arguments);if(this.parseDeferred){this.parseDeferred.then(function(){f.publish("/lbpm/operation/toHandlerAddress/parseFinish")})}}});lbpm.globals.hiddenObject(p,false);if(Lbpm_SettingInfo&&Lbpm_SettingInfo.isMultiAssignEnabled=="true"&&Lbpm_SettingInfo.isMultiAssignDefault=="true"){setTimeout(function(){var R=a.byId("isMultiAssign");R.set("checked",true)},100)}if(F!=""&&F){setTimeout(function(){var R=a.byId("_assignPassSkip");if(R){R.set("checked",true)}},100)}var E="<label class='muiRadioItem' style='padding-left: 0rem'><input name='assignType' data-dojo-type='mui/form/Radio' data-dojo-props='checked:false,showStatus:'edit',renderType:'normal',value:'10'' type='radio' value='10' />"+lbpm.constant.opt.AssignType_0+"</label></br><label class='muiRadioItem' style='padding-left: 0rem'><input name='assignType' data-dojo-type='mui/form/Radio' data-dojo-props='checked:false,showStatus:'edit',renderType:'normal',value:'1'' type='radio' value='1'/>"+lbpm.constant.opt.AssignType_1+"</label></br><label class='muiRadioItem' style='padding-left: 0rem'><input name='assignType' data-dojo-type='mui/form/Radio' data-dojo-props='checked:true,showStatus:'edit',renderType:'normal',value:'2'' type='radio' value='2' checked />"+lbpm.constant.opt.AssignType_21+"</label>";Q.style.display="";P.innerHTML=E};n.stringsConcat=function(q,p,s){var q;var p;var s;if(!q){q=";a;c"}if(!p){p=";b;"}if(!s){s=";"}if(q.lastIndexOf(s)==q.length-1&&q){q=q.substr(0,q.lastIndexOf(s))}if(p.indexOf(s)==0&&p){p=p.substr(1)}var r=q+s+p;if(r==s){r="";return r}if(r.lastIndexOf(s)==r.length-1){r=r.substr(0,r.lastIndexOf(s))}if(r.indexOf(s)==0){r=r.substr(1)}return r};n.handler_assign=lbpm.operations.handler_assign={click:m,check:b,blur:k,setOperationParam:d};n.init=function(){};return n})},"sys/lbpmservice/mobile/workitem/OperationButton":function(){define(["dojo/_base/declare","mui/tabbar/TabBarButton","dojo/topic","dojo/dom-class","dojo/dom-style","dojox/mobile/sniff","mui/device/device"],function(f,a,c,h,d,b,g){return f("sys.lbpmservice.mobile.workitem.OperationButton",[a],{operationType:null,buildRendering:function(){this.inherited(arguments);if(this.tabIndex=="0"){h.add(this.domNode,"selected")}},startup:function(){if(this._started){return}this.inherited(arguments)},_setSelectedAttr:function(i){this.inherited(arguments);this.defer(function(){this.set("selected",false)},380)},onClick:function(i){if(g&&g.getClientType()==9){i=i||window.event||arguments[0];if(i.preventDefault){i.preventDefault()}if(i.stopPropagation){i.stopPropagation()}var k=new Date().getTime();var j=lbpm.cbtime;if(j!="undefined"&&k-j<500){return false}if(!lbpm.cbtime){lbpm.firstClickStatus=true}lbpm.cbtime=k}if(lbpm){lbpm.operationButtonType=this.operationType}else{window.operationButtonType=this.operationType}c.publish("/lbpm/operation/switch",this,{methodSwitch:true,value:this.operationType,label:this.label})}})})},"sys/lbpmservice/mobile/operation/handler/operation_handler_assignpass":function(){define(["sys/lbpmservice/mobile/workitem/workitem_common"],function(d){var c={};var g=function(){lbpm.globals.clearDefaultUsageContent("handler_assignPass")};var f=function(h){lbpm.globals.setDefaultUsageContent("handler_assignPass")};var a=function(){if(lbpm.globals.isUsageContenRequired(lbpm.currentOperationType)){return lbpm.globals.validateMustSignYourSuggestion()}return true};var b=function(){};c.handler_assignPass=lbpm.operations.handler_assignPass={click:f,check:a,blur:g,setOperationParam:b};c.init=function(){};return c})},"sys/lbpmservice/mobile/node/reviewnode/operation_handler_commission":function(){define(["dijit/registry","dojo/topic","dojo/query","sys/lbpmservice/mobile/common/syslbpmprocess","mui/dialog/Tip","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm"],function(a,f,j,g,l,c,h){var i=lbpm.constant;i.opt.CommissionPeople=c["lbpmNode.processingNode.operationsTDTitle.handlerOperationType.people"];i.opt.CommissionIsNull=c["lbpmNode.validate.toOtherHandlerIds.Commission.isNull"];i.opt.returnToCommissionedPerson=c["lbpmNode.processingNode.operationsTDTitle.handlerOperationTypeCommission.returnToCommissionedPerson"];i.opt.TurnToDoNoteHiddenNote=h["lbpmOperations.turnToDo.hiddenNote"];var n={};var k=function(){lbpm.globals.clearDefaultUsageContent("handler_commission")};var m=function(B){lbpm.globals.setDefaultUsageContent("handler_commission");var v=document.getElementById("operationsRow");var C=document.getElementById("operationsTDTitle");var q=document.getElementById("operationsTDContent");C.innerHTML=B+lbpm.constant.opt.CommissionPeople;var r=document.getElementById("sysWfBusinessForm.fdHandlerRoleInfoIds");var A=c["lbpmNode.toOtherHandler.address.subject.select"]+B+c["lbpmNode.toOtherHandler.address.subject.person"];var D={mulSelect:false,idField:"toOtherHandlerIds",nameField:"toOtherHandlerNames",splitStr:";",selectType:ORG_TYPE_PERSON|ORG_TYPE_POST,notNull:true,exceptValue:r.value.split(";"),text:lbpm.constant.SELECTORG,alertText:lbpm.constant.opt.CommissionIsNull,validate:"commissionHandlerRequired required",isShowSubject:true,id:"toHandlerAddress",subject:A};var w="";var u=lbpm.nodes[lbpm.nowNodeId];if(u.operationScope&&u.operationScope.handler_commission&&u.operationScope.handler_commission!="all"){var z=u.operationScope.handler_commission==null?"":u.operationScope.handler_commission;var t=u.operationScope.handler_commission_customHandlerSelectType==null?"org":u.operationScope.handler_commission_customHandlerSelectType;var x=u.handlerSelectType==null?"org":u.handlerSelectType;var p=u.operationScope.handler_commission_customIds==null?"":u.operationScope.handler_commission_customIds;var s=$("input[name='sysWfBusinessForm.fdHandlerRoleInfoIds']").val().split(";")[0];var y="&currentId="+lbpm.nowProcessorInfoObj.expectedId+"&handlerIdentity="+s+"&customHandlerSelectType="+t+"&customHandlerIds="+encodeURIComponent(p)+"&scopeType="+z+"&fdModelName="+lbpm.modelName+"&fdModelId="+lbpm.modelId+"&exceptValue="+r.value;w+="<input type='hidden' name='toOtherHandlerIds' id='toOtherHandlerIds'/>";w+="<input type='hidden' name='toOtherHandlerNames' id='toOtherHandlerNames'/>";w+="<div id='toHandlerAddress' data-dojo-type=\"sys/lbpmservice/mobile/opthandler/OptHandler\" data-dojo-props=\"subject:'"+A+"',validate:'commissionHandlerRequired required',required:true,showHeadImg:true,idField:'toOtherHandlerIds',isMul:false,dataUrl:'/sys/lbpmservice/mobile/opthanlder.do?method=scopeHandlers"+y+"',nameField:'toOtherHandlerNames'\"></div>"}else{w=lbpm.address.html_build(D)}if(Lbpm_SettingInfo&&Lbpm_SettingInfo.isHiddeTurnToDoNoteConfigurable=="true"&&lbpm.flowcharts.isHiddeTurnToDoNoteConfigurable!="true"){w+='<div class="isHiddenNote">';w+='<div id="isHiddenNote" alertText="" key="isHiddenNote" data-dojo-type="mui/form/CheckBox"';w+=" data-dojo-props=\"name:'isHiddenNote', value:'true', mul:false, text:'";w+=lbpm.constant.opt.TurnToDoNoteHiddenNote.replace("{commission}",B)+"'";w+='"></div></div>'}if(u.handlerSelectType=="org"){w+='<div class="returnToCommissionedPerson">';w+='<div id="returnToCommissionedPerson" alertText="" key="returnToCommissionedPerson" data-dojo-type="mui/form/CheckBox"';w+=" data-dojo-props=\"name:'returnToCommissionedPerson', value:'true', mul:false, text:'";w+=lbpm.constant.opt.returnToCommissionedPerson.replace("{commission}",B)+"'";w+='"></div></div>'}j("#operationsTDContent").html(w,{parseContent:true,onEnd:function(){this.inherited("onEnd",arguments);if(this.parseDeferred){this.parseDeferred.then(function(){f.publish("/lbpm/operation/toHandlerAddress/parseFinish")})}}});lbpm.globals.hiddenObject(v,false)};var b=function(){var p=j("#toOtherHandlerIds")[0];if(p&&p.value==""){l.warn({text:lbpm.constant.opt.CommissionIsNull});return false}if(lbpm.globals.isUsageContenRequired(lbpm.currentOperationType)){return lbpm.globals.validateMustSignYourSuggestion()}return true};var d=function(){var q=j("#toOtherHandlerIds")[0];lbpm.globals.setOperationParameterJson(q,null,"param");var r=a.byId("returnToCommissionedPerson");if(r){lbpm.globals.setOperationParameterJson(r.get("checked"),"returnToCommissionedPerson","param")}var p=a.byId("isHiddenNote");if(p){lbpm.globals.setOperationParameterJson(p.get("checked"),"isHiddenNote","param")}};n.handler_commission=lbpm.operations.handler_commission={click:m,check:b,blur:k,setOperationParam:d};n.init=function(){};return n})},"sys/lbpmservice/mobile/operation/branchadmin/operation_branchadmin_endbranch":function(){define(["dijit/registry","dojo/query","dojo/store/Memory","mui/dialog/Tip","sys/lbpmservice/mobile/common/syslbpmprocess","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm"],function(b,h,i,g,d,f,c){var a={};a.branchadmin_endbranch={click:function(p){var n=p?p.curTask:"";var u=h("td[id='operationsTDTitle']")[0];var m=h("td[id='operationsTDContent']")[0];var s=u.parentNode;u.innerHTML=c["lbpmOperations.fdOperType.processor.endbranch"];if(!window.isInitLbpmNode){lbpm.globals.parseXMLObj()}if(!lbpm.nodes||lbpm.nodes.length==0||!n){return}else{window.isInitLbpmNode=true}var k=this._getSplitNode(lbpm.nodes[n.nodeId]);var l=[];var v=new KMSSData();v.AddBeanData("getConBranchStatusService&type=runing&splitNode="+k.id+"&processId="+lbpm.modelId);var r=v.GetHashMapArray();var t="";for(var q=0;q<r.length;q++){l.push({value:r[q].id,text:r[q].name})}var t='<div data-dojo-type="mui/form/CheckBoxGroup" id="endConbranchsGroup" data-dojo-props="validate:\'required\',required:true,name:\'endConbranchsGroup\'"></div>';if(l.length>0){h("td[id='operationsTDContent']").html(t,{parseContent:true,onEnd:function(){this.inherited("onEnd",arguments);if(this.parseDeferred){this.parseDeferred.then(function(){var j=b.byId("endConbranchsGroup");j.setStore(new i({data:l}))})}}});lbpm.globals.hiddenObject(s,false)}},check:function(){var j=b.byId("endConbranchsGroup");var k=j.get("value");if(k==null||k==""){g.warn({text:f["lbpmOperations.endbranch.msg"]});return false}return true},setOperationParam:function(l){var j=b.byId("endConbranchsGroup");var k=j.get("value");l.endConbranchs=k},_getSplitNode:function(n){for(var m=0;m<n.startLines.length;m++){var l=n.startLines[m];var k=l.startNode;if(!k){continue}if(k.XMLNODENAME=="splitNode"){if(window.routeJoinNodeRelatedNodeIds&&window.routeJoinNodeRelatedNodeIds.indexOf(k.id)!=-1){var j=this._getSplitNode(k);if(j==null){continue}else{return j}}else{return k}}else{if(k.XMLNODENAME=="joinNode"){if(!window.routeJoinNodeRelatedNodeIds){window.routeJoinNodeRelatedNodeIds=[]}if(window.routeJoinNodeRelatedNodeIds.indexOf(k.relatedNodeIds)==-1){window.routeJoinNodeRelatedNodeIds.push(k.relatedNodeIds)}}var j=this._getSplitNode(k);if(j==null){continue}else{return j}}}return null}};a.init=function(){};return a})},"sys/lbpmservice/mobile/node/draftnode/RadioGroup":function(){define(["dojo/_base/declare","dojo/_base/lang","mui/form/RadioGroup","mui/form/Radio","dojo/_base/array","mui/util","dojo/dom-construct","dojo/dom-attr","dijit/registry","dojo/query"],function(g,c,i,b,j,h,f,l,a,k){var d=g("sys.lbpmservice.mobile.node.draftnode.RadioGroup",[i],{checkedId:null,nodeId:null,tmpl:'<input type="radio" id="manualFutureNodeId_!{manualBranchNodeId}_!{value}" data-dojo-type="sys/lbpmservice/mobile/node/draftnode/Radio" manualBranchNodeId="!{manualBranchNodeId}" key="manualFutureNodeId" data-dojo-props="checked:!{checked},showStatus:\'edit\',name:\'manualFutureNodeId_!{manualBranchNodeId}\',text:\'!{text}\',value:\'!{value}\'">',postCreate:function(){this.subscribe("/sys/lbpmservice/mobile/draftnode/radio/change","_validateAllGroup")},startup:function(){var n=lbpm.nodes[this.nodeId];if(this.checkedId){this.set("value",this.checkedId)}var m=this;this.store=j.map(n.endLines,function(r,p){if(lbpm.globals.isClosedLoop(n,r)){return false}var q=r.name||(r.endNode.id+"."+r.endNode.name);return{text:h.formatText(q),checked:m.checkedId==r.endNode.id,value:r.endNode.id,manualBranchNodeId:n.id}});this.store=j.filter(this.store,function(p){return !(p===false)});this.inherited(arguments)},createListItem:function(n){if(this.isConcentrate(n)){return null}var m=this.tmpl.replace(/!{value}/g,n.value).replace(/!{text}/g,n.text).replace(/!{manualBranchNodeId}/g,n.manualBranchNodeId).replace("!{checked}",n.checked?true:false);var p=f.toDom(m);return p},_validateAllGroup:function(){var m=this;k(".draftworkitemBrancheGroup").forEach(function(p){var q=l.get(p,"id");if(q){var n=a.byId(q);if(n!=m){n.validation.validateElement(n)}}})}});return d})},"sys/lbpmservice/mobile/workitem/CommonUsageCreateView":function(){define(["dojo/_base/declare","dojox/mobile/View","dojo/topic","dojo/dom-style","dojo/query","dijit/registry"],function(d,g,b,c,f,a){return d("sys.lbpmservice.mobile.workitem.CommonUsageCreateView",[g],{startup:function(){this.inherited(arguments)},postCreate:function(){this.subscribe("/lbpm/commonUsageItem/edit","doInit")},onBeforeTransitionIn:function(){c.set(f("body")[0],{background:"#F5F6FB",height:"100%"});this.inherited(arguments)},onAfterTransitionOut:function(){c.set(f("body")[0],{background:"white",height:"auto"});this.doRest();this.inherited(arguments)},doRest:function(){b.publish("/lbpm/commonUsageView/rest",{value:""});var h=a.byId("commonUsageId");if(h){h._setValueAttr("")}},doInit:function(j,i){b.publish("/lbpm/commonUsageView/rest",{value:j.fdContent});var h=a.byId("commonUsageId");if(h){h._setValueAttr(j.fdId)}}})})},"sys/lbpmservice/mobile/workitem/FutureNodesChekBoxGroup":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/query","dojo/_base/array","dojo/dom-class","dojo/dom-construct","dojo/dom-style","mui/form/CheckBox","mui/form/CheckBoxGroup","mui/util","dijit/registry","dojo/request"],function(g,b,l,j,m,c,i,f,k,h,a,d){return g("sys.lbpmservice.mobile.workitem.FutureNodesChekBoxGroup",[k],{routeLineInfo:null,tmpl:"<input type=\"checkbox\" !{disabledText} id=\"futureNodeId[!{index}]\" data-dojo-type=\"sys/lbpmservice/mobile/workitem/FutureNodesChekBox\" manualBranchNodeId=\"!{manualBranchNodeId}\" key=\"futureNodeId\" index=\"!{index}\"data-dojo-props=\"checked:!{checked},showStatus:'edit',name:'!{name}',text:'!{text}',value:'!{value}',rightText:'!{rightText}',index:'!{index}',handlerSelectType:'!{handlerSelectType}',distinct:!{distinct},handlerIds:'!{handlerIds}',isManualBranch:!{isManualBranch}\">",onComplete:function(p){var q=this.generateList(p);var n=this;if(q&&q.then){q.then(function(){if(p&&p.length==1){l(".muiFieldText",n.domNode).style({"margin-left":"0","padding-left":"5px"});l(".muiFormRadio",n.domNode).style("display","none");l(".muiRadioCircle",n.domNode).style("display","none")}})}if(this.validation){this.validation.validateElement(this)}},startup:function(){var p=[];if(this.routeLineInfo!=""&&this.routeLineInfo!=null){var q=this.routeLineInfo.split(";");j.forEach(q,function(t){p.push(lbpm.lines[t])})}else{var s=lbpm.globals.getNextNodeObj(lbpm.nowNodeId);p=lbpm.nodedescs[s.nodeDescType].getLines(lbpm.globals.getCurrentNodeObj(),s,true)}if(p.length==1){this.set("value",p[0].endNode.id)}var n=this;var r=false;if(lbpm&&lbpm.settingInfo){if(lbpm.settingInfo.isRemoveNodeIdentifier==="true"){r=true}}this.store=j.map(p,function(A,z){var t=A.endNode;var D=WorkFlow_getLangLabel(A.name,A.langs);var E=D||"";var w=lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_MANUALBRANCH,A.startNode);var B=lbpm.globals.getNextNodeObj(lbpm.nowNodeId);var F,y,x=false;if(B.nodeDescType=="splitNodeDesc"&&B.splitType&&B.splitType=="custom"){w=true;var u=n.getSplitNodeInfo(B.id);if(u){F=u.defaultStartBranchIds;if(F&&F.indexOf(t.id)!=-1){x=true}y=u.canSelectDefaultBranch}}var C=WorkFlow_getLangLabel(t.name,t.langs,"nodeName");var v="";if(r){v=C}else{v=t.id+"."+C}return{text:h.formatText(E+v),checked:x||n.value==t.id||(!n.value&&n.checkedNodeIds&&n.checkedNodeIds.indexOf(t.id)>=0),value:t.id,manualBranchNodeId:A.startNode.id,index:z,rightText:t.handlerNames==null?"none":h.formatText(t.handlerNames),handlerIds:t.handlerIds==null?"none":h.formatText(t.handlerIds),distinct:lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_SEND,t),handlerSelectType:t.handlerSelectType,isManualBranch:w,name:w?"futureNode":"__futureNode__",disabledText:(x&&y=="false")?"disabled":""}});this.inherited(arguments);if(dojoConfig.dingXForm==="true"){$("#sys_lbpmservice_mobile_workitem_FutureNodesChekBoxGroup").removeClass("muiFormLeft");$("#notifyLevelTD").children().removeClass("muiFormLeft")}},getSplitNodeInfo:function(r){var q=lbpm.modelId;var n="/sys/lbpm/engine/jsonp.jsp?s_bean=lbpmProcessDefinitionDetailService&processId="+q+"&nodeId="+r;n=h.formatUrl(n);var p;d.get(n,{handleAs:"json",sync:true}).then(function(s){p=WorkFlow_LoadXMLData(s.data)});return p},createListItem:function(p){if(this.isConcentrate(p)){return null}var n=this.tmpl.replace("!{value}",p.value).replace("!{text}",p.text.replace(/&#39;/g,"\\'").replace(/\$/g,"$$$")).replace("!{manualBranchNodeId}",p.manualBranchNodeId).replace(/!{index}/g,p.index).replace("!{checked}",p.checked?true:false).replace("!{distinct}",p.distinct).replace("!{handlerIds}",p.handlerIds).replace("!{handlerSelectType}",p.handlerSelectType).replace("!{isManualBranch}",p.isManualBranch).replace("!{name}",p.name).replace("!{rightText}",p.rightText).replace("!{disabledText}",p.disabledText);var q=c.toDom(n);return q}})})},"sys/lbpmservice/mobile/node/reviewnode/operation_handler_pass":function(){define(["sys/lbpmservice/mobile/operation/operation_common_passtype","dijit/registry"],function(d,c){function h(){lbpm.globals.clearDefaultUsageContent("handler_pass");lbpm.globals.hiddenObject(document.getElementById("freeSubFlowNodeRow"),true);if(lbpm.myAddedSubNodes.length>0){var k=document.getElementById("WF_IFrame");var i=k.contentWindow.FlowChartObject;i.Nodes.deleteSubNode(lbpm.myAddedSubNodes[0]);lbpm.myAddedSubNodes=new Array();lbpm.subNodeHandlerIds=new Array();lbpm.subNodeHandlerNames=new Array();var l=i.BuildFlowXML();if(!l){return}var j=document.getElementsByName("sysWfBusinessForm.fdFlowContent")[0];j.value=l;lbpm.globals.parseXMLObj();lbpm.modifys={};$("input[name='sysWfBusinessForm.fdIsModify']")[0].value="1";var m=c.byId("freeSubFlowNodes");if(m){m.buildValue(m.contentNode)}}}function f(j){lbpm.globals.setDefaultUsageContent("handler_pass");var k=document.getElementById("operationsRow");var m=document.getElementById("operationsTDTitle");var n=document.getElementById("operationsTDContent");if(n){m.innerHTML=lbpm.workitem.constant.handlerOperationTypepass;lbpm.globals.hiddenObject(k,false);var i=lbpm.globals.analysisProcessorInfoToObject();if(i!=null){var l=lbpm.globals.generateNextNodeInfo();lbpm.globals.innerHTMLGenerateNextNodeInfo(l,n)}}}function a(i){if(lbpm.globals.common_operationCheckForPassType(i)){if(lbpm.globals.isUsageContenRequired(lbpm.currentOperationType)){return lbpm.globals.validateMustSignYourSuggestion()}return true}else{return false}}function b(){}var g={};g.handler_pass=lbpm.operations.handler_pass={isPassType:true,isHideOperationsRow:true,click:f,check:a,blur:h,setOperationParam:b};return g})},"sys/lbpmservice/mobile/operation/drafter/operation_drafter_abandon":function(){define(["mui/dialog/Tip","dojo/query","dojo/NodeList-manipulate"],function(b,a){var c={};c.drafter_abandon={click:function(){},check:function(){var d=a("#OperationView textarea[name='ext_usageContent']").val();if(d!=""&&d.trim()!=""){return true}b.fail({text:"请填写处理意见！"});return false},setOperationParam:function(d){d.notifyLevel=a("#OperationView input[name='ext_notifyLevel']").val();d.auditNote=a("#OperationView textarea[name='ext_usageContent']").val()}};c.init=function(){};return c})},"sys/lbpmservice/mobile/common/syslbpmprocess_nodes_filter":function(){define(function(){var d={};if(!window.GetXFormFieldById){window.GetXFormFieldById=function(r,x){var p=document.forms;var v=[];for(var w=0,t=p.length;w<t;w++){var q=p[w].elements;for(var u=0,s=q.length;u<s;u++){if(q[u].name!=null&&q[u].name.indexOf(r)>-1){v.push(q[u])}}}return v}}Array.prototype.distinct=function(){var q=[],p=[];for(var s in this){var r=this[s];if(r===q[s]){continue}if(p[r]!=1){q.push(r);p[r]=1}}return q};Array.prototype.equals=function(r){if(!r){return false}if(!(r instanceof Array)){return false}if(this.length!=r.length){return false}for(var q=0,p=this.length;q<p;q++){if(this[q] instanceof Array&&r[q] instanceof Array){if(!this[q].equals(r[q])){return false}}else{if(this[q]!==r[q]){return false}}}return true};d.getIdsByNodes=lbpm.globals.getIdsByNodes=function(p){var r=[];for(var q=0;q<p.length;q++){r.push(p[q].id)}return r.join(",")};d.objContain=lbpm.globals.objContain=function(r,p){if(p.length==0){return false}for(var q=0;q<p.length;q++){if(p[q]==r){return true}}return false};d.getThroughNodes=lbpm.globals.getThroughNodes=function(r,z,p,s,u,v){if(a){setTimeout(function(){lbpm.globals.getThroughNodes(r,z,p,s,u)},100);return}a=true;s=(s!=null)?s:true;var q=lbpm.globals.getBundleFilesInfo();var t=q.filedsJSON;var y=0;for(newFiledId in t){if(y==1){break}for(cacheFiledId in c){if(newFiledId==cacheFiledId){if(t[newFiledId] instanceof Array){if(!t[newFiledId].equals(c[cacheFiledId])){y=1;break}}else{if(t[newFiledId]!=c[cacheFiledId]){y=1;break}}}}}if(y==0){var x=true;var w=true;for(newFiledId in t){w=false;break}for(cacheFiledId in c){x=false;break}if(x!=w){y=1}}if(y==0){if(h.toString()!=(lbpm.globals.getFutureNodeId()).toString()){y=2}}lbpm.globals.getFilterInfo(y,q,r,z,p,s,u,v)};d.CheckBindFieldValueChange=lbpm.globals.CheckBindFieldValueChange=function(){var t=lbpm.globals.getBundleFilesInfo();var p=t.filedsJSON;var s=0;for(newFiledId in p){for(cacheFiledId in c){if(newFiledId==cacheFiledId){if(p[newFiledId] instanceof Array){if(!p[newFiledId].equals(c[cacheFiledId])){return true}}else{if(p[newFiledId]!=c[cacheFiledId]){return true}}}}}var r=true;var q=true;for(newFiledId in p){q=false;break}for(cacheFiledId in c){r=false;break}if(r!=q){return true}if(s==0){if(h.toString()!=(lbpm.globals.getFutureNodeId()).toString()){return true}}return false};var a=false;var c;var l;var h=new Array();var g=[];d.isAutoDecisionNode=lbpm.globals.isAutoDecisionNode=function(q){var p=lbpm.nodedescs[q.nodeDescType];return p.isBranch(q)&&p.isAutomaticRun(q)};d.isDecisionNode=lbpm.globals.isDecisionNode=function(q){var p=lbpm.nodedescs[q.nodeDescType];return p.isBranch(q)};d.isConcurrentNode=lbpm.globals.isConcurrentNode=function(q){var p=lbpm.nodedescs[q.nodeDescType];return p.isConcurrent(q)};d.isHandleDecisionNode=lbpm.globals.isHandleDecisionNode=function(q){var p=lbpm.nodedescs[q.nodeDescType];return p.isBranch(q)&&!p.isAutomaticRun(q)&&p.isHandler(q)};d.getThroughNodesCache=lbpm.globals.getThroughNodesCache=function(){return l};function m(r,q){if(r&&r.targetId){if(r.targetId.indexOf(";")>-1){$.each(r.targetId.split(";"),function(s,u){var t=lbpm.globals.getNodeObj(u);m(t,q)})}else{if(lbpm.globals.objContain(r.targetId,q)){return}q.push(r.targetId);var p=lbpm.globals.getNodeObj(r.targetId);m(p,q)}}}function n(r,s){var q=[];if(!s){$.each(r,function(u,t){m(t,q)})}var p=new Array();$.each(lbpm.nodes,function(u,t){if(t.Status==lbpm.constant.STATUS_PASSED&&!lbpm.globals.objContain(t.id,q)){p.push(t)}});return p}function b(p,r){if(r){lbpm.globals.getOperationParameterJson("toRefuseThisNodeId",null,null,function(t){var s=n(p,t);r(s)});return}var q=lbpm.globals.getOperationParameterJson("toRefuseThisNodeId");return n(p,q)}function i(s,p,r){var q=lbpm.globals.getPreviousNodeObjs(s.id);if(q.length==1){var t=q[0];if(lbpm.globals.isDecisionNode(t)&&!lbpm.globals.isConcurrentNode(t)){p.push(t);r.push({nodeId:t.id,targetNodeId:s.id})}i(t,p,r)}}function k(p,r){var q=[];$.each(p,function(){if(lbpm.globals.isDecisionNode(this)){var s=this;q.push({nodeId:s.id,targetNodeId:s.targetId})}});$.each(r,function(){i(this,p,q)});return q}function f(s,u,w,v,A,t,I,y,D){var B=k(y,D);if(s==2){if(v){v()}B=B.concat(g);var G=lbpm.globals.getAllThroughNodes("N1",B);l=G;if(w){if(I!="N1"){w(lbpm.globals.getAllThroughNodes(I,B))}else{w(G)}}if(A){A()}a=false;return}if(!u){u=lbpm.globals.getBundleFilesInfo()}var C=u.autoNodes;var x=u.filedsJSON;c=x;var r=new Array();for(filedId in x){if(x[filedId]!="null"){r.push(encodeURIComponent(filedId)+"="+encodeURIComponent(x[filedId]))}}for(var F=0;F<C.length;F++){for(var E=0;E<y.length;E++){if(C[F].id==y[E].id){C.splice(F,1);F--;break}}}if(!C||C.length==0){if(v){v()}var G=lbpm.globals.getAllThroughNodes("N1",B);l=G;if(w){if(I!="N1"){w(lbpm.globals.getAllThroughNodes(I,B))}else{w(G)}}if(A){A()}a=false;return}for(var F=0;F<C.length;F++){if(C[F].nodeDescType=="splitNodeDesc"&&C[F].splitType&&C[F].splitType=="custom"){continue}r.push("factNodeId="+encodeURIComponent(C[F].id))}r.push("processId="+encodeURIComponent(lbpm.globals.getWfBusinessFormModelId()));r.push("modelName="+encodeURIComponent(lbpm.globals.getWfBusinessFormModelName()));var z=document.getElementsByName("extendDataFormInfo.extendFilePath")[0];if(z){var q=z.value;r.push("extendFilePath="+encodeURIComponent(q))}if(typeof _thirdSysFormList!="undefined"){r.push("_thirdSysFormList="+encodeURIComponent(JSON.stringify(_thirdSysFormList)))}r.push("nodeFilter=true");var H=r.join("&");var p=function(L){var K=[];if(L){if(L instanceof KMSSData){K=JSON.parse(L.data[0].data)}else{if(L instanceof Array){K=JSON.parse(L[0].data)}}}if(!K){K=[]}g=K;B=B.concat(K);var M=lbpm.globals.getAllThroughNodes("N1",B);l=M;if(w){if(I!="N1"){w(lbpm.globals.getAllThroughNodes(I,B))}else{w(M)}}if(A){A()}a=false};var J=new KMSSData();J.AddBeanData("lbpmRouteDecisionRuleDataBean&"+H);if(v){v()}if(t){J.GetHashMapArray(p)}else{p(J.GetHashMapArray())}}d.getFilterInfo=lbpm.globals.getFilterInfo=function(x,q,r,y,p,s,u,v){s=s!=null?s:true;u=u!=null?u:"N1";if(x==0&&l&&u=="N1"){if(y){y()}if(r){r(l)}if(p){p()}a=false;return}var t=lbpm.globals.getAvailableRunningNodes();if(v){b(t,function(z){f(x,q,r,y,p,s,u,z,t)});return}var w=b(t);f(x,q,r,y,p,s,u,w,t)};d.getFiledsIdByLines=lbpm.globals.getFiledsIdByLines=function(x){var q=[];var r="$";var p="$";for(var u=0;u<x.length;u++){var w=x[u].condition;if(!w){continue}w=w.replace(/^\\s+|\\s+$/g,"");var v;for(v=w.indexOf(r);v>-1;v=w.indexOf(r)){var s=w.indexOf(p,v+1);if(s==-1){break}var t=w.substring(v+1,s);w=w.substring(s+1);if(w.length>0&&w.charAt(0)=="("){continue}q.push(t)}}return q.distinct()};d.getBundleFilesInfo=lbpm.globals.getBundleFilesInfo=function(){var x=new Array();var v=new Array();$.each(lbpm.nodes,function(B,A){if(lbpm.globals.isAutoDecisionNode(A)){x.push(A);$.each(A.endLines,function(){v.push(this)})}});var s={};var w=lbpm.globals.getFiledsIdByLines(v);for(var t=0;t<w.length;t++){var p=GetXFormFieldById(w[t],true);if(p&&w[t]=="docCreator"){var u=[];for(var r=0;r<p.length;r++){if(p[r].name==w[t]){u.push(p[r])}}p=u}if(p&&p.length>1){var q=false;for(var r=0;r<p.length;r++){if(p[r].type=="text"&&p[r].name==w[t]){var z=p[r];p=[];p.push(z);q=true;break}}if(!q){for(var r=0;r<p.length;r++){if(w[t]=="fdId"&&p[r].type=="hidden"&&p[r].name==w[t]){var z=p[r];p=[];p.push(z);break}}}}var y=[];for(var r=0;r<p.length;r++){if(p[r].type=="radio"||p[r].type=="checkbox"||p[r].type=="select"||p[r].type=="select-one"){if(p[r].name=="_"+w[t]||p[r].name==("_extendDataFormInfo.value("+w[t]+")")){continue}}if(p[r].name&&p[r].name.indexOf("extendDataFormInfo.value("+w[t]+"_")==0){continue}if(p[r].type=="radio"||p[r].type=="checkbox"){if(p[r].checked){y.push(p[r].value)}continue}if(p[r].type=="input"){y.push(p[r].originValue||p[r].value);continue}y.push(p[r].value)}if(!y||y.length==0){y="null"}s[w[t]]=y}return{autoNodes:x,filedsJSON:s}};d.getAllThroughNodes=lbpm.globals.getAllThroughNodes=function(x,p,v,t){var C=new Array();var r=lbpm.globals.getNodeObj(x);C.push(r);if(!t){t=new Array()}t.push(r);if(r.XMLNODENAME=="embeddedSubFlowNode"){x=r.startNodeId;r=lbpm.globals.getNodeObj(r.startNodeId);C.push(r);t.push(r)}else{if(r.XMLNODENAME=="groupEndNode"){var u=lbpm.globals.getNextNodeObj(r.groupNodeId);x=u.id;r=lbpm.globals.getNodeObj(x);C.push(r);t.push(r)}}var A=lbpm.globals.getNextNodeObjs(x);var s=[];var q=function(I){if(s.length==0){return true}for(var H=0;H<s.length;H++){if(s[H]==I){return true}}return false};if(lbpm.globals.isDecisionNode(r)){var D=true;if(lbpm.globals.isNodeRunning()&&lbpm.globals.isHandleDecisionNode(r)){var E=lbpm.nodedescs[r.nodeDescType];var F=E.getLines(v,r);if(!lbpm.globals.isSameEndLines(F,r.endLines)){for(var B=0;B<F.length;B++){s.push(F[B].endNode.id)}D=false}}if(D){if(r.nodeDescType=="splitNodeDesc"&&r.splitType&&r.splitType=="custom"&&lbpm.globals.isNodeRunning()){if(v.Status==lbpm.constant.STATUS_RUNNING){if(lbpm.globals.getSelectedFurtureNode){var G=lbpm.globals.getSelectedFurtureNode();for(var B=0;B<G.length;B++){s.push(G[B].NextRoute)}}}else{if(r.targetId){var w=r.targetId.split(";");for(var B=0;B<w.length;B++){s.push(w[B])}}}}else{for(var B=p.length-1;B>=0;B--){if(r.id==p[B].nodeId){if(p[B].targetNodeId.indexOf(";")>-1){$.each(p[B].targetNodeId.split(";"),function(){s.push(this)})}else{s.push(p[B].targetNodeId)}break}}}}}for(var B=0;B<A.length;B++){if(!q(A[B].id)){continue}if(B>=1){C.push(r)}var z=false;for(var y=0;y<t.length-1;y++){if(r.id==t[y].id&&!lbpm.globals.isDecisionNode(r)){z=true;break}}if(z){continue}C=C.concat(lbpm.globals.getAllThroughNodes(A[B].id,p,r,t))}return C};d.getFutureNodeId=lbpm.globals.getFutureNodeId=function(){var p=new Array();$("input[manualBranchNodeId]:checked").each(function(r){var q=$(this);p.push(q.attr("manualBranchNodeId"));p.push(q.val())});h=p;return p};d.isSameEndLines=lbpm.globals.isSameEndLines=function(r,p){if(r&&p){if(r.length!=p.length){return false}var t=false;for(var s=0;s<r.length;s++){t=false;for(var q=0;q<p.length;q++){if(r[s].id==p[q].id){t=true;break}}if(t){continue}else{return false}}return true}return false};d.isNodeRunning=lbpm.globals.isNodeRunning=function(){var p=false;$.each(lbpm.nodes,function(r,q){if(q.Status==lbpm.constant.STATUS_RUNNING){p=true;return false}});return p};var j=function(){return document.getElementById(arguments[0])||false};d.clearIndicatorDiv=lbpm.globals.clearIndicatorDiv=function(q,p){p=p||window;p.document.body.removeChild(q.newMaskDiv);p.document.body.removeChild(q.infoDiv)};d.openIndicatorDiv=lbpm.globals.openIndicatorDiv=function(s,r){s=s||this;var p="mask_div";if(j(r)){s.document.removeChild(j(r))}if(j(p)){s.document.removeChild(j(p))}var q=s.document.createElement("div");q.id=r;q.style.position="absolute";q.style.zIndex="9999";q.style.top="100px";q.style.left=(parseInt(s.document.body.clientWidth-300))/2+"px";q.style.background="#FFFFFF";q.style.filter="alpha(opacity=60)";q.style.opacity="0.60";q.style.border="0px solid #860001";q.style.padding="5px";q.innerHTML="<span style='font-size:12px;font-weight:bolder'><img  width=160px height=20px  src='"+Com_Parameter.ContextPath+"sys/lbpm/flowchart/images/indicator_long.gif'></img><br/>系统正在计算路径...</span>";s.document.body.appendChild(q);var t=s.document.createElement("div");t.id=p;t.style.position="absolute";t.style.zIndex="1";t.style.width=s.document.body.clientWidth+"px";t.style.height=s.document.body.clientHeight+"px";t.style.top="0px";t.style.left="0px";t.style.background="#FFFFFF";t.style.filter="alpha(opacity=60)";t.style.opacity="0.60";s.document.body.appendChild(t);return{newMaskDiv:t,infoDiv:q}};d.throughNodesSorter=lbpm.globals.throughNodesSorter=function(x,w){if(l==null){return lbpm.globals.normalSorter(x,w)}var p=l||[];var q=[];for(var s=0;s<p.length;s++){var t=false;for(var r=0;r<q.length;r++){if(p[s].id==q[r].id){t=true}}if(!t){q.push(p[s])}}var y=(lbpm.globals.getIdsByNodes(q)||"")+",";var v=y.indexOf(x.id+",");var u=y.indexOf(w.id+",");if(v==-1||u==-1||v==u){return 0}return v>u?1:-1};return d})},"sys/lbpmservice/mobile/freeflow/freeflowChartPanel":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/query","dojo/dom-construct","dojo/dom-style","dojo/_base/lang","dojo/topic","mui/dialog/Dialog","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","dojo/parser","dojo/dom-attr","sys/lbpmservice/mobile/freeflow/freeflowNodeAttribute","dojo/_base/window","dojox/mobile/sniff","mui/address/AddressMixin"],function(g,f,n,d,k,b,h,l,c,a,m,q,j,p,i){var r=g("sys.lbpmservice.mobile.freeflow.freeflowChartPanel",[f],{template:false,optTmpl:"<div id=\"freeflowNodeTypeSelect\" data-dojo-type=\"mui/form/RadioGroup\" data-dojo-props=\"showStatus:'edit',name:'_lbpm_address_button_radio',mul:'false',store:{store},orient:'vertical'\" style=\"padding-right:0;\"></div>",nodeTmpl:'<div data-dojo-type="sys/lbpmservice/mobile/freeflow/freeflowNode" data-dojo-props="nodeId:\'!{nodeId}\',template:!{template}"></div>',addAreaTmpl:'<div data-dojo-type="sys/lbpmservice/mobile/freeflow/freeflowSplitArea" data-dojo-props="nodeId:\'!{nodeId}\',template:!{template}" class="free_flow_addArea"></div>',addNodeTmpl:'<div data-dojo-type="sys/lbpmservice/mobile/freeflow/freeflowNodeType" data-dojo-props="nodeType:\'!{nodeType}\'"></div>',buildRendering:function(){this.inherited(arguments);this.cateFieldShow=d.create("div",{className:"free_flow_show"},this.domNode);if(this.template){this.defer(function(){lbpm.flow_chart_load_Frame()},0)}this._init()},_init:function(){var t=this;var s=this.getFlowChartObject();if(s&&s.Nodes&&s.Nodes.GetNodeById&&s.Nodes.GetNodeById("N2")){t.updateFreeFlowNodes(t.cateFieldShow,s)}else{this.defer(function(){this._init()},100)}},__init:function(s){if(s.id=="freeflowChartView"){this._init()}},postCreate:function(){this.inherited(arguments);this.subscribe("/sys/lbpmservice/freeflow/addNode","_addNode");this.subscribe("/sys/lbpmservice/freeflow/deleteNode","_deleteNode");this.subscribe("/sys/lbpmservice/freeflow/moveNode","_moveNode");this.subscribe("/sys/lbpmservice/freeflow/updateNode","_updateNode");this.subscribe("mui/view/currentView","__init");this.subscribe("/sys/lbpmservice/freeflow/nodeTypeCancel","_nodeTypeCancel");this.subscribe("/sys/lbpmservice/freeflow/nodeTypeSelect","_nodeTypeSelect")},_updateNode:function(t){var s=this.getFlowChartObject();this.updateFlowXml(s)},_addNode:function(s){this._selectNodeType(s)},_deleteNode:function(s){this.deleteFreeFlowNode(s.nodeId);this.updateFreeFlowNodes(this.cateFieldShow,this.getFlowChartObject())},_moveNode:function(E,B){if(E&&B){var C=this.getFlowChartObject();var v=function(F){return C.Nodes.GetNodeById(F)};if(B=="up"){var x=v(E.nodeId);var A=x.LineIn[0].StartNode;if(A.Type=="joinNode"){A=v(A.Data.relatedNodeIds)}var z=A.LineIn[0].StartNode;var w=x.LineOut[0].EndNode;if(x.Type=="splitNode"){w=v(x.Data.relatedNodeIds).LineOut[0].EndNode}var u=x.LineIn[0];var t=A.LineIn[0];var D=x.LineOut[0];if(x.Type=="splitNode"){D=v(x.Data.relatedNodeIds).LineOut[0]}t.LinkNode(z,x,"3","1");if(x.Type=="splitNode"){u.LinkNode(v(x.Data.relatedNodeIds),A,"3","1")}else{u.LinkNode(x,A,"3","1")}if(A.Type=="splitNode"){D.LinkNode(v(A.Data.relatedNodeIds),w,"3","1")}else{D.LinkNode(A,w,"3","1")}t.Refresh(C.LINE_REFRESH_TYPE_DOM);u.Refresh(C.LINE_REFRESH_TYPE_DOM);D.Refresh(C.LINE_REFRESH_TYPE_DOM)}else{var x=v(E.nodeId);var y=x.LineOut[0].EndNode;if(x.Type=="splitNode"){y=v(x.Data.relatedNodeIds).LineOut[0].EndNode}var z=x.LineIn[0].StartNode;var w=y.LineOut[0].EndNode;if(y.Type=="splitNode"){w=v(y.Data.relatedNodeIds).LineOut[0].EndNode}var s=y.LineIn[0];var t=x.LineIn[0];var D=y.LineOut[0];if(y.Type=="splitNode"){D=v(y.Data.relatedNodeIds).LineOut[0]}t.LinkNode(z,y,"3","1");if(y.Type=="splitNode"){s.LinkNode(v(y.Data.relatedNodeIds),x,"3","1")}else{s.LinkNode(y,x,"3","1")}if(x.Type=="splitNode"){D.LinkNode(v(x.Data.relatedNodeIds),w,"3","1")}else{D.LinkNode(x,w,"3","1")}t.Refresh(C.LINE_REFRESH_TYPE_DOM);s.Refresh(C.LINE_REFRESH_TYPE_DOM);D.Refresh(C.LINE_REFRESH_TYPE_DOM)}this.updateFlowXml(C);C.Nodes.FlowChart_formatNodes();this.updateFreeFlowNodes(this.cateFieldShow,C)}},_selectNodeType:function(u){var t=this;if(this.nodeTypeDialog!=null){return}var s=[{text:c["mui.freeFlow.lbpm.nodeType.reviewNode"],value:"reviewNode"},{text:c["mui.freeFlow.lbpm.nodeType.signNode"],value:"signNode"},{text:c["mui.freeFlow.lbpm.nodeType.sendNode"],value:"sendNode"}];this.dialogNode=d.toDom(b.replace(this.optTmpl,{store:JSON.stringify(s).replace(/\"/g,"'")}));this.nodeTypeDialog=l.element({canClose:false,showClass:"muiDialogElementShow muiFormSelect free_flow_selectNodeType",element:this.dialogNode,position:"bottom",scrollable:false,parseable:true,onDrawed:function(){t.defer(function(){t._nodeTypeClick(u)},100)},callback:b.hitch(this,function(){this.nodeTypeDialog=null})});var v=d.toDom("<div class='muiDialogElementButton_bottom_split'></div>");d.place(v,n("#freeflowNodeTypeSelect",this.nodeTypeDialog.contentNode)[0],"after");var w=d.toDom("<div class='muiDialogElementButton_bottom'>"+c["mui.freeFlow.cancel"]+"</div>");d.place(w,v,"after");n(w).on("touchend",function(x){t.nodeTypeDialog.hide();t.nodeTypeDialog=null})},_nodeTypeClick:function(t){var s=this;n(".muiRadioItem",this.dialogNode).on("touchend",function(u){var x=new Date().getTime();var v=this.ctime;if(v!="undefined"&&(x-v<500)){return false}this.ctime=x;var y=u.target;var z=n("input",y).val();if(!z){var w=n(y).closest(".muiRadioItem")[0];z=n("input",w).val()}s.nodeSelectType=z;s.startNodeId=t.nodeId;s.defer(function(){if(!s.nodeTypeDialog){s.dialogNode=d.toDom(s.addNodeTmpl.replace("!{nodeType}",s.nodeSelectType));this.nodeTypeDialog=l.element({canClose:false,showClass:"muiDialogElementShow muiFormSelect free_flow_NodeType",element:s.dialogNode,position:"bottom",scrollable:false,parseable:true,callback:b.hitch(this,function(){s.nodeTypeDialog=null})})}},350);s.nodeTypeDialog.hide();s.nodeTypeDialog=null})},_nodeTypeCancel:function(){if(this.nodeTypeDialog){this.nodeTypeDialog.hide();this.nodeTypeDialog=null}},_nodeTypeSelect:function(y){if(this.nodeTypeDialog){this.nodeTypeDialog.hide();this.nodeTypeDialog=null;if(y=="3"){var x=this.addNodeInFreeFlow("","",this.nodeSelectType,this.startNodeId,y);if(this.freeflowNodeAttributeDialog==null){this.freeflowNodeAttributeDialog=new q()}this.freeflowNodeAttributeDialog._selectCate({nodeId:x.Data.id,state:"add",template:this.template});var v=n(".free_flow_item[data-node-id='"+this.startNodeId+"']");if(v.length>0){var s=m.get(v[0],"data-node-type");if(s=="splitNode"){this.updateFreeFlowNodes(this.cateFieldShow,this.getFlowChartObject())}else{var w=this.buildNodeInfo(null,x,v);a.parse(w).then(function(){j.doc.dojoClick=!p("ios")||p("ios")>13});this.defer(function(){h.publish("/sys/lbpmservice/freeflow/refreshNode",this)},100)}}}else{var u=this;var t=false;i.address(true,"","",this.nodeSelectType=="sendNode"?null:window.ORG_TYPE_POSTORPERSON,function(z){if(z&&z.curIds&&!t){t=true;u.addNodeInFreeFlow(z.curIds,z.curNames,u.nodeSelectType,u.startNodeId,y);u.updateFreeFlowNodes(u.cateFieldShow,u.getFlowChartObject())}})}}},buildDraftorNode:function(s){var u=d.create("div",{className:"free_flow_item","data-node-id":"N2"},s);var t=d.create("div",{className:"free_flow_node"},u);d.create("div",{className:"free_flow_left"},t);var x=d.create("div",{className:"free_flow_center"},t);var w=d.create("span",{className:"free_flow_center_icon"},x);d.create("i",{className:"fontmuis muis-org-draft"},w);d.create("span",{className:"free_flow_sortName",innerHTML:c["mui.freeFlow.draftorNode"]},x);var v=d.create("div",{className:"free_flow_right"},t);d.create("span",{className:"free_flow_drafterTip",innerHTML:c["mui.freeFlow.draftorNode.default"]},v);this.buildAddArea(u,"N2")},buildNodeInfo:function(t,v,x){var u=d.create("div",{className:"free_flow_item"+(v.LineIn[0].StartNode.Type=="splitNode"?" firstChild":"")+(v.LineOut[0].EndNode.Type=="joinNode"?" lastChild":""),"data-node-id":v.Data.id,"data-node-type":v.Type});if(t){d.place(u,t,"last")}else{if(x){n(u).insertAfter(n(x))}}var s=this.nodeTmpl.replace("!{nodeId}",v.Data.id).replace("!{template}",this.template);var w=d.toDom(s);d.place(w,u,"last");this.buildAddArea(u,v.Data.id);return u},buildAddArea:function(u,v){var t=this.addAreaTmpl.replace("!{nodeId}",v).replace("!{template}",this.template);var s=d.toDom(t);d.place(s,u,"last")},addNodeInFreeFlow:function(B,D,w,C,s){var A=this.getFlowChartObject();if(A){var v,u;if(C){u=A.Nodes.GetNodeById(C)}else{u=A.Nodes.GetNodeById("N3").LineIn[0].StartNode}if(lbpm.freeFlow.defOperRefIds.length==0||!lbpm.freeFlow.defFlowPopedom){var y=new KMSSData();y.AddBeanData("getOperTypesByNodeService&nodeType=freeFlowReviewNode");y=y.GetHashMapArray();for(var x=0,z=y.length;x<z;x++){if(y[x].isDefault=="true"){lbpm.freeFlow.defOperRefIds.reviewNode=y[x].value;break}}y=new KMSSData().AddBeanData("getOperTypesByNodeService&nodeType=freeFlowSignNode");y=y.GetHashMapArray();for(var x=0,z=y.length;x<z;x++){if(y[x].isDefault=="true"){lbpm.freeFlow.defOperRefIds.signNode=y[x].value;break}}lbpm.freeFlow.defFlowPopedom=Lbpm_SettingInfo.defaultFlowPopedom}if(!this.notifyDfaultValue){var y=new KMSSData();y.AddBeanData("getNotifyTypeService");y=y.GetHashMapArray();this.notifyDfaultValue=y[0]["defaultValue"]}w=w||"reviewNode";var t=[];if(u.Type=="splitNode"){t=A.Nodes.spitNodecreateFreeFlow(u,w,true,{handlerType:s,handlerIds:B,handlerNames:D})}else{t=A.Nodes._CreateFreeFlowSpitMore({handlerType:s,handlerIds:B,handlerNames:D},u,w,true)}for(var x=0;x<t.length;x++){var v=t[x];lbpm.myAddedNodes.push(v.Data.id);if(v.Type=="reviewNode"||v.Type=="signNode"){v.Data.operations["refId"]=lbpm.freeFlow.defOperRefIds[v.Type];v.Data.flowPopedom=lbpm.freeFlow.defFlowPopedom;v.Data.canAddAuditNoteAtt=Lbpm_SettingInfo.isCanAddAuditNoteAtt;v.Data.canModifyMainDoc=Lbpm_SettingInfo.isEditMainDocument;v.Data.processType="2"}v.Data.notifyType=Lbpm_SettingInfo.defaultNotifyType}u=v;this.updateFlowXml(A);return v}},updateFreeFlowNodes:function(t,s){this.getChildren().forEach(function(v,u){v.destroy()});d.empty(t);lbpm.freeFlow.nextNodes=[];this.buildDraftorNode(t);this.appendFreeFlowNode(t,s);a.parse(t).then(function(){j.doc.dojoClick=!p("ios")||p("ios")>13})},appendFreeFlowNode:function(w,y,s,z,A){if(!s){s=y.Nodes.GetNodeById("N2")}if(s.Type=="splitNode"&&!z){var B=s.Data.relatedNodeIds;d.create("div",{className:"free_flow_split_item","data-split-id":s.Data.id,"data-relatedNode-id":B},A?n(".free_flow_split_item[data-relatedNode-id='"+A+"']")[0]:w);this.appendFreeFlowNode(w,y,s,B);s=y.Nodes.GetNodeById(B).LineIn[0].StartNode;z=A||"";A="";this.appendFreeFlowNode(w,y,s,z);s=y.Nodes.GetNodeById(B)}for(var v=0;v<s.LineOut.length;v++){var t=s.LineOut[v].EndNode;if(t.Data.id=="N3"||t.Data.id==z){return}var x=false;if(t.Type=="splitNode"&&z){A=z;x=true}if(z){var u=n(".free_flow_split_item[data-relatedNode-id='"+z+"']");if(u.length>0){this.buildNodeInfo(u[0],t)}else{this.buildNodeInfo(w,t)}}else{this.buildNodeInfo(w,t)}if(t.Type!="joinNode"){this.appendFreeFlowNode(w,y,t,x?"":z,A)}}},deleteFreeFlowNode:function(t){if(!this.template){var s=lbpm.nodes[t];if(!s){return}}this.delNodeInFreeFlow(t)},delNodeInFreeFlow:function(u){var t=this.getFlowChartObject();var s=t.Nodes.GetNodeById(u);t.Nodes.deleteNodeInFreeFlow(s,true);this.updateFlowXml(t)},getFlowChartObject:function(){var s=document.getElementById("WF_IFrame");return s.contentWindow.FlowChartObject},updateFlowXml:function(s){var u=s.BuildFlowXML();if(!u||this.template){return}var t=document.getElementsByName("sysWfBusinessForm.fdFlowContent")[0];t.value=u;lbpm.globals.parseXMLObj();lbpm.modifys={};$("input[name='sysWfBusinessForm.fdIsModify']")[0].value="1";lbpm.events.mainFrameSynch()}});return r})},"sys/lbpmservice/mobile/import/descGenerator":function(){define(function(){lbpmInitNodeDesc=function(c,g,d,a,j,b,f,h,k,l){lbpm.nodeDescMap[c]=g;var i=lbpm.nodedescs[g]={};i.isHandler=function(){return d};i.isAutomaticRun=function(){return a};i.isSubProcess=function(){return j};i.isConcurrent=function(){return b};i.isBranch=function(){return f};i.isGroup=function(){return h};i.isSub=function(){return k};i.uniqueMark=function(){return l};i.getLines=function(m,n){return m.endLines}}})},"sys/lbpmservice/mobile/workitem/CommonUsageSaveButton":function(){define(["dojo/_base/declare","mui/tabbar/TabBarButton","dojo/dom-class","dojo/topic","mui/util","mui/dialog/Tip","dojo/request","dojo/query","mui/i18n/_i18n!sys/mobile/js/mui/mui-common","dijit/registry","mui/history/listener","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm"],function(f,l,j,g,h,k,d,i,c,a,b,m){return f("sys.lbpmservice.mobile.workitem.CommonUsageSaveButton",[l],{saveUrl:"/sys/lbpmservice/support/lbpm_usage/lbpmUsage.do?method=save4Mobile",postCreate:function(){this.subscribe("/mui/form/valueChanged","switchClickStatus");this.subscribe("/mui/textarea/onInput","switchClickStatus");this.subscribe("/lbpm/commonUsageItem/edit","_doInit");this.subscribe("/lbpm/commonUsageItem/updateFinish","_doBack")},startup:function(){this.inherited(arguments);j.add(this.domNode,"saveUsageButton unSelected")},onClick:function(){if(!this.clickStatus){return}this.doSubmit()},switchClickStatus:function(p,n){if(p.id!="commonUsageContent"){return}if(n==""||n.value==""){this.clickStatus=false;j.add(this.domNode,"unSelected")}else{this.clickStatus=true;j.remove(this.domNode,"unSelected")}},_doInit:function(p,n){this.currentItem=p},doSubmit:function(){var p=a.byId("commonUsageContent");if(!p&&!p.value){k.warn({text:m["mui.commonUsage.tip.empty"]});return}var r=a.byId("commonUsageId");if(r&&r.value){if(this.currentItem.fdContent==p.value){k.warn({text:m["mui.commonUsage.tip.same"]});return}this.currentItem.fdContent=p.value;g.publish("/lbpm/commonUsageItem/update",this.currentItem);return}var n=this;var t=k.processing();t.show();var q=h.formatUrl(this.saveUrl);var s={fdUsageContent:p.value,fdIsSysSetup:0,fdIsAppend:1};var u=d.post(q,{data:s,headers:{Accept:"application/json"},handleAs:"json"}).then(function(v){t.hide();if(v.status===false){var w=c["mui.return.failure"];k.fail({text:w,cover:true});return}k.success({text:c["mui.return.success"],callback:n.doBack,cover:true})},function(v){t.hide();var w=c["mui.return.failure"];k.fail({text:w,cover:true})})},_doBack:function(){b.go({step:-1})},doBack:function(){g.publish("/lbpm/commonUsageView/move");b.go({step:-1})}})})},"sys/lbpmservice/mobile/node/group/subflow":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/topic","dijit/registry","dojo/ready","mui/util","mui/form/Address","dojo/query","dojo/NodeList-dom","dojo/NodeList-html","dojo/domReady!"],function(b,h,d,a,j,f,g,i){var c={};c.init=function(){lbpm.nowFreeSubFlowNodeId=null;lbpm.myAddedSubNodes=new Array();lbpm.subNodeHandlerIds=new Array();lbpm.subNodeHandlerNames=new Array();lbpm.nowAdHocSubFlowNodeId=null;if(!lbpm.nowNodeId){return}var n=lbpm.globals.getNextNodeObj(lbpm.nowNodeId);if(n.nodeDescType=="freeSubFlowNodeDesc"){lbpm.nowFreeSubFlowNodeId=n.id}else{if(lbpm.nodes[lbpm.nowNodeId].groupNodeId!=null&&lbpm.nodes[lbpm.nowNodeId].groupNodeType=="freeSubFlowNode"){lbpm.nowFreeSubFlowNodeId=lbpm.nodes[lbpm.nowNodeId].groupNodeId}}if((lbpm.nodes[lbpm.nowNodeId].groupNodeId!=null&&lbpm.nodes[lbpm.nowNodeId].groupNodeType=="adHocSubFlowNode")&&n.nodeDescType=="groupEndNodeDesc"){lbpm.nowAdHocSubFlowNodeId=lbpm.nodes[lbpm.nowNodeId].groupNodeId}else{if(n.nodeDescType=="adHocSubFlowNodeDesc"){lbpm.nowAdHocSubFlowNodeId=n.id}}if(lbpm.nowFreeSubFlowNodeId==null&&lbpm.nowAdHocSubFlowNodeId==null){return}var k=$("input[name='sysWfBusinessForm.fdIsModify']")[0];if(k==null||k.value!="1"){var l=lbpm.globals.getProcessXmlString();document.getElementsByName("sysWfBusinessForm.fdFlowContent")[0].value=l}lbpm.flow_chart_load_Frame();if(lbpm.nowFreeSubFlowNodeId!=null){var m='<div data-dojo-type="sys/lbpmservice/mobile/node/group/freesubflownode/freeSubFlowNodes"></div>';var p=i("#freeSubFlowNodeDIV");p.html(m,{parseContent:true});d.subscribe("/lbpm/operation/switch",function(x,r){if(r&&!r.methodSwitch){lbpm.globals.hiddenObject(document.getElementById("freeSubFlowNodeRow"),true);if(lbpm.myAddedSubNodes.length>0){var t=document.getElementById("WF_IFrame");var q=t.contentWindow.FlowChartObject;q.Nodes.deleteSubNode(lbpm.myAddedSubNodes[0]);lbpm.myAddedSubNodes=new Array();lbpm.subNodeHandlerIds=new Array();lbpm.subNodeHandlerNames=new Array();var u=q.BuildFlowXML();if(!u){return}var s=document.getElementsByName("sysWfBusinessForm.fdFlowContent")[0];s.value=u;lbpm.globals.parseXMLObj();lbpm.modifys={};$("input[name='sysWfBusinessForm.fdIsModify']")[0].value="1"}var w=lbpm.globals.getNextNodeObj(lbpm.nowNodeId);if(w.nodeDescType=="freeSubFlowNodeDesc"){lbpm.nowFreeSubFlowNodeId=w.id}else{if(lbpm.nodes[lbpm.nowNodeId].groupNodeId!=null&&lbpm.nodes[lbpm.nowNodeId].groupNodeType=="freeSubFlowNode"){lbpm.nowFreeSubFlowNodeId=lbpm.nodes[lbpm.nowNodeId].groupNodeId}}var v=a.byId("freeSubFlowNodes");if(v){v.buildValue(v.contentNode)}}})}};return c})},"sys/lbpmservice/mobile/noticeHandler/NoticeHandler":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/topic","dojo/query","dojo/dom-construct","mui/form/Address","mui/util","dojo/dom-style","dojo/on","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm"],function(c,j,d,k,b,g,f,h,i,a){lbpm.globals.initNoticeHandlersDataAction=function(){try{var m=Com_Parameter.ContextPath+"sys/lbpmservice/support/lbpm_process/lbpmProcess.do?method=getNoticeHandlers&ajax=true";var l=new KMSSData();var p={};p.processId=k("[name='sysWfBusinessForm.fdProcessId']")[0].value;p.taskId=lbpm.globals.getOperationParameterJson("id");l.AddHashMap(p);l.SendToUrl(m,function(w){var r=w.responseText;if(r){r=r.split("|");var v=[];for(var t=0;t<r.length;t++){var s={};var u=r[t];if(u){var q=u.split(";");if(q.length>=4){s.id=q[0];s.name=q[1];s.startPos=parseInt(q[2]);s.endPos=parseInt(q[3]);v.push(s)}}}lbpm.globals.updatenoticeHandlerNum(v)}})}catch(n){throw n}};lbpm.globals.updatenoticeHandlerNum=function(n){if(n&&Object.prototype.toString.call(n)==="[object Array]"){if(lbpm.noticeHandlers){var t=lbpm.noticeHandlers;for(var q=0;q<n.length;q++){var m=n[q];var l=true;for(var p=0;p<lbpm.noticeHandlers.length;p++){var s=lbpm.noticeHandlers[p];if(s.id===m.id){l=false;break}}if(l){lbpm.noticeHanlerNum+=1}t.push(m)}lbpm.noticeHandlers=t}else{lbpm.noticeHandlers=[];lbpm.noticeHanlerNum=0;var r="";for(var q=0;q<n.length;q++){lbpm.noticeHandlers.push(n[q]);if(r.indexOf(n[q].id)==-1){lbpm.noticeHanlerNum+=1;r+=n[q].id+";"}}}k("#noticeHandlerNum").text(lbpm.noticeHanlerNum)}};lbpm.globals.filterNoticeHandler=function(){if(lbpm.noticeHandlers){var l=lbpm.operations.getfdUsageContent();var s=l.value;var m="";for(var q=0;q<lbpm.noticeHandlers.length;q++){var r=lbpm.noticeHandlers[q];var p=r.startPos;var n=r.endPos;var t=s.substring(p,n);if(/\s@\S+\s/.test(t)){if(m.indexOf(r.id)==-1){m+=r.id+";"}}}k("input[name='noticeHandlerIds']").val(m);return m}return null};return c("sys.lbpmservice.mobile.noticeHandler.NoticeHandler",[g],{type:ORG_TYPE_PERSON,text:a["lbpm.process.noticeHandler.name"],showHeadImg:false,isMul:true,isNew:false,idField:"noticeHandlerIds",nameField:"noticeHandlerNames",templURL:"sys/lbpmservice/mobile/noticeHandler/noticeHandler.jsp",dataUrl:"/sys/lbpmservice/mobile/noticeHandler.do?method=handlers&processId=!{processId}",startup:function(){this.inherited(arguments);this.dataUrl=f.urlResolver(this.dataUrl,{processId:lbpm.modelId||k("[name='sysWfBusinessForm.fdProcessId']")[0].value});this.templURL="sys/lbpmservice/mobile/noticeHandler/noticeHandler.jsp";this.searchUrl=this.dataUrl+"&keyword=!{keyword}";var m=this;var l=setInterval(function(){if(lbpm&&lbpm.globals){clearInterval(l);m.init();d.publish("/sys/lbpmservice/mobile/noticeHandler/init",this)}},200)},domNodeClick:function(){if(this.showHeadImg){var l=k(arguments[0].target).closest(".muiCategoryAdd");if(l.length<=0){return}}this.inherited(arguments);this.set("value","")},init:function(){var n=k("div#noticeHandler");var q="";q+="<input type='hidden' name='noticeHandlerIds' id='noticeHandlerIds'>";q+="<input type='hidden' name='noticeHandlerNames' id='noticeHandlerNames'>";q+='<a href="javascript:;" style="display:inline-block;font-size: 1.2rem;color:#4285f4;border: 1px solid #4285F4;border-radius: 26px;padding: 0.5rem 1rem;" class="com_btn_link">'+this.text+"</a>";q+='<span style="display:none">(<span id="noticeHandlerNum">0</span>/<span id="noticeHandlerTotal">0</span>)</span>';n.html(q);this.subscribe("/mui/category/submit","selectNoticeHandler");var l=k("[name=fdUsageContent]")[0];var p=false;lbpm.noticeAuditNote="";var r=0;var m=setInterval(function(){lbpm.noticeAuditNote=l.value;if(r>=15){clearInterval(m)}else{if(lbpm.noticeAuditNote){clearInterval(m)}else{r++}}},200);i(l,"compositionstart",function(t){p=true});i(l,"compositionend",function(t){p=false});var s=this;i(l,"input,propertychange",function(t){t.preventDefault();t.stopPropagation();var w=this;if(lbpm.noticeAuditNote.length>k(w).val().length){var A=w.selectionStart;var u=w.selectionStart+(lbpm.noticeAuditNote.length-k(w).val().length);var v,z,y;if(A+1==u){s.delNoticeHandler(A,null,lbpm.noticeAuditNote.substring(A,u))}else{s.delNoticeHandler(A,u,lbpm.noticeAuditNote.substring(A,u))}}else{if(lbpm.noticeAuditNote.length<k(w).val().length){w.focus();var B=w.selectionStart;var x=k(w).val().length-lbpm.noticeAuditNote.length||1;s.changeNoticeHandlerToStr(B-x);s.updatenoticeHandlerPos(B,x);lbpm.noticeAuditNote=k(w).val()}}});i(l,"sys/lbpmservice/mobile/NoticeHandler",function(t){t.preventDefault();t.stopPropagation();var w=this;if(lbpm.noticeAuditNote.length>k(w).val().length){var A=w.selectionStart;var u=w.selectionStart+(lbpm.noticeAuditNote.length-k(w).val().length);var v,z,y;if(A+1==u){s.delNoticeHandler(A,null,lbpm.noticeAuditNote.substring(A,u))}else{s.delNoticeHandler(A,u,lbpm.noticeAuditNote.substring(A,u))}}else{if(lbpm.noticeAuditNote.length<k(w).val().length){var B=k(w).val().length;var x=k(w).val().length-lbpm.noticeAuditNote.length||1;s.changeNoticeHandlerToStr(B-x);s.updatenoticeHandlerPos(B,x);lbpm.noticeAuditNote=k(w).val()}}})},selectNoticeHandler:function(z,B){if(!B||!B.key||!B.curIds||!B.curNames){return}var C=B.key;if(C!="noticeHandlerIds"){return}var q=B.curIds.split(";");var v=B.curNames.split(";");var n=k("[name=fdUsageContent]")[0];var x=n.value;var s=[];var t="";var r=n.selectionStart;this.changeNoticeHandlerToStr(r);for(var y=0;y<q.length;y++){var m={};var u=q[y];var E=v[y];var D=r+t.length;var w=D+E.length+3;var A=this.ToCDB(" ");t+=A+"@"+E+A;m.id=u;m.name=E;m.startPos=D;m.endPos=w;s.push(m)}var l=n.value.substring(0,r);var p=n.value.substring(r);n.value=l+t+p;lbpm.noticeAuditNote=n.value;n.setSelectionRange(t.length+r,t.length+r);this.updatenoticeHandlerPos(r+t.length,t.length);this.updatenoticeHandlers();this.updatenoticeHandlerNum(s);this.updatenoticeHandlerTotal()},updatenoticeHandlerPos:function(s,l,r){if(lbpm.noticeHandlers){for(var p=0;p<lbpm.noticeHandlers.length;p++){var q=lbpm.noticeHandlers[p];var n=q.startPos;var m=q.endPos;if(r==0){if(n>=s){q.startPos-=l;q.endPos-=l}}else{if(n>=(s-l)){q.startPos+=l;q.endPos+=l}}}}},updatenoticeHandlers:function(){var l=window.dojoConfig||{};var r=Com_Parameter.ContextPath+"sys/lbpmservice/mobile/noticeHandler.do?method=handlers";if(l&&l.serverPrefix){r=l.serverPrefix+"/sys/lbpmservice/mobile/noticeHandler.do?method=handlers"}r+="&isNormal=true&processId="+k("[name='sysWfBusinessForm.fdProcessId']")[0].value;var s=null;var p={url:r,async:false,dataType:"json",success:function(t){s=t}};$.ajax(p);var n=[];for(var q=0;q<s.length;q++){var m={};m.id=s[q].id;m.name=s[q].name;n.push(m)}lbpm.allNoticeHandlers=n},updatenoticeHandlerNum:function(n){if(n&&Object.prototype.toString.call(n)==="[object Array]"){if(lbpm.noticeHandlers){var t=lbpm.noticeHandlers;for(var q=0;q<n.length;q++){var m=n[q];var l=true;for(var p=0;p<lbpm.noticeHandlers.length;p++){var s=lbpm.noticeHandlers[p];if(s.id===m.id){l=false;break}}if(l){lbpm.noticeHanlerNum+=1}t.push(m)}lbpm.noticeHandlers=t}else{lbpm.noticeHandlers=[];lbpm.noticeHanlerNum=0;var r="";for(var q=0;q<n.length;q++){lbpm.noticeHandlers.push(n[q]);if(r.indexOf(n[q].id)==-1){lbpm.noticeHanlerNum+=1;r+=n[q].id+";"}}}k("#noticeHandlerNum").text(lbpm.noticeHanlerNum)}},updatenoticeHandlerTotal:function(){var l=window.dojoConfig||{};var n=Com_Parameter.ContextPath+"sys/lbpmservice/mobile/noticeHandler.do?method=handlers";if(l&&l.serverPrefix){n=l.serverPrefix+"/sys/lbpmservice/mobile/noticeHandler.do?method=handlers"}n+="&type=count&isNormal=true&processId="+k("[name='sysWfBusinessForm.fdProcessId']")[0].value;var p=null;var m={url:n,async:false,dataType:"json",success:function(q){p=q}};$.ajax(m);if(p){lbpm.noticeHandlerTotal=parseInt(p[0].count)}else{lbpm.noticeHandlerTotal=0}k("#noticeHandlerTotal").text(lbpm.noticeHandlerTotal)},changeNoticeHandlerToStr:function(r){if(lbpm.noticeHandlers){var l=[];for(var p=0;p<lbpm.noticeHandlers.length;p++){var q=lbpm.noticeHandlers[p];var n=parseInt(q.startPos);var m=parseInt(q.endPos);if(!(r>n&&r<m)){l.push(q)}}lbpm.noticeHandlers=l}},delNoticeHandler:function(s,v,y){var n=k("[name=fdUsageContent]")[0];var x=n.value;if(lbpm.noticeHandlers){var t=false;var B;var r;var q=[];if(v){x=lbpm.noticeAuditNote.substring(0,s)+y+lbpm.noticeAuditNote.substring(v)}else{x=lbpm.noticeAuditNote.substring(0,s)+y+lbpm.noticeAuditNote.substring(s+1)}for(var C=0;C<lbpm.noticeHandlers.length;C++){var m=lbpm.noticeHandlers[C];var F=m.startPos;var w=m.endPos;var G=m.name;var u=m.id;if(v){if((s>F&&s<=w)||(v>F&&v<=w)||(s<=F&&v>=w)||(s>F&&v<=w)){t=true;q.push(C+"");var z=false;for(var A=0;A<lbpm.noticeHandlers.length;A++){if(q.indexOf(A+"")!=-1){continue}if(C!=A&&lbpm.noticeHandlers[A].id===u){z=true;break}}if(!z){lbpm.noticeHanlerNum-=1;k("#noticeHandlerNum").text(lbpm.noticeHanlerNum)}}if((B!=0&&!B)&&(s>F&&s<=w)||(s>F&&v<=w)){B=F}if((r!=0&&!r)&&(v>F&&v<=w)||(s>F&&v<=w)){r=w}}else{if(s>=F&&s<w){t=true;var l=x.substring(0,F);var p=x.substring(w);n.value=l+p;lbpm.noticeAuditNote=l+p;lbpm.noticeHandlers.splice(C,1);this.updatenoticeHandlerPos(w,G.length+3,0);var z=false;for(var A=0;A<lbpm.noticeHandlers.length;A++){if(lbpm.noticeHandlers[A].id===u){z=true;break}}if(!z){lbpm.noticeHanlerNum-=1;k("#noticeHandlerNum").text(lbpm.noticeHanlerNum)}n.setSelectionRange(F,F);break}}}if(v){if(t){var E=[];for(var C=0;C<lbpm.noticeHandlers.length;C++){if(q.indexOf(C+"")==-1){E.push(lbpm.noticeHandlers[C])}}lbpm.noticeHandlers=E;var l,p;if(B==0||B){l=x.substring(0,B);n.setSelectionRange(B,B)}else{l=x.substring(0,s);n.setSelectionRange(s,s)}if(r==0||r){p=x.substring(r);var D=x.length-l.length-p.length;this.updatenoticeHandlerPos(r,D,0)}else{p=x.substring(v);var D=x.length-l.length-p.length;this.updatenoticeHandlerPos(v,D,0)}n.value=l+p;lbpm.noticeAuditNote=l+p}else{var l=x.substring(0,s);var p=x.substring(v);var D=x.length-l.length-p.length;this.updatenoticeHandlerPos(v,D,0)}}else{if(!t){this.updatenoticeHandlerPos(s,1,0)}}}lbpm.noticeAuditNote=n.value},ToCDB:function(n){var m="";for(var l=0;l<n.length;l++){if(n.charCodeAt(l)>65248&&n.charCodeAt(l)<65375){m+=String.fromCharCode(n.charCodeAt(l)-65248)}else{m+=String.fromCharCode(n.charCodeAt(l))}}return m}})})},"sys/lbpmservice/mobile/operation/handler/operation_handler_robtodo":function(){define(["dijit/registry","mui/dialog/Tip","mui/i18n/_i18n!sys/mobile/js/mui/mui-common","mui/device/adapter","mui/device/device","mui/util","dojo/_base/lang","dojo/request","dojo/dom-form"],function(l,B,s,v,z,a,D,f,g){var c={};var n=function(E){lbpm.globals.setDefaultUsageContent("handler_robTodo")};function t(){lbpm.globals.clearDefaultUsageContent("handler_robTodo")}var w=function(){return true};var d=function(){if(!lbpm.hasAddComfirm){lbpm.hasAddComfirm=true;Com_Parameter.event.confirm.unshift(C);Com_Parameter.event.submit_failure_callback.push(p)}};window._alert=window.alert;var h=function(E){B.fail({text:E})};var q=B.processing();var b=false;var x=false;var r=function(){if(b){return false}b=true;window.alert=h;q.show();return true};var m=function(){b=false;window.alert=window._alert;q.hide(false)};var u=function(){var G=a.getUrlParameter(location.href,"_referer");if(Com_Submit.refresh){Com_Submit.refresh=false;location.reload();return}if(G){G=decodeURIComponent(G);location.replace(G);return}var F=v.goBack();if(F==null){history.back()}var E=z.getClientType();if(E!=7&&E!=8&&E!=9&&E!=10){setTimeout(function(){v.closeWindow()},500)}};var k=function(){x=true;B.success({text:"抢办成功！",callback:function(){location.reload()},cover:true})};var j=function(){var F=s["mui.return.failure"];if(arguments&&arguments.length>0){if(arguments[0]&&arguments[0].response){var E=arguments[0].response.data.message;if(E&&E.length>0){F=E[0].msg}}else{F=arguments[0].message[0].msg}}B.fail({text:F,callback:u,cover:true})};var A=function(E){var I=[],G;var H=E.slice(E.indexOf("?")+1).split("&");for(var F=0;F<H.length;F++){G=H[F].split("=");I[G[0]]=G[1]}return I};var y=function(){var I=document.forms[0];if(x){B.fail({text:s["mui.return.submitted"],callback:function(){location.reload()}});m();return}var F=I.action;methodd=A(F).method;var H=I.method||"post";var G=new RegExp();G.compile("[^:]*://app.[^k]*.kk");if(G.test(F)){F=a.formatUrl(F.replace(/[^:]*:\/\/app.[^k]*.kk/,"",""),true)}if(window.Com_BeforeSubmitDeferred){var E=window.Com_BeforeSubmitDeferred();E.then(D.hitch(this,function(){var K=f.post(F,{data:g.toObject(I),headers:{Accept:"application/json"},handleAs:"json"}).then(function(L){m();if(L.status===false){j(L);return}k(L)},function(L){m();j(L)})}),D.hitch(this,function(K){m();j(K)}))}else{if((H.toLowerCase())==="get"){var J=f.get(F,{data:g.toObject(I),headers:{Accept:"application/json"},handleAs:"json"}).then(function(K){m();if(K.status===false){j(K);return}k(K)},function(K){m();j(K)})}else{var J=f.post(F,{data:g.toObject(I),headers:{Accept:"application/json"},handleAs:"json"}).then(function(K){m();if(K.status===false){j(K);return}k(K)},function(K){m();j(K)})}}};var i=function(E){E.stopPropagation();E.preventDefault();r();y(form)};var C=function(){var E=false;var F="/sys/lbpmservice/support/lbpm_process/lbpmProcess.do?method=updateIsCanRobTodo";F=a.formatUrl(F);f.post(F,{data:{fdNodeId:lbpm.nowNodeId,fdProcessId:lbpm.modelId},headers:{Accept:"application/json"},handleAs:"json",sync:true}).then(function(G){E=G.status;if(!E){B.fail({text:G.msg,callback:u,cover:true})}},function(G){E=false;B.fail({text:G.msg,callback:u,cover:true})});if(E){if(window.Com_Submit){Com_Submit.ajaxBeforeSubmit=r;Com_Submit.ajaxCancelSubmit=m;Com_Submit.ajaxSubmit=y}else{on(document.forms[0],"submit",i)}}return E};var p=function(){var E=false;var F="/sys/lbpmservice/support/lbpm_process/lbpmProcess.do?method=removeCanRobTodo";F=a.formatUrl(F);f.post(F,{data:{fdNodeId:lbpm.nowNodeId,fdProcessId:lbpm.modelId},headers:{Accept:"application/json"},handleAs:"json",sync:false}).then(function(G){},function(G){})};c.handler_robTodo=lbpm.operations.handler_robTodo={click:n,check:w,setOperationParam:d};c.init=function(){};return c})},"sys/lbpmservice/mobile/node/reviewnode/operation_handler_additionSign":function(){define(["mui/form/Address","dojo/topic","dojo/query","sys/lbpmservice/mobile/common/syslbpmprocess","mui/dialog/Tip","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","dojo/NodeList-html"],function(g,f,i,h,k,b){var c={};var j=function(){lbpm.globals.clearDefaultUsageContent("handler_additionSign")};var l=function(A){lbpm.globals.setDefaultUsageContent("handler_additionSign");var u=document.getElementById("operationsRow");var B=document.getElementById("operationsTDTitle");var n=document.getElementById("operationsTDContent");B.innerHTML=A+lbpm.constant.opt.AdditionSignPeople;var p=document.getElementById("sysWfBusinessForm.fdHandlerRoleInfoIds");var z=b["lbpmNode.toOtherHandler.address.subject.select"]+A+b["lbpmNode.toOtherHandler.address.subject.person"];B.innerHTML=A+lbpm.constant.opt.AdditionSignPeople;var C={mulSelect:true,idField:"toOtherHandlerIds",nameField:"toOtherHandlerNames",splitStr:";",selectType:ORG_TYPE_PERSON|ORG_TYPE_POST,notNull:true,exceptValue:p.value.split(";"),text:lbpm.constant.SELECTORG,alertText:lbpm.constant.opt.AdditionSignIsNull,validate:"additionSignHandlerRequired required",id:"toHandlerAddress",isShowSubject:true,subject:z};var v="";var t=lbpm.nodes[lbpm.nowNodeId];if(t.operationScope&&t.operationScope.handler_additionSign&&t.operationScope.handler_additionSign!="all"){var y=t.operationScope.handler_additionSign==null?"":t.operationScope.handler_additionSign;var s=t.handlerIds==null?"":t.handlerIds;var r=t.operationScope.handler_additionSign_customHandlerSelectType==null?"org":t.operationScope.handler_additionSign_customHandlerSelectType;var w=t.handlerSelectType==null?"org":t.handlerSelectType;var m=t.operationScope.handler_additionSign_customIds==null?"":t.operationScope.handler_additionSign_customIds;var q=$("input[name='sysWfBusinessForm.fdHandlerRoleInfoIds']").val().split(";")[0];var x="&currentId="+lbpm.nowProcessorInfoObj.expectedId+"&handlerIdentity="+q+"&customHandlerSelectType="+r+"&customHandlerIds="+encodeURIComponent(m)+"&scopeType="+y+"&fdModelName="+lbpm.modelName+"&fdModelId="+lbpm.modelId+"&exceptValue="+p.value;v+="<input type='hidden' name='toOtherHandlerIds' id='toOtherHandlerIds'/>";v+="<input type='hidden' name='toOtherHandlerNames' id='toOtherHandlerNames'/>";v+="<div id='toHandlerAddress' data-dojo-type=\"sys/lbpmservice/mobile/opthandler/OptHandler\" data-dojo-props=\"subject:'"+z+"',validate:'additionSignHandlerRequired required',required:true,showHeadImg:true,idField:'toOtherHandlerIds',dataUrl:'/sys/lbpmservice/mobile/opthanlder.do?method=scopeHandlers"+x+"',nameField:'toOtherHandlerNames'\"></div>"}else{v=lbpm.address.html_build(C)}i("#operationsTDContent").html(v,{parseContent:true,onEnd:function(){this.inherited("onEnd",arguments);if(this.parseDeferred){this.parseDeferred.then(function(){f.publish("/lbpm/operation/toHandlerAddress/parseFinish")})}}});lbpm.globals.hiddenObject(u,false)};var a=function(){var m=i("#toOtherHandlerIds")[0];if(m&&m.value==""){var n=document.getElementById("operationsTDTitle").innerHTML;var p=constant.opt.PleaseChoose+" "+n;k.warn({text:p});return false}if(lbpm.globals.isUsageContenRequired(lbpm.currentOperationType)){return lbpm.globals.validateMustSignYourSuggestion()}return true};var d=function(){var m=i("#toOtherHandlerIds")[0];lbpm.globals.setOperationParameterJson(m,null,"param")};c.handler_additionSign=lbpm.operations.handler_additionSign={click:l,check:a,blur:j,setOperationParam:d};c.init=function(){};return c})},"sys/lbpmservice/mobile/node/reviewnode/operation_handler_nodeResume":function(){define(["sys/lbpmservice/mobile/workitem/workitem_common"],function(d){var c={};var g=function(){lbpm.globals.clearDefaultUsageContent("handler_nodeResume")};var f=function(h){lbpm.globals.setDefaultUsageContent("handler_nodeResume")};var a=function(){if(lbpm.globals.isUsageContenRequired(lbpm.currentOperationType)){return lbpm.globals.validateMustSignYourSuggestion()}return true};var b=function(){};c.handler_nodeResume=lbpm.operations.handler_nodeResume={click:f,check:a,blur:g,setOperationParam:b};c.init=function(){};return c})},"sys/lbpmservice/mobile/operation/handler/operation_handler_returncommunicate":function(){define(["sys/lbpmservice/mobile/workitem/workitem_common"],function(c){var f={};var d=function(g){};var a=function(){return lbpm.globals.validateMustSignYourSuggestion()};var b=function(){};f.handler_returnCommunicate=lbpm.operations.handler_returnCommunicate={click:d,check:a,setOperationParam:b};f.init=function(){};return f})},"sys/lbpmservice/mobile/workitem/CopyButton":function(){define(["dojo/_base/declare","mui/tabbar/TabBarButton","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/dialog/Confirm","dojo/request","mui/util","dojo/_base/lang"],function(d,c,h,b,f,a,g){return d("sys.lbpmservice.mobile.workitem.CopyButton",[c],{checkUrl:null,startup:function(){this.inherited(arguments);this.checkUrl=a.formatUrl(this.checkUrl)},onClick:function(){var j=document.activeElement;if(j&&j.blur){j.blur()}var i=arguments;this.defer(function(){this.checkTemplate()},350);if(this.href){return false}},checkTemplate:function(){if(this.checkUrl){var i=this;f.post(this.checkUrl,{handleAs:"json"}).then(function(j){if(j==false){if(i.href){i.jumpToPage()}}else{b(h["mui.kmReviewMain.copy.comfirm"],"",function(k){if(k&&i.href){i.jumpToPage()}})}},function(j){console.error("检查模板表单是否有更新失败："+e)})}else{if(this.href){location.href=a.formatUrl(this.href)}}},jumpToPage:function(){try{if(this._referer){this.href=a.setUrlParameter(this.href,"_referer",a.formatUrl(this._referer));location.href=a.formatUrl(this.href)}else{var i=document.referrer;if(i){var j=location.protocol.toLowerCase()+"//"+location.hostname;if(location.port!=""&&location.port!="80"){j=j+":"+location.port}i="/"+i.split(j+dojoConfig.baseUrl)[1];this.href=a.setUrlParameter(this.href,"_referer",a.formatUrl(i));location.href=a.formatUrl(this.href)}else{this.href=a.setUrlParameter(this.href,"_referer",a.formatUrl("/"));location.href=a.formatUrl(this.href)}}}catch(k){this.href=a.setUrlParameter(this.href,"_referer",a.formatUrl("/"));location.href=a.formatUrl(this.href)}}})})},"sys/lbpmservice/mobile/workitem/CommonUsageManageView":function(){define(["dojo/_base/declare","dojo/topic","mui/list/StoreScrollableView","dojo/dom-style","dojo/query","dojo/dom-geometry"],function(c,a,g,b,d,f){return c("sys.lbpmservice.mobile.workitem.CommonUsageManageView",[g],{startup:function(){b.set(this.domNode,{"overflow-x":"hidden"});this.inherited(arguments);this.checkAndFixFixedFooterHeight(this,1)},checkAndFixFixedFooterHeight:function(i,j){if(!j){j=1}if(j>10){return}if(i.fixedFooter&&!i.fixedFooterHeight){var h=f.position(this.fixedFooter);if(h.h>0){i.fixedFooterHeight=h.h}else{setTimeout(function(){i.checkAndFixFixedFooterHeight(i,++j)},100)}}},onBeforeTransitionIn:function(){this.inherited(arguments)},onAfterTransitionOut:function(){this.inherited(arguments)}})})},"sys/lbpmservice/mobile/common/syslbpmprocess":function(){define(["./workflow","./syslbpmprocess_nodes_filter","./syslbpmprocess_submit","dojo/dom","dojo/query","dojo/request","mui/dialog/Confirm","mui/dialog/Dialog","dojo/dom-construct","mui/i18n/_i18n!sys/mobile/js/mui/mui-common","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","dojo/dom-style","dojo/_base/lang","mui/util","dojo/json"],function(r,f,n,s,g,d,u,h,i,m,b,q,w,a,c){var p={};var j=function(x){return new KMSSData().AddBeanData("sysFormulaDictVarTree&modelName="+x).GetHashMapArray()};p.getfdUsageContent=lbpm.operations.getfdUsageContent=function(){return $("[name=fdUsageContent]")[0]};p.initialContextParams=lbpm.globals.initialContextParams=function(){lbpm.globals.getWfBusinessFormModelName();lbpm.globals.getWfBusinessFormModelId();lbpm.globals.getWfBusinessFormFdKey();lbpm.globals.getWfBusinessFormDocStatus();lbpm.handlerId=$("[name='sysWfBusinessForm.fdCurHanderId']")[0].value;lbpm.draftorName=$("[name='sysWfBusinessForm.fdDraftorName']")[0].value};p.parseProcessorObj=lbpm.globals.parseProcessorObj=function(){var y=window.WorkFlow_LoadXMLData($("input[name='sysWfBusinessForm.fdCurNodeXML']")[0].value);if(!y||(!y.nodes&&!y.tasks)){return}if(y.nodes){for(var A=0,z=y.nodes.length;A<z;A++){var C=y.nodes[A];for(o in C){if(lbpm.nodes[C.id]){lbpm.nodes[C.id][o]=C[o]}if(lbpm.nodesInit[C.id]){lbpm.nodesInit[C.id][o]=C[o]}}if(lbpm.isSubForm){if(!lbpm.nodes[C.id]["subFormMobileId"]){lbpm.nodes[C.id]["subFormMobileId"]="default";lbpm.nodesInit[C.id]["subFormMobileId"]="default"}}}}lbpm.drafterInfoObj=lbpm.globals.getDrafterInfoObj(y);lbpm.authorityInfoObj=lbpm.globals.getAuthorityInfoObj(y);lbpm.historyhandlerInfoObj=lbpm.globals.getHistoryhandlerInfoObj(y);lbpm.branchAdminInfoObj=lbpm.globals.getBranchAdminInfoObj(y);var B=lbpm.globals.getProcessorInfoObj(y);lbpm.processorInfoObj=B;if(B){var x=0;if(B.length>1&&lbpm.defaultTaskId&&lbpm.defaultTaskId!=""){for(var A=0;A<B.length;A++){if(B[A].id==lbpm.defaultTaskId){x=A;break}}}lbpm.nowProcessorInfoObj=B[x];if(lbpm.nowProcessorInfoObj){lbpm.nowNodeId=lbpm.nowProcessorInfoObj.nodeId;if(lbpm.isFreeFlow){if(lbpm.nowNodeId=="N2"){lbpm.nowNodeFlowPopedom="2"}else{lbpm.nowNodeFlowPopedom=lbpm.globals.getNodeObj(lbpm.nowNodeId).flowPopedom}}}}};p.parseSubFormInfoObj=lbpm.globals.parseSubFormInfoObj=function(){if(lbpm.isSubForm){var x=WorkFlow_LoadXMLData($("input[name='sysWfBusinessForm.fdSubFormXML']")[0].value);if(x.subforms){var y=$.extend(true,[],x.subforms);lbpm.subFormInfoObj=y}}};p.normalSorter=lbpm.globals.normalSorter=function(y,x){if(y.y==x.y){return y.x-x.x}return y.y-x.y};lbpm.globals._levelCalc=function(E,y,z){if(!z){z=[]}if(!y){y=0}y++;var x=lbpm.nodes[E];if(!x){return}if(x.level<y){x.level=y}z.push(x);var F=lbpm.globals.getNextNodeObjs(E);for(var D=0;D<F.length;D++){var C=false;var A=lbpm.nodedescs[F[D].nodeDescType];for(var B=0;B<z.length;B++){if(z[B].id==F[D].id&&A.isBranch(F[D])){C=true;break}}if(C){continue}lbpm.globals._levelCalc(F[D].id,y,z)}};p.setNodeLevel=lbpm.globals.setNodeLevel=function(){lbpm.globals._levelCalc("N1")};p.levelSorter=lbpm.globals.levelSorter=function(y,x){return y.level-x.level};Array.prototype.contains=function(x){for(var y=0;y<this.length;y++){if(this[y]==x){return true}}return false};p.getNodeSorter=lbpm.globals.getNodeSorter=function(){return lbpm.globals.levelSorter};p.parseXMLObj=lbpm.globals.parseXMLObj=function(){var K=WorkFlow_LoadXMLData(document.getElementById("sysWfBusinessForm.fdFlowContent").value);var F=WorkFlow_LoadXMLData(document.getElementById("sysWfBusinessForm.fdFlowContent").value);if(!K){return}var y=K.nodes;var C=F.nodes;y.sort(lbpm.globals.normalSorter);C.sort(lbpm.globals.normalSorter);for(B in K){if(B!="nodes"&&B!="lines"){lbpm.flowcharts[B]=K[B]}}var D=new Array(),z=new Array();for(var G=0,E=y.length;G<E;G++){D[G]=y[G].id}for(G=0;G<K.lines.length;G++){z[G]=K.lines[G].id}for(var B in lbpm.nodes){if(!D.contains(B)){delete lbpm.nodes[B]}}for(var B in lbpm.lines){if(!z.contains(B)){delete lbpm.lines[B]}}for(var G=0,E=y.length;G<E;G++){var x=y[G];lbpm.nodes[x.id]=x;lbpm.nodes[x.id].startLines=[];lbpm.nodes[x.id].endLines=[];lbpm.nodes[x.id].Status=1;lbpm.nodes[x.id].nodeDescType=lbpm.nodeDescMap[x.XMLNODENAME];lbpm.nodes[x.id].level=0}for(var G=0,E=C.length;G<E;G++){var M=C[G];lbpm.nodesInit[M.id]=M}for(G=0;G<K.lines.length;G++){var H=K.lines[G];lbpm.lines[H.id]=H;lbpm.lines[H.id].startNode=lbpm.nodes[H.startNodeId];lbpm.lines[H.id].endNode=lbpm.nodes[H.endNodeId];lbpm.nodes[H.startNodeId].endLines.push(H);lbpm.nodes[H.endNodeId].startLines.push(H)}var K=window.WorkFlow_LoadXMLData(document.getElementById("sysWfBusinessForm.fdTranProcessXML").value);for(G=0;G<K.historyNodes.length;G++){var L=K.historyNodes[G];var J=lbpm.nodes[L.id];if(J==null){continue}if(lbpm.isFreeFlow){J.Status=2}else{if(L.routeType=="BACK"||L.routeType=="JUMP"){J.Status=1}else{J.Status=2}}J.targetId=L.targetId}for(G=0;G<K.runningNodes.length;G++){lbpm.nodes[K.runningNodes[G].id].Status=3;if(lbpm.isFreeFlow){var A=lbpm.globals.getNextNodes(lbpm.nodes[K.runningNodes[G].id],[]);for(var E=0;E<A.length;E++){A[E].Status=1}}}lbpm.notifyType=lbpm.flowcharts.notifyType;if(lbpm.flowcharts&&lbpm.flowcharts.description){var I=Com_HtmlEscape(lbpm.flowcharts.description);if(I){I=I.replace(/&amp;#xD;&amp;#xA;/g,"<br />");I=I.replace(/&amp;#xD;/g,"");I=I.replace(/&amp;#xA;/g,"<br />")}$("#fdFlowDescription").html(I)}};p.getNextNodes=lbpm.globals.getNextNodes=function(B,x){var A=lbpm.globals.getNextNodeObjs(B.id);for(var z=0;z<A.length;z++){var y=A[z];if(lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_END,y)){continue}if(lbpm.globals.containNode(x,y)){continue}x.push(y);lbpm.globals.getNextNodes(y,x)}return x};p.containNode=lbpm.globals.containNode=function(x,y){for(var z=0;z<x.length;z++){if(y.id==x[z].id){return true}}return false};p.objectToJSONString=lbpm.globals.objectToJSONString=function(z,x,y){return c.stringify(z,x,y)};p.checkNodeType=lbpm.globals.checkNodeType=function(x,z){if(!z){return false}var A=lbpm.constant;var y=lbpm.nodedescs[z.nodeDescType];switch(x){case A.NODETYPE_HANDLER:return y.isHandler(z);break;case A.NODETYPE_CANREFUSE:if(y.isHandler(z)&&!y.isAutomaticRun(z)&&!y.isBranch(z)){return true}else{return false}break;case A.NODETYPE_SEND:if(y.isHandler(z)&&y.isAutomaticRun(z)&&!y.isBranch(z)&&!y.isSubProcess(z)&&!y.isConcurrent(z)&&y.uniqueMark(z)==null){return true}else{return false}break;case A.NODETYPE_SPLIT:if(!y.isHandler(z)&&y.isAutomaticRun(z)&&y.isBranch(z)&&!y.isSubProcess(z)&&y.isConcurrent(z)&&y.uniqueMark(z)==null){return true}else{return false}break;case A.NODETYPE_REVIEW:if(y.isHandler(z)&&!y.isAutomaticRun(z)&&!y.isBranch(z)&&!y.isSubProcess(z)&&!y.isConcurrent(z)&&y.uniqueMark(z)==null){return true}else{return false}break;case A.NODETYPE_STARTSUBPROCESS:if(!y.isHandler(z)&&y.isAutomaticRun(z)&&!y.isBranch(z)&&y.isSubProcess(z)&&y.isConcurrent(z)&&y.uniqueMark(z)==null){return true}else{return false}break;case A.NODETYPE_RECOVERSUBPROCESS:if(!y.isHandler(z)&&y.isAutomaticRun(z)&&!y.isBranch(z)&&y.isSubProcess(z)&&!y.isConcurrent(z)&&y.uniqueMark(z)==null){return true}else{return false}break;case A.NODETYPE_AUTOBRANCH:if(!y.isHandler(z)&&y.isAutomaticRun(z)&&y.isBranch(z)&&!y.isSubProcess(z)&&!y.isConcurrent(z)&&y.uniqueMark(z)==null){return true}else{return false}break;case A.NODETYPE_MANUALBRANCH:if(y.isHandler(z)&&!y.isAutomaticRun(z)&&y.isBranch(z)&&!y.isSubProcess(z)&&!y.isConcurrent(z)&&y.uniqueMark(z)==null){return true}else{return false}break;case A.NODETYPE_ROBOT:if(!y.isHandler(z)&&y.isAutomaticRun(z)&&!y.isBranch(z)&&!y.isSubProcess(z)&&!y.isConcurrent(z)&&y.uniqueMark(z)==null){return true}else{return false}break;default:if(z.nodeDescType==x){return true}break}return false};p.validateControlItem=lbpm.globals.validateControlItem=function(){var N=document.getElementById("saveDraftButton");var G=document.getElementById("updateButton");var B=document.getElementById("operationItemsRow");var y=document.getElementById("operationMethodsRow");var M=document.getElementById("descriptionRow");var F=document.getElementById("showSignature");var E=document.getElementById("notifyTypeRow");var J=document.getElementById("attachmentRow");var P=document.getElementById("notifyOptionTR");var C=document.getElementById("checkChangeFlowTR");var I=lbpm.globals.getOperationParameterJson("operations");var x=document.getElementById("commonUsagesRow");var z=document.getElementById("signaturePicUL");var H=document.getElementById("signatureTitleDiv");var A=document.getElementById("commonUsagesDiv");var D=document.getElementById("notifyLevelRow");lbpm.globals.hiddenObject(y,true);if(I==null||I.length==0){lbpm.globals.hiddenObject(B,true);if(F){lbpm.globals.hiddenObject(F,true)}lbpm.globals.hiddenObject(M,true);lbpm.globals.hiddenObject(E,true);lbpm.globals.hiddenObject(J,true);lbpm.globals.hiddenObject(P,true);lbpm.globals.hiddenObject(C,true);lbpm.globals.hiddenObject(N,true);lbpm.globals.hiddenObject(G,true);lbpm.globals.hiddenObject(D,true)}else{if(F){if(typeof seajs!="undefined"){lbpm.globals.hiddenObject(F,false)}else{lbpm.globals.hiddenObject(F,true)}}if(lbpm.nowNodeId=="N2"&&Lbpm_SettingInfo.isDraftNodeDisplayOpinion=="true"){if(lbpm.constant.DOCSTATUS!="11"&&Lbpm_SettingInfo.isNewPageAndDraftsManRecallPage=="true"){lbpm.globals.hiddenObject(x,true);lbpm.globals.hiddenObject(z,true);lbpm.globals.hiddenObject(A,true);lbpm.globals.hiddenObject(H,true)}if(lbpm.constant.DOCSTATUS=="11"&&Lbpm_SettingInfo.isRejectPage=="true"){lbpm.globals.hiddenObject(x,true);lbpm.globals.hiddenObject(z,true);lbpm.globals.hiddenObject(A,true);lbpm.globals.hiddenObject(H,true)}}else{lbpm.globals.hiddenObject(x,false)}lbpm.globals.hiddenObject(E,false);lbpm.globals.hiddenObject(J,false);lbpm.globals.hiddenObject(P,false);lbpm.globals.hiddenObject(N,false);lbpm.globals.hiddenObject(G,false);lbpm.globals.hiddenObject(C,false);lbpm.globals.hiddenObject(D,false);if(Lbpm_SettingInfo&&Lbpm_SettingInfo.isNotifyLevelOptional=="false"){lbpm.globals.hiddenObject(D,true)}}lbpm.globals.controlProcessStatusRow();if(window.OptBar_Refresh){OptBar_Refresh(true)}if(!lbpm.nowProcessorInfoObj){$("#lbpm_highLevelTab").each(function(){lbpm.globals.setNotionPopedomTRHidden(this)})}if(lbpm.isFreeFlow){lbpm.globals.hiddenObject(document.getElementById("freeflowRow"),false);var K=lbpm.globals.getCurrentNodeObj();if(K){var L=document.getElementById("freeFlowNodeDIV");lbpm.globals.hiddenObject(L,false)}}if(Lbpm_SettingInfo.isShowCurrentHandlers=="false"){var O=$("#currentHandlersRow")[0];lbpm.globals.hiddenObject(O,true)}};p.initPrivateOpinion=lbpm.globals.initPrivateOpinion=function(){require(["dojo/ready","dijit/registry","dojo/query","dojo/topic","dojo/dom-style"],function(A,x,B,y,z){A(function(){var D=B("#privateOpinionTr");if(D.length>0){var E=document.getElementById("commonUsagesDiv");if(!lbpm.isFreeFlow||!E||E.style.display=="none"||Lbpm_SettingInfo.isPrivateOpinion=="false"){z.set(D[0],{display:"none"})}else{var C=x.byId("privateOpinion");if(C){y.subscribe("mui/form/checkbox/change",function(G){if(G&&G==C){var F=B("#privateOpinionCanViewTr")[0];if(G.checked){z.set(F,{display:"block"})}else{z.set(F,{display:"none"});var H=x.byId("privateOpinionPerson");H.set("curIds","");H.set("curNames","")}}})}}}})})};p.controlProcessStatusRow=lbpm.globals.controlProcessStatusRow=function(){var x=$("input[name='sysWfBusinessForm.fdProcessStatus']").val();if(x){$("#processStatusRow").show();$("#processStatusLabel").html("<font color=red>"+x+"</font>")}};p.setupAttachmentRow=lbpm.globals.setupAttachmentRow=function(){var G=s.byId("assignmentRow");if(G==null){return}if(!lbpm.nowProcessorInfoObj){lbpm.globals.hiddenObject(G,true);return}var z=lbpm.globals.getCurrentNodeObj().canAddAuditNoteAtt;var H=s.byId("sysWfBusinessForm.fdAuditNoteFdId").value;if(z=="false"){lbpm.globals.hiddenObject(G,true);if(typeof window.AttachmentList!="undefined"&&window.AttachmentList[H]){window.AttachmentList[H].fileStatus=-1}}else{lbpm.globals.hiddenObject(G,false);if(typeof window.AttachmentList!="undefined"&&window.AttachmentList[H]){window.AttachmentList[H].fileStatus=1}}var y=lbpm.globals.getOperationParameterJson("id");var D=y+"_"+lbpm.handlerId;var E=G.getElementsByTagName("Div");var A=$(G).find("[name='attachmentTtile']");for(var C=0;C<E.length;C++){var B=E[C];if(B.getAttribute("name")!="attachmentDiv"){continue}if(B.getAttribute("id")==D){lbpm.globals.hiddenObject(B,false);if(A[C]){var x=$(B).find(".muiFormEleTitle")[0];if(x){lbpm.globals.hiddenObject(x,true)}var F=$(B).find(".muiAttachmentEditItem")[0];if(F){$(F).addClass("attr_adapter")}lbpm.globals.hiddenObject(A[C],false)}}else{lbpm.globals.hiddenObject(B,true);if(A[C]){lbpm.globals.hiddenObject(A[C],true)}}}};p.hiddenObject=lbpm.globals.hiddenObject=function(y,x){if(y!=null){if(x){$(y).hide()}else{$(y).show()}}};p.getNodeObj=lbpm.globals.getNodeObj=function(x){if(x==""||x==null){return{}}return lbpm.nodes[x]};p.getLineObj=lbpm.globals.getLineObj=function(z,y){var x=lbpm.nodes[z];if(y==null||y==true){return x.startLines[0]}else{return x.endLines[0]}};p.getNextNodeObj=lbpm.globals.getNextNodeObj=function(y){var x=lbpm.nodes[y];return x.endLines[0].endNode};p.getWfBusinessFormModelName=lbpm.globals.getWfBusinessFormModelName=function(){var x=lbpm.modelName;var y=document.getElementsByName("sysWfBusinessForm.fdModelName");if(y&&y.length>0){x=lbpm.modelName=y[0].value}return x};p.getWfBusinessFormModelId=lbpm.globals.getWfBusinessFormModelId=function(){var y=lbpm.modelId;var x=document.getElementsByName("sysWfBusinessForm.fdModelId");if(x&&x.length>0){y=lbpm.modelId=x[0].value}return y};p.getWfBusinessFormFdKey=lbpm.globals.getWfBusinessFormFdKey=function(){var y=lbpm.constant.FDKEY;var x=document.getElementsByName("sysWfBusinessForm.fdKey");if(x&&x.length>0){y=lbpm.constant.FDKEY=x[0].value}return y};p.getWfBusinessFormDocStatus=lbpm.globals.getWfBusinessFormDocStatus=function(){var x=lbpm.constant.DOCSTATUS;var y=document.getElementsByName("docStatus");if(y&&y.length>0){x=lbpm.constant.DOCSTATUS=y[0].value}return x};p.checkModifyNodeAuthorization=lbpm.globals.checkModifyNodeAuthorization=function(z,y){if(z.mustModifyHandlerNodeIds!=null&&z.mustModifyHandlerNodeIds!=""){var x=(z.mustModifyHandlerNodeIds+";").indexOf(y+";");if(x!=-1){return true}}return false};p.analysisProcessorInfoToObject=lbpm.globals.analysisProcessorInfoToObject=function(){return lbpm.nowProcessorInfoObj};p.handlerOperationClearOperationsRow=lbpm.globals.handlerOperationClearOperationsRow=function(){if(lbpm.globals.destroyOperations){lbpm.globals.destroyOperations()}$("[lbpmMark='operation']").each(function(){$(this).find("[lbpmDetail]").each(function(){this.innerHTML=""});$(this).find("td").each(function(){this.innerHTML=""});lbpm.globals.hiddenObject(this,true)});$("[lbpmMark='hide']").each(function(){lbpm.globals.hiddenObject(this,true)})};p.getNextNodeObjs=lbpm.globals.getNextNodeObjs=function(B){var A=lbpm.nodes[B];var x=new Array();for(var z=0,y=A.endLines.length;z<y;z++){x.push(A.endLines[z].endNode)}return x};p.getPreviousNodeObjs=lbpm.globals.getPreviousNodeObjs=function(B){var A=lbpm.nodes[B];var z=new Array();for(var y=0,x=A.startLines.length;y<x;y++){z.push(A.startLines[y].startNode)}return z};p.getPreviousNodeObj=lbpm.globals.getPreviousNodeObj=function(x){return lbpm.globals.getPreviousNodeObjs(x)[0]};p.getCurrentNodeObj=lbpm.globals.getCurrentNodeObj=function(){if(lbpm.nowNodeId&&lbpm.nowNodeId!=""){return lbpm.nodes[lbpm.nowNodeId]}else{return null}};lbpm.globals.parseTasksInfo=function(x,B,y){var z=$.grep(x.tasks,function(E,D){return E.taskFrom==B});if(z.length==0){return z}var A=$.extend(true,[],z);var C=$.grep(A,function(E,F){if(E.operations){var D=$.grep(E.operations,function(H,G){return H.operationHandlerType==y});if(D.length==0){return false}E.operations=D;return true}return false});return C};p.getDrafterInfoObj=lbpm.globals.getDrafterInfoObj=function(x){if(x==null){return lbpm.drafterInfoObj}return lbpm.globals.parseTasksInfo(x,"node","drafter")};p.getAuthorityInfoObj=lbpm.globals.getAuthorityInfoObj=function(x){if(x==null){return lbpm.authorityInfoObj}return lbpm.globals.parseTasksInfo(x,"node","admin")};p.getHistoryhandlerInfoObj=lbpm.globals.getHistoryhandlerInfoObj=function(x){if(x==null){return lbpm.historyhandlerInfoObj}return lbpm.globals.parseTasksInfo(x,"node","historyhandler")};p.getBranchAdminInfoObj=lbpm.globals.getBranchAdminInfoObj=function(x){if(x==null){return lbpm.branchAdminInfoObj}return lbpm.globals.parseTasksInfo(x,"node","admin")};p.getProcessorInfoObj=lbpm.globals.getProcessorInfoObj=function(x){var y=lbpm.constant.ROLETYPE;if(y==lbpm.constant.DRAFTERROLETYPE){return lbpm.globals.getDrafterInfoObj(x)}else{if(y==lbpm.constant.AUTHORITYROLETYPE){return lbpm.globals.getAuthorityInfoObj(x)}else{if(y==lbpm.constant.HISTORYHANDLERROLETYPE){return lbpm.globals.getHistoryhandlerInfoObj(x)}else{if(y==lbpm.constant.BRANCHADMINROLETYPE){return lbpm.globals.getBranchAdminInfoObj(x)}}}}if(x==null){return lbpm.processorInfoObj}var B=(lbpm.allMyProcessorInfoObj=lbpm.globals.parseTasksInfo(x,"workitem","handler"));if(lbpm.isSubForm){var A=new Array();for(var z=0;z<B.length;z++){if(lbpm.nowSubFormId==lbpm.nodes[B[z]["nodeId"]]["subFormMobileId"]){A.push(B[z])}}return A}else{return B}};p.arrayToStringByKey=lbpm.globals.arrayToStringByKey=function(x,z){var A="";if(x){for(var y=0;y<x.length;y++){A=A+";"+x[y][z]}A=A.substring(1)}return A};p.isPassedSubprocessNode=lbpm.globals.isPassedSubprocessNode=function(){var x=false;$.each(lbpm.nodes,function(z,y){if(y.Status==lbpm.constant.STATUS_PASSED){if(lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_STARTSUBPROCESS,y)){x=true;return false}}});return x};p.getAvailableRunningNodes=lbpm.globals.getAvailableRunningNodes=function(){var x=new Array();$.each(lbpm.nodes,function(z,y){if(y.Status==lbpm.constant.STATUS_RUNNING){x.push(y)}});return x};p.getAvailableHistoryNodes=lbpm.globals.getAvailableHistoryNodes=function(){var x=new Array();$.each(lbpm.nodes,function(z,y){if(y.Status==lbpm.constant.STATUS_PASSED){x.push(y)}});return x};p.getNodeSize=lbpm.globals.getNodeSize=function(){var x=0;$.each(lbpm.nodes,function(z,y){x=x+1});return x};function v(x,z){var A=new Object();for(var B=0,y=x.length;B<y;B++){var C=x[B];if(!z){A[C]=null}else{if(z[C]!=null){A[C]=z[C]}else{A[C]="";z[C]=""}}}if(x.length==1){return A[x[0]]}return A}p.getOperationParameterJson=lbpm.globals.getOperationParameterJson=function(C,z,B,D){var y=lbpm.nowProcessorInfoObj;var x=C.split(":");var A=lbpm.globals.getNullParamArr(x,y);if(A.length>0){if(D){lbpm.globals.getOperationParameterFromAjax(A,z,y,B,function(){D(v(x,y))});return}lbpm.globals.getOperationParameterFromAjax(A,z,y,B)}if(D){D(v(x,y));return}return v(x,y)};p.getNullParamArr=lbpm.globals.getNullParamArr=function(x,y){var B=new Array();if(!y){return B}for(var A=0,z=x.length;A<z;A++){if(y[x[A]]==null){B.push(x[A])}}return B};p.getOperationParameterFromAjax=lbpm.globals.getOperationParameterFromAjax=function(x,z,y,B,D){if(!y){return}var C={};if(z){C.taskType=y.type;C.taskId=y.id}else{if(B){C.nodeId=B.id;C.nodeType=B.XMLNODENAME}else{C.nodeId=lbpm.nowNodeId;C.nodeType=lbpm.globals.getCurrentNodeObj().XMLNODENAME}}C.params=x.join(":");if(D){lbpm.globals._getOperationParameterFromAjax(C,function(E){l(y,E,x);D()});return}var A=lbpm.globals._getOperationParameterFromAjax(C);l(y,A,x)};function l(y,B,x){if(B!=null){for(o in B){if(B[o]!=null){y[o]=B[o]}else{y[o]=""}}}else{for(var A=0,z=x.length;A<z;A++){y[x[A]]=""}}}lbpm.globals._getOperationParameterFromAjax=function(C,B){var x=window.dojoConfig||{};var z=Com_Parameter.ContextPath+"sys/lbpmservice/include/sysLbpmdata.jsp?m_Seq="+Math.random();if(x&&x.serverPrefix){z=x.serverPrefix+"/sys/lbpmservice/include/sysLbpmdata.jsp?m_Seq="+Math.random()}z+="&processId="+$("[name='sysWfBusinessForm.fdProcessId']")[0].value;z+="&modelName="+lbpm.modelName;var A=null;var y={url:z,data:C,async:false,dataType:"json",success:function(D){A=D}};if(B){y.async=true;y.success=function(D){B(D)}}if(window.dojo4OfflineKK){y.crossDomain=true;y.xhrFields=y.xhrFields||{};y.xhrFields.withCredentials=true}$.ajax(y);return A};p.htmlUnEscape=lbpm.globals.htmlUnEscape=function(y){if(y==null||y==""){return""}var x=/&amp;/g;y=y.replace(x,"&");x=/&quot;/g;y=y.replace(x,'"');x=/&#39;/g;y=y.replace(x,"'");x=/&lt;/g;y=y.replace(x,"<");x=/&gt;/g;return y.replace(x,">")};p.getCurrentOperation=lbpm.globals.getCurrentOperation=function(){$("[name='oprGroup']").each(function(){if(this.checked||this.type=="select"||this.type=="select-one"){var x=this.value.split(":");lbpm.currentOperationType=x[0];lbpm.currentOperationName=x[1];return false}});if(lbpm.currentOperationType==null){return null}return{type:lbpm.currentOperationType,name:lbpm.currentOperationName,operation:lbpm.operations[lbpm.currentOperationType]}};if(!lbpm.address){lbpm.address={}}p.is_pda=lbpm.address.is_pda=function(){return window.dojo?true:false};var t=function(x){return x.alertText?x.alertText:""};var k=function(x){return"id="+x+" name="+x+" key="+x+""};p.html_build=lbpm.address.html_build=function(F){var A="";if(F.cateFieldShow){A=", cateFieldShow:'#_"+F.idField+'_label\'" style="float:right;width:35px;height:30px;margin:0 5px 0 0;'}var y=F.idValue||"";var D=F.nameValue||"";var z="<input type='hidden' alertText='"+t(F)+"' value='"+Com_HtmlEscape(y)+"' "+k(F.idField)+"><input type='hidden' "+k(F.nameField)+" alertText='' value='"+Com_HtmlEscape(D)+"'>";var E="";if(F.groupBtn){E+=dojoConfig.baseUrl+"sys/lbpmservice/mobile/GroupButtonMixin.js"}var C=F.validate?"validate:'"+F.validate+"',":"";if(F.validate&&(F.validate.indexOf(" required")>=0||F.validate.indexOf("required ")>=0)){C+=" required:true, "}var B="";if(F.isShowSubject){if(F.subject){B="subject:'"+F.subject+"',"}else{B="subject:'"+t(F)+"',"}}var x=F.id?"id='"+F.id+"' ":"";z+="<div "+x+' data-dojo-type="mui/form/Address" data-dojo-props="type: '+(F.selectType||ORG_TYPE_POSTORPERSON)+",idField:'"+F.idField+"',nameField:'"+F.nameField+"',exceptValue:'"+(F.exceptValue==null?"":F.exceptValue.join(";"))+"',curIds:'"+(F.idValue==null?"":F.idValue)+"',curNames:'"+(F.nameValue==null?"":F.nameValue)+"',"+C+B+"isMul:"+F.mulSelect+A+'"></div>';return z};p.getFormFieldList=lbpm.globals.getFormFieldList=function(){var x=lbpm.constant.FDKEY?lbpm.constant.FDKEY:$("[name='sysWfBusinessForm.fdKey']").val();var y="XForm_getXFormDesignerObj_"+x;if(window[y]){return window[y]()}else{return j(lbpm.globals.getWfBusinessFormModelName())}};p.getExtAttribute=lbpm.globals.getExtAttribute=function(B,z){if(!B||!B.extAttributes){return}var A=B.extAttributes;if(A.length>0){for(var y=0;y<A.length;y++){var x=A[y];if(x.name==z){return x}}}return null};p.updateProcessToFinalVersion=lbpm.globals.updateProcessToFinalVersion=function(){var y=g("#__docStatus").val();var A=g("#__method").val();if(A=="edit"&&y=="10"){var x=Com_Parameter.ContextPath+"sys/lbpmservice/support/lbpmSaveDraftAction.do?method=checkIsDraft";var z={processId:g("[name='sysWfBusinessForm.fdProcessId']")[0].value};d.post(x,{data:z,handleAs:"json",sync:false}).then(function(C){if(C==true||C=="true"){var F='<span style="font-size:14px">'+b["lbpmservice.saveDraft.content"]+"</span>";var H=b["lbpmservice.saveDraft.title"];var B=false;var I=function(N,L){if(N){var M=Com_Parameter.ContextPath+"sys/lbpmservice/support/lbpmSaveDraftAction.do?method=updateProcessToFinalVersion";var K={processId:g("[name='sysWfBusinessForm.fdProcessId']")[0].value};d.post(M,{data:K,handleAs:"json",sync:true}).then(function(O){if(O==true||O=="true"){window.location.href=location.href+"&time="+((new Date()).getTime())}},function(O){})}};var D=function(){I(true)};var E=i.create("div",{className:"muiConfirmDialogElement",innerHTML:"<div>"+F+"</div>"});var J={title:H,showClass:"muiConfirmDialogShow",element:E,scrollable:false,parseable:false,canClose:false,callback:D,buttons:[{title:'<span style="font-size:1.6rem">'+m["mui.button.ok"]+"</span>",fn:function(K){K.hide();I(true,K)}}]};var G=h.element(J)}},function(B){})}};p.updateShowLimitTimeTotal=lbpm.globals.updateShowLimitTimeTotal=function(){var x=function(C){var D={};var B=2;C=C/1000;var z=parseInt(C/(3600*24));D.day=z;C=C-z*3600*24;var y=parseInt(C/3600);D.hour=(""+y).length<B?((new Array(B+1)).join("0")+y).slice(-B):""+y;C=C-y*3600;var E=parseInt(C/60);D.minute=(""+E).length<B?((new Array(B+1)).join("0")+E).slice(-B):""+E;var A=parseInt(C-E*60);D.second=(""+A).length<B?((new Array(B+1)).join("0")+A).slice(-B):""+A;return D};setInterval(function(){if(lbpm.limitTotalTime){var A=parseInt(lbpm.limitTotalTime);var y=lbpm.isTimeoutTotal;if(y=="true"){A=A+1000}else{if(y=="false"){A=A-1000}}if(A<0){A=Math.abs(A);y="true";var C=Data_GetResourceString("sys-lbpmservice:lbpmNode.processingNode.timeoutRow");$("#limitTimeMethodRowTitle .titleNode").html(C)}var B=x(A);var z='<span class="limit_time_span" style="border-radius: 2px; padding: 2px 7px;">'+B.day+"</span> "+Data_GetResourceString("sys-lbpmservice:FlowChartObject.Lang.Node.day")+' <span class="limit_time_span" style="border-radius: 2px; padding: 2px 7px;">'+B.hour+'</span> : <span class="limit_time_span" style="border-radius: 2px; padding: 2px 7px;">'+B.minute+'</span> : <span class="limit_time_span" style="border-radius: 2px; padding: 2px 7px;">'+B.second+"</span>";$("#limitTimeMethodRow .detailNode").html(z);lbpm.limitTotalTime=A;lbpm.isTimeoutTotal=y}},1000)};p.showNodeHelpDailog=window.showNodeHelpDialog=function(){var x=i.create("div");i.place(s.byId("nodeDescriptionDialog"),x,"first");var y={title:"节点帮助",showClass:"nodeDescriptionDialog",element:x,scrollable:false,parseable:false,iconClose:true,buttons:[],callback:w.hitch(this,function(A,z){q.set(s.byId("nodeDescriptionDialog"),{display:"none"});i.place(g("#nodeDescriptionDialog",z.element)[0],s.byId("nodeDescriptionRow"),"last")}),onDrawed:w.hitch(this,function(z){q.set(s.byId("nodeDescriptionDialog"),{display:"block"});q.set(z.contentNode,{"min-height":"10rem","max-height":"32rem","overflow-y":"auto","overflow-x":"hidden"})})};h.element(y)};p.showFlowDescriptionDialog=window.showFlowDescriptionDialog=function(){var x=i.create("div");i.place(s.byId("flowDescriptionDialog"),x,"first");var y={title:"流程说明",showClass:"flowDescriptionDialog",element:x,scrollable:false,parseable:false,iconClose:true,buttons:[],callback:w.hitch(this,function(A,z){q.set(s.byId("flowDescriptionDialog"),{display:"none"});i.place(g("#flowDescriptionDialog",z.element)[0],s.byId("fdFlowDescriptionRow"),"last")}),onDrawed:w.hitch(this,function(z){q.set(s.byId("flowDescriptionDialog"),{display:"block"});q.set(z.contentNode,{"min-height":"10rem","max-height":"32rem","overflow-y":"auto","overflow-x":"hidden"})})};h.element(y)};p.handleDescriptionLang4View=lbpm.globals.handleDescriptionLang4View=function(D,A){function C(E,H,G){if(H==null){return E}for(var F=0;F<H.length;F++){if(G==H[F]["lang"]){return x(H[F]["value"])||E}}return x(E)}function x(E){E=E||"";E=a.formatText(E);E=E.replace(/&amp;#xD;&amp;#xA;/g,"<br />");E=E.replace(/&amp;#xD;/g,"");E=E.replace(/&amp;#xA;/g,"<br />");return E}if(!_isLangSuportEnabled){return A}if(D.descriptionLangJson){var y=c.parse(D.descriptionLangJson);var B=WorkFlow_GetCurrUserLang();var z=C(D.description,y,B);return z||""}return A};p.fdFlowDescriptionInit=lbpm.globals.fdFlowDescriptionInit=function(){try{if(lbpm.flowcharts&&lbpm.flowcharts.description&&Lbpm_SettingInfo.isShowFlowDescription=="true"){var x=a.formatText(lbpm.flowcharts.description);if(x){x=x.replace(/&amp;#xD;&amp;#xA;/g,"<br />");x=x.replace(/&amp;#xD;/g,"");x=x.replace(/&amp;#xA;/g,"<br />")}x=lbpm.globals.handleDescriptionLang4View(lbpm.flowcharts,x);g("#currentflowDescription").html(x);q.set(s.byId("fdFlowDescriptionRow"),{display:"inline-block"});q.set(s.byId("lbpmOtherInfo"),{display:""});lbpm.isShowLbpmOtherInfo=true}else{q.set(s.byId("fdFlowDescriptionRow"),{display:"none"});if(!lbpm.isShowLbpmOtherInfo){q.set(s.byId("lbpmOtherInfo"),{display:"none"});lbpm.isShowLbpmOtherInfo=false}}}catch(y){}};p.lbpmIsRemoveNodeIdentifier=lbpm.globals.lbpmIsRemoveNodeIdentifier=function(){var x=false;if(lbpm&&lbpm.settingInfo){if(lbpm.settingInfo.isRemoveNodeIdentifier==="true"){x=true}}return x};p.lbpmIsHideAllNodeIdentifier=lbpm.globals.lbpmIsHideAllNodeIdentifier=function(){var x=false;if(Lbpm_SettingInfo&&Lbpm_SettingInfo.isHideNodeIdentifier==="true"&&Lbpm_SettingInfo.hideNodeIdentifierType==="isHideAllNodeIdentifier"){x=true}return x};p.init=function(){lbpm.globals.initialContextParams();lbpm.globals.parseXMLObj();lbpm.globals.setNodeLevel();lbpm.globals.parseSubFormInfoObj();lbpm.globals.parseProcessorObj();lbpm.globals.validateControlItem();lbpm.globals.initPrivateOpinion();lbpm.globals.setupAttachmentRow();lbpm.events.addListener(lbpm.constant.EVENT_CHANGEWORKITEM,lbpm.globals.setupAttachmentRow);if(window.fromReview!="true"){lbpm.globals.updateProcessToFinalVersion()}lbpm.events.addListener("updateShowLimitTimeOperation",lbpm.globals.updateShowLimitTimeOperation);lbpm.limitTotalTime=window.limitTotalTime;lbpm.isTimeoutTotal=window.isTimeoutTotal;lbpm.globals.updateShowLimitTimeTotal();lbpm.globals.fdFlowDescriptionInit()};return p})},"sys/lbpmservice/mobile/operation/handler/operation_handler_jump":function(){define(["dojo/query","dojo/store/Memory","dijit/registry","mui/dialog/Tip"],function(f,j,g,k){lbpm.operations.handler_jump={click:h,check:m,blur:l,setOperationParam:c};function l(){lbpm.globals.clearDefaultUsageContent("handler_jump")}function h(G){lbpm.globals.setDefaultUsageContent("handler_jump");var C=document.getElementById("operationsRow");var K=document.getElementById("operationsTDTitle");K.innerHTML=lbpm.workitem.constant.handlerOperationTypeJump.replace("{jump}",G);var J=lbpm.globals.getCurrentNodeObj();var w=J.id;lbpm.globals._isJumpNodeInJoin=false;var H=b();var L=[];if(J.canHandlerJumpNodeIds){L=J.canHandlerJumpNodeIds.split(";")}var z=d(J);var y=i();if(H&&H.length){var E='<div id="jumpToNodeIdSelectObj" data-dojo-type="mui/form/Select" key="jumpToNodeId" data-dojo-props="validate:\'jumpRequired required\',required:true,name:\'jumpToNodeIdSelectObj\', value:\'\', mul:false" ></div>';var D=lbpm.globals.isPassedSubprocessNode();if(D){E+="<div class='isRecoverPassedSubprocessLabel'>";E+='<div id="isRecoverPassedSubprocess" alertText="" key="isRecoverPassedSubprocess" data-dojo-type="mui/form/CheckBox"';E+=" data-dojo-props=\"name:'isRecoverPassedSubprocess', value:'true', mul:false, text:'";E+=lbpm.workitem.constant.handlerOperationTypeRefuse_abandonSubprocess.replace("{refuse}",G)+"'";E+='"></div></div>'}var B=[];for(var A=0;A<H.length;A++){var I=H[A];if(L.length>0&&L.indexOf(I.id)<0){continue}if(!p(z,I)){continue}var F=WorkFlow_getLangLabel(I.name,I.langs,"nodeName");var x=y?F:(I.id+"."+F);if(I.handlerSelectType=="org"){if(I.handlerNames){x+="("+I.handlerNames+")"}else{x+="("+lbpm.workitem.constant.COMMONNODEHANDLERORGEMPTY+")"}}else{if(I.handlerSelectType!=null){x+="("+lbpm.workitem.constant.COMMONLABELFORMULASHOW+")"}}B.push({text:x,value:I.id})}if(B.length>0){f("#operationsTDContent").html(E,{parseContent:true,onEnd:function(){var N=this.inherited("onEnd",arguments);var M=function(O){var P=g.byId("jumpToNodeIdSelectObj");P.setStore(new j({data:B}));if(B.length>0){if(lbpm.isFreeFlow){P.set("value",B[0].value)}else{P.set("value",B[B.length-1].value)}}};if(this.parseDeferred){this.parseDeferred.then(M)}}})}else{f("#operationsTDContent").html(lbpm.workitem.constant.noRefuseNode.replace("{jump}",G)+'<input type="hidden" alertText="'+lbpm.workitem.constant.noRefuseNode.replace("{jump}",G)+'" key="jumpToNodeId">')}}else{f("#operationsTDContent").html(lbpm.workitem.constant.noRefuseNode.replace("{jump}",G)+'<input type="hidden" alertText="'+lbpm.workitem.constant.noRefuseNode.replace("{jump}",G)+'" key="jumpToNodeId">')}lbpm.globals.hiddenObject(C,false)}function i(){var w=false;if(lbpm&&lbpm.settingInfo&&lbpm.settingInfo.isHideNodeIdentifier==="true"&&lbpm.settingInfo.hideNodeIdentifierType==="isHideAllNodeIdentifier"){w=true}return w}function m(){var w=f("#operationsTDContent [name='jumpToNodeIdSelectObj']").val();if(w==null||w==""){k.warn({text:lbpm.workitem.constant.noRefuseNode.replace("{jump}",lbpm.currentOperationName)});return false}if(lbpm.globals.isUsageContenRequired(lbpm.currentOperationType)){return lbpm.globals.validateMustSignYourSuggestion()}return true}function c(){var x=f("#operationsTDContent [name='jumpToNodeIdSelectObj']").val();var y=x.split(":");lbpm.globals.setOperationParameterJson(y[0],"jumpToNodeId","param");if(y.length>1){lbpm.globals.setOperationParameterJson(y[1],"jumpToNodeInstanceId","param")}else{lbpm.globals.setOperationParameterJson("","jumpToNodeInstanceId","param")}var z=lbpm.nodes[y[0]].name;lbpm.globals.setOperationParameterJson(z,"jumpToNodeName","param");var w=g.byId("isRecoverPassedSubprocess");if(w){lbpm.globals.setOperationParameterJson(w.checked,"isRecoverPassedSubprocess","param")}}function b(){var w=[];lbpm.globals.setNodeLevel();$.each(lbpm.nodes,function(x,y){if(lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_START,y)||lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_END,y)||lbpm.nowNodeId==y.id||lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_AUTOBRANCH,y)||lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_MANUALBRANCH,y)||lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_SPLIT,y)||lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_JOIN,y)||y.Status==lbpm.constant.STATUS_RUNNING||y.endLines.length==0||y.startLines.length==0){}else{w.push(y)}});w.sort(function(A,y){var z=A.level;var x=y.level;return z-x});return w}function d(z){var x=[];x=q(z,x);if(lbpm.isFreeFlow){return x}var w=[];w=a(z,w,true);var y=[];y=t(x,w);return y}function t(y,w){for(var z=0;z<y.length;z++){for(var x=0;x<w.length;x++){if(y[z]===w[x]){y.splice(z,1)}}}for(var z=0;z<w.length;z++){y.push(w[z])}return y}function a(A,x,C){var B=lbpm.globals.getPreviousNodeObjs(A.id);for(var z=0;z<B.length;z++){var y=B[z];if(lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_START,y)){break}else{if(lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_GROUPSTART,y)){y=lbpm.globals.getPreviousNodeObj(y.groupNodeId)}}if(C&&lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_JOIN,A)){var w=r(A);if(w!=null&&w.id!=y.id){continue}}if(p(x,y)){continue}x.push(y);a(y,x);if(v(y)){q(y,x)}}return x}function q(A,w){var z=lbpm.globals.getNextNodeObjs(A.id);for(var y=0;y<z.length;y++){var x=z[y];if(lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_END,x)){continue}else{if(lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_GROUPEND,x)){x=lbpm.globals.getNextNodeObj(x.groupNodeId)}}if(p(w,x)){continue}w.push(x);q(x,w)}return w}function p(w,x){for(var y=0;y<w.length;y++){if(x.id==w[y].id){return true}}return false}function v(x){var w=lbpm.nodedescs[x.nodeDescType];return w.isBranch(x)&&!w.isConcurrent(x)}function r(y){if(lbpm.nowProcessorInfoObj.parameter){var w=JSON.parse(lbpm.nowProcessorInfoObj.parameter);if(w.conBranchSourceId){var x=w.conBranchSourceId;if(x.indexOf("L")==0){if(lbpm.lines[x]){x=lbpm.lines[x].endNode.id}}if(lbpm.nodes[x]){return n(y,lbpm.nodes[x])}}}}function n(A,z,B){if(B==null){B=new Array()}if(!p(B,z)){B.push(z);for(var y=0;y<z.endLines.length;y++){var w=z.endLines[y];if(w.endNode==A){return w.startNode}else{var x=n(A,w.endNode,B);if(x!=null){return x}}}}}function u(z,w){var A=0;var y="";for(var x=0;x<z.length;x++){if(z.charCodeAt(x)>128){A+=2}else{A++}y+=z.charAt(x);if(A>=w){return y+"..."}}return y}function s(x){var y=0;for(var w=0;w<x.length;w++){if(x.charCodeAt(w)>128){y+=2}else{y++}}return y}})},"sys/lbpmservice/mobile/common/syslbpmprocess_submit":function(){define(function(){var submitFlow={};submitFlow.submitFormEvent=lbpm.globals.submitFormEvent=function(formObj,method,clearParameter,moreOptions){if(!lbpm.globals.validateBeforeSumbitVersion()){return false}var callBack1=arguments.callee.caller;if(lbpm.globals!=undefined&&lbpm.nowNodeId!=undefined&&lbpm.globals.getNodeObj(lbpm.nowNodeId).processType!=undefined&&lbpm.constant.PROCESSTYPE_SINGLE!=undefined){if(callBack1==Com_Submit&&lbpm.globals.getNodeObj(lbpm.nowNodeId).processType==lbpm.constant.PROCESSTYPE_SINGLE){var handlerType=lbpm.currentOperationType;if(lbpm.nowProcessorInfoObj){var operInfo=lbpm.nowProcessorInfoObj.operations;var operName=null;if(operInfo!=null){for(var i=0;i<operInfo.length;i++){if(operInfo[i].id=="handler_communicate"){operName=operInfo[i].name;break}}}if((handlerType=="handler_refuse"||handlerType=="handler_pass"||handlerType=="handler_additionSign"||handlerType=="handler_superRefuse"||handlerType=="handler_abandon")&&(window.commuflag==false||window.commuflag==null)){var proId=lbpm.modelId;var ajaxurl=Com_Parameter.ContextPath+"sys/lbpmservice/support/lbpmHistoryWorkitemAction.do?method=getCommunicateWorkitem&fdProcessId="+proId;var kmssData=new KMSSData();kmssData.SendToUrl(ajaxurl,function(http_request){var responseText=http_request.responseText;var json=eval("("+responseText+")");if(json.hasCommunicate==true){require({async:false},["mui/dialog/Confirm"],function(Confirm){var contentHtml="当前已有其他审批人"+json.personList+"正处于"+operName+"中，您是否还需要继续审批？";var title="提示信息";var callback=function(bool,dialog){if(bool){window.commuflag=true;Com_Submit(formObj,method,clearParameter,moreOptions)}else{return}};Confirm(contentHtml,title,callback)})}else{window.commuflag=true;Com_Submit(formObj,method,clearParameter,moreOptions)}},true);return false}}}}var docStatus=lbpm.constant.DOCSTATUS;if(parseInt(docStatus)>=lbpm.constant.STATE_COMPLETED){return true}var canStartProcess=document.getElementById("sysWfBusinessForm.canStartProcess");var operatorInfo=lbpm.globals.analysisProcessorInfoToObject();if(operatorInfo==null){canStartProcess.value="false";return true}if(typeof lbpm.saveFormData!="undefined"&&canStartProcess.value==="false"){lbpm.globals.setParameterOnSubmit();return true}var currentHandlerIds=document.getElementById("sysWfBusinessForm.fdHandlerRoleInfoIds").value;if(lbpm.constant.METHOD==lbpm.constant.METHODEDIT&&canStartProcess!=null){var currentIdArray=currentHandlerIds.split(";");var flag=false;for(var i=0;i<currentIdArray.length;i++){if(lbpm.handlerId.indexOf(currentIdArray[i])!=-1){flag=true;break}}if(!flag){canStartProcess.value="false";return true}}if(lbpm.isFreeFlow&&lbpm.globals.getNodeSize()<=3){if(moreOptions){if(!moreOptions.saveDraft){require(["mui/dialog/Tip"],function(tip){tip.warn({text:lbpm.constant.FREEFLOW_MUSTAPPENDNODE})});return false}}else{require(["mui/dialog/Tip"],function(tip){tip.warn({text:lbpm.constant.FREEFLOW_MUSTAPPENDNODE})});return false}}var optInfo=$("#operationMethodsGroup").val();if(optInfo==""){require(["mui/dialog/Tip"],function(tip){tip.warn({text:lbpm.constant.VALIDATEOPERATIONTYPEISNULL})});return false}if(optInfo){var oprArr=optInfo.split(":");lbpm.currentOperationType=oprArr[0];lbpm.currentOperationName=oprArr[1]}var fdUsageContent=lbpm.operations.getfdUsageContent();if(fdUsageContent!=null&&fdUsageContent.value!=""){var maxLength=4000;var contentVal=fdUsageContent.value||"";var newvalue=contentVal.replace(/[^\x00-\xff]/g,"***");if(newvalue.length>maxLength){var msg=lbpm.constant.ERROR_FDUSAGECONTENT_MAXLENGTH;var title=lbpm.constant.OPINION;msg=msg.replace(/\{name\}/,title).replace(/\{maxLength\}/,maxLength);require(["mui/dialog/Tip"],function(tip){tip.warn({text:msg,width:"260",height:"150"})});return false}}var isValidated=lbpm.globals.isUsageContenValidated(lbpm.currentOperationType);if(isValidated==true){var defalutUsage="";defalutUsage=lbpm.globals.getOperationDefaultUsageValidate(lbpm.currentOperationType);var deafultUsageName=defalutUsage.replace("{xx}","");var fdUsageContent=lbpm.operations.getfdUsageContent();if((fdUsageContent.value).indexOf("{xx}")>=0){require(["mui/dialog/Tip"],function(tip){tip.warn({text:Data_GetResourceString("sys-lbpmservice:lbpmUsageContent.fdDescription.details.7")})});return false}else{if(!(deafultUsageName==(fdUsageContent.value))){var defalutUsageRep=defalutUsage;if(defalutUsage.indexOf("{xx}")>=0){defalutUsageRep=defalutUsage.replace(/\{xx\}/g,"(\\S{0,})")}defalutUsageRep=new RegExp("^"+defalutUsageRep+"$");if(!(defalutUsageRep.test(fdUsageContent.value))){var prompt=Data_GetResourceString("sys-lbpmservice:lbpmUsageContent.fdDescription.details.7");prompt=prompt.replace("{0}",defalutUsage);require(["mui/dialog/Tip"],function(tip){tip.warn({text:prompt,width:"300",height:"200"})});return false}}}}var isExcludeValidated=lbpm.globals.isUsageContenExcludeValidated(lbpm.currentOperationType);if(isExcludeValidated==true){var excludeUsage="";excludeUsage=lbpm.globals.getOperationDefaultUsageValidate(lbpm.currentOperationType);var fdUsageContent=lbpm.operations.getfdUsageContent();if((fdUsageContent.value).indexOf(excludeUsage)!=-1){var prompt=Data_GetResourceString("sys-lbpmservice:lbpmUsageContent.fdDescription.details.9");prompt=prompt.replace("{0}",excludeUsage);require(["mui/dialog/Tip"],function(tip){tip.warn({text:prompt,width:"300",height:"200"})});return false}}if(lbpm.isFreeFlow&&Lbpm_SettingInfo.isPrivateOpinion=="true"){var isCanpass=true;require(["dijit/registry"],function(registry){var switchWgt=registry.byId("privateOpinion");if(switchWgt&&switchWgt.value=="on"){var myWgt=registry.byId("privateOpinionPerson");if(myWgt&&!myWgt.curIds){require(["mui/dialog/Tip"],function(tip){tip.warn({text:Data_GetResourceString("sys-lbpmservice:lbpmservice.auditnote.placeholder")})});isCanpass=false}}});if(!isCanpass){return false}}var oprClass=null;if(lbpm.currentOperationType){oprClass=lbpm.operations[lbpm.currentOperationType];if(oprClass!=null){if(!oprClass.check(formObj,method,clearParameter,moreOptions)){return false}}}if(lbpm&&lbpm.processorInfoObj&&((lbpm.nowProcessorInfoObj.type=="reviewWorkitem"&&lbpm.currentOperationType=="handler_pass")||(lbpm.nowProcessorInfoObj.type=="signWorkitem"&&lbpm.currentOperationType=="handler_sign"))&&lbpm.globals.handlerWrittenValidator){if(!lbpm.globals.handlerWrittenValidator()){return false}}if(callBack1==Com_Submit){if(!lbpm.constant.handlerIdentityIsSameDept&&!lbpm.isLbpmIdentityCheck&&!lbpm.globals.lbpmIdentityCheck(formObj,method,clearParameter,moreOptions)){return false}}lbpm.globals.setParameterOnSubmit();if(oprClass!=null&&oprClass.setOperationParam){oprClass.setOperationParam();lbpm.events.fireListener(lbpm.constant.EVENT_SETOPERATIONPARAM,null)}if($("input[name='futureNode']:checked").length>0){var eleObj=$("input[name='sysWfBusinessForm.fdParameterJson']");if(eleObj.length>0&&eleObj[0].value){var jsonObj=$.parseJSON(eleObj[0].value);if(!jsonObj.param||!jsonObj.param["futureNodeId"]){require(["mui/dialog/Tip"],function(tip){tip.warn({text:lbpm.constant.CHKNEXTNODENOTNULL})});return false}}}var isCheck=true;$("input[name^='dynamicNextNodeIds_']").each(function(){var $futureNode=$(this).closest(".muiRadioItem").find("input[name='futureNode']");if($futureNode.length==0||$futureNode.is(":checked")){if(!$(this).val()){var _name=$(this).attr("name");var __node=lbpm.nodes[_name.split("_")[1]];require(["mui/dialog/Tip","mui/i18n/_i18n!sys/mobile/js/mui/mui-common"],function(tip,Msg){tip.warn({text:Msg["mui.form.please.select"]+(__node.dynamicGroupShowName?__node.dynamicGroupShowName:__node.name)})});isCheck=false;return false}}});if(!isCheck){return false}return true};lbpm.globals.getSplitNodeInfo=function(nodeId){var nodeInfo;require(["mui/util","dojo/request"],function(util,request){var processId=lbpm.modelId;var url="/sys/lbpm/engine/jsonp.jsp?s_bean=lbpmProcessDefinitionDetailService&processId="+processId+"&nodeId="+nodeId;url=util.formatUrl(url);request.get(url,{handleAs:"json",sync:true}).then(function(data){nodeInfo=WorkFlow_LoadXMLData(data.data)})});return nodeInfo};submitFlow.setParameterOnSubmit=lbpm.globals.setParameterOnSubmit=function(){var operatorInfo=lbpm.nowProcessorInfoObj;var taskId=lbpm.globals.getOperationParameterJson("id");lbpm.globals.setOperationParameterJson(taskId==null?"":taskId,"taskId");lbpm.globals.setOperationParameterJson($("[name='sysWfBusinessForm.fdProcessId']")[0].value,"processId");lbpm.globals.setOperationParameterJson(operatorInfo.type,"activityType");if(lbpm.currentOperationType){lbpm.globals.setOperationParameterJson(lbpm.currentOperationType.toString(),"operationType")}if(lbpm.currentOperationName){lbpm.globals.setOperationParameterJson(lbpm.currentOperationName,"operationName","param")}var futureNodeCheckboxs=$("input[name='futureNode'][type='checkbox']");if(futureNodeCheckboxs.length>0){var futureNodes="";var futureNodesChekBoxGroup;require(["dojo/topic","dijit/registry"],function(topic,registry){futureNodesChekBoxGroup=registry.byId("sys_lbpmservice_mobile_workitem_FutureNodesChekBoxGroup");futureNodes=futureNodesChekBoxGroup.value.replace(/;/g,",")});lbpm.globals.setOperationParameterJson(futureNodes,"futureNodeId","param")}else{$("input[name='futureNode']:checked").each(function(i){lbpm.globals.setOperationParameterJson(this,null,"param")})}$("input[name='sysWfBusinessForm.fdSystemNotifyType']").each(function(i){lbpm.globals.setOperationParameterJson(this,"notifyType","param")});$("input[name='sysWfBusinessForm.fdNotifyLevel']:checked").each(function(i){lbpm.globals.setOperationParameterJson(this,"notifyLevel","param")});$("#notifyOnFinish").each(function(i){lbpm.globals.setOperationParameterJson(this,"notifyOnFinish","param")});if($("#opinionConfig").css("display")=="block"){var notifyIsScript="";var approveOpinionType="";require(["dojo/topic","dijit/registry"],function(topic,registry){notifyIsScript=registry.byId("notifyIsScript").value;approveOpinionType=registry.byId("approveOpinionType").value});lbpm.globals.setOperationParameterJson(notifyIsScript,"notifyIsScript","param");lbpm.globals.setOperationParameterJson(approveOpinionType,"approveOpinionType","param")}var auditNodeObj=lbpm.operations.getfdUsageContent();if(auditNodeObj){lbpm.globals.setOperationParameterJson(auditNodeObj,"auditNote","param")}var $privateOpinion=$("input[name='privateOpinionCanViewIds']");if($privateOpinion.val()){lbpm.globals.setOperationParameterJson($privateOpinion[0],"privateOpinionIds","param")}if(lbpm.globals.filterNoticeHandler){var noticeHandlerIds=lbpm.globals.filterNoticeHandler();var noticeHandlerIdsObj=$("input[name='noticeHandlerIds']")[0];if(noticeHandlerIds){lbpm.globals.setOperationParameterJson(noticeHandlerIdsObj,"noticeHandlerIds","param")}}$("input[name='sysWfBusinessForm.fdAuditNoteFdId']").each(function(i){lbpm.globals.setOperationParameterJson(this,"auditNoteFdId","param")});$("input[name='sysWfBusinessForm.fdAuditNoteFrom']").each(function(i){lbpm.globals.setOperationParameterJson(this,"auditNoteFrom","param")});$("input[name^='dynamicNextNodeIds_']").each(function(i){var $futureNode=$(this).closest(".muiRadioItem").find("input[name='futureNode']");if($futureNode.length==0||$futureNode.is(":checked")){if(this.value){lbpm.globals.setOperationParameterJson(this.value.replace(/;/g,","),"_futureNodeId","param")}}});$("input[name='nextAdHocRouteId']:checked").each(function(i){lbpm.nextAdHocRouteId=this.value;lbpm.globals.setAdHocSubNode()});if(lbpm.currentOperationType&&lbpm.operations[lbpm.currentOperationType]&&lbpm.operations[lbpm.currentOperationType].isPassType){lbpm.globals.setEmbeddedNodeInfo();lbpm.globals.setFreeflowNodeInfo();lbpm.globals.setDynamicNodeInfo()}lbpm.globals.setModifyParameterOnSubmit()};lbpm.globals.setEmbeddedNodeInfo=function(isInit){var getContentByRefId=function(fdRefId){var fdContent="";var ajaxurl=Com_Parameter.ContextPath+"sys/lbpmservice/support/lbpmEmbeddedSubFlow.do?method=getContentByRefId&fdRefId="+fdRefId;var kmssData=new KMSSData();kmssData.SendToUrl(ajaxurl,function(http_request){var responseText=http_request.responseText;var json=eval("("+responseText+")");if(json.fdContent){fdContent=json.fdContent}},false);return fdContent};var getGroupLineById=function(nodeId,flowInfo){for(var i=0;i<flowInfo.nodes.length;i++){if(flowInfo.nodes[i].groupNodeId==nodeId&&flowInfo.nodes[i].XMLNODENAME==("groupStartNode")){for(var j=0;i<flowInfo.lines.length;j++){if(flowInfo.lines[j]["startNodeId"]==flowInfo.nodes[i].id){return flowInfo.lines[j]}}}}return null};var needCopyData=["subFormId","subFormName","subFormMobileId","subFormMobileName","subFormPrintId","subFormPrintName","nodeCanViewCurNodeIds","nodeCanViewCurNodeNames","otherCanViewCurNodeIds","otherCanViewCurNodeNames","canModifyNotionPopedom","canModifyFlow"];var setSubNodeInfoByGroupNode=function(newNode,groupNode){for(var i=0;i<needCopyData.length;i++){if((!newNode[needCopyData[i]]||newNode[needCopyData[i]]=="false")&&groupNode[needCopyData[i]]!=undefined){newNode[needCopyData[i]]=groupNode[needCopyData[i]]}}};var nowFlow=WorkFlow_LoadXMLData(lbpm.globals.getProcessXmlString());var nowNodeIndex=parseInt(nowFlow.nodesIndex,10);var nowLineIndex=parseInt(nowFlow.linesIndex,10);var newNodeAndLineInfo={};var fdEmbeddedInfo=[];var formFieldList=lbpm.globals.getFormFieldList();for(var i=0;i<nowFlow.nodes.length;i++){if(nowFlow.nodes[i].XMLNODENAME=="embeddedSubFlowNode"&&nowFlow.nodes[i].embeddedRefId&&nowFlow.nodes[i].isInit!="true"){var fdContent=getContentByRefId(nowFlow.nodes[i].embeddedRefId);if(fdContent){if(nowFlow.nodes[i].extAttributes){for(var j=0;j<nowFlow.nodes[i].extAttributes.length;j++){if(nowFlow.nodes[i].extAttributes[j].name=="paramsConfig"&&nowFlow.nodes[i].extAttributes[j].value){var paramsConfig=JSON.parse(nowFlow.nodes[i].extAttributes[j].value);fdContent=fdContent.replace(/\$(\w+)\$/g,function($1,$2){for(var k=0;k<paramsConfig.length;k++){if(paramsConfig[k].fdParamValue==$2){var formValue=paramsConfig[k].fdFormValue;for(var l=0;l<formFieldList.length;l++){var info=formFieldList[l];if(formValue===info.name){if(!(info.name.indexOf("$")>-1)){formValue="$"+info.name+"$"}break}}return formValue.replace(/\"/g,"&quot;")}}return $1});break}}}var embeddedFlow=WorkFlow_LoadXMLData(fdContent);var nodeInfo={};var newNodes=[];for(var j=0;j<embeddedFlow.nodes.length;j++){var newNode=$.extend(true,{},embeddedFlow.nodes[j]);newNode.groupNodeId=nowFlow.nodes[i].id;newNode.groupNodeType="embeddedSubFlowNode";newNode.x=-newNode.x;newNode.y=-newNode.y;nodeInfo[embeddedFlow.nodes[j].id]=newNode.id="N"+(++nowNodeIndex);if(!newNode.extAttributes){newNode.extAttributes=[]}var extAttribute=[];extAttribute.XMLNODENAME="attribute";extAttribute.name="sourceSubId";extAttribute.value=embeddedFlow.nodes[j].id;newNode.extAttributes.push(extAttribute);setSubNodeInfoByGroupNode(newNode,nowFlow.nodes[i]);newNodes.push(newNode)}lbpm.globals.replaceModifyHandlerNodeIds(newNodes,nodeInfo,nowFlow);newNodeAndLineInfo[nowFlow.nodes[i].id]={};newNodeAndLineInfo[nowFlow.nodes[i].id]["newNodes"]=newNodes;var newLines=[];for(var j=0;j<embeddedFlow.lines.length;j++){var newLine=$.extend(true,{},embeddedFlow.lines[j]);newLine.startNodeId=nodeInfo[newLine.startNodeId];newLine.endNodeId=nodeInfo[newLine.endNodeId];newLine._points=newLine.points;delete newLine.points;newLine.id="L"+(++nowLineIndex);newLines.push(newLine)}newNodeAndLineInfo[nowFlow.nodes[i].id]["newLines"]=newLines;nowFlow.nodes[i].isInit="true";fdEmbeddedInfo.push({nodeId:nowFlow.nodes[i].id,fdRefId:nowFlow.nodes[i].embeddedRefId})}}}for(var nodeId in newNodeAndLineInfo){nowFlow.nodes=nowFlow.nodes.concat(newNodeAndLineInfo[nodeId]["newNodes"]);nowFlow.lines=nowFlow.lines.concat(newNodeAndLineInfo[nodeId]["newLines"]);var noStartId="";var noEndId="";for(var i=0;i<newNodeAndLineInfo[nodeId]["newNodes"].length;i++){var newNodeId=newNodeAndLineInfo[nodeId]["newNodes"][i].id;var isExitStart=false;var isExitEnd=false;for(var j=0;j<newNodeAndLineInfo[nodeId]["newLines"].length;j++){if(newNodeAndLineInfo[nodeId]["newLines"][j].startNodeId==newNodeId){isExitStart=true}if(newNodeAndLineInfo[nodeId]["newLines"][j].endNodeId==newNodeId){isExitEnd=true}}if(!isExitStart){noStartId=newNodeId}if(!isExitEnd){noEndId=newNodeId}}var line=getGroupLineById(nodeId,nowFlow);if(line!=null){var newLine=$.extend(true,{},line);newLine.startNodeId=noStartId;line.endNodeId=noEndId;newLine.id="L"+(++nowLineIndex);newLine._points=newLine.points;line._points=line.points;delete newLine.points;delete line.points;nowFlow.lines.push(newLine)}}if(fdEmbeddedInfo.length>0){var processXMLObj=document.getElementsByName("sysWfBusinessForm.fdFlowContent")[0];nowFlow.nodesIndex=nowNodeIndex+"";nowFlow.linesIndex=nowLineIndex+"";processXMLObj.value=WorkFlow_BuildXMLString(nowFlow);if(isInit){lbpm.globals.parseXMLObj()}if(!lbpm.modifys){lbpm.modifys={}}$("input[name='sysWfBusinessForm.fdIsModify']")[0].value="1";lbpm.lbpmEmbeddedInfo=fdEmbeddedInfo}};lbpm.globals.setFreeflowNodeInfo=function(){var nowFlow=WorkFlow_LoadXMLData(lbpm.globals.getProcessXmlString());if(!nowFlow||!nowFlow.nodes||!nowFlow.opinionSortIds){return}for(var i=0;i<nowFlow.nodes.length;i++){if(nowFlow.nodes[i].XMLNODENAME=="freeSubFlowNode"&&nowFlow.nodes[i].initSubNodeId){var nextObj=lbpm.globals.getNextNodeObj(lbpm.nowNodeId);var oIds=nowFlow.opinionSortIds.split(";");if(nextObj&&nextObj.id==nowFlow.nodes[i].id&&Com_ArrayGetIndex(oIds,nowFlow.nodes[i].id)>-1){if(Com_ArrayGetIndex(oIds,nowFlow.nodes[i].initSubNodeId)==-1){oIds.push(nowFlow.nodes[i].initSubNodeId);nowFlow.opinionSortIds=oIds.join(";");lbpm.nowFreeSubFlowNodeId=nowFlow.nodes[i].initSubNodeId;var processXMLObj=document.getElementsByName("sysWfBusinessForm.fdFlowContent")[0];processXMLObj.value=WorkFlow_BuildXMLString(nowFlow);if(!lbpm.modifys){lbpm.modifys={}}$("input[name='sysWfBusinessForm.fdIsModify']")[0].value="1"}}}}};lbpm.globals.setDynamicNodeInfo=function(isInit){if(!lbpm.constant.IS_HANDER||lbpm.constant.IS_HANDER=="false"){return}var nexNodeIds=[];if(lbpm.nowNodeId){var nextNodes=lbpm.globals.getNextNodeObjs(lbpm.nowNodeId);for(var i=0;i<nextNodes.length;i++){if(nextNodes[i].XMLNODENAME=="dynamicSubFlowNode"&&nextNodes[i].isInit!="true"){nexNodeIds.push(nextNodes[i].id)}else{if(nextNodes[i].XMLNODENAME=="manualBranchNode"){var _nextNodes=lbpm.globals.getNextNodeObjs(nextNodes[i].id);for(var j=0;j<_nextNodes.length;j++){if(_nextNodes[j].XMLNODENAME=="dynamicSubFlowNode"&&_nextNodes[j].isInit!="true"){nexNodeIds.push(_nextNodes[j].id)}}}}}}var getGroupsByFdId=function(fdId){var fields=new KMSSData().AddBeanData("lbpmDynamicSubFlowTreeServiceImp&type=groups&fdId="+fdId).GetHashMapArray();if(fields&&fields.length>0&&fields[0].groups){return fields[0].groups}return null};var needCopyData=["subFormId","subFormName","subFormMobileId","subFormMobileName","subFormPrintId","subFormPrintName","nodeCanViewCurNodeIds","nodeCanViewCurNodeNames","otherCanViewCurNodeIds","otherCanViewCurNodeNames","canModifyNotionPopedom","canModifyFlow"];var setSubNodeInfoByGroupNode=function(newNode,groupNode){for(var i=0;i<needCopyData.length;i++){if((!newNode[needCopyData[i]]||newNode[needCopyData[i]]=="false")&&groupNode[needCopyData[i]]!=undefined){newNode[needCopyData[i]]=groupNode[needCopyData[i]]}}};var getNodeById=function(nodes,nodeId){for(var i=0;i<nodes.length;i++){if(nodes[i].id==nodeId){return nodes[i]}}};var getSplitLineBySplitNodeId=function(nodeId,flowInfo){for(var j=0;j<flowInfo.lines.length;j++){if(flowInfo.lines[j]["startNodeId"]==nodeId){return flowInfo.lines[j]}}};var getGroupInfoById=function(extAttributes,id){var groupsConfig=[];if(extAttributes){for(var i=0;i<extAttributes.length;i++){if(extAttributes[i].name=="groupsConfig"&&extAttributes[i].value){groupsConfig=JSON.parse(extAttributes[i].value);break}}}for(var i=0;i<groupsConfig.length;i++){if(groupsConfig[i].fdId==id){return groupsConfig[i]}}return null};var nowFlow=WorkFlow_LoadXMLData(lbpm.globals.getProcessXmlString());if(!nowFlow||!nowFlow.nodes){return}var nowNodeIndex=parseInt(nowFlow.nodesIndex,10);var nowLineIndex=parseInt(nowFlow.linesIndex,10);var fdDynamicInfo=[];for(var i=0;i<nowFlow.nodes.length;i++){if(nowFlow.nodes[i].XMLNODENAME=="dynamicSubFlowNode"&&nowFlow.nodes[i].isInit!="true"){if(nowFlow.nodes[i].splitType=="custom"&&(isInit||Com_ArrayGetIndex(nexNodeIds,nowFlow.nodes[i].id)<0)){continue}var splitNode=getNodeById(nowFlow.nodes,nowFlow.nodes[i].splitNodeId);var copyAtt=["splitType","startBranchHandlerSelectType","startBranchHandlerId","startBranchHandlerName","defaultStartBranchNames","canSelectDefaultBranch"];for(var j=0;j<copyAtt.length;j++){var _key=copyAtt[j];if(nowFlow.nodes[i][_key]){splitNode[_key]=nowFlow.nodes[i][_key]}}var _defaultStartBranchIds=[];var __defaultStartBranchIds=[];if(nowFlow.nodes[i]["defaultStartBranchIds"]){_defaultStartBranchIds=nowFlow.nodes[i]["defaultStartBranchIds"].split(";")}var splitLine=getSplitLineBySplitNodeId(nowFlow.nodes[i].splitNodeId,nowFlow);var _splitLine=$.extend(true,{},splitLine);var _groups=getGroupsByFdId(nowFlow.nodes[i].dynamicGroupId);if(_groups){var ___groups=JSON.parse(_groups);var leftX=80;var maxY=0;for(var h=0;h<___groups.length;h++){var param=___groups[h];var fdContent=param.fdContent;if(fdContent){if(param.fdParamContent&&nowFlow.nodes[i].extAttributes){for(var k=0;k<nowFlow.nodes[i].extAttributes.length;k++){if(nowFlow.nodes[i].extAttributes[k].name=="paramsConfig"&&nowFlow.nodes[i].extAttributes[k].value){var paramsConfig=JSON.parse(nowFlow.nodes[i].extAttributes[k].value);var __params=param.fdParamContent;if(__params){var _params=JSON.parse(__params);fdContent=fdContent.replace(/\$(\w+)\$/g,function($1,$2){for(var l=0;l<_params.length;l++){if(_params[l].fdParamData==$2){if(_params[l].orgOrFormula=="org"){return"$"+_params[l].fdParamValue+"$"}else{if(_params[l].orgOrFormula=="formula"){var fdFactParamValue=_params[l].fdFactParamValue;return fdFactParamValue.replace(/\$(\w+)\$/g,function($11,$22){for(var ll=0;ll<paramsConfig.length;ll++){if(paramsConfig[ll].fdParamValue==$22){return"$"+paramsConfig[ll].fdFormValue+"$"}}return $11})}}}}return $1})}break}}}var embeddedFlow=WorkFlow_LoadXMLData(fdContent);var nodeInfo={};var newNodes=[];var minX=999999;var maxX=0;for(var k=0;k<embeddedFlow.nodes.length;k++){var newNode=$.extend(true,{},embeddedFlow.nodes[k]);newNode.groupNodeId=nowFlow.nodes[i].id;newNode.groupNodeType="dynamicSubFlowNode";if(minX>parseInt(newNode.x)){minX=parseInt(newNode.x)}if(maxX<parseInt(newNode.x)){maxX=parseInt(newNode.x)}if(maxY<parseInt(newNode.y)){maxY=parseInt(newNode.y)}nodeInfo[embeddedFlow.nodes[k].id]=newNode.id="N"+(++nowNodeIndex);if(!newNode.extAttributes){newNode.extAttributes=[]}var extAttribute=[];extAttribute.XMLNODENAME="attribute";extAttribute.name="sourceSubId";extAttribute.value=embeddedFlow.nodes[k].id;newNode.extAttributes.push(extAttribute);var extAttribute2=[];extAttribute2.XMLNODENAME="attribute";extAttribute2.name="nodeGroupId";extAttribute2.value=param.fdId;newNode.extAttributes.push(extAttribute2);newNode.fdGroupAlias=param.fdAlias;setSubNodeInfoByGroupNode(newNode,nowFlow.nodes[i]);newNodes.push(newNode)}lbpm.globals.replaceModifyHandlerNodeIds(newNodes,nodeInfo,nowFlow);var newLines=[];for(var k=0;k<embeddedFlow.lines.length;k++){var newLine=$.extend(true,{},embeddedFlow.lines[k]);newLine.startNodeId=nodeInfo[newLine.startNodeId];newLine.endNodeId=nodeInfo[newLine.endNodeId];if(newLine.points){var __points=newLine.points.split(";");for(var o=0;o<__points.length;o++){__points[o]=(parseInt(__points[o].split(",")[0])-(minX-leftX))+","+(parseInt(__points[o].split(",")[1])+80)}newLine._points=__points.join(";");delete newLine.points}newLine.id="L"+(++nowLineIndex);newLines.push(newLine)}for(var k=0;k<newNodes.length;k++){newNodes[k].x=parseInt(newNodes[k].x)-(minX-leftX);newNodes[k].x=-newNodes[k].x;newNodes[k].y=-newNodes[k].y-80}leftX+=(maxX-minX)+160;nowFlow.nodes=nowFlow.nodes.concat(newNodes);nowFlow.lines=nowFlow.lines.concat(newLines);var noStartId="";var noEndId="";for(var l=0;l<newNodes.length;l++){var newNodeId=newNodes[l].id;var isExitStart=false;var isExitEnd=false;for(var m=0;m<newLines.length;m++){if(newLines[m].startNodeId==newNodeId){isExitStart=true}if(newLines[m].endNodeId==newNodeId){isExitEnd=true}}if(!isExitStart){noStartId=newNodeId}if(!isExitEnd){noEndId=newNodeId}}if(Com_ArrayGetIndex(_defaultStartBranchIds,param.fdId)>-1){__defaultStartBranchIds.push(noEndId)}var newLine=$.extend(true,{},_splitLine);newLine.startNodeId=noStartId;newLine.id="L"+(++nowLineIndex);nowFlow.lines.push(newLine);if(h==0){splitLine.name=param.fdAlias;splitLine.endNodeId=noEndId;if(splitNode.splitType=="condition"){var _groupInfo=getGroupInfoById(nowFlow.nodes[i].extAttributes,param.fdId);if(_groupInfo){splitLine.condition=_groupInfo.lineCondition;splitLine.disCondition=_groupInfo.lineDisCondition}else{splitLine.condition="0";splitLine.disCondition="0"}splitLine.priority=h}}else{var _newLine=$.extend(true,{},_splitLine);_newLine.endNodeId=noEndId;_newLine.id="L"+(++nowLineIndex);_newLine.name=param.fdAlias;if(splitNode.splitType=="condition"){var _groupInfo=getGroupInfoById(nowFlow.nodes[i].extAttributes,param.fdId);if(_groupInfo){_newLine.condition=_groupInfo.lineCondition;_newLine.disCondition=_groupInfo.lineDisCondition}else{_newLine.condition="0";_newLine.disCondition="0"}splitLine.priority=h}nowFlow.lines.push(_newLine)}}}splitNode.x=-((leftX-80)/2);splitNode.y=-40;var joinNode=getNodeById(nowFlow.nodes,nowFlow.nodes[i].joinNodeId);joinNode.x=-((leftX-80)/2);joinNode.y=-(maxY+160);for(var h=0;h<nowFlow.lines.length;h++){var _newLine=nowFlow.lines[h];if(_newLine.startNodeId==nowFlow.nodes[i].splitNodeId){if(_newLine.points){var startNode=getNodeById(nowFlow.nodes,_newLine.startNodeId);var endNode=getNodeById(nowFlow.nodes,_newLine.endNodeId);var __points=_newLine.points.split(";");__points.splice(1,0,(-endNode.x)+","+(-startNode.y+20));_newLine._points=__points.join(";");delete _newLine.points}}else{if(nowFlow.lines[h].endNodeId==nowFlow.nodes[i].joinNodeId){if(_newLine.points){var startNode=getNodeById(nowFlow.nodes,_newLine.startNodeId);var endNode=getNodeById(nowFlow.nodes,_newLine.endNodeId);var __points=_newLine.points.split(";");__points.splice(1,0,(-startNode.x)+","+(-endNode.y-20));_newLine._points=__points.join(";");delete _newLine.points}}}}nowFlow.nodes[i].isInit="true";fdDynamicInfo.push({nodeId:nowFlow.nodes[i].id,fdId:nowFlow.nodes[i].dynamicGroupId})}if(__defaultStartBranchIds.length>0){splitNode.defaultStartBranchIds=__defaultStartBranchIds.join(";");nowFlow.nodes[i]["defaultStartBranchIds"]=__defaultStartBranchIds.join(";")}}}if(fdDynamicInfo.length>0){var processXMLObj=document.getElementsByName("sysWfBusinessForm.fdFlowContent")[0];nowFlow.nodesIndex=nowNodeIndex+"";nowFlow.linesIndex=nowLineIndex+"";processXMLObj.value=WorkFlow_BuildXMLString(nowFlow);if(!lbpm.modifys){lbpm.modifys={}}$("input[name='sysWfBusinessForm.fdIsModify']")[0].value="1";lbpm.lbpmDynamicInfo=fdDynamicInfo}};lbpm.globals.replaceModifyHandlerNodeIds=function(nodes,nodeMap,nowFlow){var attMap=["defaultStartBranchIds","relatedNodeIds","canModifyHandlerNodeIds","mustModifyHandlerNodeIds","canHandlerJumpNodeIds","nodeCanViewCurNodeIds","deRefuseNodeIds","refuseNodeIds"];for(var i=0;i<nodes.length;i++){var nodeObj=nodes[i];for(var h=0;h<attMap.length;h++){var attr=attMap[h];if(nodeObj[attr]){var oldIds=nodeObj[attr].split(";");for(var j=0;j<oldIds.length;j++){if(nodeMap[oldIds[j]]){oldIds[j]=nodeMap[oldIds[j]]}}nodeObj[attr]=oldIds.join(";")}}}if(nodes.length>0&&nodes[0].groupNodeId){var groupNodeId=nodes[0].groupNodeId;if(nowFlow.opinionSortIds){var oIds=nowFlow.opinionSortIds.split(";");for(var i=0;i<oIds.length;i++){if(oIds[i]&&oIds[i].indexOf("-")>-1){for(var key in nodeMap){if(oIds[i]==groupNodeId+"-"+key){oIds[i]=nodeMap[key];break}}}}nowFlow.opinionSortIds=oIds.join(";")}var nAttMap=["canModifyHandlerNodeIds","mustModifyHandlerNodeIds","distributeNoteNodeIds"];for(var i=0;i<nowFlow.nodes.length;i++){var nodeObj=nowFlow.nodes[i];for(var h=0;h<nAttMap.length;h++){var attr=nAttMap[h];if(nodeObj[attr]){var oldIds=nodeObj[attr].split(";");for(var j=0;j<oldIds.length;j++){if(oldIds[j]&&oldIds[j].indexOf("-")>-1){for(var key in nodeMap){if(oldIds[j]==groupNodeId+"-"+key){oldIds[j]=nodeMap[key];break}}}}nodeObj[attr]=oldIds.join(";")}}}}};lbpm.globals.setAdHocSubNode=function(){if($("input[name='nextAdHocRouteId']").length==1){return}var adHocSubFlowNode=lbpm.nodes[lbpm.nowAdHocSubFlowNodeId];var firstSubNode=lbpm.nodes[adHocSubFlowNode.startNodeId].endLines[0].endNode;var nowFlow=WorkFlow_LoadXMLData(lbpm.globals.getProcessXmlString());var nextNodeObj=lbpm.globals.getNextNodeObj(lbpm.nowNodeId);if(nextNodeObj.id==lbpm.nowAdHocSubFlowNodeId){var getGroupSubStartLine=function(groupStartNodeId,flowInfo){for(var i=0;i<flowInfo.lines.length;i++){if(flowInfo.lines[i]["startNodeId"]==groupStartNodeId){return flowInfo.lines[i]}}return null};var deleteSubNodes=function(subNode,flowInfo){if(subNode.endLines.length>0){var targetNodeIndex=-1;for(var i=0;i<flowInfo.nodes.length;i++){if(flowInfo.nodes[i].id==subNode.id){var targetLineIndex=-1;for(var j=0;j<flowInfo.lines.length;j++){if(flowInfo.lines[j]["startNodeId"]==subNode.id){targetLineIndex=j;break}}if(targetLineIndex!=-1){flowInfo.lines.splice(targetLineIndex,1);targetNodeIndex=i;break}}}if(targetNodeIndex!=-1){flowInfo.nodes.splice(targetNodeIndex,1)}deleteSubNodes(subNode.endLines[0].endNode,flowInfo)}};deleteSubNodes(firstSubNode,nowFlow);var subStartLine=getGroupSubStartLine(adHocSubFlowNode.startNodeId,nowFlow);subStartLine.endNodeId=adHocSubFlowNode.endNodeId;delete subStartLine.points}var nowNodeIndex=parseInt(nowFlow.nodesIndex,10);var nowLineIndex=parseInt(nowFlow.linesIndex,10);var nodeMap={};for(var i=0;i<lbpm.adHocRoutes.length;i++){if(lbpm.adHocRoutes[i].startNodeId==lbpm.nextAdHocRouteId){var adHocRoute=lbpm.adHocRoutes[i];var newNodes=[];for(var j=0;j<adHocRoute.subNodes.length;j++){var subNodeObj=adHocRoute.subNodes[j].data;var subNode=$.extend(true,{},subNodeObj);subNode.routeId=lbpm.nextAdHocRouteId;subNode.sourceNodeId=subNodeObj.id;nodeMap[subNodeObj.id]=subNode.id="N"+(++nowNodeIndex);subNode.x=-subNodeObj.x;subNode.y=-subNodeObj.y;subNode.groupNodeId=lbpm.nowAdHocSubFlowNodeId;subNode.groupNodeType="adHocSubFlowNode";if(!subNode.extAttributes){subNode.extAttributes=[]}var extAttribute=[];extAttribute.XMLNODENAME="attribute";extAttribute.name="sourceSubId";extAttribute.value=subNodeObj.id;subNode.extAttributes.push(extAttribute);newNodes.push(subNode)}lbpm.globals.replaceModifyHandlerNodeIds(newNodes,nodeMap,nowFlow);var newLines=[];for(var j=0;j<adHocRoute.subLines.length;j++){var subLineObj=adHocRoute.subLines[j].data;var subLine=$.extend(true,{},subLineObj);subLine.startNodeId=nodeMap[subLine.startNodeId];subLine.endNodeId=nodeMap[subLine.endNodeId];delete subLine.points;subLine.id="L"+(++nowLineIndex);newLines.push(subLine)}nowFlow.nodes=nowFlow.nodes.concat(newNodes);nowFlow.lines=nowFlow.lines.concat(newLines);var getGroupSubEndLine=function(groupEndNodeId,flowInfo){for(var j=0;j<flowInfo.lines.length;j++){if(flowInfo.lines[j]["endNodeId"]==groupEndNodeId){return flowInfo.lines[j]}}return null};var line=getGroupSubEndLine(adHocSubFlowNode.endNodeId,nowFlow);var newLine=$.extend(true,{},line);newLine.startNodeId=newNodes[newNodes.length-1].id;line.endNodeId=newNodes[0].id;newLine.id="L"+(++nowLineIndex);delete newLine.points;delete line.points;nowFlow.lines.push(newLine);nowFlow.nodesIndex=nowNodeIndex+"";nowFlow.linesIndex=nowLineIndex+""}}var processXMLObj=document.getElementsByName("sysWfBusinessForm.fdFlowContent")[0];processXMLObj.value=WorkFlow_BuildXMLString(nowFlow);if(!lbpm.modifys){lbpm.modifys={}}$("input[name='sysWfBusinessForm.fdIsModify']")[0].value="1"};submitFlow.getProcessXmlString=lbpm.globals.getProcessXmlString=function(){var processXml=document.getElementsByName("sysWfBusinessForm.fdFlowContent")[0].value;var data=new KMSSData();var fdIsModify=$("input[name='sysWfBusinessForm.fdIsModify']")[0];if(fdIsModify==null||fdIsModify.value!="1"){data.AddBeanData("lbpmProcessDefinitionDetailService&processId="+lbpm.globals.getWfBusinessFormModelId());var result=data.GetHashMapArray();if(result&&result.length>0){if(result[0]["key0"]){processXml=result[0]["key0"]}}}var xmlObj=XML_CreateByContent(processXml);var xmlNodes=XML_GetNodesByPath(xmlObj,"/*/nodes/*");if(xmlNodes&&lbpm.modifys){$.each(lbpm.modifys,function(index,nodeData){for(var i=0,l=xmlNodes.length;i<l;i++){if(xmlNodes[i].getAttribute("id")==nodeData.id){for(nodeField in nodeData){xmlNodes[i].setAttribute(nodeField,nodeData[nodeField])}}}})}return(xmlObj.xml||new XMLSerializer().serializeToString(xmlObj))};submitFlow.setModifyParameterOnSubmit=lbpm.globals.setModifyParameterOnSubmit=function(){if(lbpm.modifys){var fdFlowContent=$("[name='sysWfBusinessForm.fdFlowContent']")[0];var fdIsModify=$("input[name='sysWfBusinessForm.fdIsModify']")[0];var jsonArr=new Array();if(fdIsModify.value!="1"){var nodesModifyXML="";$.each(lbpm.modifys,function(index,nodeData){nodesModifyXML+=WorkFlow_BuildXMLString(nodeData,lbpm.nodes[index].XMLNODENAME,true)});if(nodesModifyXML!=""){nodesModifyXML="<process><nodes>"+nodesModifyXML+"</nodes></process>";var jsonObj={};jsonObj.xml=nodesModifyXML;if(lbpm.globals.toRefuseThisNodeHandlerChange){jsonObj.toRefuseThisNodeHandlerChange=lbpm.globals.toRefuseThisNodeHandlerChange}var paramObj={};paramObj.param=jsonObj;paramObj.type="additions_modifyNodeAttribute";jsonArr.push(paramObj)}}else{fdFlowContent.value=lbpm.globals.getProcessXmlString();var jsonObj={};jsonObj.type="additions_modifyProcess";if(lbpm.nowFreeSubFlowNodeId!=null||lbpm.nowAdHocSubFlowNodeId!=null||lbpm.lbpmEmbeddedInfo||lbpm.lbpmDynamicInfo){jsonObj.type="additions_modifySubFlowNode";if(lbpm.lbpmEmbeddedInfo){jsonObj.lbpmEmbeddedInfo=lbpm.lbpmEmbeddedInfo}if(lbpm.lbpmDynamicInfo){jsonObj.lbpmDynamicInfo=lbpm.lbpmDynamicInfo}}jsonObj.field="fdFlowContent";jsonArr.push(jsonObj)}if(jsonArr.length>0){var additionParamObj=$("input[name='sysWfBusinessForm.fdAdditionsParameterJson']")[0];additionParamObj.value=lbpm.globals.objectToJSONString(jsonArr)}}};require(["dijit/registry","dojo/topic","dojo/dom-construct","dojo/dom-style","mui/dialog/Dialog","mui/util","dojo/_base/array","mui/i18n/_i18n!sys/mobile/js/mui/mui-common"],function(registry,topic,domConstruct,domStyle,Dialog,util,array,msg){window.createRolesListItem=function(props){var itemRenderer='<input type="checkbox" data-dojo-type="mui/form/CheckBox" name="_select_box_roles" value="!{value}" data-dojo-props="tag:\'li\',mul:false,text:\'!{text}\',checked:!{checked},pop:true">';itemRenderer=itemRenderer.replace("!{text}",util.formatText(props.text.replace("'","&#039;"))).replace("!{checked}",props.selected).replace("!{value}",props.value);var item=domConstruct.toDom(itemRenderer);return item};lbpm.globals.lbpmIdentityCheck=function(formObj,method,clearParameter,moreOptions){if(moreOptions&&moreOptions.saveDraft){return true}var handlerIdentityRow=document.getElementById("handlerIdentityRow");if(lbpm.nowNodeId=="N2"&&Lbpm_SettingInfo.isShowDraftsmanStatus=="true"&&Lbpm_SettingInfo.isPopupWindowRemindSubmitter=="true"&&handlerIdentityRow.style.display!="none"){var rolesSelectObj=registry.byId("rolesSelectObj");if(rolesSelectObj==null){return}var handlerIdentityIdsObj=document.getElementById("sysWfBusinessForm.fdHandlerRoleInfoIds");var handlerIdentityNamesObj=document.getElementById("sysWfBusinessForm.fdHandlerRoleInfoNames");var handlerIdentityIds=handlerIdentityIdsObj.value;var rolesIdsArray=handlerIdentityIds.split(";");var handlerIdentityNames=handlerIdentityNamesObj.value;var handlerRoleInfoNames=lbpm.globals.getHandlerRoleInfoNamesByOrgConfig(handlerIdentityIds);if(handlerRoleInfoNames){handlerIdentityNames=handlerRoleInfoNames}var rolesNamesArray=handlerIdentityNames.split(";");if(rolesIdsArray.length<=1){return true}var dialogNode=domConstruct.create("div",{className:"muiCheckBoxPopWarp"});var listNode=domConstruct.create("ul",{className:"muiRadioGroupPopList"},dialogNode);var data=[];var rolesValue=rolesSelectObj.get("value");for(var i=0;i<rolesIdsArray.length;i++){var obj={value:rolesIdsArray[i],text:rolesNamesArray[i],selected:false};if(rolesValue==rolesIdsArray[i]){obj.selected=true}data.push(obj)}for(var i=0;i<data.length;i++){var listItem=createRolesListItem(data[i]);listNode.appendChild(listItem)}var buttons=[{title:msg["mui.button.cancel"],fn:function(dialog){dialog.hide()}},{title:msg["mui.button.ok"],fn:function(dialog){array.forEach(dialog.htmlWdgts,function(wdt){if(wdt&&wdt.name=="_select_box_roles"&&wdt.checked){rolesSelectObj.set("value",wdt.value);return false}});lbpm.isLbpmIdentityCheck=true;dialog.hide();Com_Submit(formObj,method,clearParameter,moreOptions)}}];var rolesDialog=Dialog.element({canClose:false,showClass:"muiDialogElementShow muiFormSelect",element:dialogNode,buttons:buttons,position:"bottom",scrollable:false,parseable:true});var title=domConstruct.toDom("<div class='muiDialogElementButton_bottom' style='width:50%;float:left;'><bean:message bundle='sys-lbpmservice' key='lbpmProcess.processor.identity.validate.title' /></div>");domConstruct.place(title,rolesDialog.buttonsDom[0],"after");domStyle.set(title,"font-size","1.7rem");domStyle.set(rolesDialog.buttonsDom[0],"width","15%");domStyle.set(rolesDialog.buttonsDom[1],"width","15%");domStyle.set(title,"width","70%");return false}return true}});window.validateBeforeSumbitVersion=lbpm.globals.validateBeforeSumbitVersion=function(){if(!lbpm||!lbpm.nowNodeId){return true}var opers=["handler_pass","handler_giveup","drafter_submit","handler_sign"];if(lbpm.currentOperationType&&opers.indexOf(lbpm.currentOperationType)==-1){return true}var currentNodeObj=lbpm.nodes[lbpm.nowNodeId];var nextNodeObj=lbpm.globals.getNextNodeObj(lbpm.nowNodeId);if(!currentNodeObj||!nextNodeObj||(lbpm.nowProcessorInfoObj.type!="reviewWorkitem"&&lbpm.nowProcessorInfoObj.type!="signWorkitem")||nextNodeObj.nodeDescType!="manualBranchNodeDesc"||currentNodeObj.processType!="2"||!lbpm.globals.isLastHandler()){return true}lbpm.noValidateFutureNode=false;var operationsTDContent=document.getElementById("operationsTDContent");var html=lbpm.globals.generateNextNodeInfo();lbpm.globals.innerHTMLGenerateNextNodeInfo(html,operationsTDContent);return lbpm.globals.common_operationCheckForPassType()};Com_Parameter.event.submit[Com_Parameter.event.submit.length]=lbpm.globals.submitFormEvent;require(["dojo/request","dojo/query"],function(request,query){Com_Parameter.event.submit.push(function(formObj,method,clearParameter,moreOptions){var docStatus=document.getElementsByName("docStatus")[0].value;if(!(docStatus=="10"||docStatus=="11")){return true}var fdModelId=document.getElementsByName("sysWfBusinessForm.fdModelId")[0].value;var fdModelName=document.getElementsByName("sysWfBusinessForm.fdModelName")[0].value;var fdKey=document.getElementsByName("sysWfBusinessForm.fdKey")[0].value;if(moreOptions&&!moreOptions.saveDraft){var url=Com_Parameter.ContextPath+"sys/lbpm/engine/jsonp.jsp";var pjson={s_bean:"lbpmTempStorageDataBean",fdModelId:fdModelId,fdModelName:fdModelName,fdKey:fdKey,op:"delete",_d:new Date().toString()};request.post(url,{data:pjson,handleAs:"json"}).then(function(data){},function(error){});return true}else{document.getElementById("sysWfBusinessForm.canStartProcess").value="false"}var tdata={};var futureNodeCheckboxs=query("input[name='futureNode'][type='checkbox']");if(futureNodeCheckboxs.length>0){tdata.futureNode="";query("input[name='futureNode']:checked").forEach(function(domObj){tdata.futureNode+=tdata.futureNode==""?domObj.value:","+domObj.value})}else{query("input[name='futureNode']:checked").forEach(function(domObj){tdata.futureNode=domObj.value})}query("input[name='sysWfBusinessForm.fdNotifyLevel']:checked").forEach(function(domObj){tdata.fdNotifyLevel=domObj.value});var usageContent=document.getElementsByName("fdUsageContent")[0];if(usageContent){var fdUsageContent=usageContent.value;tdata.fdUsageContent=fdUsageContent}var data=lbpm.globals.objectToJSONString(tdata);var url=Com_Parameter.ContextPath+"sys/lbpm/engine/jsonp.jsp";var pjson={s_bean:"lbpmTempStorageDataBean",fdModelId:fdModelId,fdModelName:fdModelName,fdKey:fdKey,op:"add",fdData:data,_d:new Date().toString()};request.post(url,{data:pjson,handleAs:"json"}).then(function(data){},function(error){});return true})});return submitFlow});require(["dojo/ready","dojo/request","dojo/query","dojo/topic","dijit/registry"],function(ready,request,query,topic,registry){topic.subscribe("initComplete",function(){if(lbpm.constant.ISINIT){lbpm.globals.setEmbeddedNodeInfo(true);lbpm.globals.setFreeflowNodeInfo();lbpm.globals.setDynamicNodeInfo(true)}var docStatus=document.getElementsByName("docStatus")[0].value;if(!(docStatus=="10"||docStatus=="11")){return}var fdModelId=document.getElementsByName("sysWfBusinessForm.fdModelId")[0].value;var fdModelName=document.getElementsByName("sysWfBusinessForm.fdModelName")[0].value;var fdKey=document.getElementsByName("sysWfBusinessForm.fdKey")[0].value;var url=Com_Parameter.ContextPath+"sys/lbpm/engine/jsonp.jsp";var pjson={s_bean:"lbpmTempStorageDataBean",fdModelId:fdModelId,fdModelName:fdModelName,fdKey:fdKey,op:"get",_d:new Date().toString()};request.post(url,{data:pjson,handleAs:"json"}).then(function(json){if(json.errcode=="0"){var fdUsageContent=document.getElementsByName("fdUsageContent");if(fdUsageContent[0]!=null){fdUsageContent[0].value=json.fdUsageContent||""}}},function(error){})})})},"sys/lbpmservice/mobile/node/draftnode/workitem_draftworkitem":function(){define(["dijit/registry","dojo/store/Memory","dojo/_base/array","dojo/query","dojo/topic","dojo/dom","sys/lbpmservice/mobile/common/syslbpmprocess"],function(b,g,h,d,c,f){var a={};a.showHandlerIdentityRow=lbpm.globals.showHandlerIdentityRow=function(){var u=f.byId("handlerIdentityRow");var j=f.byId("sysWfBusinessForm.fdHandlerRoleInfoIds");var l=f.byId("sysWfBusinessForm.fdHandlerRoleInfoNames");var y=f.byId("sysWfBusinessForm.fdDefaultIdentity").value;var t=f.byId("sysWfBusinessForm.fdIdentityId").value;var w=j.value;var q=w.split(";");var x=l.value;var r=lbpm.globals.getHandlerRoleInfoNamesByOrgConfig(w);if(r){x=r}var s=x.split(";");if(q.length<=1&&u!=null){lbpm.globals.hiddenObject(u,true)}else{lbpm.globals.hiddenObject(u,false)}var v=b.byId("rolesSelectObj");if(v==null){return}lbpm.constant.handlerIdentityIsSameDept=(function(C){var i=false;if(C&&C.length==2){var z=Com_Parameter.ContextPath+"sys/lbpmservice/support/lbpm_process/lbpmProcess.do?method=getHandlerRoleInfoIsSameParent&ajax=true";var B={handlerRoleInfoIds:C};var i;var A=new KMSSData();A.AddHashMap(B);A.SendToUrl(z,function(D){if(D.responseText.indexOf("<error>")==-1){i=D.responseText=="true"}},false)}return i})(q);var p=[];var k=false;var n=false;for(var m=0;m<q.length;m++){p.push({value:q[m],text:s[m]});if(t==q[m]){k=true}if(y==q[m]){n=true}}v.setStore(new g({data:p}));if(n&&lbpm.constant.ISINIT){v.set("value",y)}else{if(k){v.set("value",t)}else{v.set("value",q[0])}}if(u!=null&&Lbpm_SettingInfo.isShowDraftsmanStatus=="false"){lbpm.globals.hiddenObject(u,true)}c.subscribe("/mui/form/valueChanged",function(i){if(i==v){lbpm.events.mainFrameSynch()}})};a.showManualBranchNodeRow=lbpm.globals.showManualBranchNodeRow=function(){var i="";lbpm.globals.getOperationParameterJson("draftDecidedFactIds:toRefuseThisNodeId",null,null,function(p){var l=[];if(p.draftDecidedFactIds!=null&&p.draftDecidedFactIds!=""){l=$.parseJSON(p.draftDecidedFactIds)}var q=p.toRefuseThisNodeId!=null&&p.toRefuseThisNodeId!="";var j=l.length>0;$.each(lbpm.nodes,function(s,t){if(lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_MANUALBRANCH,t)&&t.decidedBranchOnDraft=="true"){var r=true;$.each(l,function(v,u){if(u.NodeName==t.id){r=false;return false}});if(j&&r){return}i+=lbpm.globals.getNodeBranchesInfo(t,l)}});if(i==""){lbpm.globals.hiddenObject(f.byId("manualBranchNodeRow"),true)}else{var n=f.byId("manualNodeSelectTD");if(n!=null){d(n).forEach(function(r){h.forEach(b.findWidgets(r),function(s){s.destroy&&!s._destroyed&&s.destroy()})}).html(i,{parseContent:true});var k=d("#nextNodeTD");if(k.length>0){var m=lbpm.globals.getNextNodeObj(lbpm.nowNodeId);if(m&&m.decidedBranchOnDraft=="true"){if(lbpm.globals.destroyOperations){lbpm.globals.destroyOperations()}else{k.html()}}}}setTimeout(function(){lbpm.globals.hiddenObject(f.byId("manualBranchNodeRow"),q)},100);if(j){setTimeout(function(){lbpm.globals.setNextBranchNodes($("input[key='manualFutureNodeId']:checked").first())},350)}}})};a.getNodeBranchesInfo=lbpm.globals.getNodeBranchesInfo=function(k,p){p=p||lbpm.globals.getSelectedManualNode();var j="";$.each(p,function(i,q){if(q.NodeName==k.id){j=q.NextRoute}});if(j==""&&k.defaultBranch){for(var m=0;m<k.endLines.length;m++){if(k.endLines[m].id==k.defaultBranch){j=k.endLines[m].endNodeId}}}var l="<div class='draftworkitemBrancheGroup' data-dojo-type='sys/lbpmservice/mobile/node/draftnode/RadioGroup' data-dojo-props='checkedId:\""+j+'",nodeId:"'+k.id+'",validate:"manualFutureNodeIdSelect required",required:true\'></div>';if(l!=""){var n=WorkFlow_getLangLabel(k.name,k.langs,"nodeName");l="<div class='draftworikitem_branche_row'><div class='draftworkitemBranche'>"+k.id+"."+n+"：</div>"+l+"</div>"}return l};lbpm.isClosedLoop=lbpm.globals.isClosedLoop=function(j,r){var q=false;var p=new Array();p.push(r.endNode);var n=new Array();outer:while(p.length>0){for(var l=0,k=p.length;l<k;l++){var m=p[l];n.push(m);if(m.id==j.id){q=true;break outer}}p=lbpm.globals.getNextNodesByManual(p);p=lbpm.globals.filterSearchedNodes(p,n)}return q};a.setNextBranchNodes=lbpm.globals.setNextBranchNodes=function(j){var k="";var i=lbpm.globals.getManualNodeArray();$.each(i,function(n,m){k+=lbpm.globals.getNodeBranchesInfo(m)});var l=f.byId("manualNodeSelectTD");d(l).forEach(function(m){h.forEach(b.findWidgets(m),function(n){n.destroy&&!n._destroyed&&n.destroy()})}).html(k,{parseContent:true});lbpm.events.fireListener(lbpm.constant.EVENT_SELECTEDMANUAL,j)};a.getManualNodeArray=lbpm.globals.getManualNodeArray=function(){var i=new Array();var k=new Array();k.push(lbpm.nodes.N1);var j=new Array();while(k.length>0){$.each(k,function(l,m){j.push(m);if(lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_MANUALBRANCH,m)&&m.decidedBranchOnDraft=="true"){i.push(m)}});k=lbpm.globals.getNextNodesByManual(k);k=lbpm.globals.filterSearchedNodes(k,j)}return i};a.filterSearchedNodes=lbpm.globals.filterSearchedNodes=function(k,j){var i=new Array();$.each(k,function(l,n){var m=false;$.each(j,function(p,q){if(n.id==q.id){m=true;return false}});if(!m){i.push(n)}});return i};a.getNextNodesByManual=lbpm.globals.getNextNodesByManual=function(i){var j=lbpm.globals.getSelectedManualNode();var k=new Array();$.each(i,function(l,m){if(lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_MANUALBRANCH,m)&&m.decidedBranchOnDraft=="true"){var n="";$.each(j,function(p,q){if(q.NodeName==m.id){n=q.NextRoute;return false}});$.each(m.endLines,function(q,p){if(n!=""){if(p.endNode.id==n){lbpm.globals.pushNode(k,p.endNode);return false}}else{lbpm.globals.pushNode(k,p.endNode)}})}else{$.each(m.endLines,function(q,p){lbpm.globals.pushNode(k,p.endNode)})}});return k};a.pushNode=lbpm.globals.pushNode=function(k,j){var i=true;$.each(k,function(l,m){if(m.id==j.id){i=false;return false}});if(i){k.push(j)}};a.getSelectedManualNode=lbpm.globals.getSelectedManualNode=function(){var i=new Array();$("input[key='manualFutureNodeId']:checked").each(function(k,j){var l={};j=$(j);l.NodeName=j.attr("manualBranchNodeId");l.NextRoute=j.val();i.push(l)});return i};a.isSelectAllManualNode=lbpm.globals.isSelectAllManualNode=function(){var i=true;$.each($("input[key='manualFutureNodeId']"),function(l,k){i=false;var j=$("input[manualBranchNodeId='"+$(k).attr("manualBranchNodeId")+"']");$.each(j,function(n,m){if(m.checked){i=true;return false}});if(!i){return false}});return i};a.init=function(){lbpm.globals.getOperationParameterJson("futureNodeId:draftDecidedFactIds:dayOfNotifyDrafter:hourOfNotifyDrafter:minuteOfNotifyDrafter",null,null,function(){});lbpm.globals.showHandlerIdentityRow();lbpm.globals.showManualBranchNodeRow();var n=$("#dayOfNotifyDrafter")[0];if(n!=null){var i=lbpm.globals.getOperationParameterJson("dayOfNotifyDrafter");n.value=!i||i==""?"0":i}var l=$("#hourOfNotifyDrafter")[0];if(l!=null){var k=lbpm.globals.getOperationParameterJson("hourOfNotifyDrafter");l.value=!k||k==""?"0":k}var m=$("#minuteOfNotifyDrafter")[0];if(n!=null){var j=lbpm.globals.getOperationParameterJson("minuteOfNotifyDrafter");m.value=!j||j==""?"0":j}};return a})},"sys/lbpmservice/mobile/change_process/GroupButtonMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/query","dojo/_base/array","dojo/dom-class","dojo/dom-construct","dojo/dom-style","mui/form/Address"],function(c,g,f,i,d,a,b,h){return c("sys.lbpmservice.mobile.GroupButtonMixin",null,{postCreate:function(){this.text=this.text||"地址簿";this.inherited(arguments)},startup:function(){this.inherited(arguments);this.disconnect(this.domNodeOnClickEvent);this.subscribe("/mui/form/valueChanged","_addressValueChange")},_addressValueChange:function(k,j){if(k&&k===this&&k instanceof h&&!k._overTime&&(k.handlerIds!=null||k.optHandlerIds!=null)){if(k.getParent&&k.getParent()!=null&&k.getParent().childrenMap!=null){var m=k.getParent().childrenMap;for(var l in m){if(l!==k.id){m[l].curIds=k.curIds;m[l].curNames=k.curNames}}}}}})})},"sys/lbpmservice/mobile/operation/drafter/operation_drafter_press":function(){define(["dojo/query","dojo/NodeList-manipulate"],function(a){var b={};b.drafter_press={click:function(){},check:function(){return true},setOperationParam:function(c){c.notifyLevel=a("#OperationView input[name='ext_notifyLevel']").val();c.auditNote=a("#OperationView textarea[name='ext_usageContent']").val()}};b.init=function(){};return b})},"sys/lbpmservice/mobile/operation/other/AssignOprView":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-class","dojox/mobile/ViewController","dojox/mobile/viewRegistry","dojo/query","dojo/request","dojo/topic","dijit/registry","mui/util","mui/dialog/Dialog","mui/dialog/Tip","mui/device/device","mui/device/adapter","dojox/mobile/ScrollableView","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","dojo/NodeList-dom"],function(s,h,u,j,t,q,d,c,n,i,b,f,r,p,l,m,g,k){var a=s("sys.lbpmservice.mobile.operation.other.AssignOprView",[m],{processId:"",operationType:0,buildRendering:function(){this.inherited(arguments);window.showFlowChartView=this.showFlowChartView},showFlowChartView:function(v){location=b.formatUrl("/sys/lbpmservice/mobile/lbpm_audit_note/flowchart.jsp?processId="+v)},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments)},initExtOpertion:function(v){this.initOtherInfo();this.resetViewInfo();var w="";if(v.operationType==0){w=k["mui.lbpmAssign.operation.replyAssign"];d("#AssignOprView #assignOprArea").style({display:"none"})}else{w=k["mui.lbpmAssign.operation.assign"];d("#AssignOprView #assignOprArea").style({display:""})}d("#OperationMethodTable .detailNode").html(w)},resetViewInfo:function(){d("#AssignOprView .actionArea").style({display:""})},initOtherInfo:function(v){if(!this.initEvent){this.initSubmitButton(v);this.initCommonUsage(v);this.initEvent=true}},initSubmitButton:function(x){var w=this;var v=i.byId("OperationSubmit");u.mixin(v,{_onClick:function(){var z={};z.fdAssignItemId=lbpm.nowAssignItem.id;z.fdAssignOpinion=d("#AssignOprView textarea[name='ext_usageContent']").val();if(w.operationType==1){z.toAssigneeIds=d("#assigneeIds").val();var A=i.byId("canMultiAssign");if(A){z.fdIsCanAssign=A.get("checked")}}z.fdAuditNoteFrom=p.getClientType();var y=window.Com_BeforeSubmitDeferred();y.then(u.hitch(this,function(){c.post(b.formatUrl("/sys/lbpmservice/support/lbpm_assign/lbpmAssign.do?method=doAssign4Mobile"),{data:z,headers:{Accept:"application/json"},handleAs:"json"}).then(function(B){if(B.sucess){r.success({text:lbpm.constant.OPRSUCCESS,callback:function(){history.back();w.defer(function(){document.location.reload()},500)}})}else{r.fail({text:lbpm.constant.OPRFAILURE})}},function(B){r.fail({text:lbpm.constant.OPRFAILURE})})}),u.hitch(this,function(){r.fail({text:lbpm.constant.OPRFAILURE})}))}})},initCommonUsage:function(C){var B=this;var D=new KMSSData();D.AddBeanData("lbpmUsageTarget&type=getUsagesInfo");var E=D.GetHashMapArray();if(E&&E[0]){var z=E[0].usagesInfo?decodeURIComponent(E[0].usagesInfo):null;var w=[];if(z!=null&&z!=""){w=z.split("\n")}var A='<input type="checkbox" data-dojo-type="mui/form/CheckBox" name="_ext_box_commonUsageObjName" value="!{value}" data-dojo-props="mul:false,text:\'!{text}\'">';var v=h.map(w,function(F){while(F.indexOf("nbsp;")!=-1){F=F.replace("&nbsp;"," ")}F=F.replace(/\'/g,"\\'").replace(/\"/g,"&quot;");return{text:F,value:F}});var x="";if(v.length==0){x="<p>"+g["mui.operation.commonUsage.none"]+"</p>"}else{x=h.map(v,function(F){return A.replace("!{text}",F.text).replace("!{value}",F.value)});x="<div class='muiFormSelectElement'>"+x.join("")+"</div>"}var y=null;d("#"+B.id+" #commonExtUsages").on("touchend",function(){setTimeout(function(){y=f.element({element:x,showClass:"muiDialogSelect muiFormSelect",position:"bottom",scrollable:false,parseable:true,callback:function(){y=null}})},300)});n.subscribe("mui/form/checkbox/change",function(F,G){if(G.name!="_ext_box_commonUsageObjName"){return}if(y){y.hide()}y=null;d("#"+B.id+" textarea[name='ext_usageContent']").val(G.value.replace(/\\\'/g,"&#39;")+"\r\n")})}}});return a})},"sys/lbpmservice/node/manualbranchnode/node_desc":function(){(function(c){c.manualBranchNodeDesc.getLines=a;function a(f,l,g){if(l.decidedBranchOnDraft=="true"){var n=d(l);var q=b(n,l);if(q){return q}}else{if(g){return l.endLines}if(f){if(f.Status==lbpm.constant.STATUS_RUNNING){if(lbpm.globals.getSelectedFurtureNode){var n=lbpm.globals.getSelectedFurtureNode();var q=b(n,l);if(q){return q}}var m=lbpm.globals.getOperationParameterJson("futureNodeId",false,f);if(m&&lbpm.nodes[m]){var h=lbpm.nodes[m].startLines;var k=[];for(var j=0,p=h.length;j<p;j++){if(h[j].startNode.id==l.id){k[0]=h[j];return k}}}}else{if(f.Status==lbpm.constant.STATUS_PASSED){if(l.targetId){var k=[];for(var j=0,p=l.endLines.length;j<p;j++){if(l.endLines[j].endNode.id==l.targetId){k[0]=l.endLines[j];return k}}}}}}}return l.endLines}function d(h){if(lbpm.globals.getSelectedManualNode){var j=lbpm.globals.getSelectedManualNode();if(j&&j.length>0){return j}}var f=lbpm.globals.getOperationParameterJson("draftDecidedFactIds",false,h);if(f==null){if(lbpm.globals.draftDecidedFactIds!=null){f=lbpm.globals.draftDecidedFactIds}else{var i={nodeId:h.id,nodeType:h.XMLNODENAME,params:"draftDecidedFactIds"};var g=lbpm.globals._getOperationParameterFromAjax(i);if(g&&g.draftDecidedFactIds){f=lbpm.globals.draftDecidedFactIds=g.draftDecidedFactIds}else{f=lbpm.globals.draftDecidedFactIds=""}}}if(f){return $.parseJSON(f)}return null}function b(m,l){if(m!=null){var k="";for(var g=0,f=m.length;g<f;g++){if(m[g].NodeName==l.id){k=m[g].NextRoute;break}}if(k!=""&&lbpm.nodes[k]){var h=[];var j=lbpm.nodes[k].startLines;for(var g=0,f=j.length;g<f;g++){if(j[g].startNode.id==l.id){h[0]=j[g];return h}}}}return null}})(lbpm.nodedescs)},"sys/lbpmservice/mobile/workitem/CommonUsageTabbar":function(){define(["dojo/_base/declare","mui/tabbar/TabBar","./CommonUsageButton","dojo/json","dojo/dom-class"],function(c,b,a,f,d){return c("sys.lbpmservice.mobile.workitem.CommonUsageTabbar",[b],{buttons:[],buildRendering:function(){this.inherited(arguments);this.buildButtons();d.add(this.domNode,"commonUsageTabbar")},buildButtons:function(){var g=this;this.buttons.forEach(function(j,h){j.tabIndex=h;var i=new a(j);d.add(i.domNode,"commonUsageButton");g.addChild(i,h)})}})})},"sys/lbpmservice/mobile/freeflow/freeflowNodeOkBtn":function(){define(["dojo/_base/declare","mui/tabbar/TabBarButton","dojo/topic"],function(c,a,b){var d=c("sys.lbpmservice.mobile.freeflow.freeflowNodeOkBtn",[a],{onClick:function(){if(!this._CLICK_FLAG){return}b.publish("/sys/lbpmservice/freeflow/ok",this)}});return d})},"sys/lbpmservice/mobile/node/votenode/operation_handler_abstain":function(){define(["sys/lbpmservice/mobile/workitem/workitem_common"],function(c){var d={};var f=function(g){};var a=function(){return true};var b=function(){};d.handler_agree=lbpm.operations.handler_agree={click:f,check:a,setOperationParam:b};d.init=function(){};return d})},"sys/lbpmservice/mobile/common/workflow":function(){define(function(){var a={};a.WorkFlow_BuildXMLString=window.WorkFlow_BuildXMLString=function(g,i,c){if(i==null){if(g.XMLNODENAME){i=g.XMLNODENAME}}var d="<"+i;var b="";for(var h in g){if(h=="XMLNODENAME"){continue}var f=g[h];if(f==null){continue}if(typeof(f)=="function"){continue}if(!isNaN(h)){h=f.XMLNODENAME}switch(typeof(f)){case"string":if(!c&&f==""){continue}f=Com_HtmlEscape(g[h]);break;case"object":b+="\r\n"+window.WorkFlow_BuildXMLString(f,h,c);continue}d+=" "+h+'="'+f+'"'}if(b==""){d+=" />"}else{d+=">"+b+"\r\n</"+i+">"}return d};a.WorkFlow_LoadXMLData=window.WorkFlow_LoadXMLData=function(j,k,h){var l=j;if(typeof(j)=="string"){if(j==null||j==""){return}if(window.ActiveXObject){l=new ActiveXObject("MSXML2.DOMDocument.3.0");l.loadXML(j);l=l.firstChild}else{var d=new DOMParser();var m=d.parseFromString(j,"text/xml");l=m.documentElement}}var g=new Array();g.XMLNODENAME=l.nodeName;var b=l.attributes;for(var f=0;f<b.length;f++){g[b[f].nodeName]=b[f].value}if(g.CHILDRENISARRAY!=null){k=g.CHILDRENISARRAY=="true"}if(h!=null){if(h.indexOf(l.nodeName)!=-1){return l.text}}for(var c=l.firstChild;c!=null;c=c.nextSibling){if(c.nodeType==1){if(k){g[g.length]=window.WorkFlow_LoadXMLData(c,false,h)}else{g[c.nodeName]=window.WorkFlow_LoadXMLData(c,true,h)}}}return g};a.WorkFlow_SetInnerText=window.WorkFlow_SetInnerText=function(b,c){if("textContent" in b){b.textContent=c}else{b.innerText=c}};a.WorkFlow_PutDataToField=window.WorkFlow_PutDataToField=function(g,d){for(var h in g){var j=h;if(d!=null){j=d(j)}if(j==null){continue}var b=document.getElementsByName(j);if(b.length==0){continue}var f=g[h];switch(b[0].tagName){case"INPUT":switch(b[0].type){case"radio":for(var c=0;c<b.length;c++){b[c].checked=b[c].value==f}break;case"checkbox":if(f){if(f=="true"||f=="false"){for(var c=0;c<b.length;c++){b[c].checked=b[c].value==f}}else{for(var c=0;c<b.length;c++){b[c].checked=(f+";").indexOf(b[c].value+";")>=0}}}break;default:b[0].value=f}break;case"TEXTAREA":b[0].value=f;break;case"SELECT":for(var c=0;c<b[0].options.length;c++){b[0].options[c].selected=b[0].options[c].value==f}break;case"SPAN":window.WorkFlow_SetInnerText(b[0],f);break}}};a.WorkFlow_GetDataFromField=window.WorkFlow_GetDataFromField=function(h,c,j){if(j==null){j=document}var b=j.getElementsByTagName("INPUT");var f=function(i){if(i.name==null||i.name==""){return null}if(c!=null){return c(i.name)}return i.name};for(var d=0;d<b.length;d++){var g=f(b[d]);if(g==null){continue}switch(b[d].type){case"radio":if(b[d].checked){h[g]=b[d].value}break;case"checkbox":if(b[d].checked){if(b[d].value=="true"||b[d].value=="false"){h[g]=b[d].value}else{if(h[g]){h[g]+=";"+b[d].value}else{h[g]=b[d].value}}}else{if(b[d].value=="true"){h[g]="false"}else{if(b[d].value=="false"){h[g]="true"}}}break;default:h[g]=b[d].value}}b=j.getElementsByTagName("TEXTAREA");for(var d=0;d<b.length;d++){var g=f(b[d]);if(g==null){continue}h[g]=b[d].value}b=j.getElementsByTagName("SELECT");for(var d=0;d<b.length;d++){var g=f(b[d]);if(g==null){continue}h[g]=b[d].options[b[d].selectedIndex].value}};a.WorkFlow_RefreshNotifyType=window.WorkFlow_RefreshNotifyType=function(c,h){var g=document.getElementById(c);if(h==null){var d=new Array()}else{var d=h.split(";")}var b=g.getElementsByTagName("INPUT");for(var f=0;f<b.length;f++){if(b[f].name.substring(0,14)=="__notify_type_"){b[f].checked=Com_ArrayGetIndex(d,b[f].value)>-1}}};a.WorkFlow_GetStatusObjectByXML=window.WorkFlow_GetStatusObjectByXML=function(h){var r=[];var q=window.WorkFlow_LoadXMLData(h);var g,f,s,b;if(q.runningNodes==null){q.runningNodes=new Array()}q.historyNodes[0].routePath="";for(g=0;g<q.historyNodes.length;g++){var s=q.historyNodes[g];switch(s.routeType){case"BACK":b=window.WorkFlow_GetStatusInfoByModelId(q,s.targetId).routePath;break;case"RESUME":for(var f=g-1;f>=0;f--){if(q.historyNodes[f].id==s.targetId){b=q.historyNodes[f].routePath;break}}break;default:b=((s.routePath==null||s.routePath=="")?"":s.routePath+";")+s.id+":"+s.modelId}if(s.targetId==""){continue}var c=s.targetId.split(";");for(var f=0;f<c.length;f++){var l=window.WorkFlow_GetStatusInfoById(q,c[f],g);if(l!=null){window.WorkFlow_MergeStatusRoutePath(l,b)}else{r.push({nodeId:c[f],routePath:b})}}}if(q.historyNodes.length>0&&r.length>0){var n=0;for(g=0;g<q.runningNodes.length;g++){var p=q.runningNodes[g];if(p.routePath==null||p.routePath==""){if(n>=r.length){n=0}p.routePath=r[n].routePath;n++}}for(g=0;g<q.historyNodes.length;g++){var m=q.historyNodes[g];if(m.routePath==null||m.routePath==""){for(f=0;f<r.length;f++){if(m.id==r[f].nodeId){m.routePath=r[f].routePath;var c=m.targetId.split(";");for(var d=0;d<c.length;d++){var l=window.WorkFlow_GetStatusInfoById(q,c[d],q.historyNodes.length);if(l!=null){l.routePath=m.routePath+";"+m.id+":"+m.modelId}}break}}}}}return q};a.WorkFlow_MergeStatusRoutePath=window.WorkFlow_MergeStatusRoutePath=function(g,d){if(d==null||d==""){return}if(g.routePath==null||g.routePath==""){g.routePath=d;return}var f=g.routePath.split(";");var c=d.split(";");var h=function(l,k){for(var j=0;j<l.length;j++){if(l[j]==k){return true}}return false};for(var b=0;b<c.length;b++){if(!h(f,c[b])){f[f.length]=c[b]}}g.routePath=f.join(";")};a.WorkFlow_GetStatusInfoByModelId=window.WorkFlow_GetStatusInfoByModelId=function(c,d){for(var b=0;b<c.historyNodes.length;b++){if(c.historyNodes[b].id==d){return c.historyNodes[b]}}};a.WorkFlow_GetStatusInfoById=window.WorkFlow_GetStatusInfoById=function(d,f,b){for(var c=b+1;c<d.historyNodes.length;c++){if(d.historyNodes[c].id==f){return d.historyNodes[c]}}for(var c=0;c<d.runningNodes.length;c++){if(d.runningNodes[c].id==f){return d.runningNodes[c]}}};a.WorkFlow_GetCurrUserLang=window.WorkFlow_GetCurrUserLang=function(){var b=Com_Parameter.Lang;var d=b.indexOf("-");if(d!=-1){var c=b.split("-");return c[0]+"-"+c[1].toUpperCase()}return b};a.WorkFlow_getLangLabel=window.WorkFlow_getLangLabel=function(b,g,d,j){if(typeof g=="undefined"||(typeof _isLangSuportEnabled!="undefined"&&!_isLangSuportEnabled)){return b}if(typeof j=="undefined"){j=window.WorkFlow_GetCurrUserLang()}var f=[];if(typeof d=="undefined"){f=$.parseJSON(g)}else{var h={};if(g!=null&&g!=""){h=$.parseJSON(g)}if(typeof h[d]=="undefined"){return b}f=h[d]}for(var c=0;c<f.length;c++){if(j==f[c]["lang"]){return f[c]["value"]||b}}return b};return a})},"sys/lbpmservice/mobile/signature/SignatrueHandlerView":function(){define(["dojo/_base/declare","dojox/mobile/View","dojo/query","dojo/touch","dojo/_base/lang","dojo/on","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","dojo/request","./signatrueHtml"],function(declare,View,query,touch,lang,on,msg,request,signatrueHtml){return declare("sys.lbpmservice.mobile.signature.SignatrueHandlerView",[View],{descriptionDiv:null,buttonDiv:null,startup:function(){this.inherited(arguments);this.createBtn();this.bindEvents()},createBtn:function(){var obj=query(this.buttonDiv);var html='<div class="handingWay" id="signature">';html+='<div class="iconArea"><i class="mui mui-signature mui-sign"></i></div><span class="iconTitle">'+msg["mui.lbpmNode.signature"]+"</span></div>";signatrueHtml.confirm(this.fdKey,this.fdModelId,this.fdModelName);this.initialSignature(function(res){var results=eval("("+res.responseText+")");if(results.length>0){obj.append(html);signatrueHtml.dialogSignatureList("signature",res.responseText);setTimeout(function(){for(var i=0;i<results.length;i++){if(results[i].fdIsDefault&&results[i].fdIsFreeSign){if(lbpm&&lbpm.allMyProcessorInfoObj&&lbpm.allMyProcessorInfoObj.length>0){signatrueHtml.showDefaultSignature(results[i].id)}}}},500)}})},initialSignature:function(callback){var url=Com_Parameter.ContextPath+"km/signature/km_signature_main/kmSignatureMain.do?method=getSignatureList";var responseText="";request.get(url,{handleAs:"test"}).then(function(responseText){responseText=responseText?decodeURIComponent(responseText):null;callback&&callback({responseText:responseText})})},bindEvents:function(){lbpm.events.addListener(lbpm.constant.EVENT_validateMustSignYourSuggestion,function(){var imageDiv=query(".auditNoteHandlerImgUl");return imageDiv.children().length>0});on(query(this.descriptionDiv).parent()[0],on.selector("#imgUl li .btn_canncel_img",touch.press),lang.hitch(this,this.auditNoteViewDelete));this.inherited(arguments)}})})},"sys/lbpmservice/mobile/freeflow/freeflowChartButton":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/dom-class","dojo/dom-construct","dojo/query","dojox/mobile/ViewController","dojox/mobile/viewRegistry","dijit/registry","mui/util","mui/dialog/Dialog","mui/dialog/Tip","mui/tabbar/TabBarButton","dojo/Deferred","mui/device/adapter","mui/history/listener","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","dojo/NodeList-traverse"],function(r,t,n,l,j,f,s,p,k,b,g,q,c,a,m,d,h){var i=r("sys.lbpmservice.mobile.freeflow.freeflowChartButton",[c],{icon1:"",isHandler:false,handleView:"freeflowChartView",viewerUrl:"/sys/lbpmservice/mobile/freeflow/freeflowChartViewer.jsp",processId:"",modelName:"",modelId:"",key:"freeflowChart",showType:"",buildRendering:function(){this.inherited(arguments)},_onClick:function(){if(!lbpm.globals.isCanEdit()){return}lbpm.globals.saveOrUpdateFreeflowVersion();var x=s.getInstance();var v=null;if(this.showType=="dialog"){if(!this.backTo){var v=p.getEnclosingView(this.domNode);v=p.getParentView(v);this.backTo=v?v.id:"scrollView"}v=p.hash[this.backTo]}else{if(this.backTo!=null){v=p.hash[this.backTo]}else{v=p.getEnclosingView(this.domNode);v=p.getParentView(v)||v;this.backTo=v.id}}var u=p.hash[this.key];if(u==null){u=p.hash[this.key+"View"]}if(this.showType=="dialog"){n.publish("/lbpm/operation/hideDialog",this)}if(u==null){var w=b.formatUrl(this.viewerUrl);w=b.setUrlParameter(w,"backTo",v.id);w=b.setUrlParameter(w,"processId",this.processId);w=b.setUrlParameter(w,"modelName",this.modelName);w=b.setUrlParameter(w,"modelId",this.modelId);w=b.setUrlParameter(w,"key",this.key);w=b.setUrlParameter(w,"showType",this.showType);var y=this;x.openExternalView({url:w,transition:"slide"},v.domNode.parentNode).then(function(){var z=p.hash[y.key+"View"]})}else{v.performTransition(u.id,1,"slide")}},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments)}});return i})},"sys/lbpmservice/mobile/workitem/LbpmTabBar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/window","mui/tabbar/TabBar","mui/dialog/Dialog","mui/history/listener","./OperationButton","./OperationSwitchButton","./TransactionTabBarBtn","dojox/mobile/TransitionEvent","dojox/mobile/viewRegistry","dojo/_base/array","dojo/Deferred","mui/device/adapter","dojo/query","dijit/registry","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","dojo/dom","dojo/dom-style","dojo/dom-construct","mui/dialog/Tip"],function(v,w,d,r,g,b,j,p,c,s,u,k,a,n,f,l,h,t,q,i,m){return v("sys.lbpmservice.mobile.workitem.LbpmTabBar",[r],{fill:"grid",viewName:null,curTaskId:null,_operateConfig:{},_taskIds:[],transactionWgt:null,oldTaskId:"",showType:"dialog",signValidPushed:false,buildRendering:function(){this.inherited(arguments);this.initOperateInfo()},postCreate:function(){this.inherited(arguments);this.subscribe("/lbpm/operation/switch","switchButton");if(this.showType=="dialog"){this.subscribe("/lbpm/operation/hideDialog","_hideDialog");this.subscribe("/lbpm/operation/showDialog","_showDialog");this.subscribe("/lbpm/operation/destroyDialog","_destroyDialog");this.subscribe("/lbpm/ext/auditNoteHandler/change","_changeHWSign");this.subscribe("/mui/Category/valueChange","_toHandlerValChange");this.subscribe("/lbpm/operation/toHandlerAddress/parseFinish","_toSelectCate")}},initOperateInfo:function(){var y=this;var z=0;k.forEach(window.LBPM_CurOperationCfg,function(C,A){if(C.taskFrom=="workitem"){var B=true;if(lbpm&&lbpm.isSubForm&&lbpm.nowSubFormId!=C.subFormMobileId){B=false}if(B){y._operateConfig[C.taskId]=C;y._taskIds[z]=C.taskId;z++}}});if(!this.curTaskId){var x=0;if(this._taskIds.length>1){for(var z=0;z<this._taskIds.length;z++){if(lbpm&&lbpm.defaultTaskId&&this._taskIds[z]==lbpm.defaultTaskId){x=z;break}}}this.curTaskId=this._taskIds[x]}},startup:function(){if(this._started){return}this.renderTabrBar(this.curTaskId);this.inherited(arguments)},fillLbpmInfo:function(x){if(x.value!=this.curOperationType||this.oldTaskId!=this.curTaskId){var z=x.value+":"+x.label;f("#operationMethodsGroup")[0].value=z;lbpm.globals.clickOperation(z);var y=this;k.forEach(lbpm.processorInfoObj,function(D,A){if(y.curTaskId==D.id){lbpm.nowProcessorInfoObj=D;lbpm.nowNodeId=lbpm.nowProcessorInfoObj.nodeId;var E=y.curTaskName;var C=new RegExp("^N.");if(C.test(E)){if(lbpm&&lbpm.settingInfo){if(lbpm.settingInfo.isHideNodeIdentifier==="true"&&lbpm.settingInfo.hideNodeIdentifierType==="isHideAllNodeIdentifier"){var B=E.substring(E.indexOf("N"),E.indexOf(".")+1);E=E.replace(B,"")}}}f("#operationItemsRow .detailNode").html(y.curTaskName);f("#operationItemsSelect")[0].value=A}});f("#lbpmOperationMethodTable .detailNode").html(this.curNodeInfo+":"+x.label);this.curOperationType=x.value;lbpm._mobileView=this.backTo}},switchButton:function(F,E){if(E){this.currentOperationData=E;if(E.methodSwitch){var A=null;if(this.backTo==null){A=u.getEnclosingView(this.domNode);A=u.getParentView(A)||A;this.backTo=A.id}var y=l.byId(this.backTo);if(y){if(E.value&&E.value!="handler_pass"&&lbpm&&lbpm.nowProcessorInfoObj&&(lbpm.nowProcessorInfoObj.type=="reviewWorkitem"||lbpm.nowProcessorInfoObj.type=="assignWorkitem")){y.notValRequired=true}else{y.notValRequired=false;var x=document.activeElement;if(x&&x.blur){x.blur()}}}if(this.showType=="dialog"){if(E.value&&lbpm.operations&&lbpm.operations[E.value]&&lbpm.operations[E.value].isPassType){var C=u.getEnclosingView(this.domNode);C=u.getParentView(C)||C;if(C.validate&&!C.validate()){return}}}if(this.showType!="dialog"){new s(d.body(),{moveTo:this.viewName,transition:"slide",transitionDir:1}).dispatch()}window.Com_BeforeSubmitDeferred=w.hitch(this,this._validateFingerPrint);var z=this;if(this.showType!="dialog"){b.add({callback:function(){new s(d.body(),{moveTo:z.backTo,transition:"slide",transitionDir:-1}).dispatch();window.Com_BeforeSubmitDeferred=null}})}this.fillLbpmInfo(E);this.addHWSignValidator(E);if(this.showType=="dialog"){var B=["handler_commission","handler_communicate","handler_additionSign","handler_assign"];if(!(E.value&&B.indexOf(E.value)>=0)){this.showOperationDialog(E)}if(dojoConfig.dingXForm==="true"&&E.value&&E.value=="handler_communicate"){$("#toHandlerAddress").removeClass("muiFormLeft")}}}else{if(this.curTaskId!=E.value){var D=this;k.forEach(this.getChildren(),function(G){if((G instanceof j)||(G instanceof p)){D.removeChild(G)}});this.oldTaskId=this.curTaskId;this.curTaskId=E.value;this.renderTabrBar(E.value);setTimeout(function(){D.resize()},20);k.forEach(lbpm.processorInfoObj,function(H,G){if(D.curTaskId==H.id){lbpm.nowProcessorInfoObj=H;lbpm.nowNodeId=lbpm.nowProcessorInfoObj.nodeId;f("#operationItemsRow .detailNode").html(D.curTaskName);f("#operationItemsSelect")[0].value=G}})}}}},_toSelectCate:function(){if(this.showType=="dialog"){var x=u.getEnclosingView(this.domNode);x=u.getParentView(x)||x;if(x.validate&&!x.validate()){return}}var y=l.byId("toHandlerAddress");y._selectCate()},_toHandlerValChange:function(x,z){var y=l.byId("toHandlerAddress");if(y&&y==x&&this.dialog==null){this.showOperationDialog(this.currentOperationData)}},_showDialog:function(x,y){q.set(f("body")[0],{"overflow-y":"hidden",position:"fixed"});this.defer(function(){q.set(t.byId(this.viewName),{display:"block"});if(y&&y.handwriting){var z=this._getDomOffsetTop(f("#handwriting")[0]);var A=window;if(this.showType=="dialog"){A=f(".muiLbpmDialog .muiDialogElementContent_bottom")[0]}this._scrollTo(A,{y:0-z+110})}},500)},_hideDialog:function(x){q.set(t.byId(this.viewName),{display:"none"});q.set(f("body")[0],{"overflow-y":"",position:""})},_destroyDialog:function(x){if(this.dialog&&this.dialog.callback){this.dialog.callback(window,this.dialog)}this.lastDialog.hide();this.lastDialog=null},showOperationDialog:function(y){var x=l.byId("fdUsageContent");if(x.validation){x.validation.hideWarnHint(x.domNode)}if(lbpm&&lbpm.events){this.defer(function(){lbpm.events.mainFrameSynch()},100)}this.lbpmViewDom=t.byId(this.viewName);this.dialogContentNode=i.create("div");i.place(t.byId("lbpmOperContent"),this.dialogContentNode,"first");var z=[];lbpm.currentOperationLabel=y.label;var B="<span style='font-size:1.6rem'>"+y.label+"</span>";var A=lbpm.globals.getCurrentNodeObj();if(A&&A.description){B+="<span class='nodeDescriptionHelp' onclick='showNodeHelpDialog()'>节点帮助</span>"}this.dialog=g.element({title:B||"",canClose:false,element:this.dialogContentNode,buttons:z,position:"bottom",appendTo:this.lbpmViewDom,scrollable:false,parseable:false,showClass:"muiLbpmDialog",callback:w.hitch(this,function(D,C){q.set(this.lbpmViewDom,{display:"none",position:"","z-index":""});q.set(f("body")[0],{"overflow-y":""});i.place(f("#lbpmOperContent",C.element)[0],this.lbpmViewDom,"first");window.Com_BeforeSubmitDeferred=null;this.lastDialog=this.dialog;this.dialog=null}),onDrawed:w.hitch(this,function(C){q.set(this.lbpmViewDom,{display:"block",position:"fixed",bottom:"0","z-index":"100"});q.set(f("body")[0],{"overflow-y":"hidden"});this.defer(function(){var E=document.documentElement.clientHeight*0.9;if(C.privateHeight){E=C.privateHeight}if(C.divNode){E=E-C.divNode.offsetHeight}if(C.buttonsNode){E=E-C.buttonsNode.offsetHeight}q.set(C.contentNode,{"max-height":E+"px","overflow-x":"hidden"});C.scrollViewNode=C.contentNode},800);var D=l.byId("lbpmViewOperationTabBar");D.resize()})})},_validateFingerPrint:function(){var x=this;var A=new a(),y=lbpm.globals.getExtAttribute&&lbpm.globals.getExtAttribute(lbpm.globals.getCurrentNodeObj(),"fingerPrintReview"),z=lbpm.globals.getExtAttribute&&lbpm.globals.getExtAttribute(lbpm.globals.getCurrentNodeObj(),"facePrintReview");if(y&&y.value=="true"){if(n.supportfingerPrint==1){A.resolve();if(x.showType=="dialog"){x._hideDialog()}else{history.back()}return}if(n.supportfingerPrint==2){A.resolve();if(x.showType=="dialog"){x._hideDialog()}else{history.back()}return}n.validatefingerPrint(function(B){if(B){A.reject(B);return}A.resolve();if(x.showType=="dialog"){x._hideDialog()}else{history.back()}},function(B){A.reject(B);return})}else{if(z&&z.value=="true"){if(n.supportfingerPrint==1){A.resolve();if(x.showType=="dialog"){x._hideDialog()}else{history.back()}return}if(n.supportFacePrint==2){A.resolve();if(x.showType=="dialog"){x._hideDialog()}else{history.back()}return}n.checkFace(function(B){if(B){A.reject(B);return}A.resolve();if(x.showType=="dialog"){x._hideDialog()}else{history.back()}},function(B){if(B.code==6){A.resolve();if(x.showType=="dialog"){x._hideDialog()}else{history.back()}return}A.reject(B);return})}else{A.resolve();if(x.showType=="dialog"){x._hideDialog()}else{history.back()}}}return A},renderTabrBar:function(H){if(!H||!this._operateConfig[H]){return}var G=0;if(this._taskIds.length>1){var J=[];for(var E=0;E<this._taskIds.length;E++){var y=this._taskIds[E];if(!this._operateConfig[y]){continue}var z=this._operateConfig[y].nodeId;var A=null;k.forEach(window.LBPM_CurNodeCfg,function(K){if(z==K.nodeId){A=K}});var x=(this._operateConfig[y].parentHandlerName)?(this._operateConfig[y].parentHandlerName+":"):"";x=z+"."+x+A.nodeName+"("+this._operateConfig[y].expectedName+")";if(A&&A.groupNodeId){x=x+"【"+A.groupNodeId+"."+this._getLangLabel(A.groupNodeName,A.groupNodeLangs,"nodeName")+"】"}if(this.curTaskId==y){this.curTaskName=x;this.curNodeInfo=z+"."+A.nodeName}J.push({text:x,value:y,checked:H==y})}if(!this.transactionWgt){this.transactionWgt=new c({tabBar:this,options:J,curTaskId:this.curTaskId})}}else{var z=this._operateConfig[H].nodeId;var A=null;k.forEach(window.LBPM_CurNodeCfg,function(K){if(z==K.nodeId){A=K}});this.curNodeInfo=z+"."+A.nodeName;this.curTaskName=z+"."+A.nodeName+"("+this._operateConfig[H].expectedName+")"}var D=this._operateConfig[H].operations;if(D.length>0){var F=0;var I=lbpm.isShowSubBut?3:4;var B=false;if(D.length<=I){F=D.length}else{F=I-1;B=true}for(var E=0;E<F;E++){var C=D[E];this.addChild(new j({label:C.operationName,operationType:C.operationType,tabIndex:G}),G);G++}if(B){var J=[];for(var E=F;E<D.length;E++){var C=D[E];J.push({text:C.operationName,value:C.operationType})}this.addChild(new p({options:J}),G);G++}}},_getLangLabel:function(x,B,z,D){if(typeof B=="undefined"||(typeof _isLangSuportEnabled!="undefined"&&!_isLangSuportEnabled)){return x}if(typeof D=="undefined"){D=this._GetCurrUserLang()}var A=[];if(typeof z=="undefined"){A=$.parseJSON(B)}else{var C={};if(B!=null&&B!=""){C=$.parseJSON(B)}if(typeof C[z]=="undefined"){return x}A=C[z]}for(var y=0;y<A.length;y++){if(D==A[y]["lang"]){return A[y]["value"]||x}}return x},_GetCurrUserLang:function(){var x=Com_Parameter.Lang;var z=x.indexOf("-");if(z!=-1){var y=x.split("-");return y[0]+"-"+y[1].toUpperCase()}return x},_changeHWSign:function(){var y=f("[name='hwSignEmpty']")[0];if(y){var x=l.byId(this.viewName);x.validate([y])}},addHWSignValidator:function(G){var y=lbpm.nowProcessorInfoObj.type=="reviewWorkitem"&&G.value=="handler_pass";var A=lbpm.nowProcessorInfoObj.type=="signWorkitem"&&G.value=="handler_sign";if(!lbpm||!lbpm.processorInfoObj||!(y||A)){if(this.showType=="dialog"&&this.signValidPushed){var x=l.byId(this.viewName);x._validation.hideWarnHint(f("#hwSignEmpty")[0]);var F=l.byId("hwSignEmpty");F.destroy();f("#hwSignRequiredIcon").remove();f("#hwSignEmptyDiv").remove();this.signValidPushed=false}else{f("#hwSignRequiredIcon").remove()}return}var B=lbpm.nodes[lbpm.nowNodeId].needMobileHandWrittenSignatureReviewNode||lbpm.nodes[lbpm.nowNodeId].needMobileHandWrittenSignatureSignNode;if(typeof B=="undefined"){B=y?Lbpm_SettingInfo.needMobileHandWrittenSignatureReviewNode:Lbpm_SettingInfo.needMobileHandWrittenSignatureSignNode}if(B=="true"&&!this.signValidPushed){var E='<span id="hwSignRequiredIcon" style="color:red;display:block;position:absolute;top:0px;right:0px;line-height:10px;font-size:10px;">*</span>';var D=f(".mui-handwrite");if(D){D.html(E);if(this.showType=="dialog"){var C=i.create("div",{id:"hwSignEmptyDiv",style:"position:relative"});i.place(C,t.byId("commonUsagesDiv"),"before");var z='<div data-dojo-type=\'mui/form/Input\' data-dojo-props=\'"name":"hwSignEmpty","showStatus":"edit","validate":"hwSignRequired"\' id=\'hwSignEmpty\' style=\'display:none;\'></div>';f("#hwSignEmptyDiv").html(z,{parseContent:true})}}this.signValidPushed=true;lbpm.globals.handlerWrittenValidator=function(){var H=f("#imgUl");if(!H||H.length===0||H.innerHTML()==""){m.warn({text:h["FlowChartObject.Lang.Node.needHandWritten"]});return false}return true}}},_scrollTo:function(D,I){var G=0;if(I){G=I.y||0}var B=-G;var z=this.getPos(D).y;var H=B-z;var J=300;var F=30;var E=10;var A=H/E;var C=0;var x=window.setInterval(function(){if(C<=E-1){z+=A;C++;D.scrollTo(0,z)}else{window.clearInterval(x)}},F)},getPos:function(x){if(x==window){return{y:document.documentElement.scrollTop||document.body.scrollTop}}else{return{y:x.scrollTop}}},_getDomOffsetTop:function(z){var y=z;var x=0;while(y!=null&&y!=document.body){x+=y.offsetTop;y=y.offsetParent}return x}})})},"sys/lbpmservice/mobile/operation/other/AssignOprButton":function(){define(["dojo/_base/declare","dojo/_base/window","dojox/mobile/TransitionEvent","dojox/mobile/ViewController","dojox/mobile/viewRegistry","mui/util","mui/tabbar/TabBarButton","dojo/topic","dojo/dom-class","dojo/dom-style","dojo/Deferred","mui/history/listener","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm"],function(d,i,k,a,m,g,n,f,l,h,j,b,c){return d("sys.lbpmservice.mobile.operation.other.AssignOprButton",[n],{operationType:0,extOptUrl:"/sys/lbpmservice/mobile/operation/other/assignOprViewer.jsp",processId:"",modelName:"",modelId:"",buildRendering:function(){this.inherited(arguments);if(window.LBPM_CanAssign){if(this.operationType==0){l.add(this.domNode,"selected")}}else{l.add(this.domNode,"selected")}if(this.operationType==0){this.label=c["mui.lbpmAssign.operation.replyAssign"]}else{this.label=c["mui.lbpmAssign.operation.assign"]}},startup:function(){if(this._started){return}this.inherited(arguments)},_setSelectedAttr:function(p){this.inherited(arguments);this.defer(function(){this.set("selected",false)},380)},onClick:function(){var t=a.getInstance();var r=null;if(this.backTo!=null){r=m.hash[this.backTo]}else{r=m.getEnclosingView(this.domNode);r=m.getParentView(r)||r;this.backTo=r.id}var q=m.hash.AssignOprView;if(q==null){var s=g.formatUrl(this.extOptUrl);s=g.setUrlParameter(s,"backTo",r.id);s=g.setUrlParameter(s,"processId",this.processId);s=g.setUrlParameter(s,"modelName",this.modelName);s=g.setUrlParameter(s,"modelId",this.modelId);var u=this;t.openExternalView({url:s,transition:"slide"},r.domNode.parentNode).then(function(){var v=m.hash.AssignOprView;v.set("operationType",u.operationType);if(v&&v.initExtOpertion){v.initExtOpertion(u)}})}else{q.set("operationType",this.operationType);r.performTransition(q.id,1,"slide");if(q.initExtOpertion){q.initExtOpertion(this)}}var p=this;window.Com_BeforeSubmitDeferred=this.defaultDeferred;b.add({callback:function(){new k(i.body(),{moveTo:p.backTo,transition:"slide",transitionDir:-1}).dispatch();window.Com_BeforeSubmitDeferred=null}})},defaultDeferred:function(){var p=new j();p.resolve();history.back();return p}})})},"sys/lbpmservice/mobile/node/joinnode/operation_handler_cancelconbranch":function(){define(["dijit/registry","mui/form/Address","dojo/query","sys/lbpmservice/mobile/common/syslbpmprocess","dojo/store/Memory","mui/dialog/Tip"],function(a,f,i,g,h,k){var l=function(v){var s=document.getElementById("operationsRow");var w=document.getElementById("operationsTDTitle");var p=document.getElementById("operationsTDContent");w.innerHTML=lbpm.constant.opt.CancelconbranchTitle;var u=lbpm.nodes[lbpm.nowNodeId].relatedNodeIds;var m=lbpm.nodes[u];var x=new KMSSData();x.AddBeanData("getConBranchStatusService&type=runing&splitNode="+u+"&processId="+lbpm.modelId);var r=x.GetHashMapArray();var n=[];for(var q=0;q<r.length;q++){n.push({value:r[q].id,text:r[q].name})}var t='<div data-dojo-type="mui/form/CheckBoxGroup" id="cancelConbranchsGroup" data-dojo-props="validate:\'cancelconbranchRequired required\',required:true,name:\'cancelConbranchsGroup\'"></div>';i("#operationsTDContent").html(t,{parseContent:true,onEnd:function(){this.inherited("onEnd",arguments);if(this.parseDeferred){this.parseDeferred.then(function(){var y=a.byId("cancelConbranchsGroup");y.setStore(new h({data:n}))})}}});lbpm.globals.hiddenObject(s,false)};var b=function(){var m=a.byId("cancelConbranchsGroup");var n=m.get("value");if(n==null||n==""){k.warn({text:lbpm.constant.opt.CancelbranchIsNull});return false}return true};var d=function(){var m=a.byId("cancelConbranchsGroup");var n=m.get("value");lbpm.globals.setOperationParameterJson(n,"cancelConbranchs","param")};var j=function(){};var c={};c.handler_cancelconbranch=lbpm.operations.handler_cancelconbranch={click:l,check:b,blur:j,setOperationParam:d};c.init=function(){};return c})},"sys/lbpmservice/mobile/change_process/sysLbpmProcess_changeProcess":function(){define(["dojo/_base/array","dojo/topic","dijit/registry","mui/util","mui/form/Address","dojo/query"],function(h,p,i,a,r,f){var u={};var n=function(z,x,y){var v,w;y+=",";if(y.indexOf(x+",")==-1){return false}if(z.canModifyHandlerNodeIds!=null&&z.canModifyHandlerNodeIds!=""){w=z.canModifyHandlerNodeIds+";";v=w.indexOf(x+";");if(v!=-1){return true}}if(z.mustModifyHandlerNodeIds!=null&&z.mustModifyHandlerNodeIds!=""){w=z.mustModifyHandlerNodeIds+";";v=w.indexOf(x+";");if(v!=-1){return true}}return false};var m=function(){var w=new Array();for(var v in lbpm.nodes){var y=lbpm.nodes[v];var x=lbpm.nodedescs[y.nodeDescType];if(x.isHandler(y)&&!x.isBranch(y)){w.push(y)}}w.sort(lbpm.globals.getNodeSorter());return w};var q=function(y,x,v,w){if(y.indexOf("handlerIds_")==-1){return}var B=y.replace("handlerIds_","");var A={};A.sourceObj=location.href;var z="org";if(w&&w.handlerSelectType&&x==""){z=w.handlerSelectType}A.nodeInfos=[{id:B,handlerSelectType:z,handlerIds:x,handlerNames:v}];A.isChangeHandlerAddress=w.isChangeHandlerAddress==true?true:false;lbpm.events.fireListener(lbpm.constant.EVENT_MODIFYNODEATTRIBUTE,A)};var s=function(w){var v=lbpm.constant.ADDRESS_SELECT_POSTPERSONROLE;if(lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_SEND,w)){v=lbpm.constant.ADDRESS_SELECT_ALLROLE}if(w.nodeDescType=="shareReviewNodeDesc"){v="ORG_TYPE_PERSON"}return v};var c=function(v){if(v.nodeDescType=="shareReviewNodeDesc"){return false}return true};var g=function(){var v=lbpm.modelName;var w=lbpm.modelId;lbpm.globals.getThroughNodes(function(N){var F=lbpm.globals.getIdsByNodes(N);var A=lbpm.globals.getNodeObj(lbpm.nowNodeId);var H=m();var x=[];var J=[];for(var K=0;K<H.length;K++){var z=H[K];var O=z.id;if(!lbpm.globals.judgeIsNecessaryAlert(z)){continue}if(n(A,O,F)){var I=z.handlerSelectType;var E=z.handlerIds==null?"":z.handlerIds;var P=z.handlerNames==null?"":z.handlerNames;if(I=="formula"){E=!z.handlerIds?"":"formula";P=lbpm.workitem.constant.COMMONHANDLERISFORMULA}else{if(I=="matrix"){E=!z.handlerIds?"":"matrix";P=lbpm.workitem.constant.COMMONHANDLERISMATRIX}else{if(I=="rule"){E=!z.handlerIds?"":"rule";P=lbpm.workitem.constant.COMMONHANDLERISRULE}}}var y="handlerIds_"+O;var B="handlerNames_"+O;var M=(function(){if(z.optHandlerCalType==null||z.optHandlerCalType=="2"){var Q=f("input[name='rolesSelectObj']");if(Q.length>0&&Q[0].selectedIndex>-1){return Q[0].value}return f("input[name='sysWfBusinessForm.fdIdentityId']")[0].value}var R=f("input[name='sysWfBusinessForm.fdHandlerRoleInfoIds']")[0].value.split(";");return R[0]})();var C={idField:y,nameField:B,mulSelect:c(z),splitStr:";",selectType:s(z),addAction:"lbpm.globals.temp_updateFutureHandlers",deleteAction:"lbpm.globals.temp_updateFutureHandlers",idValue:E,nameValue:P,handlerSelectType:z.handlerSelectType,cateFieldShow:true,nodeId:O,isChangeHandlerAddress:true};var G='<div class="modifyNodeAuthorizationSelector">';var L=WorkFlow_getLangLabel(z.name,z.langs,"nodeName");G+="<b>"+z.id+"."+Com_HtmlEscape(L)+"</b>";G+="<div style='margin-top: .5rem;' id=\"_"+y+'_label" class="muiCateFiledShow"></div>';G+=b(C);if(z.useOptHandlerOnly=="true"){G+=" "+j(C,M,z.optHandlerIds,z.optHandlerSelectType,v,w,z.useOptHandlerOnly)}else{if(z.optHandlerIds||z.optHandlerSelectType=="dept"||z.optHandlerSelectType=="mechanism"||z.optHandlerSelectType=="otherOrgDept"){C.groupBtn=true;G+='<div data-dojo-type="sys/lbpmservice/mobile/change_process/AddressButtonGroup" data-dojo-props="icon1:\'mui mui-address\'">';G+=d(C);G+=j(C,M,z.optHandlerIds,z.optHandlerSelectType,v,w,z.useOptHandlerOnly);G+="</div>"}else{G+=" "+d(C)}}G+="</div>";x.push(G);J.push(O)}}var D=f("#modifyNodeAuthorizationDetail");D.forEach(function(Q){h.forEach(i.findWidgets(Q),function(R){R._overTime=true;R.destroy&&!R._destroyed&&R.destroy()})});if(x.length>0){f("#modifyNodeAuthorizationTr").style("display","");D.html(x.join(""),{parseContent:true})}else{f("#modifyNodeAuthorizationTr").style("display","none");D.html()}},null,null,false,lbpm.nowNodeId);f(".opt_address").forEach(function(x){var y=i.byNode(x);if(y&&y.validation){y.validation.validateElement(y)}})};var t=function(v){return v.alertText?v.alertText:""};var k=function(v){return"id="+v+" name="+v+" key="+v+""};var b=function(x){var w=x.idValue||"";var v=x.nameValue||"";var y="<input type='hidden' alertText='"+t(x)+"' value='"+a.formatText(w)+"' "+k(x.idField)+"><input type='hidden' "+k(x.nameField)+" alertText='' value='"+a.formatText(v)+"'>";return y};var j=function(K,z,G,A,D,I,L){var x=K.idValue||"";var H=K.nameValue||"";var v=K.nodeId||"";var J="";if(K.groupBtn){J+=dojoConfig.baseUrl+"sys/lbpmservice/mobile/change_process/GroupButtonMixin.js"}var w="";if(L=="true"){w=" validate:'futureNodeObjs', "}var B='<div class=\'opt_address\' data-dojo-type="sys/lbpmservice/mobile/opthandler/OptHandler" data-dojo-mixins="'+J+'" data-dojo-props="'+w+"idField:'"+a.formatText(K.idField)+"',optHandlerIds:'"+a.formatText(G)+"',handlerIdentity:'"+a.formatText(z)+"',optHandlerSelectType:'"+A+"',handlerSelectType:'"+(K.handlerSelectType==null?"org":K.handlerSelectType)+"',fdModelName:'"+D+"',fdModelId:'"+I+"',curIds:'"+a.formatText(x)+"',value:'"+a.formatText(x)+"',optClass:'fontmuis muis-new optAddressAdd',curNames:'"+a.formatText(H)+"',nodeid:'"+v+"',nameField:'"+K.nameField+"'\"";if(K.groupBtn){B+=' style="display:none" nodeId="'+K.nodeId+'"'}B+=" >";B+=" </div>";if(A=="dept"||A=="mechanism"||A=="otherOrgDept"){var F="dept";var C="";if(A=="mechanism"){F="org"}else{if(A=="otherOrgDept"){F="otherOrgDept";C="otherOrgDept-"+G}}var y=document.getElementById("sysWfBusinessForm.fdHandlerRoleInfoIds");var E="&currentId="+lbpm.nowProcessorInfoObj.expectedId+"&handlerIdentity="+z+"&scopeType="+F+"&fdModelName="+D+"&fdModelId="+I+"&exceptValue="+y.value+"&deptLimit="+C;B='<div class=\'opt_address\' data-dojo-type="sys/lbpmservice/mobile/opthandler/OptHandler" data-dojo-mixins="'+J+'" data-dojo-props="idField:\''+a.formatText(K.idField)+"',optHandlerIds:'"+a.formatText(G)+"',handlerIdentity:'"+a.formatText(z)+"',optHandlerSelectType:'"+A+"',handlerSelectType:'"+(K.handlerSelectType==null?"org":K.handlerSelectType)+"',fdModelName:'"+D+"',fdModelId:'"+I+"',curIds:'"+a.formatText(x)+"',value:'"+a.formatText(x)+"',optClass:'fontmuis muis-new optAddressAdd',curNames:'"+a.formatText(H)+"',dataUrl:'/sys/lbpmservice/mobile/opthanlder.do?method=scopeHandlers"+E+"',deptLimit:'"+C+"',nameField:'"+K.nameField+"'\"";if(K.groupBtn){B+=' style="display:none"'}B+=" >";B+=" </div>"}return B};var d=function(A){var y=", cateFieldShow:'#_"+A.idField+'_label\'" style="';var x=A.idValue||"";var v=A.nameValue||"";var w="";if(A.groupBtn){w+=dojoConfig.baseUrl+"sys/lbpmservice/mobile/change_process/GroupButtonMixin.js"}var C=false;if(A.handlerSelectType=="rule"||A.handlerSelectType=="formula"||A.handlerSelectType=="matrix"){var z=lbpm.globals.getNodeObj(A.nodeId);lbpm.globals.setNodeParseHandler(z);C=true}if(!A.isChangeHandlerAddress){A.isChangeHandlerAddress=false}var B='<div class="opt_address" data-dojo-type="mui/form/Address" data-dojo-mixins="'+w+"\" data-dojo-props=\"validate:'futureNodeObjs',type: "+A.selectType+",isChangeHandlerAddress:"+A.isChangeHandlerAddress+",idField:'"+A.idField+"',nameField:'"+A.nameField+"',showHeadImg:false,isMul:"+A.mulSelect+",optClass:'fontmuis muis-new optAddressAdd',exceptValue:'"+(A.exceptValue==null?"":A.exceptValue.join(";"))+"',curIds:'"+(C?(a.formatText(lbpm.nodeParseHandlerId?lbpm.nodeParseHandlerId.value:"")):a.formatText(x))+"',value:'"+(C?(a.formatText(lbpm.nodeParseHandlerId?lbpm.nodeParseHandlerId.value:"")):a.formatText(x))+"',curNames:'"+(C?(a.formatText(lbpm.nodeParseHandlerName?lbpm.nodeParseHandlerName.value:"")):a.formatText(v))+"',orient:'none',align:'left',handlerIds:'"+(C?(a.formatText(lbpm.nodeParseHandlerId?lbpm.nodeParseHandlerId.value:"")):a.formatText(x))+"',handlerSelectType:'"+(A.handlerSelectType==null?"org":A.handlerSelectType)+'\'" nodeId="'+A.nodeId+'"></div>';return B};var l=function(){if(!lbpm.nowProcessorInfoObj){return false}return h.some(lbpm.nowProcessorInfoObj.operations,function(v){return lbpm.operations[v.id]&&lbpm.operations[v.id].isPassType})};u.init=function(){if(!l()){return}p.subscribe("/mui/form/valueChanged",function(w,v){if(w&&w instanceof r&&!w._overTime&&(w.handlerIds!=null||w.optHandlerIds!=null)){var x=w.key||v.key;q(x,w.curIds,w.curNames,w)}});g();lbpm.events.addListener(lbpm.constant.EVENT_SELECTEDFUTURENODE,g);lbpm.events.addListener(lbpm.constant.EVENT_CHANGEWORKITEM,g)};return u})},"sys/lbpmservice/mobile/workitem/FutureNodesChekBox":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/query","dojo/_base/array","dojo/dom-class","dojo/dom-construct","dojo/dom-style","mui/form/CheckBox","mui/form/CheckBoxGroup","mui/util","dijit/registry"],function(f,b,k,i,l,c,h,d,j,g,a){return f("sys.lbpmservice.mobile.workitem.FutureNodesChekBox",[d],{rightText:null,handlerIds:null,handlerSelectType:null,isManualBranch:true,buildRendering:function(){this.inherited(arguments);if(this.rightText!=null&&this.rightText!="none"){var n=this.rightText=="";var m=this;var p=function(r){var s=m.rightText="",q=r.GetHashMapArray();if(q.length>0){i.forEach(q,function(t){s=s+";"+t.name});if(s!=""){s=s.substring(1)}}m.rightTextNode=c.create("div",{className:n?"handlerNamesLabel noHandlerNamesLabel":"handlerNamesLabel",innerHTML:n?"(未设置)":"("+g.formatText(s)+")",id:"handlerShowNames["+m.index+"]"},m.fieldOptions,"last");h.set(k(".mui-checkbox-base",m.fieldOptions)[0],{display:"inline"})};if(this.handlerSelectType=="formula"){lbpm.globals.formulaNextNodeHandler(this.handlerIds,true,this.distinct,p)}else{if(this.handlerSelectType=="matrix"){lbpm.globals.matrixNextNodeHandler(this.handlerIds,true,this.distinct,p)}else{if(this.handlerSelectType=="rule"){lbpm.globals.ruleNextNodeHandler(this.value,this.handlerIds,true,this.distinct,p)}else{lbpm.globals.parseNextNodeHandler(this.handlerIds,true,this.distinct,p)}}}}if(!this.isManualBranch){this.domNode.removeAttribute("key");h.set(this.checkboxIcon,"display","none")}},_onClick:function(){if(!this.__checkFlag){this.__checkFlag=true;this.inherited(arguments);lbpm.events.fireListener(lbpm.constant.EVENT_SELECTEDFUTURENODE,null);this.__checkFlag=false}},_setCheckedAttr:function(m){this.inherited(arguments);if(m){this.defer(function(){lbpm.events.fireListener(lbpm.constant.EVENT_SELECTEDFUTURENODE,null)},420)}}})})},"sys/lbpmservice/mobile/node/reviewnode/operation_handler_superRefuse":function(){define(["dojo/query","dojo/store/Memory","dijit/registry","dojo/request","dojo/_base/array","dojo/dom","dojo/dom-prop","dojo/dom-construct","mui/dialog/Tip"],function(g,p,l,d,k,w,j,i,q){lbpm.operations.handler_superRefuse={click:m,check:s,blur:r,setOperationParam:c};function r(){lbpm.globals.clearDefaultUsageContent("handler_superRefuse")}function m(H){lbpm.globals.setDefaultUsageContent("handler_superRefuse");var D=document.getElementById("operationsRow");var J=document.getElementById("operationsTDTitle");J.innerHTML=lbpm.workitem.constant.handlerOperationTypeRefuse.replace("{refuse}",H);var I=lbpm.globals.getCurrentNodeObj();var z=I.id;var B=lbpm.nodes[lbpm.nowNodeId].extAttributes;var E=[];var F=0;var G=false;for(var C=0;B&&C<B.length;C++){if(B[C].name=="refuse_types"){E=B[C].value.split(";");break}}var x=Com_Parameter.ContextPath+"sys/lbpm/engine/jsonp.jsp";var A={s_bean:"lbpmRefuseRuleDataBean",processId:g("[name='sysWfBusinessForm.fdProcessId']").val(),nodeId:z,_d:new Date().toString(),refuseType:"superRefuse"};var y={s_bean:"lbpmRefuseRuleDataBean",processId:g("[name='sysWfBusinessForm.fdProcessId']").val(),nodeId:z,_d:new Date().toString()};lbpm.globals._isJumpNodeInJoin=false;d.post(x,{handleAs:"json",data:A}).then(function(K){return d.post(x,{handleAs:"json",data:y}).then(function(L){return[K,L]})}).then(function(O){var L=O[0],K=O[1];if(L&&L.length){var U=[];var W=0;var X=false;$.each(L,function(ac,ae){if(ae.indexOf("#")>-1){var ad=ae.split("#");ae=ad[0];W=ad[1];X=true}U.push(ae)});L=U;var aa=function(ac){return k.some(K,function(ad){return ad==ac})};var Q='<div id="jumpToNodeIdSelectObj" data-dojo-type="mui/form/Select" key="jumpToNodeId" data-dojo-props="validate:\'jumpToNodeRequired required\',required:true,name:\'jumpToNodeIdSelectObj\', value:\'\', mul:false" ></div>';Q+='<div id="_super_triageHandler"></div>';lbpm.rejectOptionsEnabled=true;if(Lbpm_SettingInfo&&(Lbpm_SettingInfo.isShowRefuseOptonal==="false")){lbpm.rejectOptionsEnabled=false}if(lbpm.rejectOptionsEnabled){var P=0;if(lbpm.flowcharts&&lbpm.flowcharts.rejectReturn=="true"){P=1}if(h("refusePassedToSequenceFlowNodeLabel",E)){Q+='<div class="refusePassedToSequenceFlowNode refuseNode">';Q+='<div id="refusePassedToSequenceFlowNode" alertText="" key="refusePassedToSequenceFlowNode" data-dojo-type="mui/form/CheckBox"';Q+=" data-dojo-props=\"name:'refusePassedToSequenceFlowNode', value:'true', mul:false, text:'";Q+=lbpm.workitem.constant.handlerOperationTypeRefuse_sequenceFlow.replace("{refuse}",H)+"'";Q+=",checked:"+(F==P?true:false);Q+='"></div></div>';F+=1}if(h("refusePassedToThisNodeLabel",E)){Q+='<div id="refusePassedToThisNodePane" class="refusePassedToThisNode refuseNode">';Q+='<div id="refusePassedToThisNode" alertText="" key="refusePassedToThisNode" data-dojo-type="mui/form/CheckBox"';Q+=" data-dojo-props=\"name:'refusePassedToThisNode', value:'true', mul:false, text:'";Q+=lbpm.workitem.constant.handlerOperationTypeRefuse_returnBackMe.replace("{refuse}",H)+"'";Q+=",checked:"+(F==P?true:false);Q+='"></div></div>';F+=1}if(h("refusePassedToThisNodeOnNodeLabel",E)){Q+='<div id="refusePassedToThisNodeOnNodePane" class="refusePassedToThisNodeOnNode refuseNode" ';Q+=">";Q+='<div id="refusePassedToThisNodeOnNode" alertText="" key="refusePassedToThisNodeOnNode" data-dojo-type="mui/form/CheckBox"';Q+=" data-dojo-props=\"name:'refusePassedToThisNodeOnNode', value:'true', mul:false, text:'";Q+=lbpm.workitem.constant.handlerOperationTypeRefuse_returnBack.replace("{refuse}",H)+"'";Q+=",checked:"+(F==P?true:false);Q+='"></div></div>';F+=1}if(h("refusePassedToTheNodeLabel",E)){Q+='<div id="refusePassedToTheNodePane" class="refusePassedToTheNode refuseNode"';Q+=">";Q+='<div id="refusePassedToTheNode" alertText="" key="refusePassedToTheNode" data-dojo-type="mui/form/CheckBox"';Q+=" data-dojo-props=\"name:'refusePassedToTheNode', value:'true', mul:false, text:'";Q+=lbpm.workitem.constant.handlerOperationTypeRefuse_returnBackTheNode.replace("{refuse}",H)+"'";Q+=",checked:"+(F==P?true:false);if(F==0){G=true}Q+='"></div></div>';Q+='<div id="returnBackToNodeIdSelectObj" data-dojo-type="mui/form/Select" key="returnBackToNodeId" data-dojo-props="name:\'returnBackToNodeIdSelectObj\', value:\'\', mul:false" style="display:none"></div>';Q+='<div id="noReturnBackNodeLabel" style="display:none">'+lbpm.workitem.constant.noReturnBackNode+"</div>";F+=1}}var M=lbpm.globals.isPassedSubprocessNode();if(M){Q+="<div class='isRecoverPassedSubprocessLabel refuseNode'>";Q+='<div id="isRecoverPassedSubprocess" alertText="" key="isRecoverPassedSubprocess" data-dojo-type="mui/form/CheckBox"';Q+=" data-dojo-props=\"name:'isRecoverPassedSubprocess', value:'true', mul:false, text:'";Q+=lbpm.workitem.constant.handlerOperationTypeRefuse_abandonSubprocess.replace("{refuse}",H)+"'";Q+='"></div></div>'}var T=[];T=v(L,true);var ab=[];for(var V=0;V<L.length;V++){var Z=lbpm.nodes[L[V]];var Y=WorkFlow_getLangLabel(Z.name,Z.langs,"nodeName");var N=(lbpm.globals.lbpmIsRemoveNodeIdentifier()||lbpm.globals.lbpmIsHideAllNodeIdentifier())?Y:(Z.id+"."+Y);N+=T[Z.id];ab.push({text:N,value:L[V]})}g("#operationsTDContent").html(Q,{parseContent:true,onEnd:function(){var ad=this.inherited("onEnd",arguments);var ac=function(ai){var ak=l.byId("jumpToNodeIdSelectObj");ak.setStore(new p({data:ab}));if(G){var ak=l.byId("jumpToNodeIdSelectObj");ak.setStore(new p({data:ab}));if(!X&&Lbpm_SettingInfo&&Lbpm_SettingInfo.isRefuseToPrevNodeDefault=="true"){ak.set("value",L[L.length-1])}else{ak.set("value",L[W])}if(L.length==1){b(L[L.length-1])}lbpm.globals.buildSuperReturnBackToNodeIdSelectOption(ak)}if(!X&&Lbpm_SettingInfo&&Lbpm_SettingInfo.isRefuseToPrevNodeDefault=="true"){ak.set("value",L[L.length-1]);b(L[L.length-1])}else{ak.set("value",L[W]);b(L[W])}if(lbpm.rejectOptionsEnabled){var al=l.byId("refusePassedToSequenceFlowNode");var am=g(".refusePassedToSequenceFlowNode");var an=l.byId("refusePassedToThisNode");var ah=g("#refusePassedToThisNodePane");var ag=l.byId("refusePassedToThisNodeOnNode");var ae=g("#refusePassedToThisNodeOnNodePane");var af=l.byId("refusePassedToTheNode");var aj=g("#refusePassedToTheNodePane");lbpm.globals._isJumpNodeInJoin=aa(ak.value);if(!lbpm.globals._isJumpNodeInJoin){if(an){an.set("checked",false);ah.style("display","none")}if(ag){ag.set("checked",false);ae.style("display","none")}aj.style("display","")}if(al){al.watch("checked",function(ar,ap,at){if(at){if(an){an.set("checked",false)}if(ag){ag.set("checked",false)}if(af){af.set("checked",false)}}else{var ao=false;if(an&&an.checked){ao=true}if(ag&&ag.checked){ao=true}if(af&&af.checked){ao=true}if(!ao){al.set("checked",true)}}var aq=l.byId("isRecoverPassedSubprocess");if(aq){if(this.checked){aq.set("checked",false);g(".isRecoverPassedSubprocessLabel").style("display","")}else{aq.set("checked",false);g(".isRecoverPassedSubprocessLabel").style("display","none")}}})}if(an){an.watch("checked",function(ar,ap,at){if(at){if(ag){ag.set("checked",false)}if(af){af.set("checked",false)}if(al){al.set("checked",false)}}else{var ao=false;if(ag&&ag.checked){ao=true}if(af&&af.checked){ao=true}if(al&&al.checked){ao=true}if(!ao){an.set("checked",true)}}var aq=l.byId("isRecoverPassedSubprocess");if(aq){if(at){aq.set("checked",false);g(".isRecoverPassedSubprocessLabel").style("display","none")}else{aq.set("checked",false);g(".isRecoverPassedSubprocessLabel").style("display","")}}})}if(ag){ag.watch("checked",function(ar,ap,at){if(at){if(an){an.set("checked",false)}if(af){af.set("checked",false)}if(al){al.set("checked",false)}}else{var ao=false;if(an&&an.checked){falg=true}if(af&&af.checked){ao=true}if(al&&al.checked){ao=true}if(!ao){ag.set("checked",true)}}var aq=l.byId("isRecoverPassedSubprocess");if(aq){if(at){aq.set("checked",false);g(".isRecoverPassedSubprocessLabel").style("display","none")}else{aq.set("checked",false);g(".isRecoverPassedSubprocessLabel").style("display","")}}})}if(af){af.watch("checked",function(ar,ap,at){if(at){if(an){an.set("checked",false)}if(al){al.set("checked",false)}if(ag){ag.set("checked",false)}}else{var ao=false;if(an&&an.checked){ao=true}if(ag&&ag.checked){ao=true}if(al&&al.checked){ao=true}if(!ao){af.set("checked",true);return}}if(at){lbpm.globals.buildSuperReturnBackToNodeIdSelectOption(ak)}else{g("#returnBackToNodeIdSelectObj").style("display","none");g("#noReturnBackNodeLabel").style("display","none")}var aq=l.byId("isRecoverPassedSubprocess");if(aq){if(at){aq.set("checked",false);g(".isRecoverPassedSubprocessLabel").style("display","none")}else{aq.set("checked",false);g(".isRecoverPassedSubprocessLabel").style("display","")}}})}ak.on("attrmodified-value",function(ao){var ap=ao.detail.newValue;lbpm.globals._isJumpNodeInJoin=aa(ap);if(!lbpm.globals._isJumpNodeInJoin){if(an){an.set("checked",false);ag.set("checked",false)}if(af){af.set("checked",false);ah.style("display","none")}if(ae){ae.style("display","none")}if(aj){aj.style("display","")}}else{if(ag&&ag.checked!=true){ah.style("display","")}if(an&&an.checked!=true){ae.style("display","")}}if(af&&af.checked){if(al){al.set("checked",true)}else{if(an){an.set("checked",true)}else{if(ag){ag.set("checked",true)}}}af.set("checked",false)}if(M){if(!((an&&an.checked)||(ag&&ag.checked)||(af&&af.checked))){g(".isRecoverPassedSubprocessLabel").style("display","")}}b(ap)});if(M){if((an&&an.checked)||(ag&&ag.checked)||(af&&af.checked)){g(".isRecoverPassedSubprocessLabel").style("display","none")}}}else{ak.on("attrmodified-value",function(ao){var ap=ao.detail.newValue;b(ap)})}};if(this.parseDeferred){this.parseDeferred.then(ac)}}})}else{g("#operationsTDContent").html(lbpm.workitem.constant.noRefuseNode.replace("{refuse}",H).replace("{jump}",H)+'<input type="hidden" alertText="'+lbpm.workitem.constant.noRefuseNode.replace("{refuse}",H).replace("{jump}",H)+'" key="jumpToNodeId">');var S=i.create("div",{id:"noRefuseNodeEmptyDiv",style:"position:relative"});i.place(S,g("#operationsTDContent")[0],"last");var R='<div data-dojo-type=\'mui/form/Input\' data-dojo-props=\'"name":"jumpToNodeIdEmpty","showStatus":"edit","validate":"jumpToNodeRequired"\' id=\'jumpToNodeIdEmpty\' style=\'display:none;\'></div>';g("#noRefuseNodeEmptyDiv").html(R,{parseContent:true})}});lbpm.globals.hiddenObject(D,false)}function s(){var x=g("#operationsTDContent [name='jumpToNodeIdSelectObj']").val();if(x==null||x==""){q.warn({text:lbpm.workitem.constant.noRefuseNode.replace("{refuse}",lbpm.currentOperationName)});return false}if(lbpm.globals.isUsageContenRequired(lbpm.currentOperationType)){return lbpm.globals.validateMustSignYourSuggestion()}return true}function c(){var y=g("#operationsTDContent [name='jumpToNodeIdSelectObj']").val();var z=y.split(":");lbpm.globals.setOperationParameterJson(z[0],"jumpToNodeId","param");if(z.length>1){lbpm.globals.setOperationParameterJson(z[1],"jumpToNodeInstanceId","param")}else{lbpm.globals.setOperationParameterJson("","jumpToNodeInstanceId","param")}var D=l.byId("refusePassedToThisNode");if(D){lbpm.globals.setOperationParameterJson(D.checked,"refusePassedToThisNode","param")}else{lbpm.globals.setOperationParameterJson(false,"refusePassedToThisNode","param")}var C=l.byId("refusePassedToThisNodeOnNode");if(C){lbpm.globals.setOperationParameterJson(C.checked,"refusePassedToThisNodeOnNode","param")}else{lbpm.globals.setOperationParameterJson(false,"refusePassedToThisNodeOnNode","param")}var A=g("[name='trialStaffPeople']").val();lbpm.globals.setOperationParameterJson(A,"lbpmHandlerTriage","param");var B=l.byId("refusePassedToTheNode");if(B){lbpm.globals.setOperationParameterJson(B.checked,"refusePassedToTheNode","param");if(B.checked){lbpm.globals.setOperationParameterJson(l.byId("returnBackToNodeIdSelectObj").value,"returnBackToNodeId","param")}}else{lbpm.globals.setOperationParameterJson(false,"refusePassedToTheNode","param")}var x=l.byId("isRecoverPassedSubprocess");if(x){lbpm.globals.setOperationParameterJson(x.checked,"isRecoverPassedSubprocess","param")}}lbpm.globals.getHistoryPreviousNodeInfo=function(){var B=lbpm.globals.getAvailableHistoryRoute();var A=B.split(";");for(var z=A.length-1;z>=0;z--){var x=A[z].split(":");var y=lbpm.nodes[x[0]];if(lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_START,y)||lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_END,y)||lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_AUTOBRANCH,y)||lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_MANUALBRANCH,y)||lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_SEND,y)){continue}if(y.id==lbpm.nowNodeId){continue}return A[z]}};lbpm.globals.getAvailableHistoryRoute=function(){var A=document.getElementById("sysWfBusinessForm.fdTranProcessXML");var z=WorkFlow_GetStatusObjectByXML(A.value);for(var y=0;y<z.runningNodes.length;y++){var x=z.runningNodes[y];if(x.id==lbpm.nowNodeId){return x.routePath}}return""};lbpm.globals.buildSuperReturnBackToNodeIdSelectOption=function(E){if(E==null){E=l.byId("jumpToNodeIdSelectObj")}var A=E.store.data;var B=E.value;var x=a(lbpm.globals.getNodeObj(B));var D=[];for(var y=0;y<A.length;y++){var z=lbpm.globals.getNodeObj(A[y].value);if(!u(x,z)){continue}D.push({text:A[y].text,value:A[y].value})}if(u(x,lbpm.globals.getNodeObj(lbpm.nowNodeId))){D.push({text:lbpm.workitem.constant.thisNode,value:lbpm.nowNodeId})}var C=l.byId("returnBackToNodeIdSelectObj");C.setStore(new p({data:D}));if(D.length==0){C.set("value","");g("#returnBackToNodeIdSelectObj").style("display","none");g("#noReturnBackNodeLabel").style("display","")}else{C.set("value",D[0].value);g("#returnBackToNodeIdSelectObj").style("display","");g("#noReturnBackNodeLabel").style("display","none")}};function a(y){var x=[];x=n(y,x);return x}function n(B,x){var A=lbpm.globals.getNextNodeObjs(B.id);for(var z=0;z<A.length;z++){var y=A[z];if(lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_END,y)){continue}if(u(x,y)){continue}x.push(y);if(y.id==lbpm.nowNodeId){continue}if(lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_SPLIT,y)){y=lbpm.globals.getNodeObj(y.relatedNodeIds);x.push(y)}n(y,x)}return x}function u(x,y){for(var z=0;z<x.length;z++){if(y.id==x[z].id){return true}}return false}function h(z,x){if(!x||x.length==0){return true}for(var y=0;y<x.length;y++){if(z==x[y]){return true}}return false}function v(C,z){var y=[];if(z){var x=[];$.each(C,function(F,G){var E=lbpm.nodes[G];if(E.handlerIds){x.push({nodeId:E.id,handlerIds:E.handlerIds,handlerSelectType:E.handlerSelectType,distinct:false})}});y=f(x)}for(var B=0;B<C.length;B++){var D=y[C[B]];if(D==null||D==""){var A=lbpm.nodes[C[B]];if(A.handlerNames!=null&&A.handlerSelectType=="org"){y[C[B]]="("+A.handlerNames+")"}else{if(A.handlerSelectType!=null){y[C[B]]="("+lbpm.workitem.constant.COMMONLABELFORMULASHOW+")"}else{y[C[B]]=""}}}else{y[C[B]]="("+D+")"}}return y}function f(y){var x=[];if(y&&y.length>0){var A="lbpmHandlerParseService&modelId="+lbpm.globals.getWfBusinessFormModelId()+"&modelName="+lbpm.globals.getWfBusinessFormModelName();for(var B=0;B<y.length;B++){var C=y[B];if(!C.handlerIds){continue}A+="&nodeId="+C.nodeId;A+="&handlerIds="+encodeURIComponent(C.handlerIds);A+="&isFormula="+(C.handlerSelectType=="formula"?"true":"false");A+="&isMatrix="+(C.handlerSelectType=="matrix"?"true":"false");A+="&isRule="+(C.handlerSelectType=="rule"?"true":"false");A+="&distinct="+(C.distinct?"true":"false")}var D=new KMSSData();var E=D.AddBeanData(A).GetHashMapArray();if(E&&E.length>0){for(var z=0;z<E.length;z++){x[E[z].nodeId]=lbpm.globals.htmlUnEscape(E[z].name)}}}return x}function t(A){var x="lbpmHandlerTriageService&modelId="+lbpm.modelId+"&fdFactId="+A;var z=[];var y=new KMSSData();z=y.AddBeanData(x).GetHashMapArray();return z}function b(A){var C=l.byId("mobile_controls_trialStaffPeople");if(C){C.destroy()}var z=WorkFlow_LoadXMLData(lbpm.globals.getProcessXmlString());if(lbpm.workitem.constant.isRefuseSelectPeople=="true"&&z&&z.refuseSelectPeople&&z.refuseSelectPeople=="true"){var E=t(A);var x="&quot;store&quot;:[";if(E.length>0){for(var B=0;B<E.length;B++){if(B==0){x+="{&quot;text&quot;:&quot;"+E[B].handlerName+"&quot;,&quot;value&quot;:&quot;"+E[B].handlerId+"&quot;}"}else{x+=",{&quot;text&quot;:&quot;"+E[B].handlerName+"&quot;,&quot;value&quot;:&quot;"+E[B].handlerId+"&quot;}"}}}x+="],";var F="&quot;name&quot;:&quot;trialStaffPeople&quot;,"+x+"&quot;mul&quot;:true,&quot;showPleaseSelect&quot;:true,&quot;leastNItem&quot;:null,&quot;showStatus&quot;:&quot;edit&quot;,&quot;subject&quot;:&quot;"+lbpm.workitem.constant.refuseSelectPeopleMessage+"&quot;,&quot;orient&quot;:&quot;none&quot;,&quot;onValueChange&quot;:&quot;__xformDispatch&quot;";var D='<xformflag id="_xform_trialStaffPeople" _xform_type="fSelect"><div data-dojo-type="sys/xform/mobile/controls/fSelect/FSelect" data-dojo-props="'+F+'" class="oldMui muiFormEleWrap popup muiFormStatusEdit muiFormRight showTitle trialStaffPeople" style="width:100%;margin-top:4px;" id="mobile_controls_trialStaffPeople"></div></xformflag>';var y=lbpm.nodes[A];if(y.processType&&y.processType=="2"){g("#_super_triageHandler").html(D,{parseContent:true})}else{g("#_super_triageHandler").html("")}}}})},"sys/lbpmservice/mobile/freeflow/freeflowNodeType":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/query","dojo/dom-attr","dojo/dom-construct","dojo/topic","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm"],function(c,g,h,i,a,b,f){var d=c("sys.lbpmservice.mobile.freeflow.freeflowNodeType",[g],{nodeType:"reviewNode",buildRendering:function(){this.inherited(arguments);this.contentNode=a.create("div",{className:"muiFreeflowNodeTypeWarp"},this.domNode);a.create("div",{className:"muiFreeflowNodeTypeTitle",innerHTML:f["mui.freeFlow.lbpm.nodeType."+this.nodeType]},this.contentNode);var k=a.create("ul",{className:"muiFreeflowNodeTypeList"},this.contentNode);var j=(k.offsetWidth-20)/3/200*132;var l=a.create("li",{className:"muiFreeflowNodeTypeli muiFreeflowNodeTypeDefault",style:{height:j+"px"}},k);a.create("div",{"data-value":3},l);l=a.create("li",{className:"muiFreeflowNodeTypeli muiFreeflowNodeTypeSerial",style:{height:j+"px"}},k);a.create("div",{"data-value":0},l);l=a.create("li",{className:"muiFreeflowNodeTypeli muiFreeflowNodeTypeSplit",style:{height:j+"px"}},k);a.create("div",{"data-value":1},l);a.create("div",{className:"muiFreeflowNodeTypeSplitDiv"},this.contentNode);this.cancelNode=a.create("div",{className:"muiFreeflowNodeTypeCancel",innerHTML:f["mui.freeFlow.cancel"]},this.contentNode);this.bindEvent()},bindEvent:function(){this.connect(this.cancelNode,"click",function(k){b.publish("/sys/lbpmservice/freeflow/nodeTypeCancel")});var j=this;h(".muiFreeflowNodeTypeli div",this.domNode).on("click",function(k){var m=new Date().getTime();var l=this.ctime;if(l!="undefined"&&(m-l<500)){return false}this.ctime=m;var p=k.target;var n=i.get(p,"data-value");b.publish("/sys/lbpmservice/freeflow/nodeTypeSelect",n)})},postCreate:function(){this.inherited(arguments)}});return d})},"sys/lbpmservice/mobile/operation/handler/operation_handler_assigncancel":function(){define(["dojo/query","dijit/registry","dojo/store/Memory","mui/dialog/Tip"],function(h,d,i,g){var c={};var f=function(j){lbpm.globals.getOperationParameterJson("relationWorkitemId:relations",true);var k=document.getElementById("operationsRow");var q=getCurrAssignRelationInfo();if(q.length>0){var n=document.getElementById("operationsTDTitle");n.innerHTML=lbpm.constant.opt.Assignee;var m='<div data-dojo-type="mui/form/CheckBoxGroup" id="WorkFlow_CancelAssignWorkitemsGroup" data-dojo-props="name:\'WorkFlow_CancelAssignWorkitemsGroup\',validate:\'assignCancelHandlerRequired required\',required:true"></div>';var p=[];for(var l=0;l<q.length;l++){p.push({value:q[l].itemId,text:q[l].userName})}h("#operationsTDContent").html(m,{parseContent:true,onEnd:function(){this.inherited("onEnd",arguments);if(this.parseDeferred){this.parseDeferred.then(function(){var r=d.byId("WorkFlow_CancelAssignWorkitemsGroup");r.setStore(new i({data:p}))})}}});lbpm.globals.hiddenObject(k,false)}else{lbpm.globals.hiddenObject(k,true)}};var a=function(){var k=dijit.registry.byId("WorkFlow_CancelAssignWorkitemsGroup");var j=k.get("value");if(j==null||j==""){g.warn({text:lbpm.constant.opt.AssignNeedSelectCanceler});return false}if(lbpm.globals.isUsageContenRequired(lbpm.currentOperationType)){return lbpm.globals.validateMustSignYourSuggestion()}return true};var b=function(){var l=dijit.registry.byId("WorkFlow_CancelAssignWorkitemsGroup");var k=l.get("value");lbpm.globals.setOperationParameterJson(k,"cancelAssigneeIds","param");var j="";h("[name='_WorkFlow_CancelAssignWorkitemsGroup_single']").forEach(function(n,m){if(j==""){j=n.value}else{j+=";"+n.value}});lbpm.globals.setOperationParameterJson(j,"allAssigneeIds","param")};c.handler_assignCancel=lbpm.operations.handler_assignCancel={click:f,check:a,setOperationParam:b};c.init=function(){};return c})},"sys/lbpmservice/mobile/operation/branchadmin/operation_branchadmin_startconcurrentbranch":function(){define(["dijit/registry","mui/form/Address","dojo/query","sys/lbpmservice/mobile/common/syslbpmprocess","dojo/store/Memory","mui/dialog/Tip","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm","mui/i18n/_i18n!sys/lbpmservice/mobile/sys-lbpm"],function(a,c,g,d,f,h,j,i){var b={};b.branchadmin_startconcurrentbranch={click:function(p){var n=p?p.curTask:"";var v=g("td[id='operationsTDTitle']")[0];var m=g("td[id='operationsTDContent']")[0];var s=v.parentNode;v.innerHTML=j["lbpmNode.processingNode.operationsTDTitle.restartconbranch"];var t="";if(!window.isInitLbpmNode){lbpm.globals.parseXMLObj()}if(!lbpm.nodes||lbpm.nodes.length==0||!n){return}else{window.isInitLbpmNode=true}var k=this.getSplitNode(lbpm.nodes[n.nodeId]);var l=[];var u=new KMSSData();u.AddBeanData("getConBranchStatusService&type=startConcurrent&splitNode="+k.id+"&processId="+lbpm.modelId);var r=u.GetHashMapArray();var t="";for(var q=0;q<r.length;q++){l.push({value:r[q].id,text:r[q].name})}var t='<div data-dojo-type="mui/form/CheckBoxGroup" id="restartConbranchsGroup" data-dojo-props="validate:\'restartConbranchRequired required\',required:true,name:\'restartConbranchsGroup\'"></div>';if(l.length>0){g("td[id='operationsTDContent']").html(t,{parseContent:true,onEnd:function(){this.inherited("onEnd",arguments);if(this.parseDeferred){this.parseDeferred.then(function(){var w=a.byId("restartConbranchsGroup");w.setStore(new f({data:l}))})}}})}else{g("#operationsTDContent").html("无可启动的分支")}lbpm.globals.hiddenObject(s,false)},getSplitNode:function(p){for(var n=0;n<p.startLines.length;n++){var m=p.startLines[n];var l=m.startNode;if(!l){continue}if(l.XMLNODENAME=="splitNode"){if(window.routeJoinNodeRelatedNodeIds&&window.routeJoinNodeRelatedNodeIds.indexOf(l.id)!=-1){var k=this.getSplitNode(l);if(k==null){continue}else{return k}}else{return l}}else{if(l.XMLNODENAME=="joinNode"){if(!window.routeJoinNodeRelatedNodeIds){window.routeJoinNodeRelatedNodeIds=[]}if(window.routeJoinNodeRelatedNodeIds.indexOf(l.relatedNodeIds)==-1){window.routeJoinNodeRelatedNodeIds.push(l.relatedNodeIds)}}var k=this.getSplitNode(l);if(k==null){continue}else{return k}}}return null},check:function(){var k=a.byId("restartConbranchsGroup");if(!k){h.warn({text:i["lbpmProcess.joinnode.conbranch.restartbranch.check"]});return false}var l=k.get("value");if(l==null||l==""){h.warn({text:i["lbpmProcess.joinnode.conbranch.restartbranch.check"]});return false}return true},setOperationParam:function(m){var k=a.byId("restartConbranchsGroup");var l=k.get("value");m.restartConbranchs=l}};b.init=function(){};return b})},"sys/lbpmservice/mobile/workitem/CommonUsageItemListMixin":function(){define(["dojo/_base/declare","mui/list/_TemplateItemListMixin","sys/lbpmservice/mobile/workitem/CommonUsageItemMixin"],function(b,c,a){return b("sys.lbpmservice.mobile.workitem.CommonUsageItemListMixin",[c],{itemTemplateString:null,itemRenderer:a})})},"sys/lbpmservice/mobile/freeflow/freeflow":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/topic","dijit/registry","dojo/ready","mui/util","mui/form/Address","dojo/query","dojo/request","mui/dialog/Tip","dojo/dom-style","dojo/NodeList-dom","dojo/NodeList-html","dojo/domReady!"],function(b,i,d,a,k,f,g,j,c,m,h){lbpm.globals.canAddOtherNode=function(n){if(lbpm.freeFlow.isCanAddOtherNode&&lbpm.freeFlow.nextNodes){if(lbpm.freeFlow.nextNodes.length==0){this.getNextFreeFlowNodes(lbpm.nowNodeId)}if(Com_ArrayGetIndex(lbpm.freeFlow.nextNodes,n)==-1){return false}}return true};lbpm.globals.getNextFreeFlowNodes=function(r){if(Com_ArrayGetIndex(lbpm.freeFlow.nextNodes,r)==-1){lbpm.freeFlow.nextNodes.push(r)}var q=lbpm.globals.getNodeObj(r);for(var p=0;p<q.endLines.length;p++){var n=q.endLines[p].endNode;if(n.XMLNODENAME!="endNode"&&n.XMLNODENAME!="joinNode"){this.getNextFreeFlowNodes(n.id)}else{if(n.XMLNODENAME=="joinNode"&&Com_ArrayGetIndex(lbpm.freeFlow.nextNodes,n.relatedNodeIds)>-1){this.getNextFreeFlowNodes(n.id)}}}};lbpm.globals.saveOrUpdateFreeflowVersion=function(){var n=f.formatUrl("/sys/lbpmservice/support/lbpmFreeflowVersionAction.do?method=saveOrUpdateFreeflowVersion");var p={fdProcessId:lbpm.modelId};c.post(n,{handleAs:"json",sync:false,data:p}).then(function(q){if(q){lbpm.freeFlow.editTime=new Date()}})};lbpm.globals.isCanEdit=function(){var q=true;if(lbpm.freeFlow.editTime){var n=parseInt(Lbpm_SettingInfo.freezeFreeFlowTime);if(new Date()-lbpm.freeFlow.editTime<n*60*1000){return q}}var p=f.formatUrl("/sys/lbpmservice/support/lbpmFreeflowVersionAction.do?method=isCanEdit");var r={fdProcessId:lbpm.modelId};c.post(p,{handleAs:"json",sync:true,data:r}).then(function(v){if(v){q=v.isCanEdit;if(q){if(v.needCheck){var w=XML_CreateByContent(lbpm.globals.getProcessXmlString());var z=(w.xml||new XMLSerializer().serializeToString(w));var u=null;var y=new KMSSData();y.UseCache=false;y.AddBeanData("lbpmProcessDefinitionDetailService&processId="+lbpm.globals.getWfBusinessFormModelId());var s=y.GetHashMapArray();if(s&&s.length>0){if(s[0]["key0"]){processXml=s[0]["key0"];u=XML_CreateByContent(processXml)}}var t=(u.xml||new XMLSerializer().serializeToString(u));if(t!=z){q=false;var x=m.warn({text:v.msg});h.set(x.textNode,"-webkit-line-clamp","inherit");h.set(j("span",x.containerNode)[0],"-webkit-line-clamp","inherit")}}}else{if(v.msg){var x=m.warn({text:v.msg});h.set(x.textNode,"-webkit-line-clamp","inherit");h.set(j("span",x.containerNode)[0],"-webkit-line-clamp","inherit")}}}});return q};Com_Parameter.event.confirm.push(function(){var n=f.formatUrl("/sys/lbpmservice/support/lbpmFreeflowVersionAction.do?method=deleteVersionOnConfirm");var p={fdProcessId:lbpm.modelId};c.post(n,{handleAs:"json",sync:true,data:p}).then(function(q){if(q){}});return true});Com_Parameter.event.submit.push(function(){if(lbpm.isFreeFlow){return lbpm.globals.isCanEdit()}return true});var l={};l.init=function(){var n=$("input[name='sysWfBusinessForm.fdIsModify']")[0];if(n==null||n.value!="1"){var q=lbpm.globals.getProcessXmlString();document.getElementsByName("sysWfBusinessForm.fdFlowContent")[0].value=q}var p=WorkFlow_LoadXMLData(lbpm.globals.getProcessXmlString());if(p&&p.isCanAddOtherNode&&p.isCanAddOtherNode=="true"){lbpm.freeFlow.isCanAddOtherNode=true}else{lbpm.freeFlow.isCanAddOtherNode=false}setTimeout(function(){lbpm.flow_chart_load_Frame();lbpm.myAddedNodes=new Array();var r='<div data-dojo-type="sys/lbpmservice/mobile/freeflow/freeflowNodes" data-dojo-props="validate:\'freeflowNodes\'"></div>';var s=j("#freeFlowNodeDIV");s.html(r,{parseContent:true})},0)};return l})},"sys/lbpmservice/mobile/node/joinnode/operation_handler_confirmconbranch":function(){define(["dojo/query","dijit/registry"],function(g,c){function f(i){}function a(i){return true}function b(){}function h(){}var d={};d.handler_confirmconbranch=lbpm.operations.handler_confirmconbranch={click:f,check:a,blur:h,setOperationParam:b};d.init=function(){};return d})},"sys/lbpmservice/mobile/workitem/NextAdHocRoutes":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/query","dojo/_base/array","dojo/dom-class","dojo/dom-construct","dojo/dom-style","mui/form/RadioGroup","mui/form/Radio","mui/util","dijit/registry"],function(f,c,k,j,l,d,i,h,b,g,a){var m=f("sys.lbpmservice.mobile.workitem.AdHocRouteRadio",[b],{rightText:null,handlerIds:null,handlerSelectType:null,buildRendering:function(){this.inherited(arguments);if(this.rightText!=null&&this.rightText!="none"){var p=this.rightText=="";var n=this;var q=function(s){var t=n.rightText="",r=s.GetHashMapArray();if(r.length>0){j.forEach(r,function(u){t=t+";"+u.name});if(t!=""){t=t.substring(1)}}n.rightTextNode=d.create("div",{className:p?"handlerNamesLabel noHandlerNamesLabel":"handlerNamesLabel",innerHTML:p?"(未设置)":"("+g.formatText(t)+")",id:"handlerShowNames["+n.index+"]"},n.fieldOptions,"last")};if(this.handlerSelectType=="formula"){lbpm.globals.formulaNextNodeHandler(this.handlerIds,true,this.distinct,q)}else{if(this.handlerSelectType=="matrix"){lbpm.globals.matrixNextNodeHandler(this.handlerIds,true,this.distinct,q)}else{if(this.handlerSelectType=="rule"){lbpm.globals.ruleNextNodeHandler(this.value,this.handlerIds,true,this.distinct,q)}else{lbpm.globals.parseNextNodeHandler(this.handlerIds,true,this.distinct,q)}}}}},_onClick:function(){if(!this.__checkFlag){this.__checkFlag=true;this.inherited(arguments);this.__checkFlag=false}},_setCheckedAttr:function(n){this.inherited(arguments)}});lbpm.globals.parseNextNodeHandler=function(t,q,s,v){if(t==""||t==null){return[{name:lbpm.constant.COMMONNODEHANDLERORGEMPTY}]}t=encodeURIComponent(t);var n="&modelId="+lbpm.globals.getWfBusinessFormModelId();var r=document.getElementsByName("rolesSelectObj");if(r!=null&&r.length>0){n+="&drafterId="+r[0].value}var p="lbpmHandlerParseService&handlerIds="+t+n+"&analysis4View="+q;if(s){p+="&distinct=true"}var u=new KMSSData();if(v){u.SendToBean(p,v)}else{return u.AddBeanData(p).GetHashMapArray()}};lbpm.globals.formulaNextNodeHandler=function(v,q,s,u){if(v==""||v==null){return[{name:"("+lbpm.constant.COMMONNODEHANDLERORGEMPTY+")"}]}v=encodeURIComponent(v);var n="&modelId="+lbpm.globals.getWfBusinessFormModelId()+"&modelName="+lbpm.globals.getWfBusinessFormModelName();var r=document.getElementsByName("rolesSelectObj");if(r!=null&&r.length>0){n+="&drafterId="+r[0].value}var p="lbpmHandlerParseService&formula="+v+n+"&analysis4View="+q;if(s){p+="&distinct=true"}var t=new KMSSData();if(u){t.SendToBean(p,u)}else{return t.AddBeanData(p).GetHashMapArray()}};lbpm.globals.matrixNextNodeHandler=function(p,r,t,v){if(p==""||p==null){return[{name:"("+lbpm.constant.COMMONNODEHANDLERORGEMPTY+")"}]}p=encodeURIComponent(p);var n="&modelId="+lbpm.globals.getWfBusinessFormModelId()+"&modelName="+lbpm.globals.getWfBusinessFormModelName();var s=document.getElementsByName("rolesSelectObj");if(s!=null&&s.length>0){n+="&drafterId="+s[0].value}var q="lbpmHandlerParseService&matrix="+p+n+"&analysis4View="+r;if(t){q+="&distinct=true"}var u=new KMSSData();if(v){u.SendToBean(q,v)}else{return u.AddBeanData(q).GetHashMapArray()}};lbpm.globals.ruleNextNodeHandler=function(p,v,w,r,q){if(v==""||v==null){return[{name:"("+lbpm.constant.COMMONNODEHANDLERORGEMPTY+")"}]}v=encodeURIComponent(v);var t="&modelId="+lbpm.globals.getWfBusinessFormModelId()+"&modelName="+lbpm.globals.getWfBusinessFormModelName();var u=document.getElementsByName("rolesSelectObj");if(u!=null&&u.length>0){t+="&drafterId="+u[0].value}var n="lbpmHandlerParseService&nowNodeId="+p+"&rule="+v+t+"&analysis4View="+w;if(r){n+="&distinct=true"}var s=new KMSSData();if(q){s.SendToBean(n,q)}else{return s.AddBeanData(n).GetHashMapArray()}};return f("sys.lbpmservice.mobile.workitem.NextAdHocRoutes",[h],{name:"nextAdHocRoutes",tmpl:"<input type=\"radio\" id=\"nextAdHocRouteId[!{index}]\" data-dojo-type=\"sys.lbpmservice.mobile.workitem.AdHocRouteRadio\" key=\"nextAdHocRouteId\" index=\"!{index}\"data-dojo-props=\"checked:!{checked},showStatus:'edit',name:'!{name}',text:'!{text}',value:'!{value}',rightText:'!{rightText}',index:'!{index}',handlerSelectType:'!{handlerSelectType}',distinct:!{distinct},handlerIds:'!{handlerIds}'\">",onComplete:function(p){var q=this.generateList(p);var n=this;if(q&&q.then){q.then(function(){if(p&&p.length==1){k(".muiFieldText",n.domNode).style({"margin-left":"0","padding-left":"5px"});k(".muiFormRadio",n.domNode).style("display","none");k(".muiRadioCircle",n.domNode).style("display","none")}})}},startup:function(){var n=this;var r=false;if(Lbpm_SettingInfo.isRemoveNodeIdentifier==="true"){r=true}var t=[];for(var p=0;p<lbpm.adHocRoutes.length;p++){if(lbpm.adHocRouteId!=null&&lbpm.adHocRouteId==lbpm.adHocRoutes[p].startNodeId){continue}var s=lbpm.adHocSubFlowNodeInfo[lbpm.nowAdHocSubFlowNodeId].adHocSubNodes[lbpm.adHocRoutes[p].startNodeId];var q=s.data;t.push(q)}t.push(lbpm.nodes[lbpm.nowAdHocSubFlowNodeId].endLines[0].endNode);if(t.length==1){this.set("value",lbpm.nodes[lbpm.nowAdHocSubFlowNodeId].endLines[0].endNode.id)}this.store=j.map(t,function(x,u){var w=WorkFlow_getLangLabel(x.name,x.langs,"nodeName");var v="";if(r){v=w}else{v=x.id+"."+w}return{text:g.formatText(v),checked:n.value==x.id,value:x.id,index:u,rightText:x.handlerNames==null?"none":g.formatText(x.handlerNames),handlerIds:x.handlerIds==null?"none":g.formatText(x.handlerIds),distinct:false,handlerSelectType:x.handlerSelectType,name:"nextAdHocRouteId"}});this.inherited(arguments)},createListItem:function(p){if(this.isConcentrate(p)){return null}var n=this.tmpl.replace("!{value}",p.value).replace("!{text}",p.text.replace(/&#39;/g,"\\'").replace(/\$/g,"$$$")).replace(/!{index}/g,p.index).replace("!{checked}",p.checked?true:false).replace("!{distinct}",p.distinct).replace("!{handlerIds}",p.handlerIds.replace(/\$/g,"$$$")).replace("!{handlerSelectType}",p.handlerSelectType).replace("!{name}",p.name).replace("!{rightText}",p.rightText);var q=d.toDom(n);return q}})})},"sys/lbpmservice/mobile/workitem/workitem_common_generatenextroute":function(){define(["dojo/query","dijit/registry","dojo/_base/array","sys/lbpmservice/mobile/common/syslbpmprocess"],function(g,b,h,d){var c={};function f(j,p){var k="";if(j.currNodeNextHandlersId&&p.processType==lbpm.constant.PROCESSTYPE_SERIAL){var n=WorkFlow_getLangLabel(p.name,p.langs,"nodeName");var m=c.resolveNodeIdentifier(p.id,n);k='<div class="lbpmNextRouteInfoRow "><div id="nextNodeName">'+m+"</div>";k+='<input type="hidden" id="handlerIds" name="handlerIds" value="'+j.currNodeNextHandlersId+'">';k+='<input type="hidden" id="handlerNames" name="handlerNames" readonly class="inputSgl" onChange="lbpm.globals.setHandlerInfoes();" value="'+Com_HtmlEscape(j.currNodeNextHandlersName)+'">';k+='<div id="handlerShowNames" class=handlerNamesLabel nodeId="'+p.id+'">('+Com_HtmlEscape(j.currNodeNextHandlersName.replace(/;/g,"; "))+")</div></div>"}else{if(j.toRefuseThisNodeId&&lbpm.globals.getNodeObj(j.toRefuseThisNodeId)){k=lbpm.globals.generateRefuseThisNodeIdInfo(j.toRefuseThisNodeId,j.toRefuseThisHandlerIds,j.toRefuseThisHandlerNames,j.currNodeNextHandlersId,j.currNodeNextHandlersName)}else{var q=lbpm.globals.getNextNodeObj(lbpm.nowNodeId);var i=lbpm.nodedescs[q.nodeDescType].getLines(lbpm.globals.getCurrentNodeObj(),q,true);if(q.nodeDescType=="splitNodeDesc"||q.nodeDescType=="autoBranchNodeDesc"){var l=new Array();lbpm.globals.getThroughNodes(function(u){var r=lbpm.globals.getIdsByNodes(u)+",";for(var t=0;t<i.length;t++){var s=i[t].startNodeId+","+i[t].endNodeId+",";if(r.indexOf(s)>-1){l.push(i[t])}}},null,null,false);i=l;if(q.nodeDescType=="autoBranchNodeDesc"&&l.length!=1){i=lbpm.nodedescs[q.nodeDescType].getLines(lbpm.globals.getCurrentNodeObj(),q,false)}}if(q.nodeDescType=="groupEndNodeDesc"&&q.groupNodeType!="freeSubFlowNode"){i=lbpm.nodes[q.groupNodeId].endLines}k=lbpm.globals.getNextRouteInfo(i);if(lbpm.nodes[lbpm.nowNodeId].groupNodeId!=null&&lbpm.nodes[lbpm.nowNodeId].groupNodeType=="adHocSubFlowNode"&&q.nodeDescType=="groupEndNodeDesc"){lbpm.nowAdHocSubFlowNodeId=lbpm.nodes[lbpm.nowNodeId].groupNodeId;lbpm.adHocRouteId=lbpm.nodes[lbpm.nowNodeId].routeId;k=lbpm.globals.getNextAdHocSubFlowRouteInfo()}else{if(q.nodeDescType=="adHocSubFlowNodeDesc"){lbpm.nowAdHocSubFlowNodeId=q.id;lbpm.adHocRouteId=null;k=lbpm.globals.getNextAdHocSubFlowRouteInfo()}}}}return k}lbpm.globals.getAutoNextInfo=function(){var i=document.getElementById("nextNodeTD");if(i!=null){lbpm.globals.generateNextNodeInfo(function(j){lbpm.globals.innerHTMLGenerateNextNodeInfo(j,i);lbpm.globals.hiddenObject(i.parentNode,false);if(Lbpm_SettingInfo.isHideOperationsRow=="true"&&lbpm.canHideNextNodeTr){lbpm.globals.hiddenObject(i.parentNode,true)}})}};c.generateNextNodeInfo=lbpm.globals.generateNextNodeInfo=function(p){if(lbpm.nowProcessorInfoObj.lbpm_nextHandlerName!=null&&lbpm.nowProcessorInfoObj.lbpm_nextHandlerNameId!=null&&lbpm.nowProcessorInfoObj.lbpm_nextNodeId!=null){var l=lbpm.nodes[lbpm.nowProcessorInfoObj.lbpm_nextNodeId];var j=lbpm.nowProcessorInfoObj.lbpm_nextHandlerName;var m=WorkFlow_getLangLabel(l.name,l.langs,"nodeName");var k=c.resolveNodeIdentifier(l.id,m);html='<label id="nextNodeName"><b>'+k+"</b></label>";html+='<input type="hidden" id="handlerIds" name="handlerIds" value="'+lbpm.nowProcessorInfoObj.lbpm_nextHandlerNameId+'">';html+='<input type="hidden" id="handlerNames" name="handlerNames" readonly class="inputSgl" onChange="lbpm.globals.setHandlerInfoes();" value="'+Com_HtmlEscape(j)+'">';html+='<label id="handlerShowNames" class=handlerNamesLabel nodeId="'+l.id+'">('+Com_HtmlEscape(j.replace(/;/g,"; "))+")</label>";return html}var n=lbpm.nodes[lbpm.nowNodeId];if(p){lbpm.globals.getOperationParameterJson("currNodeNextHandlersId:currNodeNextHandlersName:toRefuseThisNodeId:toRefuseThisHandlerIds:toRefuseThisHandlerNames:futureNodeId",null,null,function(q){p(f(q,n))});return}var i=lbpm.globals.getOperationParameterJson("currNodeNextHandlersId:currNodeNextHandlersName:toRefuseThisNodeId:toRefuseThisHandlerIds:toRefuseThisHandlerNames:futureNodeId");return f(i,n)};function a(p,i){var n="";var m;var k="";if(p.handlerSelectType){if(p.handlerSelectType=="formula"){m=lbpm.globals.formulaNextNodeHandler(i,true,lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_SEND,p),undefined,p.id)}else{if(p.handlerSelectType=="matrix"){m=lbpm.globals.matrixNextNodeHandler(i,true,lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_SEND,p),undefined,p.id)}else{if(p.handlerSelectType=="rule"){m=lbpm.globals.ruleNextNodeHandler(p.id,i,true,lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_SEND,p))}else{m=lbpm.globals.parseNextNodeHandler(i,true,lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_SEND,p),undefined,p.id)}}}for(var l=0;l<m.length;l++){if(k==""){k=m[l].name}else{k+=";"+m[l].name}}}if(k==""&&p.handlerIds!=null){k=lbpm.constant.COMMONNODEHANDLERORGNULL}n+=(k.replace(/;/g,"; "));return n}c.generateRefuseThisNodeIdInfo=lbpm.globals.generateRefuseThisNodeIdInfo=function(i,p,n,s,l){var j=lbpm.globals.getNodeObj(i);var r=p||"";var k=n||"";if(r){if(r!="_onNode"&&r!="_onTheNode"){if(j.processType==lbpm.constant.PROCESSTYPE_SERIAL||j.processType==lbpm.constant.PROCESSTYPE_SINGLE){r=r.split(";")[0];k=k.split(";")[0]}}else{if(j.processType==lbpm.constant.PROCESSTYPE_SERIAL){r=j.handlerIds.split(";")[0];k=a(j,j.handlerIds.split(";")[0])}else{r=j.handlerIds;k=a(j,j.handlerIds)}}}else{if(s!=null){j=lbpm.globals.getCurrentNodeObj();r=s;k=l}}var q=WorkFlow_getLangLabel(j.name,j.langs,"nodeName");var m=c.resolveNodeIdentifier(j.id,q);html="<label id='nextNodeName[0]'><b>"+m+"</b></label>";html+="<input type='hidden' id='handlerIds[0]' name='handlerIds[0]' value='"+r+"'>";html+="<input type='hidden' id='handlerNames[0]' name='handlerNames[0]' readonly class='inputSgl' onChange='lbpm.globals.setHandlerInfoes();' value='"+Com_HtmlEscape(k)+"'>";html+="<label id='handlerShowNames[0]' nodeId='"+j.id+"'>("+Com_HtmlEscape(k.replace(/;/g,"; "))+")</label>";return html};c.setFutureHandlerFormulaDialog=lbpm.globals.setFutureHandlerFormulaDialog=function(k,j,i){var l=function(m){lbpm.globals.afterChangeFurtureHandlerInfoes(m,lbpm.constant.ADDRESS_SELECT_FORMULA)};lbpm.globals.setHandlerFormulaDialog_(k,j,i,l)};c.showFutureNodeSelectedLink=lbpm.globals.showFutureNodeSelectedLink=function(j){var k=j.getAttribute("index");$("#operationsTDContent, #nextNodeTD").find(".divselect").each(function(){var i=$(this);if(i.attr("index")==k){i.show()}else{i.hide()}});var n=j.parentNode.parentNode.getElementsByTagName("a");for(var m=0;m<n.length;m++){var l=n[m];if(l.getAttribute("index")!=null){if(l.getAttribute("index")==j.getAttribute("index")){l.parentNode.style.display=""}else{l.parentNode.style.display="none"}}}lbpm.events.fireListener(lbpm.constant.EVENT_SELECTEDFUTURENODE,null)};c.innerHTMLGenerateNextNodeInfo=lbpm.globals.innerHTMLGenerateNextNodeInfo=function(j,k,i){if(lbpm.globals.destroyOperations){lbpm.globals.destroyOperations()}g(k).forEach(function(l){h.forEach(b.findWidgets(l),function(m){m.destroy&&!m._destroyed&&m.destroy()})}).html(j,{parseContent:true,onEnd:function(){this.inherited("onEnd",arguments);if(this.parseDeferred&&i){this.parseDeferred.then(i)}}})};c.getNextRouteInfo=lbpm.globals.getNextRouteInfo=function(s){if(s.length==1){lbpm.canHideNextNodeTr=true}var j="";if(s.length>0){h.forEach(s,function(y){j=j+";"+y.id})}if(j.length>0){j=j.substring(1)}var v=g("input[name='futureNodes']").val();var q="";if(v!=null&&v!=""){q="value:'"+v+"'"}else{h.forEach(s,function(y){if(lbpm.globals.checkNodeType(lbpm.constant.NODETYPE_MANUALBRANCH,y.startNode)){if(y.startNode.defaultBranch==y.id){q="value:'"+y.endNodeId+"'"}}})}if(!v){var w=lbpm.globals.getOperationParameterJson("futureNodeId");if(w){if(q){q+=",checkedNodeIds:'"+w+"'"}else{q="checkedNodeIds:'"+w+"'"}}}var r=lbpm.globals.getNextNodeObj(lbpm.nowNodeId);if(r.nodeDescType=="autoBranchNodeDesc"){var u='(&nbsp;<label id="calc" style="color:#dd772c;cursor:pointer;" onclick="lbpm.globals.getAutoNextInfo()">'+lbpm.constant.COMMONNODEREPLAYCAL+"</label>)";var l=g("#nextNodeTDTitle");if(l.length>0&&l[0].innerHTML!=null&&l[0].innerHTML.indexOf("label")==-1){l[0].innerHTML=l[0].innerHTML+u}}if((r!=null&&r.nodeDescType=="freeSubFlowNodeDesc")||(lbpm.nodes[lbpm.nowNodeId].groupNodeId!=null&&lbpm.nodes[lbpm.nowNodeId].groupNodeType=="freeSubFlowNode")){lbpm.globals.hiddenObject(document.getElementById("freeSubFlowNodeRow"),false);var i=lbpm.globals.getCurrentNodeObj();if(i){var n=document.getElementById("freeSubFlowNodeDIV");lbpm.globals.hiddenObject(n,false)}}var m=lbpm.nodes[lbpm.nowNodeId];var t=lbpm.globals.isLastHandler();var p="";var k="validate:'futureNodeSelected required',required:true";if(s.length>1&&r.nodeDescType=="manualBranchNodeDesc"&&m.processType=="2"&&!t){lbpm.noValidateFutureNode=true;p+="<div style='color:#999999;margin-bottom: 5px;' id='futureNodeTip'>"+lbpm.workitem.constant.FUTURENODESTIP+"</div>";k=""}if(r.nodeDescType=="splitNodeDesc"&&r.splitType&&r.splitType=="custom"){return p+'<div id="sys_lbpmservice_mobile_workitem_FutureNodesChekBoxGroup" data-dojo-type="sys/lbpmservice/mobile/workitem/FutureNodesChekBoxGroup" class="lbpmNextRouteInfoRow no_border_bottom dingNodeContent" data-dojo-props="'+(q==""?"":(q+","))+"name:'futureNodes', routeLineInfo:'"+j+"',subject:'',"+k+",orient:'vertical'\"></div>"}else{var x=true;if(r.nodeDescType=="manualBranchNodeDesc"&&m.processType=="2"&&!t){x=false}if(r.XMLNODENAME!="splitNode"&&j&&j.split(";").length>1){return p+'<div data-dojo-type="sys/lbpmservice/mobile/workitem/FutureNodes" class="lbpmNextRouteInfoRow no_border_bottom dingNodeContent" data-dojo-props="isEditStatus:'+x+","+(q==""?"":(q+","))+"name:'futureNodes', routeLineInfo:'"+j+"',subject:'"+lbpm.constant.CHKNEXTNODENOTNULL+"',"+k+'"></div>'}else{return p+'<div data-dojo-type="sys/lbpmservice/mobile/workitem/FutureNodes" class="lbpmNextRouteInfoRow no_border_bottom dingNodeContent" data-dojo-props="isEditStatus:'+x+","+(q==""?"":(q+","))+"name:'futureNodes', routeLineInfo:'"+j+"',subject:'"+lbpm.constant.CHKNEXTNODENOTNULL+"'\"></div>"}}};c.getSelectedFurtureNode=lbpm.globals.getSelectedFurtureNode=function(){var i=new Array();$("input[name='futureNode']:checked").each(function(k,j){var l={};j=$(j);l.NodeName=j.attr("manualBranchNodeId");l.NextRoute=j.val();i.push(l)});return i};c.setFurtureHandlerInfoes=lbpm.globals.setFurtureHandlerInfoes=function(l,r){var j=(l==null);var w;var s;var x;var u;var p=$("input[name='futureNode']:checked");var t=null;if(p.length>0){u=p[0].value;t=p[0].getAttribute("index")}else{var m=lbpm.globals.getCurrentNodeObj();var q=lbpm.globals.getNextNodeObj(m.id);u=q.id;t="0"}w=document.getElementsByName("handlerIds["+t+"]")[0];s=document.getElementsByName("handlerNames["+t+"]")[0];x=document.getElementById("handlerShowNames["+t+"]");if(j){w.value=w.getAttribute("defaultValue");s.value=s.getAttribute("defaultValue");return}if(r==lbpm.constant.ADDRESS_SELECT_FORMULA){w.setAttribute("isFormula","true")}else{w.setAttribute("isFormula","false")}w.setAttribute("defaultValue",w.value);s.setAttribute("defaultValue",s.value);x.innerHTML="("+s.value+")";var y=lbpm.globals.analysisProcessorInfoToObject();if(y==null){return}var n=lbpm.nowNodeId;var v=new Array();var i=new Object();i.id=u;i.handlerIds=w.value;i.handlerNames=s.value;if(r!=null){i.handlerSelectType=r}v.push(i);var k={};k.nodeInfos=v;lbpm.events.fireListener(lbpm.constant.EVENT_MODIFYNODEATTRIBUTE,k)};c.afterChangeFurtureHandlerInfoes=lbpm.globals.afterChangeFurtureHandlerInfoes=function(l,p){var s;var q;var t;if(l){var k=l.GetHashMapArray();if(k){var n=$("input[name='futureNode']:checked");var r=null;if(n.length>0){r=n[0].getAttribute("index")}else{r="0"}s=document.getElementsByName("handlerIds["+r+"]")[0];q=document.getElementsByName("handlerNames["+r+"]")[0];t=document.getElementById("handlerShowNames["+r+"]");var j="";var u="";for(var m=0;m<k.length;m++){j+=";"+k[m]["id"];u+=";"+k[m]["name"]}s.value=j.substring(1);q.value=u.substring(1);lbpm.globals.setFurtureHandlerInfoes(l,p)}}};c.isRemoveNodeIdentifier=function(){var i=false;if(lbpm&&lbpm.settingInfo){if((lbpm.settingInfo.isHideNodeIdentifier==="false"&&lbpm.settingInfo.hideNodeIdentifierType==="false")&&lbpm.settingInfo.isRemoveNodeIdentifier==="true"){i=true}else{if(lbpm.settingInfo.isHideNodeIdentifier==="true"&&lbpm.settingInfo.hideNodeIdentifierType==="isRemoveNodeIdentifier"){i=true}}}return i};c.isHideAllNodeIdentifier=function(){var i=false;if(lbpm&&lbpm.settingInfo){if(lbpm.settingInfo.isHideNodeIdentifier==="true"&&lbpm.settingInfo.hideNodeIdentifierType==="isHideAllNodeIdentifier"){i=true}}return i};c.resolveNodeIdentifier=function(k,i){var j="";if(c.isRemoveNodeIdentifier()||c.isHideAllNodeIdentifier()){j=i}else{j=k+"."+i}return j};c.getNextAdHocSubFlowRouteInfo=lbpm.globals.getNextAdHocSubFlowRouteInfo=function(){lbpm.canHideNextNodeTr=false;if(lbpm.adHocSubFlowNodeInfo==null||lbpm.adHocSubFlowNodeInfo[lbpm.nowAdHocSubFlowNodeId]==null){lbpm.globals.initAdHocSubFlowInfo()}lbpm.adHocRoutes=lbpm.adHocSubFlowNodeInfo[lbpm.nowAdHocSubFlowNodeId];var j=g("input[name='nextAdHocRouteId']:checked")[0]?g("input[name='nextAdHocRouteId']:checked")[0].value:null;var i=j?"value:'"+j+"',":"";return'<div data-dojo-type="sys/lbpmservice/mobile/workitem/NextAdHocRoutes" data-dojo-props="'+i+"validate:'adHocSubFlowNodeSelected required',required:true,subject:'"+lbpm.constant.CHKNEXTNODENOTNULL+'\'" class="lbpmNextRouteInfoRow" style="border-bottom:0"></div>'};lbpm.globals.initAdHocSubFlowInfo=function(){if(lbpm.adHocSubFlowNodeInfo==null){lbpm.adHocSubFlowNodeInfo=new Object()}var t=new Array();var s=new Object();var r=new Object();lbpm.adHocSubFlowNodeInfo[lbpm.nowAdHocSubFlowNodeId]=t;lbpm.adHocRoutes=lbpm.adHocSubFlowNodeInfo[lbpm.nowAdHocSubFlowNodeId];var k=lbpm.nodes[lbpm.nowAdHocSubFlowNodeId];var n=k.adHocSubFlowData;if(n){var l=WorkFlow_LoadXMLData(n);for(var p=0;p<l.nodes.length;p++){var j=l.nodes[p];s[j.id]={};s[j.id].id=j.id;s[j.id].data=j;s[j.id].startLines=[];s[j.id].endLines=[]}lbpm.adHocSubFlowNodeInfo[lbpm.nowAdHocSubFlowNodeId].adHocSubNodes=s;for(p=0;p<l.lines.length;p++){var q=l.lines[p];r[q.id]={};r[q.id].id=q.id;r[q.id].data=q;r[q.id].startNode=s[q.startNodeId];r[q.id].endNode=s[q.endNodeId];(s[q.startNodeId].endLines).push(r[q.id]);(s[q.endNodeId].startLines).push(r[q.id])}var m=function(u,v){v.subNodes.push(u);for(var i=0;i<u.endLines.length;i++){v.subLines.push(u.endLines[i]);m(u.endLines[i].endNode,v)}};$.each(s,function(i,u){if(u.startLines.length==0){var v=new Array();v.subNodes=new Array();v.subLines=new Array();v.startNodeId=u.data.id;m(u,v);t.push(v)}})}};return c})}}});require({cache:{"sys/lbpmservice/mobile/sys-lbpm_zh-cn._min_":function(){define("",{"mui.freeFlow.lbpm.node.processType_2.signNode":"会签","mui.signature.cancel":"取消","mui.freeFlow.lbpm.nodeType.signNode":"签字节点","mui.freeFlow.node.onAdjoinHandlerSame":"仅相邻处理人身份重复跳过","mui.freeFlow.tip.successChange":"修改成功","mui.lbpmservice.lbpmPostscript.load.failure":"新增流程附言加载失败","mui.hand.empty.tip":"请签批","mui.freeFlow.lbpm.oprItem.modifyProcessType":"修改流转方式","mui.extOperation.im.approver":"我是审批人","mui.extOperation.next":"下一步","mui.lbpmservice.lbpmAuditNote.fdCostTime":"耗时","mui.freeFlow.sendNode.nodeTitle":"多人抄送","mui.lbpmNode.usage.speech":"语音","mui.lbpmservice.node.hide":"隐藏","mui.extOperation.im.finishProcessor":"我是已处理人","mui.subform.transaction":"有待处理事务","mui.freeFlow.node.yes":"是","mui.errors.maxLength.simple":"{0} 超出 {1} 个英文字符限制","mui.commonUsage.tip.empty":"请输入数据","mui.lbpmservice.node.operation":"操作","mui.freeFlow.node.select":"请选择","mui.lbpmservice.flowchart.process.branch":"启动分支节点","mui.freeFlow.node.ignoreOnFutureHandlerSame":"后续处理人身份重复跳过当前","mui.freeFlow.node.flowPopedom_1":"增加节点","mui.freeFlow.node.flowPopedom_0":"无","mui.freeFlow.node.flowPopedom_2":"编辑流程","mui.freeFlow.reviewNode.processType_2.nodeTitle":"{0}人审批|会审","mui.commonUsage.manage":"管理","mui.commonUsage.del":"删除","mui.freeFlow.lbpm.node.processType_1":"并行","mui.freeFlow.lbpm.node.processType_0":"串行","mui.operation.commonUsage.none":"暂时没有数据","mui.freeFlow.node.close":"关闭","mui.extOperation.audit":"审批","mui.freeFlow.node.open":"开启","mui.freeFlow.node.set":"请设置","mui.freeFlow.lbpm.oprItem.viewHandler":"查看人员","mui.commonUsage.edit":"编辑","mui.freeFlow.node.deleteMsg":"确定删除该节点？","mui.operation.processed":"已处理","mui.signature.warn.msg":"密码错误，请重新输入","mui.lbpmservice.lbpmPostscript.ok":"确定","mui.lbpmNode.usage.handwrite.color.red":"红色","mui.subform.defaultForm":"默认表单","mui.lbpmNode.signature":"电子签章","mui.process.mobile.note":"流程记录","mui.freeFlow.lbpm.oprItem.insertNode":"添加节点","mui.operation.branchadmin":"分支特权人","mui.dialog.selectOrg":"选择","mui.freeFlow.draftorNode.default":"默认为本人","mui.freeFlow.lbpm.nodeType.sendNode":"抄送节点","mui.workitem.operation.transaction":"事务","mui.freeFlow.node.onSkipHandlerSame":"处理人身份重复跳过","mui.lbpmNode.usage.handwrite.color.blue":"蓝色","mui.lbpmNode.usage.handwrite.color.black":"黑色","mui.lbpmservice.node.operation.from":"来自","mui.freeFlow.node.canModifyMainDoc":"编辑主文档","mui.commonUsage.placeholder":"请输入审批语","mui.freeFlow.splitNode.deleteMsg":"您确定删除当前节点及后面所有节点吗?","mui.extOperation.operationselection":"操作选择","mui.freeFlow.tip.successInsert":"添加成功","mui.freeFlow.lbpm.oprItem.modifyHandler":"替换人员","mui.freeFlow.signNode.processType_2.nodeTitle":"{0}人签字|会签","mui.freeFlow.lbpm.nodeType.reviewNode":"审批节点","mui.freeFlow.node.more":"等","mui.lbpmNode.usage.handwrite.color":"颜色","mui.commonUsage.add":"添加审批语","mui.freeFlow.node.person":"人","mui.subform.defaultCurrForm":"默认表单(当前表单)","mui.lbpmNode.usage.handwrite":"手写","mui.lbpmNode.usage.handwrite.penWidth":"笔触","mui.freeFlow.node.attrSet":"节点设置","mui.freeFlow.node.canAddAuditNoteAtt":"审批意见中上传附件","mui.lbpmservice.lbpmPostscript":"回复","mui.freeFlow.lbpm.nodeType.robotNode":"机器人节点","mui.freeFlow.reviewNode.processType_0.nodeTitle":"{0}人审批|串行","mui.button.savedraft":"暂存","mui.lbpmservice.node.deleted":"此审批意见所属节点已删除","mui.freeFlow.draftorNode":"起草节点","mui.freeFlow.node.no":"否","mui.freeFlow.reviewNode.processType_1.nodeTitle":"{0}人审批|并行","mui.extOperation.finishProcessor":"已处理人","mui.lbpmNode.usage":"审批语","mui.freeFlow.lbpm.oprItem.modifyPopedom":"修改节点权限","mui.freeFlow.lbpm.node.processType_2.reviewNode":"会审","mui.extOperation.drafter":"起草人","mui.freeFlow.cancel":"取消","mui.freeFlow.node.ignoreOnHandlerSame":"处理人身份重复不跳过","mui.commonUsage.tip.same":"数据没有变更","mui.freeFlow.signNode.processType_0.nodeTitle":"{0}人签字|串行","mui.signature.input.password":"输入密码","mui.operation.drafter":"起草人","mui.subform.switchForm":"切换表单","mui.freeFlow.lbpm.node.flowPopedom_2":"编辑流程","mui.freeFlow.lbpm.node.flowPopedom_1":"增加节点","mui.freeFlow.lbpm.node.flowPopedom_0":"不可编辑","mui.lbpmservice.lbpmPostscript.cancel":"取消","mui.lbpmservice.flowchart.process.end":"结束","mui.freeFlow.signNode.processType_1.nodeTitle":"{0}人签字|并行","mui.extOperation.im.drafter":"我是起草人","mui.lbpmservice.flowchart.process.begin":"开始","mui.operation.commonUsage":"常用审批意见","mui.freeFlow.node.delete":"删除","mui.workitem.operation.other":"其他","mui.operation.process":"流程处理","mui.lbpmNode.usage.sign":"批注","mui.signature.ok":"确定","mui.subform.currForm":"当前表单","lbpmNode.currentNode.distributeType.robtodo":"竞争抢单","lbpmNode.subForm.switchForm":"切换表单","lbpmNode.subform.Corresponding_form":"对应表单","lbpmNode.processingNode.operationsTDTitle_Scope.assignType":"流转方式","lbpmNode.processingNode.changeProcessor.select.alternative":"从备选列表中选择","lbpmNode.processingNode.processStatus":"流程状态","lbpmNode.processingNode.operationsTDTitle.handlerOperationTypeRefuse.modifyRefuseBackHandler":"驳回返回的节点处理人已发生变更，提交后将默认返回到节点，并重新计算节点处理人！","lbpmNode.flowContent.noRefuseNode":"无可{refuse}节点","lbpmNode.subform.taskToDo":"有待处理事务","lbpmNode.subform.pc":"PC表单","lbpmNode.currentNode.distributeType":"分配方式","lbpmNode.currentNode.notify.type":"通知方式","lbpmNode.processingNode.operationsTDTitle_Scope.allow.muti":"允许多级","lbpmNode.chooseRefuseNode.info":"说明：为空则默认所有符合条件的节点","lbpmNode.processingNode.operationsTDTitle.adminOperationTypeJump.abandonSubprocess":"跳转后流经的子流程重新流转","lbpmNode.processingNode.operationsTDTitle.handlerOperationTypeRefuse":"{refuse}到","lbpmNode.currentNode.notifyToDraft":"通知起草人","lbpmNode.currentNode.notifyToDraft.message1":"流程启动","lbpmNode.subform.web_formm":"移动表单","lbpmNode.currentNode.notifyToDraft.message2":"后仍未完成通知我","lbpmNode.currentNode.notifyToDraft.message3":"流程结束后通知我","lbpmNode.opInfo.authorize.read":"“{0}”授权给“{1}”阅读","lbpmNode.toOtherHandler.address.subject.select":"选择","lbpmNode.currentNode.robtodo.notify.after":"抢办成功后通知","lbpmNode.processingNode.adminrecover.scopetype.all":"所有节点","lbpmNode.processingNode.operationsTDTitle_Scope.Limit.sub":"限制子级","lbpmNode.processingNode.operationsTDTitle.adminOperationTypeRecover":"子流程","lbpmNode.subform.print_formm":"打印表单","lbpmNode.opInfo.subprocess.recover.process":'回收子流程"{0}"条。',"lbpmNode.processingNode.changeProcessor.nodeHelpInfo":"节点帮助","lbpmNode.attribute.passTime.compare.commissionTime.tip":"超时时间必须大于等于催办时间","lbpmNode.opInfo.proxy":"代理","lbpmNode.processingNode.adminrecover.dialog.title":"选择子流程","lbpmNode.processingNode.operationsTDTitle_Type.adminOperationTypeAppend":"追加","lbpmNode.nodeHandler.nodeHandler":"节点处理人","lbpmNode.nodeHandler.processtypeSingle":"并行","lbpmNode.processingNode.repeat.adjoinJump":"（相邻跳过）","lbpmNode.flowContent.mustModifyHandlerNodeIds.parse.postEmpty":"为必须修改的节点，存在岗位未设置成员，请重新设置该节点的处理人再进行提交操作！","lbpmNode.processingNode.assignment":"附件","lbpmNode.processingNode.operationsTDTitle.handlerOperationTypepass":"即将流向","lbpmNode.subForm.switchPrint":"选择打印模板","lbpmNode.processingNode.changeProcessor.select.organization":"从组织架构中选择","lbpmNode.processingNode.currentProcessor":"当前处理人","lbpmNode.processingNode.operationsTDTitle.handlerOperationTypeCommission.returnToCommissionedPerson":"流程重新流经本节点时，直接由{commission}人员处理","lbpmNode.processingNode.operationsTDTitle.handlerOperationTypeRefuse.returnBackTheNode":"{refuse}的节点通过后返回指定节点","lbpmNode.processingNode.changeProcessor.filterNode":"过滤节点","lbpmNode.processingNode.changeProcessor.filterNode.clear":"清除过滤","lbpmNode.processingNode.operationsTDTitle.handlerOperationTypeRefuse.returnBackMe.title":"{refuse}的节点通过后，返回我","lbpmNode.processingNode.operationsTDTitle.handlerOperationTypeRefuse.selectTypes":"驳回的节点通过后选择方式","lbpmNode.processingNode.operationsTDTitle.check.assign.obj":"选择加签对象","lbpmNode.flowContent.noJumpNode":"无可跳转节点","lbpmNode.futureNodes.tip":"由当前节点的最后一位处理人选择","lbpmNode.flowContent.admin_operation_type.chgcurhandle.mustChangeAppendOperator":"请选择“追加人”！","lbpmNode.nodeHandler.orgEmpty":"未设处理人","lbpmNode.subform.default_print_form":"默认打印模板","lbpmNode.currentNode.notify.type.info":"说明：为空则使用模板的缺省通知方式","lbpmNode.processingNode.operationsTDTitle_Scope.Limit.scope":"范围","lbpmNode.createDraft.manualNodeSelect.mobile":"分支条件","lbpmNode.currentNode.fastReview.info":"说明：以下四种情况不允许设置快速通过：1、必须修改其他节点处理人 2、包含重要审批要点 3、下个节点为人工分支 4、表单中有设置该节点的编辑表单数据（用户判断）","lbpmNode.processingNode.operationMethods":"操作","lbpmNode.validate.hanlderEmpty.jump.confirm":"前后跳转的节点未设处理人，请确定要跳转到该节点吗？","lbpmNode.processingNode.limitTimeRow":"办理限时剩余","lbpmNode.calcBranch":"(计算分支)","lbpmNode.opInfo.repeat.adjoinJump":"身份重复跳过（相邻跳过）：“{0}”","lbpmNode.currentNode.submitRole":"提交身份","lbpmNode.noCalcBranchResult":"(无法计算出符合条件的分支流向)","lbpmNode.validate.abandon.confirm":"请确定要废弃该文档吗？","lbpmNode.chooseDefaultRefuseNode.info":"说明：为空则默认所有符合条件的节点","lbpmNode.opInfo.repeat.adjoinJump.byProxy":"身份重复跳过（相邻跳过）：“{0} [{1} 被代理]”","lbpmNode.subform.default_web_form":"默认表单(移动)","lbpmNode.processingNode.operationsTDTitle.handlerOperationTypeRefuse.returnBackTheNode.title":"{refuse}的节点通过后，返回指定节点","lbpmNode.processingNode.operationsTDTitle.handlerOperationTypeRefuse.abandonSubprocess":"{refuse}后流经的子流程重新流转","lbpmNode.processingNode.operationsTDTitle.handlerOperationTypeRefuse.returnBackTheNode.text":"驳回的节点通过后，返回指定节点","lbpmNode.nodeHandler.processtypeSerial":"串行","lbpmNode.opInfo.sendto.empty.jump":"抄送人为空，节点自动跳过","lbpmNode.currentNode.robtodo.notify.1":"抢办成功后通知","lbpmNode.currentNode.robtodo.notify.0":"抢办前通知","lbpmNode.createDraft.manualNodeSelect":"分支条件","lbpmNode.validate.nextNodeHandler.mobile.isNull":"即将流向节点处理人为空！","lbpmNode.currentNode.notify.type.info1":"说明：为空则使用节点或模板的缺省通知方式","lbpmNode.opInfo.authorize.proxy":"“{0}”代理给“{1}”处理","lbpmNode.subform.web_form":"移动","lbpmNode.opInfo.subprocess.start.process":'启动子流程"{0}"条。',"lbpmNode.processingNode.operationsTDTitle.handlerOperationTypeRefuse.returnBack.text":"驳回的节点通过后，返回这个节点所有人","lbpmNode.processingNode.communicate.NeedSelectCanceler":"请选择要取消的人员","lbpmNode.nodeHandler.postEmpty":"岗位成员未设置","lbpmNode.processingNode.operationsTDTitle_Scope.isNull.NoLimit":"（为空时不限制）","lbpmNode.createDraft.opinion.maxLength":"{0} 超出 {1} 个英文字符限制，建议以附件方式提交意见","lbpmNode.processingNode.repeat.jump":"身份重复跳过","lbpmNode.processingNode.operationsTDTitle.handlerOperationTypeRefuse.returnBackMe":"{refuse}的节点通过后直接返回本人","lbpmNode.opInfo.sendto.and.error":"抄送：“{0}” 。为空或无效组织架构：“{1}”","lbpmNode.validate.nextNode.isNull":"请选择流程的一个即将流向节点！","lbpmNode.processingNode.operationsTDTitle.adminOperationTypeJump":"前后跳转","lbpmNode.opInfo.repeat.jump.byAccr":"身份重复跳过：“{0} [{1} 授权]”","lbpmNode.processingNode.adminrecover.subtitle":"子流程名","lbpmNode.processingNode.operationsTDTitle_Type.adminOperationTypeModifyType":"修改模式","lbpmNode.opInfo.repeat.adjoinJump.byAccr":"身份重复跳过（相邻跳过）：“{0} [{1} 授权]”","lbpmNode.createDraft.opinion":"处理意见","lbpmNode.flowContent.noReturnBackNode":"无可返回的节点","lbpmNode.processingNode.operationsTDTitle.check.communicate.obj":"选择沟通对象","lbpmNode.opInfo.authorize.handle":"“{0}”授权给“{1}”处理","lbpmNode.chooseJumpNode.info":"说明：为空则默认所有符合条件的节点","lbpmNode.nodeHandler.parseError":"暂时无法计算处理人","lbpmNode.nodeHandler.elementDisabled":"已禁用","lbpmNode.processingNode.operationsTDTitle.handlerOperationTypeRefuse.returnBack.title":"{refuse}的节点通过后，返回这个节点所有人","lbpmNode.processingNode.identifyRole.button.historyhandler":"以已处理人身份操作","lbpmNode.currentNode.details":"更多信息","lbpmNode.processingNode.relatedItems":"关联事务","lbpmNode.opInfo.authorize":"授权","lbpmNode.opInfo.repeat.jump":"身份重复跳过：“{0}”","lbpmNode.processingNode.finishProcessor":"已经处理人","lbpmNode.opInfo.handler.empty.jump":"处理人为空的节点自动跳过","lbpmNode.flowContent.thisNode":"本节点","lbpmNode.processingNode.changeProcessor.select":"组织架构备选列表","lbpmNode.opInfo.subprocess.recover.empty.jump":"无子流程需要回收，直接跳过。","lbpmNode.flowContent.mustModifyHandlerNodeIds.parse.isNull":"节点为必须修改的节点，是否修改？","lbpmNode.subform.curSubForm":"当前表单","lbpmNode.processingNode.assign.NeedSelectCanceler":"请选择要收回的人员！","lbpmNode.flowContent.mustModifyHandlerNodeIds.mobile.isNull":"节点处理人为空！","lbpmNode.processingNode.changeProcessor.title":"修改其他节点处理人","lbpmNode.processingNode.changeProcessor.processorNotAlllowEmpty":"节点处理人不能为空","lbpmNode.processingNode.operationsTDTitle.handlerOperationTypeRefuse.sequenceFlow.text":"驳回的节点通过后，按顺序流转","lbpmNode.validate.nextNodeHandler.isNull":"请选择流程的即将流向节点处理人！","lbpmNode.processingNode.adminrecover.scopetype.assign":"指定节点","lbpmNode.processingNode.operationsTDTitle_Scope.assignPass.skip":"人员通过后跳过我","lbpmNode.processingNode.operationsTDTitle_Scope.assignType_21":"无序加签","lbpmNode.processingNode.identifyRole.button.authority":"以特权人身份操作","lbpmNode.toOtherHandler.address.subject.person":"人员","lbpmNode.processingNode.adminrecover.delete":"删除","lbpmNode.processingNode.handMethods":"处理方式","lbpmNode.processingNode.operationsTDTitle.handlerOperationTypeRefuse.sequenceFlow.title":"{refuse}的节点通过后，按顺序流转","lbpmNode.processingNode.timeoutRow":"办理超时","lbpmNode.flowContent.admin_operation_type.chgcurhandle.mustSelectCurHandler":"请选择一个“当前处理人”","lbpmNode.processingNode.operationsTDTitle.handlerOperationTypeRefuse.returnBack":"{refuse}的节点通过后直接返回本节点","lbpmNode.currentNode.robtodo.notify.before":"抢办前通知","lbpmNode.flowContent.mustModifyHandlerNodeIds.isNull":"节点为必须修改的节点，请设置该节点的处理人后再进行提交操作！","lbpmNode.processingNode.changeProcessor.handlerIds":"处理人","lbpmNode.subform.defaut_form":"默认表单","lbpmNode.manualNodeOnDraft.noSelectAll":"请选择分支节点走向！","lbpmNode.processingNode.identifyRole.button.branchadmin":"以分支特权人身份操作","lbpmNode.validate.toOtherHandlerIds.additionSign.isNull":"请选择补签人员!","lbpmNode.processingNode.operationsTDTitle_Scope.assignType_0":"顺序加签","lbpmNode.processingNode.operationsTDTitle_Scope.assignType_1":"并行加签","lbpmNode.createDraft.commonUsages.definite":"自定义","lbpmNode.flowContent.mustModifyNodeNextHandlerNodeIds.isNull":"{0}.{1} 是 {2}.{3} 的后续审批节点，因此必须设置该节点的处理人！","lbpmNode.validate.toOtherHandlerIds.Communicate.isNull":"请选择","lbpmNode.opInfo.repeat.jump.byProxy":"身份重复跳过：“{0} [{1} 被代理]”","lbpmNode.processingNode.adminrecover.scopetype.assign.alert":"请指定节点","lbpmNode.opInfo.sendto.and.error.none":"抄送人为空，节点自动跳过。为空或无效组织架构：“{0}”","lbpmNode.processingNode.adminrecover.node.title":"子流程","lbpmNode.validate.notifyType.isNull":"请选择流程的通知方式！","lbpmNode.nodeHandler.orgNull":"处理人为空","lbpmNode.processingNode.operationsTDTitle_Type.adminOperationTypeReplace":"替换","lbpmNode.processingNode.processStatus.processSuspended":"此流程已被暂停","lbpmNode.processingNode.operationsTDTitle.handlerOperationType.people":"人员","lbpmNode.processingNode.operationsTDTitle.handlerOperationTypeRefuse.returnBackMe.text":"驳回的节点通过后，返回我","lbpmNode.validate.operationType.isNull":"请选择流程下一步操作！","lbpmNode.flowContent.mustModifyHandlerNodeIds.parse.elementDisabled":"为必须修改的节点，存在无效的组织架构对象，请重新设置该节点的处理人再进行提交操作！","lbpmNode.opInfo.handover":"交接","lbpmNode.processingNode.operationsTDTitle.handlerOperationTypeRefuse.selectTypesNotnull":"驳回的节点通过后选择方式不能为空！","lbpmNode.recalculation.handler":"重新计算","lbpmNode.processingNode.adminrecover.add":"添加","lbpmNode.processingNode.limitTime":"办理限时剩余","lbpmNode.processingNode.changeProcessor.button":"修改其他节点处理人","lbpmNode.createDraft.nextNode":"即将流向","lbpmNode.processingNode.operationsTDTitle.adminOperationTypeRepCurHandler":"替换人","lbpmNode.processingNode.notifyOption.message":"流程结束后通知我","lbpmNode.nodeHandler.hint":"提示:实际计算结果可能因表单数据变化而改变","lbpmNode.currentNode.distributeType.0":"竞争抢单","lbpmNode.processingNode.processStatus.nodeSuspended":"此流程在节点（{0}）被暂停","lbpmNode.processingNode.adminrecover.alertText":"请选择子流程","lbpmNode.processingNode.changeProcessor.nodeIndex":"节点","lbpmNode.nodeHandler.nodeName":"节点名称","lbpmNode.processingNode.operationsTDTitle.adminOperationTypeApdCurHandler":"追加人","lbpmNode.subform.print_form":"打印","lbpmNode.opInfo.repeat.futureJump":"后续身份重复，跳过：“{0}”","lbpmNode.createDraft.commonUsages":"常用意见","lbpmNode.opInfo.sendto":"抄送：“{0}”","lbpmNode.processingNode.operationsTDTitle.handlerOperationTypeRefuse.sequenceFlow":"{refuse}的节点通过后按顺序流转","lbpmNode.currentNode.modifyFlow":"修改流程信息","lbpmNode.processingNode.changeProcessor":"修改流程信息","lbpmNode.processingNode.adminrecover.scope.title":"范围选项","lbpmNode.validate.toOtherHandlerIds.assign.isNull":"请选择","lbpmNode.mustSignYourSuggestion":"请填写处理意见！","lbpmNode.processingNode.notifyOption":"通知选项","lbpmNode.processingNode.operationsTDTitle.adminOperationTypeChgCurHandler":"当前处理人","lbpmNode.processingNode.operationItems":"处理事务","lbpmNode.attribute.passTime.compare.limitTime.tip":"超时时间必须大于等于限时时间","lbpmNode.flowContent.admin_operation_type.chgcurhandle.mustChangeOperator":"请选择“替换人”！","lbpmNode.validate.toOtherHandlerIds.Commission.isNull":"请选择转办人员!","lbpmNode.processingNode.identifyRole.button.drafter":"以起草人身份操作","lbpmNode.processingNode.identifyRole.button.approve":"审批操作","lbpmNode.nodeHandler.processtypeAll":"会审/会签","lbpmAssign.fdOperType.assign":"分发","lbpmSetting.approve.ReminderCooldown.desc":"说明：起草人和已处理人点击催办后需要等待X小时后才能再次催办；为空或者为0，表示不限制","lbpmSetting.approve.ReminderCooldown.hours":"小时","lbpmSetting.approve.model.default":"默认模式","lbpmSetting.approve.model.right":"右侧审批模式","lbpmSetting.approve.model":"审批模式","lbpmSetting.approve.ReminderCooldown":"冷却催办时间","lbpmSetting.approve.model.tiled":"操作按钮平铺模式","lbpmSetting.approve.model.dialog":"简单弹出框模式","lbpmSetting.approve.ReminderCooldown.noPress":"冷却催办时间未到，暂时不能发送催办","lbpmSetting.approve.model.desc":"说明：使用的是老版本UI的模块，无论选择哪种模式都仅支持默认模式","lbpmProcess.handler.usageContent.default":"同意","lbpmSupport.STATUS_RUNNING":"处理节点","lbpmSupport.selectAddress":"从组织架构选择","lbpmSupport.HandlerIsRule":"<规则计算>","lbpmSupport.STATUS_PASSED":"已执行","lbpmSupport.processType_0":"串行","lbpmSupport.processType_1":"并行","lbpmSupport.concurrencyBranchSelect":"请选择分支","lbpmSupport.curNodeotherCanViewCurNode":"本节点意见的其他可阅读者","lbpmSupport.curNodeCanViewCurNode":"可查看本节点意见的节点","lbpmSupport.processType":"流转方式","lbpmSupport.selectOptList":"从备选列表选择","lbpmSupport.HandlerIsMatrix":"<矩阵计算>","lbpmSupport.STATUS_NORMAL":"未执行","lbpmSupport.processType_20":"会审","lbpmSupport.processType_21":"会签","lbpmSupport.concurrencyBranchTitle":"并行分支","lbpmSupport.HandlerIsFormula":"<公式计算>","lbpmSupport.environmentUnsupportOperation":"当前环境不支持此操作","lbpmSupport.selectFormList":"使用公式定义器","label.formula.show":"公式计算","lbpmProcess.handler.usageContent.notNull":"“处理意见”不能为空","lbpmservice.view.openMorenActionView":"更多审批信息","lbpmservice.view.closeMorenActionView":"收起审批信息","validate.isNull":"不允许为空","validate.isNaN":"必须输入数字","lbpmTemplate.fdType.free":"自由流 ","lbpm.freeFlow.mustAppendSomeNode":"请设置下一环节的节点与处理人！","lbpm.group.freeSubFlow":"自由子流程","lbpm.group.updateNextStep":"更新下一步","lbpm.group.setNextStep":"设置下一步","WorkFlow.Loading.Msg":"数据加载中...","lbpmservice.freeflow.deleteTitle":"删除","lbpmservice.freeflow.noHandlerTitle":"未设置处理人！","lbpmservice.freeflow.dragTitle":"点击进行拖拽","lbpmservice.checkForm":"请检查表单字段是否填写完整！","lbpmservice.freeflow.saveNoRecord":"未找到默认模板！","lbpmservice.auditnote.have":"有","lbpmservice.please.insert":"请输入","lbpmservice.closeDataCoverageWarn":"关闭同时审核数据覆盖提醒","lbpmservice.freeflow.editTitle":"编辑","lbpmservice.freeflow.fixedTitle":"固定节点","lbpmservice.freeflow.saveOtherTemp":"存为其他模板","lbpmservice.freeflow.saveFailure":"保存失败！","lbpmservice.taglib.docCreator":"创建人","lbpmservice.auditnote.setPrivateOpinion":"设置私密意见","lbpmservice.freeflow.reviewNode":"审批节点","lbpmservice.freeflow.loadDefaultTemp":"使用默认模板","lbpmservice.taglib.docCreateTime":"创建时间","lbpmservice.select.refusePeopleMess":"驳回的人","lbpmservice.freeflow.loadOk":"加载成功！","lbpmservice.freeflow.deleteTempMsg":"确定删除该模板？","lbpmservice.auditnote.placeholder":"请选择意见可查看人员","lbpmservice.select.refusePeople":"请选择驳回的人","lbpmservice.freeflow.sendNode":"抄送节点","lbpmservice.freeflow.close":"关闭","lbpmservice.auditnote.canViewPerson":"查看人员","lbpmservice.freeflow.addHandlerTitle":"点击添加","lbpmservice.saveDraft.content":"您好！在您暂存草稿期间，流程管理员调整了流程审核过程，在您提交文档后将采用最新的流程审核。请知悉！","lbpmservice.freeflow.template":"模板","lbpmservice.auditnote.without":"无","lbpmservice.taglib.showProcess.status.feedback":"已反馈","lbpmservice.select.refusePeople.search":"搜索","lbpmservice.freeflow.saveOk":"保存成功！","lbpmservice.taglib.nodeName":"当前节点","lbpmservice.freeflow.loadOtherTemp":"使用其他模板","lbpmservice.taglib.handerName":"当前处理人 ","lbpmservice.freeflow.robtodo":"抢办","lbpmservice.taglib.docSubject":"主题","lbpmservice.taglib.docStatus":"状态","lbpmservice.freeflow.addTitle":"新增","lbpmservice.auditnote.privateOpinion":"私密意见","lbpmservice.freeflow.jump":"自由跳转","lbpmservice.freeflow.insertTemplateName":"请输入模板名称","lbpmservice.saveDraft.title":"流程变更提醒","lbpmservice.attachment.upload":"附件上传","lbpmservice.freeflow.signNode":"签字节点","lbpmservice.freeflow.review":"审批","lbpmservice.freeflow.passedTitle":"已完成","lbpmservice.closeDataCoverageWarnTip":"会审节点，多个审批人同时打开流程进行审核时，后提交的审批人在提交流程时会弹出数据覆盖的提醒。如当前会审节点人员较多时，且审批人不会对流程数据进行更改，可设置关闭数据覆盖的提醒，避免审批人审批提交时弹出提醒而再次刷新文档重新审批时造成重复性审批操作。注意：关闭提醒可能会导致流程数据的覆盖，请谨慎操作。","lbpmservice.freeflow.saveConfirm":"确定保存为默认模板？","lbpmservice.freeflow.templateName":"模板名称","lbpmservice.freeflow.draft":"起草","lbpmservice.freeflow.send":"抄送","lbpmservice.freeflow.deleteNodeMsg":"确定删除当前节点吗？","lbpmservice.freeflow.versionChangeMsg":"流程版本已更新，请重新保存默认模板！","lbpmservice.freeflow.sign":"签字","lbpmservice.freeflow.node":"节点","lbpmservice.freeflow.saveDefaultTemp":"存为默认模板","lbpmservice.freeflow.runningTitle":"正在进行中","lbpmservice.freeflow.open":"开启","lbpmservice.freeflow.seleteTempMsg":"请选择要使用的模板!","FlowChartObject.Lang.Node.needHandWritten":"请手写签字","lbpmExtAuditPoint.important.cannot.benullMobile":"审批要点中有必须确认的项未确认，请勾选确认","lbpmOperations.backbranch.msg":"请至少选择一个需要撤回的分支！","lbpmOperations.backbranch.msg2":"因撤回所有分支会导致流程无停留节点，请至少保留一条分支！","lbpmOperations.fdOperType.processor.backbranch":"撤回分支","lbpmOperations.fdOperType.processor.backbranch.info":"撤回分支({0})","lbpmOperations.fdOperType.processor.backbranch.event":"撤回分支事件","lbpmOperations.fdOperType.processor.backbranch.event.description":"分支特权人撤回分支操作时发布该事件","lbpmOperations.turnToDo.hiddenNote":"隐藏意见","lbpmOperations.endbranch.msg":"请至少选择一个需要结束的分支！","lbpmOperations.fdOperType.processor.endbranch.event":"结束分支事件","lbpmOperations.fdOperType.processor.endbranch.info":"结束分支({0})","lbpmOperations.fdOperType.processor.endbranch":"结束分支","lbpmOperations.fdOperType.processor.endbranch.event.description":"分支特权人结束分支操作时发布该事件","lbpm.process.noticeHandler.name":"@已处理人","mui.kmreviewTemplate.createByThirdMall":"从模板中心创建","mui.kmReviewMain.mobile.info":"审批内容","mui.kmReviewMain.docDraft":"草稿","mui.kmReviewMain.docCreatorName":"申请人","mui.kmReviewMain.docPublish":"结束","mui.kmReviewMain.docCreatetime":"创建时间","mui.kmreviewTemplate.launch":"发起","mui.kmReviewMain.docRate":"流程进度","mui.kmreviewTemplate.created":"已创建的模板","mui.kmReviewMain.mobile.note":"流程记录","mui.kmReviewMain.mobile.subprocesses":"子流程","mui.kmReviewMain.status":"状态","mui.kmReviewMain.docFeedback":"已反馈","mui.kmReviewMain.docPending":"待审","mui.kmreviewTemplate.create":"创建","mui.kmReviewMain.docInitiateTime":"发起时间","mui.kmReviewTemplate.mobile.flow":"流程设置","mui.kmReviewTemplate.mobile.right":"权限设置","mui.kmReviewMain.docReject":"驳回","mui.kmReviewMain.docAbandoned":"废弃","mui.kmreviewTemplate.createByThirdMallDesc":"量身定制办公解决方案","mui.kmReviewMain.mobile.basicInfo":"基本信息","mui.kmReviewMain.mobile.parentprocesses":"父流程","mui.kmReviewMain.copy.comfirm":"系统检测到当前模板已有新版本，将会基于最新模板发起流程申请，可能会存在历史数据不继承，是否继续？","mui.kmReviewTemplate.mobile.info":"模板信息","mui.kmReviewMain.mobile.review":"流程操作","mui.kmReviewMain.docEndTime":"结束时间","mui.lbpmAssign.operation.replyAssign":"回复分发","mui.lbpmAssign.operation.assign":"分发","mui.lbpm.process.status.fdStartDate":"接收时间","mui.lbpm.process.status.operationType":"操作状态","mui.lbpm.process.status.fdFinishDate":"操作时间","lbpmNode.processingNode.operationsTDTitle.confirmconbranch.all":"其它到达分支一并结束","lbpmNode.processingNode.operationsTDTitle.confirmconbranch":"结束到达分支选项","lbpmNode.processingNode.operationsTDTitle.restartconbranch":"启动新分支","lbpmProcess.joinnode.conbranche.notify.handler.subject":"请处理%drafter%提交的流程：%docSubject%","lbpmProcess.joinnode.conbranch.restartbranch.check":"请选择需要启动的分支","lbpmProcess.joinnode.conbranch.cancelbranch.check":"请选择需要取消的分支"})}}});