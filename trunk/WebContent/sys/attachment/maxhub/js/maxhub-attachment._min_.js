require({cache:{"sys/attachment/maxhub/js/AttachmentOptListItem":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/parser","dojo/query","dojo/topic","dojo/request","dojo/dom-construct","dojo/_base/array","sys/attachment/mobile/js/_AttachmentItem","mui/util","mhui/device/jssdk","mhui/dialog/Dialog","mui/dialog/Tip","mui/i18n/_i18n!sys/attachment/maxhub/js/maxhub-attachment"],function(h,b,a,m,j,g,e,k,d,i,f,l,n,c){if(!Object.assign){Object.assign=function(s){for(var q=1;q<arguments.length;q++){var r=arguments[q];for(var p in r){if(Object.prototype.hasOwnProperty.call(r,p)){s[p]=r[p]}}}return s}}var o=function(){};return h("sys.attachment.maxhub.js.AttachmentOptListItem",[d],{eventPrefix:"attachmentObject_",baseClass:"mhuiAttachmentEditItem mhuiAttachmentEditOptItem",postCreate:function(){this.inherited(arguments);this.lifecycle={};this.subscribe(this.eventPrefix+this.getParent().fdKey+"_success","_success");this.subscribe(this.eventPrefix+this.getParent().fdKey+"_openBoard","_handleClose")},successCount:0,_success:function(){console.log("success:"+this.successCount);this.successCount=this.successCount+1},buildItem:function(){this.loading=this.buildTip("加载中...");this.processing=this.buildTip("上传中...");var p=e.create("div",{className:"mhuiAttachmentItemT"},this.containerNode);var q=e.create("div",{className:"mhuiAttachmentItemIcon"},p);this.uploadDom=e.create("i",{className:"mui mui-plus"},q);this.connect(this.domNode,"click","_handleOpen");j.subscribe("attachmentObj_"+this.getParent().fdKey+"_selectFile",b.hitch(this,this._handleOpen))},buildTip:function(q){var p=h([n.Tip],{icon:"mui mui-loading mui-spin",time:-1,cover:true,text:q,hide:function(){this.inherited(arguments,[false])}});return new p()},_handleOpen:function(q){if(!window.AttachmentList){window.AttachmentList={}}var p=window.AttachmentList[this.getParent().fdKey];if(p&&p.selectedValues){n.tip({text:"附件上传中,请耐心等待上一次附件上传结束"});return}this.loading.show();var r=this;this.initlifecycle(q);var s=g(i.formatUrl("/sys/attachment/maxhub/tmpl/dialogTemplate.jsp"),{handleAs:"text/html"});s.then(function(u){var t=b.replace(u,{fdKey:r.getParent().fdKey});var v=e.create("div",{innerHTML:t,className:"mhuiAttachmentContent"});a.parse(v).then(function(w){k.forEach(w,function(x,y){if(x.declaredClass==="sys.attachment.maxhub.js.AttachmentSelectList"){r.selectlist=x}});r._buildDialog(v);r.lifecycle.handleUploadCreate&&r.lifecycle.handleUploadCreate();f.getFiles(null,function(y){var x=r._formatFiles(y);x=k.filter(x,function(z){return k.indexOf(r.getParent().pathAtts,z.filePath)<0});r.selectlist.set("selectedValues",[]);r.selectlist.set("values",x);r.loading.hide()})})})},_handleClose:function(p){this.loading.hide();this.processing.hide();this.dialog.hide();this.lifecycle.handleUploadClose&&this.lifecycle.handleUploadClose({isCancel:p})},_buildDialog:function(r){var p=this;var q=l.show({title:c["table.sysAttRtfData"],content:r,baseClass:"mhuiAttachmentDialog",showClose:false,isTop:true,buttons:[{text:"取消",onClick:function(s){p._handleClose(true)}},{text:"确定",className:"mhuiDialogPrimaryBtn",onClick:function(w){p.processing.show();var v=p.selectlist,t=v.get("selectedValues");if(t.length>0){for(var u=0;u<t.length;u++){f.uploadFiles({options:p.getParent(),evt:{path:t[u].filePath,name:t[u].fileName,size:t[u].fileSize}})}var s=window.AttachmentList[p.getParent().fdKey];if(!s.selectedValues){s.selectedValues=t}p._handleUploadComplete()}else{p.lifecycle.handleUploadComplete&&p.lifecycle.handleUploadComplete()}p._handleClose(false)}}]});this.dialog=q;return q},_formatFiles:function(r){var q=[];for(var p=0;p<r.length;p++){var s=r[p].filePath;if(s.lastIndexOf("/")>-1){s=s.substring(s.lastIndexOf("/")+1,s.length)}q.push(Object.assign(r[p],{fileName:s}))}return q},_handleUploadComplete:function(){var p=window.AttachmentList[this.getParent().fdKey],q=p.selectedValues,s=this.getParent().filekeys;if(q){if(this.successCount===q.length){if(p!=null&&p.fileStatus!=-1){for(var r=0;r<s.length;r++){if(s[r].status==-1){console.error("第["+r+"]个文件上传失败");this.lifecycle.handleUploadError&&this.lifecycle.handleUploadError();return}if(s[r].status<2){setTimeout(b.hitch(this,this._handleUploadComplete),500);return}}}}else{setTimeout(b.hitch(this,this._handleUploadComplete),500);return}this.lifecycle.handleUploadComplete&&this.lifecycle.handleUploadComplete();this.___reset()}},___reset:function(){var p=window.AttachmentList[this.getParent().fdKey];if(p){p.selectedValues=null}this.successCount=0},initlifecycle:function(p){p=p||{};this.lifecycle={handleUploadCreate:p.create||o,handleUploadComplete:p.complete||o,handleUploadClose:p.close||o,handleUploadError:p.error||o}}})})},"sys/attachment/maxhub/js/AttachmentSelectList":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojox/mobile/Container","dojo/dom-construct","dojo/_base/array","./table/AttachmentTable"],function(c,e,b,a,f,d){return c("sys.attachment.maxhub.js.AttachmentSelectList",[e,b],{tables:[],values:[],selectedValues:[],baseClass:"mhAttachmentSelectList",_setSelectedValuesAttr:function(g){for(var h=0;h<this.tables.length;h++){var j=this.tables[h];j.set("selectedValues",g)}this._set("selectedValues",g)},_setValuesAttr:function(j){for(var g=0;g<this.tables.length;g++){var h=this.tables[g];h.set("selectedValues",this.selectedValues);h.set("values",j);h.render&&h.render()}this._set("values",j)},buildRendering:function(){this.inherited(arguments);this.listNode=a.create("div",{className:"mhuiAttachmentList"},this.domNode)},addChild:function(g){this.inherited(arguments);if(g.isInstanceOf(d)){this.tables.push(g)}},startup:function(){this.inherited(arguments);var j=this.getChildren();for(var h=0;h<j.length;h++){var k=j[h];if(k.isInstanceOf(d)){this.tables.push(k);a.place(k.domNode,this.listNode);k.set("values",this.values);k.set("fdKey",this.fdKey);k.render&&k.render()}}if(this.tables.length>0){var g=this.tables[0];this.switchMode(g.key)}this.subscribe("attachmentObj_"+this.fdKey+"_selectedChange","_handleSelected")},switchMode:function(h){for(var g=0;g<this.tables.length;g++){var j=this.tables[g];j.key===h?j.show():j.hide()}},_handleSelected:function(h){var g=-1,i=false;console.log("this.selectedValues.length:"+this.selectedValues.length);var i=f.some(this.selectedValues,function(l,j){var k=h.filePath==l.filePath;if(k){g=j}return k},this);if(i){this.selectedValues.splice(g)}else{this.selectedValues.push(h)}}})})},"sys/attachment/maxhub/js/AttachmentList":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_Contained","dijit/_Container","dojo/dom-construct","dojo/_base/array","dojo/request","dojo/dom-form","dojo/topic","sys/attachment/mobile/js/AttachmentList","sys/attachment/maxhub/js/AttachmentEditListItem","sys/attachment/maxhub/js/AttachmentViewListItem","mui/util"],function(g,e,l,c,d,j,f,b,i,m,k,a,h){return g("sys.attachment.maxhub.js.AttachmentList",[m],{postCreate:function(){this.inherited(arguments);this.subscribe(this.eventPrefix+"submit","submit");this.subscribe(this.eventPrefix+"refresh","refresh")},startup:function(){this.inherited(arguments);this.pathAtts=[];var p=this.getChildren();for(var o=0;o<p.length;o++){if(p[o].href){this.pathAtts.push(p[o].href)}}var n=this;n.defer(function(){n.publishCount()})},fillAttInfo:function(){if(this.filekeys.length>0){var n=window.AttachmentList[this.fdKey];if(n!=null&&n.fileStatus!=-1){j.forEach(this.filekeys,function(o){if(j.indexOf(this.pathAtts,o.path)<0){this.pathAtts.push(o.path)}},this)}}},publishCount:function(o){var n=o||this.getCount()||0;i.publish(this.eventPrefix+"count",n)},getCount:function(){var p=0;var o=this.getChildren();if(o&&o.length>0){for(var n=0;n<o.length;n++){if(o[n].isInstanceOf(k)||o[n].isInstanceOf(a)){p+=1}}}return p},submit:function(n){n=n||{};if(this.checkAttRules()){if(!n.url){n.success&&n.success();return}f.post(n.url,{data:b.toObject(this.domNode),headers:{Accept:"application/json"},handleAs:"json"}).then(function(o){if(o.status===false){n.fail&&n.fail(o);return}n.success&&n.success(o)},function(o){n.fail&&n.fail(o)})}},refresh:function(){var n=this;console.log("editMode:"+this.editMode);if(this.editMode!=="view"){return}var o="/sys/attachment/maxhub/import/view_json.jsp";o=h.setUrlParameter(o,"fdModelName",this.fdModelName);o=h.setUrlParameter(o,"fdModelId",this.fdModelId);o=h.setUrlParameter(o,"fdKey",this.fdKey);o=h.formatUrl(o);console.log("refresh url:"+o);f.post(o,{headers:{Accept:"application/json"},handleAs:"json"}).then(function(p){console.log("refresh result:"+JSON.stringify(p));var r=n.getChildren();for(var q=0;q<r.length;q++){if(r[q].isInstanceOf(a)){r[q].destroyRecursive()}}if(p&&p.length>0){n.publishCount(p.length);for(var q=0;q<p.length;q++){var s=new a(p[q]);s.startup();n.addChild(s)}}})},checkAttRules:function(){if(!this.validateAttUploading()){Tip.tip({text:"附件上传中.."});return false}if(this.filekeys.length>0){var n=window.AttachmentList[this.fdKey];if(n!=null&&n.fileStatus!=-1){j.forEach(this.filekeys,function(o){if(o._hasSubmit){return}var p=n.registFile({filekey:o.filekey,name:o.name});o._hasSubmit=true;if(p){this.addAtts.push(p)}},this)}}this.fillAttInfo();return true}})})},"sys/attachment/maxhub/js/table/AttachmentListTable":function(){define(["dojo/_base/declare","dojo/dom-construct","dojo/dom-style","./AttachmentListTableItem"],function(c,a,b,d){return c("sys.attachment.maxhub.js.AttachmentListTable",[],{key:"list",itemRenderer:d})})},"sys/attachment/maxhub/js/table/AttachmentListTableItem":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojox/mobile/_ItemBase","dojo/dom-construct","dojo/dom-style","./_AttachmentTableItemMixin"],function(d,e,b,a,c,f){return d("sys.attachment.maxhub.js.AttachmentListTableItem",[b,f],{baseClass:"mhuiAttachmentTileTableItem",buildRendering:function(){this.inherited(arguments);var h=a.create("div",{className:"itemTop "+this.getAttContainerType()},this.domNode);var g=a.create("div",{className:"mhuiAttachmentItemIcon"},h);a.create("i",{className:this.getAttTypeClass()},g);a.create("div",{className:"itemBottom",innerHTML:this.fileName},this.domNode)},getAttTypeClass:function(){var g=this.getType();if(g!=""){return"mui mui-file-"+g}return"mui mui-file"},getAttContainerType:function(){var g=this.getType();if(g!=""){return"mui-files-"+g}return"mui-files"},getType:function(){var g="";if(this.fileName.lastIndexOf(".")>-1){var h=this.fileName.substring(this.fileName.lastIndexOf(".")+1);if(h!=""){h=h.toLowerCase()}switch(h){case"doc":case"docx":g="word";break;case"xls":case"xlsx":g="excel";break;case"pps":case"ppt":case"pptx":g="ppt";break;case"pdf":g="pdf";break;case"txt":g="text";break;case"jpg":case"jpeg":case"ico":case"bmp":case"gif":case"png":case"tif":g="img";break;case"mht":case"html":case"htm":g="html";break;case"mpp":g="project";break;case"vsd":g="visio";break;case"zip":case"rar":g="zip";break;case"mp4":g="video";break;case"mp3":g="audio";break}}return g}})})},"sys/attachment/maxhub/js/table/_AttachmentTableItemMixin":function(){define(["dojo/_base/declare","dojo/topic","dojo/dom-construct","dojo/dom-class","mhui/device/jssdk"],function(d,c,b,e,a){return d("sys.attachment.maxhub._AttachmentTableItemMixin",null,{buildRendering:function(){this.inherited(arguments);this.selectboxNode=b.create("div",{className:"itemSelectbox"},this.domNode);if(this.selected){e.add(this.domNode,"active")}},startup:function(){this.inherited(arguments);this.connect(this.selectboxNode,"click","_onSelected");this.connect(this.domNode,"click","_onOpen");this.subscribe("attachmentObj_"+this.fdKey+"_selectedChange","_handleSelected")},_onOpen:function(){a.viewFile({path:this.filePath})},_onSelected:function(f){f.preventDefault();f.stopPropagation();console.log("on seleled changed");c.publish("attachmentObj_"+this.fdKey+"_selectedChange",this)},_handleSelected:function(f){if(f.filePath==this.filePath){e.toggle(this.domNode,"active")}}})})},"sys/attachment/maxhub/js/AttachmentEditListItem":function(){define(["dojo/_base/declare","dojo/dom-construct","mui/util","mhui/device/jssdk","dojo/topic","dojo/_base/lang","dojo/dom-style","sys/attachment/mobile/js/_AttachmentItem"],function(f,c,b,a,d,h,e,g){return f("sys.attachment.maxhub.js.AttachmentEditListItem",[g],{baseClass:"mhuiAttachmentEditItem",status:3,buildItem:function(){var l=c.create("div",{className:"mhuiAttachmentItemL "+this.getAttContainerType()},this.containerNode);this.attItemIcon=c.create("div",{className:"mhuiAttachmentItemIcon"},l);var i=this.getAttTypeClass();if(this.icon!=null&&this.icon!=""){i=this.icon}c.create("i",{className:i},this.attItemIcon);var k=c.create("div",{className:"mhuiAttachmentItemC"},this.containerNode);c.create("span",{className:"mhuiAttachmentItemName",innerHTML:this.name},k);var j={className:"mhuiAttachmentItemDel",style:{display:"inline-block"}};if(this.status!=3){this.statusDiv=c.create("div",{className:"mhuiAttachmentItemStatus"},this.domNode);c.create("i",{className:"mui mui-spin mui-loading2"},this.statusDiv);j.style.display="none"}this.attItemDel=c.create("div",j,this.domNode);c.create("i",{className:"mui mui-close"},this.attItemDel);this.connect(this.attItemDel,"click",h.hitch(this,function(m){d.publish("attachmentObject_"+this.key+"_del",this,{widget:this});if(m.stopPropagation){m.stopPropagation()}if(m.cancelBubble){m.cancelBubble=true}if(m.preventDefault){m.preventDefault()}if(m.returnValue){m.returnValue=false}}));if(this.href){this.connect(this.domNode,"click",h.hitch(this._onItemClick))}},changeProgress:function(i){},uploadError:function(i){if(this.statusDiv){c.empty(this.statusDiv);this.statusDiv.innerHTML="上传失败!"}if(this.attItemDel){e.set(this.attItemDel,{display:"inline-block"})}},uploaded:function(){c.empty(this.attItemIcon);var i=c.create("i",{className:"mui "+this.getAttTypeClass()},this.attItemIcon);if(this.statusDiv){c.destroy(this.statusDiv);this.statusDiv=null}if(this.attItemDel){e.set(this.attItemDel,{display:"inline-block"})}if(this.href||this.path){this.connect(this.domNode,"click",h.hitch(this._onItemClick))}},_imgResize:function(i){i.onload=function(){var j=i.height,k=i.width;if(j<k){e.set(i,{height:"40px",position:"relative",top:"50%",left:"50%",transform:"translate(-50%,-50%)"})}else{e.set(i,{width:"40px",position:"relative",top:"50%",left:"50%",transform:"translate(-50%,-50%)"})}}},_onItemClick:function(){if(this.href){console.log("_onItemClick href:"+b.formatUrl(this.href));window.location.href=b.formatUrl(this.href)}else{if(this.path){a.viewFile({path:this.path})}}}})})},"sys/attachment/maxhub/js/AttachmentViewListItem":function(){define(["dojo/_base/declare","dojo/dom-construct","mui/util","dojo/_base/lang","sys/attachment/mobile/js/_AttachmentItem"],function(c,b,a,e,d){return c("sys.attachment.maxhub.js.AttachmentViewListItem",[d],{baseClass:"mhuiAttachmentItem",status:3,buildItem:function(){var h=b.create("div",{className:"mhuiAttachmentItemL "+this.getAttContainerType()},this.containerNode);this.attItemIcon=b.create("div",{className:"mhuiAttachmentItemIcon"},h);if(this.getType()=="img"){b.create("img",{align:"middle",src:a.formatUrl(this.href)},this.attItemIcon)}else{var f=this.getAttTypeClass();if(this.icon!=null&&this.icon!=""){f=this.icon}b.create("i",{className:f},this.attItemIcon)}var g=b.create("div",{className:"mhuiAttachmentItemC",innerHTML:""},this.containerNode);b.create("span",{className:"mhuiAttachmentItemName",innerHTML:this.name},g);if(this.href){this.connect(g,"click",e.hitch(this._onItemClick));g.dojoClick=true}},_onItemClick:function(){console.log(a.formatUrl(this.href));window.location.href=a.formatUrl(this.href)}})})},"sys/attachment/maxhub/js/table/AttachmentTable":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojox/mobile/Container","dojo/topic","dojo/dom-construct","dojo/dom-style","dojo/_base/array","dojo/_base/lang","mhui/device/jssdk"],function(f,e,b,g,c,h,i,a,d){if(!Object.assign){Object.assign=function(m){for(var k=1;k<arguments.length;k++){var l=arguments[k];for(var j in l){if(Object.prototype.hasOwnProperty.call(l,j)){m[j]=l[j]}}}return m}}return f("sys.attachment.maxhub.js.AttachmentSelectTable",[e,b],{key:"abstract",selectedValues:[],values:[],itemRenderer:null,render:function(){c.empty(this.domNode);var j=this.values;if(j&&j.length>0){this._buildRunningNode(a.hitch(this,function(){for(var l=0;l<j.length;l++){var m=i.some(this.selectedValues,function(o){return o.filePath===j[l].filePath});var k=Object.assign({},j[l],{fdKey:this.fdKey,selected:m});var n=new this.itemRenderer(k);n.startup();c.place(n.domNode,this.domNode)}}))}else{c.create("div",{className:"mhuiAttachementNodata"},this.domNode);c.create("div",{className:"mhuiAttachementNodataLabel",innerHTML:"暂无会议纪录"},this.domNode);this._buildRunningNode()}},_buildRunningNode:function(j){d.isBoardRunning(a.hitch(this,function(l){if(l){var k=c.create("div",{className:"mhuiBoardRunningNode"},this.domNode);c.create("span",{className:"mhui-icon mhui-icon-warn"},k);c.create("span",{innerHTML:"设备白板正在使用中，是否需要将白板数据保存到智能会议？"},k);var m=c.create("span",{className:"mhuiBoardOpenNode",innerHTML:"去保存"},k);this.connect(m,"click",this._openBoard)}j&&j.call(this)}))},_openBoard:function(){d.board();g.publish("attachmentObject_"+this.fdKey+"_openBoard")},show:function(){h.set(this.domNode,"display","block")},hide:function(){h.set(this.domNode,"display","none")}})})},"sys/attachment/maxhub/js/AttachmentEvent":function(){define(["dojo/_base/declare","dojo/topic","sys/attachment/mobile/js/AttachmentEvent","sys/attachment/maxhub/js/AttachmentEditListItem"],function(c,b,d,a){return c("sys.attachment.maxhub.js.AttachmentEvent",[d],{AttachmentListItem:a,_addItem:function(i,e){var h=e.file;var g=this.getParent();var f=g.getChildren().length;var j=this.AttachmentListItem;g.addChild(new j(h),0);b.publish("/mui/list/resize")}})})}}});