require({cache:{"sys/attachment/mobile/js/AttachmentViewContentListItem":function(){define(["dojo/_base/declare","dojo/dom-construct","mui/util","dojo/_base/lang","mui/dialog/Tip","sys/attachment/mobile/js/_AttachmentItem","sys/attachment/mobile/js/_AttachmentLinkItem","mui/device/adapter","mui/device/device","sys/attachment/mobile/js/_AttachmentViewOnlineMixin","mui/i18n/_i18n!sys/attachment/mobile/js/mui-attachment","dojo/request"],function(declare,domConstruct,util,lang,Tip,AttachmentItem,AttachmentLinkItem,adapter,device,_AttachmentViewOnlineMixin,msg,request){return declare("sys.attachment.mobile.js.AttachmentViewContentListItem",[AttachmentItem,AttachmentLinkItem,_AttachmentViewOnlineMixin],{buildItem:function(){var text=this.customSubject;if(text==""){text=msg["mui.viewContent"]}var childNode=domConstruct.create("div",{className:"muiReadAllItem "},this.containerNode);var childNode1=domConstruct.create("div",{className:"textAlign"},childNode);var readNode=domConstruct.create("span",{className:"muiReadAll",innerHTML:text},childNode1);if(this.href){this.connect(readNode,"click",lang.hitch(this._onItemClick))}var devType=device.getClientType();var fdFileType=this.getType();if(this.canEdit){var _self=this;if((this.wpsWebOfficeEnable||this.wpsCloudOfficeEnableEdit||this.wpsCenterWebOfficeEnable||this.wpsCloudOfficeEnableMobileEdit)&&(fdFileType=="word"||fdFileType=="excel"||fdFileType=="ppt")){var editNode=domConstruct.create("span",{className:"muiReadAll",innerHTML:msg["mui.editContent"]},childNode1);if(_self.href){_self.connect(editNode,"click",function(){_self.editWps()})}}else{if(devType==9||devType==10){adapter.mixinReady(function(){if(typeof eval(adapter.canUseJinGe)=="function"){var authDf=adapter.canUseJinGe();authDf.then(function(auth){if(auth.office&&(fdFileType=="word"||fdFileType=="excel"||fdFileType=="ppt")){var editNode=domConstruct.create("span",{className:"muiReadAll",innerHTML:msg["mui.editContent"]},childNode1);if(_self.href){_self.connect(editNode,"click",function(){_self.editfile(fdFileType)})}}if(auth.pdf&&fdFileType=="pdf"){var editNode=domConstruct.create("span",{className:"muiReadAll",innerHTML:msg["mui.sysAttMain.comment"]},childNode1);if(_self.href){_self.connect(editNode,"click",function(){_self.editfile(fdFileType)})}}})}})}}}if(this.canDownload){var childNode2=domConstruct.create("div",{className:"muiOtherOpt"},childNode);if(this.canDownload&&!this.newsFlag){var downloadNode=domConstruct.create("span",{className:"muiDownloadBtn",innerHTML:'<i class="mui mui-top"></i>'+msg["mui.sysAttMain.download"]},childNode2);if(this.href){this.connect(downloadNode,"click",function(){this._downLoad()})}}}},_downLoad:function(){if(this.canDownload){var logUrl="/sys/attachment/sys_att_download_log/sysAttDownloadLog.do?method=addDownlodLog&downloadType=manual&fdId="+this.fdId;request.post(util.formatUrl(logUrl,true));adapter.download({fdId:this.fdId,name:this.name,type:this.type,href:this.href})}else{Tip.tip({icon:"mui mui-warn",text:"无权限下载文件"})}}})})},"sys/attachment/mobile/js/AttachmentOptDialog":function(){define(["dojo/_base/declare","mui/dialog/Dialog","dojo/dom-construct"],function(d,b,a){var c=d("sys.attachment.mobile.js.AttachmentOptDialog",[b.claz],{buildRendering:function(){this.domNode=a.create("div",{className:"muiDialogElement"+(this.showClass!=null?" "+this.showClass:"")},document.body,"last");this.containerNode=a.create("div",{className:"muiAttDialogContainer"},this.domNode);a.place(this.element,this.containerNode);a.create("div",{className:"muiAttDialogBottom",innerHTML:"取消"},this.containerNode);this.connect(this.domNode,"click","_onClose")},_onClose:function(e){if(this.callback){this.callback(window,this)}this.hide()}});return{element:function(e){var f=new c(e);return f.show()}}})},"sys/attachment/mobile/js/AttachmentOptListItem":function(){define(["dojo/_base/declare","dojo/dom-construct","mui/device/device","mui/device/adapter","mui/dialog/Tip","dojox/mobile/sniff","sys/attachment/mobile/js/_AttachmentItem","mui/i18n/_i18n!sys/attachment/mobile/js/mui-attachment","mui/i18n/_i18n!sys/attachment/mobile/js/mui-attachment","dojo/dom-attr","dojo/touch","dojo/topic","dojo/dom-class","mui/form/_AlignMixin","dojo/on","dojo/query","dojo/_base/lang"],function(g,e,a,m,n,o,d,c,q,k,f,h,l,p,i,j,b){return g("sys.attachment.mobile.js.AttachmentOptListItem",[d,p],{isForm:true,baseClass:"muiAttachmentEditItem muiAttachmentEditOptItem",customSubject:"",capture:"",aligin:"",showStatus:"edit",postCreate:function(){this.inherited(arguments);this.subscribe("attachmentOptListItem_emit_events","emitEvents")},getIconClass:function(){if("pic"==this._fdAttType){return"muis-images-upload"}return"muis-uploader"},buildRendering:function(){this.inherited(arguments);if("right"==this.align){l.add(this.domNode,"muiRight")}this.domNode.dojoClick=!o("ios")},buildHItem:function(){this.attItemTop=e.create("div",{className:"muiAttachmentItemT"},this.containerNode);var r=e.create("div",{className:"muiAttachmentItemIcon"},this.attItemTop);this.uploadDom=e.create("i",{className:"fontmuis "+this.getIconClass()},r);e.create("div",{className:"muiAttachmentItemText"},this.attItemTop)},buildVItem:function(){l.add(this.domNode,"muiAttachmentEditVOptItem");this.attItemTop=e.create("div",{className:"muiAttachmentItemTV"},this.containerNode);var r=e.create("div",{className:"muiAttachmentItemTVIcon"},this.attItemTop);this.uploadDom=e.create("i",{className:"fontmuis "+this.getIconClass()},r)},buildItem:function(){var r=this;if(this.orient=="vertical"){this.buildVItem()}else{this.buildHItem()}var t=a.getClientType();if(t>6&&t<11){if(this.capture.toLowerCase().indexOf("camera")==-1){this.connect(this.uploadDom,f.press,"_onKKppload")}else{this.connect(this.uploadDom,"click","_onCamera")}}else{var u={type:"file",className:"muiAttachmentUploadFile"};if(this.getParent().fdAttType&&this.getParent().fdAttType=="pic"){if(t==6){u.accept="image/*"}else{u.accept="image/gif,image/jpeg,image/bmp,image/png"}}else{if(this.getParent().enabledFileType){var s=this.formatEnabledFileType(this.getParent().enabledFileType);u.accept="*";if(s!=null){$.ajax({url:Com_Parameter.ContextPath+"sys/attachment/js/mime.jsp",dataType:"json",data:"extFileNames="+s,type:"POST",async:false,success:function(v){if(v.status==1){u.accept=v.message.join(",")}},error:function(w,v,x){if(window.console){window.console.error(x)}}})}}}if(this.getParent().fdMulti==true){u.multiple=true}if(o("ios")&&o("ios")<6){this.connect(this.uploadDom,"click",function(){n.tip({icon:"mui mui-warn",time:2000,text:"不支持附件上传，请升级到IOS6.0以上"})})}else{if(o("android")&&o("android")<4){this.connect(this.uploadDom,"click",function(){n.tip({icon:"mui mui-warn",time:2000,text:"不支持附件上传，请升级到ANDROID4.0以上"})})}else{this.uploadDom=e.create("input",u,this.attItemTop);if(o("android")){this.connect(this.uploadDom,"click",function(v){if(!r.supportCustom||r.supportCustom=="false"){if(v.stopPropagation){v.stopPropagation()}if(v.cancelBubble){v.cancelBubble=true}if(v.preventDefault){v.preventDefault()}if(v.returnValue){v.returnValue=false}}})}this.connect(this.uploadDom,"click","_onValueClear");this.connect(this.uploadDom,"change","_onUpload")}}}},formatEnabledFileType:function(r){if(r==null||r==""){return null}r=r.replace(/\|/g,",");r=r.replace(/\;/g,",");r=r.replace(/[\.|\*]/g,"");return r},startup:function(){this.inherited(arguments);this._onUploadChange();this.subscribe("attachmentObject_"+this.getParent().fdKey+"_addItem","_onUploadChange");this.subscribe("attachmentObject_"+this.getParent().fdKey+"_del","_onUploadChange")},_onValueClear:function(){this.uploadDom.value=""},_onKKppload:function(u){if(this.selectDiv){return}this.selectDiv=e.create("div",{className:"muiAttachmentUploadArea"},document.body,"last");e.create("div",{className:"muiAttachmentUploadbak"},this.selectDiv);var t=e.create("div",{className:"muiAttachmentUploadOpt"},this.selectDiv);var s=e.create("div",{className:"muiAttachmentUploadSelect"},t);var v=e.create("div",{className:"muiAttachmentUploadCamera",innerHTML:c["mui.sysAttMain.photograph"]},s);this.connect(v,"click","_onCamera");var r=e.create("div",{className:"muiAttachmentUploadFiles",innerHTML:c["mui.sysAttMain.picture"]},s);k.set(r,"feature","album");this.connect(r,"click","_onUpload");if(this.getParent().fdAttType!="pic"){var x=e.create("div",{className:"muiAttachmentUploadFiles",innerHTML:c["mui.sysAttMain.file.manager"]},s);k.set(x,"feature","file_manager");this.connect(x,"click","_onUpload")}var w=e.create("div",{className:"muiAttachmentUploadCancel",innerHTML:q["sysAttMain.button.cancelAll"]},t);this.connect(w,"click","_onCancel")},_onCancel:function(r){if(this.selectDiv){e.destroy(this.selectDiv);this.selectDiv=null}},_onCamera:function(r){this._onCancel(r);m.openCamera({options:this.getParent()})},_onUpload:function(r){var s=r.target;if(s){s.blur()}this._onCancel(r);m.selectFile({options:this.getParent(),evt:r,feature:k.get(s,"feature")})},_onUploadChange:function(){var r=this.getParent();if(r&&!r.fdMulti){var s=r.getChildren();if(s.length>2){this.containerNode.style.display="none";return}}this.containerNode.style.display="inline-block";h.publish("/mui/list/resize",this)},emitEvents:function(t,s){if(!s.key||s.key!=this.getParent().fdKey){return}var r=a.getClientType();if(s.targetName==="uploadDom"){if(s.eventType==="click"){if(r>6&&r<11){if(this.capture.toLowerCase().indexOf("camera")==-1){this._onKKppload()}else{this._onCamera()}}else{this._onValueClear();this.uploadDom.click()}}}}})})},"sys/attachment/mobile/js/AttachmentEvent":function(){define(["dojo/_base/declare","dojo/topic","dojo/dom-style","sys/attachment/mobile/js/AttachmentEditListItem","dijit/_WidgetBase","mui/dialog/Tip","mui/i18n/_i18n!sys/attachment/mobile/js/mui-attachment","dojo/query","dojo/dom-construct","dojo/dom-class"],function(d,e,f,i,c,j,a,g,b,h){return d("sys.attachment.mobile.js.AttachmentEvent",[c],{AttachmentListItem:i,isResizeListView:true,buildRendering:function(){this.inherited(arguments);f.set(this.domNode,{width:"0px",height:"0px",opacity:0})},postCreate:function(){this.inherited(arguments);this.handle=this.subscribe("attachmentObject_"+this.getParent().fdKey+"_addItem","_addItem")},_addItem:function(v,s){var n=s.file;if(v.enabledFileType){var m=this.formatEnabledFileType(v.enabledFileType).split(",");var u=false;for(var o=0;o<m.length;o++){if(n.name.endsWith(m[o])){u=true;break}}if(!u){j.fail({text:a["mui.sysAttMain.errortypefile"]});return false}}var k=this.getParent();var l=this.AttachmentListItem;n.hidePicName=this.hidePicName;var t=new l(n);var q=k.align;var r=k.orient;var p=g(".muiAttachmentEditOptItem",k.domNode);b.place(t.domNode,p[0],"before");if(this.isResizeListView){e.publish("/mui/list/resize")}},destroy:function(){if(this.handle){this.handle.remove()}this.inherited(arguments)},formatEnabledFileType:function(k){if(k==null||k==""){return null}k=k.replace(/\|/g,",");k=k.replace(/\;/g,",");k=k.replace(/[\.|\*]/g,"");return k}})})},"sys/attachment/mobile/js/_AttachmentTypeMixin":function(){define(["dojo/_base/declare"],function(a){return a("sys.attachment.mobile.js._AttachmentTypeMixin",null,{getType:function(){var b="";if(this.name.lastIndexOf(".")>-1){var c=this.name.substring(this.name.lastIndexOf(".")+1);if(c!=""){c=c.toLowerCase()}switch(c){case"doc":case"docx":b="word";break;case"xls":case"xlsx":b="excel";break;case"pps":case"ppt":case"pptx":b="ppt";break;case"ofd":b="ofd";break;case"pdf":b="pdf";break;case"txt":case"text":b="text";break;case"jpg":case"jpeg":case"ico":case"bmp":case"gif":case"png":case"svg":b="img";break;case"tif":b="tif";break;case"mht":case"html":case"htm":b="html";break;case"mpp":b="project";break;case"vsd":b="visio";break;case"zip":case"rar":case"rar":case"7z":case"gz":b="zip";break;case"mp4":case"m4v":case"flv":case"f4v":case"ogg":case"3gp":case"avi":case"wmv":case"asx":case"asf":case"mpg":case"mov":case"rm":case"wmv9":case"wrf":b="video";break;case"mp3":b="audio";break;case"wps":b="wps";break;case"et":b="et";break;case"dps":b="dps";break;case"out":b="out";break;case"psd":b="psd";break;case"raq":b="raq";break;case"wav":b="wav";break;case"ttc":case"ttf":case"otf":b="ttf";break;case"key":b="keynote";break;case"rmvb":b="rmvb";break;case"ai":b="ai";break;case"sketch":b="sketch";break}}return b}})})},"sys/attachment/mobile/js/AttachmentLogApi":function(){define(["dojo/_base/declare","mui/util","dojo/request","dojo/_base/lang"],function(b,a,c,d){return b("sys.attachment.log.api",null,{ADD_URL:"/sys/attachment/sys_att_play_log/sysAttPlayLog.do?method=save",UPDATE_URL:"/sys/attachment/sys_att_play_log/sysAttPlayLog.do?method=update",FIND_URL:"/sys/attachment/sys_att_play_log/sysAttPlayLog.do?method=viewByAttId",enable:false,support:true,fdLogId:null,isEnable:function(){return this.enable&&this.support},find:function(e,f){c.get(a.formatUrl(this.FIND_URL+"&fdAttId="+e+"&fdType="+this.type),{handleAs:"json"}).response.then(d.hitch(this,function(g){if(g.status==200){var g=g.data;this.enable=g.fdEnable;this.findDone(g)}}))},add:function(e,f){if(!this.isEnable()){return}c.post(a.formatUrl(this.ADD_URL),{data:{fdAttId:e,fdParam:f,fdType:this.type},timeout:30000,handleAs:"json"}).response.then(d.hitch(this,function(g){if(g.status==200){this.addDone(g.data)}}))},update:function(f,e){if(!this.isEnable()){return}c.post(a.formatUrl(this.UPDATE_URL),{data:{fdId:f,fdParam:e},timeout:30000,handleAs:"json"}).response.then(d.hitch(this,function(g){if(g.status==200){this.updateDone(g.data)}}))},log:function(e,f){if(this.fdLogId){this.update(this.fdLogId,f)}else{this.add(e,f)}},findDone:function(e){if(e&&e.fdId){this.fdLogId=e.fdId}},updateDone:function(){},addDone:function(e){if(e&&e.fdId){this.fdLogId=e.fdId}}})})},"sys/attachment/mobile/js/_AttachmentViewOnlineMixin":function(){define(["dojo/_base/declare","sys/attachment/mobile/js/AttachmentOptSelect","mui/util","dojo/_base/lang","dojox/mobile/sniff","mui/i18n/_i18n!sys/attachment/mobile/js/mui-attachment","mui/device/adapter","dijit/registry","mui/device/device","mui/dialog/Tip","dojo/request","dojo/Deferred"],function(declare,Select,util,lang,has,msg,adapter,registry,device,Tip,req,Deferred){return declare("sys.attachment.mobile.js._AttachmentViewOnlineMixin",null,{viewHref:"/sys/attachment/sys_att_main/sysAttMain.do?method=view&fdId=!{fdId}&viewer=mobilehtmlviewer",editHref:"/sys/attachment/sys_att_main/sysAttMain.do?method=edit&fdId=!{fdId}",viewPicHref:"/third/pda/attdownload.jsp?open=1",wpsWebOfficeEnable:false,wpsCloudOfficeEnable:false,wpsCenterWebOfficeEnable:false,wpsCloudOfficeEnableEdit:false,wpsCloudOfficeEnableMobileEdit:false,wpsPreviewIsLinux:false,wpsPreviewIsWindows:false,canDownload:false,canRead:false,canEdit:false,readOLConfig:"-1",getPool:function(){var pool=[];var fdFileType=this.getType();var devType=device.getClientType();if(this.canRead||this.canViewOnline()){pool.push({value:1,text:msg["mui.sysAttMain.openfile"],callback:function(){this.view()}})}else{if(this.canRead&&(this.wpsWebOfficeEnable||this.wpsCloudOfficeEnable||this.wpsCenterWebOfficeEnable)&&(fdFileType=="word"||fdFileType=="excel"||fdFileType=="ppt"||fdFileType=="wps"||fdFileType=="et"||fdFileType=="dps")){pool.push({value:1,text:msg["mui.sysAttMain.openfile"],callback:function(){this.view()}})}}if(this.canDownload){var isDisplaySaveButton=true;var isKK=(device.getClientType()>6&&device.getClientType()<11);var isIOS=has("ios");if(isIOS&&!isKK){isDisplaySaveButton=false}if(isDisplaySaveButton){pool.push({value:2,text:msg["mui.sysAttMain.savefile"],callback:function(){this._downLoad()}})}if(devType==11){$.ajaxSettings.async=false;$.post(dojoConfig.baseUrl+"sys/attachment/sys_att_main/sysAttMain.do?method=isShow",{key:"ding"},function(result){if("true"==result){pool.push({value:5,text:msg["mui.sysAttMain.download.to.ding"],callback:function(){this.downloadToDing()}})}});$.ajaxSettings.async=true}}var defer=new Deferred();var devType=device.getClientType();var fdFileType=this.getType();if(this.canEdit){var _self=this;if(this.canRead&&(this.wpsWebOfficeEnable||this.wpsCloudOfficeEnableEdit||this.wpsCenterWebOfficeEnable||(this.wpsCloudOfficeEnableMobileEdit&&devType==12)||(this.wpsCloudOfficeEnableMobileEdit&&devType==11))&&(fdFileType=="word"||fdFileType=="excel"||fdFileType=="ppt"||fdFileType=="wps"||fdFileType=="et"||fdFileType=="dps")){pool.push({value:3,text:msg["mui.sysAttMain.editfile"],callback:function(){_self.editWps()}});defer.resolve(pool)}else{if(devType==9||devType==10){adapter.mixinReady(function(){if(typeof eval(adapter.canUseJinGe)=="function"){var authDf=adapter.canUseJinGe();authDf.then(function(auth){if(auth.office&&(fdFileType=="word"||fdFileType=="excel"||fdFileType=="ppt")){pool.push({value:3,text:msg["mui.sysAttMain.editfile"],callback:function(){_self.editfile(fdFileType)}})}if(auth.pdf&&fdFileType=="pdf"){pool.push({value:4,text:msg["mui.sysAttMain.comment"],callback:function(){_self.editfile(fdFileType)}})}defer.resolve(pool)})}else{defer.resolve(pool)}})}else{defer.resolve(pool)}}}else{defer.resolve(pool)}return defer},editfile:function(fileType){if(this.canEdit){if(typeof eval(adapter.editfile)=="function"){adapter.editfile({fdAttMainId:this.fdId,name:this.name,href:this.href,key:this.key,fileType:fileType},function(rtn){},function(rtn){Tip.fail({text:rtn.text})})}else{Tip.fail({text:"功能暂不支持！"})}}},editWps:function(){var devType=device.getClientType();var url=util.formatUrl(this.editHref.replace("!{fdId}",this.fdId),true);try{if(typeof eval(adapter.openFileByWpsOaassist)=="function"&&devType==12&&this.wpsCloudOfficeEnableMobileEdit){adapter.openFileByWpsOaassist({fdAttMainId:this.fdId,fdMode:"EditMode"})}else{if(devType==11&&this.wpsCloudOfficeEnableMobileEdit){var downloadUri="";var fileId="";var fileName="";var uploadUri="";var wpsSerNum="";$.ajaxSettings.async=false;$.post(dojoConfig.baseUrl+"sys/attachment/sys_att_main/sysAttMain.do?method=getParamForDing",{fdAttMainId:this.fdId},function(data){if(data){var results=eval("("+data+")");downloadUri=results.downloadUri;fileId=results.fileId;fileName=results.fileName;uploadUri=results.uploadUri;wpsSerNum=results.wpsSerNum;console.log("downloadUri:"+downloadUri+",fileId:"+fileId+",fileName:"+fileName+",uploadUri:"+uploadUri+",wpsSerNum:"+wpsSerNum)}else{Tip.fail({text:"请求参数有错"})}});$.ajaxSettings.async=true;require(["dojo/topic","mui/device/adapter","dojo/request","dojo/ready","dijit/registry","mui/util","dojo/query","dojo/dom-construct"],function(topic,adapter,request,ready,registry,util,query,domConstruct){ready(function(){var options={downloadUri:downloadUri,fileId:fileId,fileName:fileName,uploadUri:uploadUri,wpsSerNum:wpsSerNum,config:{}};var flag=true;adapter.editOffice(options,function(status){if(flag){flag=false;console.log(JSON.stringify(status));var errorCode=status.errorCode;var resultCode=status.resultCode;if(errorCode=="7"||resultCode=="-1"){Tip.fail({text:"唤起WPS Office失败"})}}})})})}else{if(typeof eval(adapter.open)=="function"&&this.getType()!="text"){adapter.open(url,"_blank")}else{location.href=url}}}}catch(e){location.href=url}},view:function(){var url="";var fileType=this.getType();var devType=device.getClientType();if(fileType=="img"){var devType=device.getClientType();var attrNodeList=this.domNode.parentNode.children;var srcList=[];for(var i=0;i<attrNodeList.length;i++){var attrObj=registry.byNode(attrNodeList[i]);try{if(attrObj&&attrObj.getType()=="img"){if(has("ios")||attrObj.canRead){url=util.formatUrl(attrObj.viewPicHref+"&isPic=true&fdId="+attrObj.fdId,true);if(null!=attrObj.fdId){srcList.push(url)}else{srcList.push(attrObj.href)}}}}catch(e){}}var curSrc="";if(this.fdId){curSrc=util.formatUrl(this.viewPicHref+"&isPic=true&fdId="+this.fdId,true)}else{curSrc=this.href}var now=new Date().getTime();for(var i=0;i<srcList.length;i++){if(srcList[i].indexOf("blob")==-1){srcList[i]=srcList[i]+"&time="+now}}adapter.imagePreview({curSrc:curSrc+"&time="+now,srcList:srcList,previewImgBgColor:""});return}else{if(fileType=="video"){url=util.formatUrl("/sys/attachment/mobile/viewer/video/videoViewer.jsp?fdId="+this.fdId,true)}else{if(fileType=="audio"){url=util.formatUrl("/sys/attachment/mobile/viewer/audio/audioViewer.jsp?fdId="+this.fdId,true)}else{if(fileType=="text"){url=util.formatUrl("/sys/attachment/sys_att_main/sysAttMain.do?method=readDownload&fdId="+this.fdId,true)}else{if(fileType=="zip"||fileType=="rar"||fileType=="7z"){url=util.formatUrl("/sys/attachment/mobile/viewer/zip/zipViewer.jsp?fdId="+this.fdId,true)}else{if(fileType=="ofd"&&devType==10&&!this.wpsCenterWebOfficeEnable){if(typeof eval(adapter.openOfdFile)=="function"){adapter.openOfdFile({fdAttMainId:this.fdId,name:this.name,fileType:fileType},function(rtn){},function(rtn){Tip.fail({text:rtn.text})})}else{Tip.fail({text:"暂不支持打开ofd文件！"})}return}else{url=util.formatUrl(this.viewHref.replace("!{fdId}",this.fdId),true)}}}}}}var parentId=registry.byId(this.domNode.parentNode.id);if(parentId._templateId&&parentId._contentId){url+="&_templateId="+parentId._templateId;url+="&_contentId="+parentId._contentId}try{if(this.name){var name=this.name.substring(0,this.name.lastIndexOf("."));if(name!="null"){url=util.setUrlParameter(url,"title",name)}}if(typeof eval(adapter.openFileByWpsOaassist)=="function"&&devType==12&&this.wpsCloudOfficeEnable){adapter.openFileByWpsOaassist({fdAttMainId:this.fdId,fdMode:"read,upload,download"})}else{if(typeof eval(adapter.open)=="function"&&this.getType()!="text"){if(this.canViewOnline()){adapter.open(url,"_blank")}else{if(this.canDownload){this._downLoad()}else{location.href=url}}}else{location.href=url}}}catch(e){location.href=url}},onDialogSelect:function(obj,evt){if(obj!=this.select){return}var defer=this.getPool();var _self=this;defer.then(function(pool){for(var i=0;i<pool.length;i++){if(evt.value==pool[i].value){lang.hitch(_self,pool[i].callback)();_self.select.destroy();return}}})},onDialogCallback:function(obj,evt){if(obj==this.select){this.select.destroy()}},buildRendering:function(){this.inherited(arguments);this.subscribe("/mui/form/valueChanged","onDialogSelect");this.subscribe("mui/form/select/callback","onDialogCallback")},canViewOnline:function(){var fdFileType=this.getType();var cvo_devType=device.getClientType();var isOfficeAndWps=fdFileType=="word"||fdFileType=="excel"||fdFileType=="ppt"||fdFileType=="wps"||fdFileType=="et"||fdFileType=="dps";var canReadOfdOrPdf=(this.getType()=="ofd"&&this.wpsPreviewIsLinux)||(this.getType()=="pdf"&&this.wpsPreviewIsLinux)||(this.getType()=="pdf"&&this.wpsPreviewIsWindows)||(this.getType()=="pdf"&&this.wpsCloudOfficeEnableEdit);if(canReadOfdOrPdf){isOfficeAndWps=true}var r=(this.hasViewer||(this.readOLConfig=="4")||this.getType()=="img"||(this.getType()=="ofd"&&this.wpsPreviewIsLinux)||(this.getType()=="pdf"&&this.wpsPreviewIsLinux)||(this.getType()=="pdf"&&this.wpsPreviewIsWindows)||(this.getType()=="pdf"&&this.wpsCloudOfficeEnableEdit)||(this.getType()=="ofd"&&this.wpsCenterWebOfficeEnable)||(this.getType()=="pdf"&&this.wpsCenterWebOfficeEnable)||(this.getType()=="text"&&this.wpsCenterWebOfficeEnable)||this.canRead&&(this.wpsWebOfficeEnable||this.wpsCloudOfficeEnableEdit||this.wpsCenterWebOfficeEnable||this.wpsCloudOfficeEnableMobileEdit||(cvo_devType=="10"&&this.wpsCloudOfficeEnableMobileEdit))&&(fdFileType=="word"||fdFileType=="excel"||fdFileType=="ppt"||fdFileType=="wps"||fdFileType=="et"||fdFileType=="dps")||(has("ios")&&this.getType()=="text"));return r},_onItemClick:function(){if(this.canViewOnline()){if(has("ios")){this.view();return true}var _self=this;var defer=this.getPool();defer.then(function(pool){if(pool.length==0){_self._downLoad();return true}if(_self.canRead){_self.view();return true}else{if(_self.canDownload){_self._downLoad();return true}}})}else{this._downLoad()}return true},_onMoreItemClick:function(){var defer=this.getPool();var _self=this;defer.then(function(pool){if(pool.length==0){_self._downLoad();return true}else{if(pool.length==1){lang.hitch(_self,pool[0].callback)();return true}else{_self.select=new Select({store:pool,mul:false,showClass:"muiDialogSelect attOperationDialog",subject:this.name});_self.select.startup();_self.select._onClick()}}})}})})},"sys/attachment/mobile/js/AttachmentViewPageTime":function(){define(["dojo/_base/declare","dojo/topic","dijit/_WidgetBase","mui/util","dojo/request","dojo/string"],function(d,c,f,a,e,b){return d("AttachmentViewPageTime",[f],{fdId:"",_templateId:"",_contentId:"",computingTimeUrl:"/sys/attachment/computingTime.do?method=computingTime&fdId=${fdId}&_templateId=${_templateId}&_contentId=${_contentId}",startup:function(){this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);window.computingTimeTimer="";computingTimeTimer=setInterval(function(){g.computingTime()},1000*60);var g=this;document.addEventListener("visibilitychange",function(){if(document.hidden){clearInterval(computingTimeTimer)}else{computingTimeTimer=setInterval(function(){g.computingTime()},1000*60)}});this.computingTime()},computingTime:function(){var g=e.post(a.formatUrl(b.substitute(this.computingTimeUrl,{fdId:this.fdId||"",_templateId:this._templateId||"",_contentId:this._contentId||""})),{handleAs:"json"});g.response.then(function(h){if(h.status==200){var i=h.data;if(i.isFinished){clearInterval(computingTimeTimer)}}})}})})},"sys/attachment/mobile/js/AttachmentEditListItem":function(){define(["dojo/_base/declare","dojo/dom-construct","mui/util","dojo/topic","dojo/_base/lang","dojo/dom-style","dojox/mobile/ProgressBar","sys/attachment/mobile/js/_AttachmentItem","mui/device/adapter","sys/attachment/mobile/js/_AttachmentViewOnlineMixin","dojo/request","dojo/query"],function(f,d,h,g,a,i,l,c,k,b,e,j){return f("sys.attachment.mobile.js.AttachmentEditListItem",[c,b],{baseClass:"muiAttachmentEditItem",status:3,canDownload:true,canRead:true,canEdit:true,showDeleteIcon:"true",postCreate:function(){this.inherited(arguments);this.subscribe("attachmentEditListItem_delItem","_delItem");this.subscribe("attachmentListItem_viewItem","_viewItem")},buildItem:function(){var n=d.create("div",{className:"muiAttachmentItemT "+this.getAttContainerType()},this.containerNode);this.attItemIcon=d.create("div",{className:"muiAttachmentItemIcon"},n);if(this.getType()=="img"&&this.status==3){if(this.thumb){var r=d.create("img",{align:"middle",src:h.formatUrl(this.thumb)},this.attItemIcon);this._imgResize(r);g.publish("attachmentObject_"+this.key+"_afterView",this,{href:this.thumb,pageType:"edit"})}else{var r=d.create("img",{align:"middle",src:h.formatUrl(this.href)},this.attItemIcon);this._imgResize(r);g.publish("attachmentObject_"+this.key+"_afterView",this,{href:this.href,pageType:"edit"})}}else{d.create("i",{className:this.getAttTypeClass()},this.attItemIcon)}this.connect(this.attItemIcon,"click",a.hitch(this._onItemClick));var m={className:"muiAttachmentItemDel",style:{display:this.showDeleteIcon==="true"?"block":"none"}};if(this.status!=3){this.statusDiv=d.create("div",{className:"muiAttachmentItemStatus"},n);d.create("i",{className:"fontmuis mui-spin muis-refresh"},this.statusDiv);m.style.display="none"}this.attItemDel=d.create("div",m,n);d.create("i",{className:"fontmuis muis-epid-delete"},this.attItemDel);this.connect(this.attItemDel,"click",a.hitch(this,function(s){g.publish("attachmentObject_"+this.key+"_del",this,{widget:this});if(s.stopPropagation){s.stopPropagation()}if(s.cancelBubble){s.cancelBubble=true}if(s.preventDefault){s.preventDefault()}if(s.returnValue){s.returnValue=false}}));var q=d.create("div",{className:"muiAttachmentItemB"},this.containerNode);var p=d.create("div",{className:"muiAttachmentItemName",innerHTML:this.name},q);if(this.size!=null&&this.size!=""){d.create("div",{className:"muiAttachmentItemSize",innerHTML:this.formatFileSize()},q)}if(this.hidePicName&&this.hidePicName=="true"){var o=this.id;setTimeout(function(){$("[id='"+o+"']").find(".muiAttachmentItemB").hide()},100)}},changeProgress:function(m){},uploadError:function(m){if(this.statusDiv){d.empty(this.statusDiv);this.statusDiv.innerHTML="上传失败!"}if(this.attItemDel){i.set(this.attItemDel,{display:"block"})}},uploaded:function(){if(this.attItemIcon&&this.getType()=="img"&&this.href){d.empty(this.attItemIcon);var m=d.create("img",{align:"middle",src:h.formatUrl(this.href)},this.attItemIcon);this._imgResize(m)}if(this.statusDiv){d.destroy(this.statusDiv);this.statusDiv=null}if(this.attItemDel){i.set(this.attItemDel,{display:"block"})}},_onItemClick:function(){if(this.filePath){k.fileView({path:this.filePath})}else{if(this.inherited(arguments)){return}this._downLoad()}},_downLoad:function(){var m="/sys/attachment/sys_att_download_log/sysAttDownloadLog.do?method=addDownlodLog&downloadType=manual&fdId="+this.fdId;e.post(h.formatUrl(m,true));k.download({fdId:this.fdId,name:this.name,type:this.type,href:this.href})},_imgResize:function(m){m.onload=function(){var n=m.height,p=m.width;var o=j(".muiAttachmentItemT")[0].getBoundingClientRect();if(n<p){i.set(m,{height:o.height==0?"100%":(o.height+"px"),position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)","-webkit-transform":"translate(-50%,-50%)"})}else{i.set(m,{width:o.width==0?"100%":(o.width+"px"),position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)","-webkit-transform":"translate(-50%,-50%)"})}}},_delItem:function(m,n){if(n.key&&n.key==this.key){g.publish("attachmentObject_"+this.key+"_del",this,{widget:this})}},_viewItem:function(m,n){if(n.key&&n.key==this.key){this._onItemClick()}}})})},"sys/attachment/mobile/js/AttachmentViewListItem":function(){define(["dojo/_base/declare","dojo/dom-construct","mui/util","dojo/topic","dojo/_base/lang","dojo/dom-style","mui/dialog/Tip","mui/i18n/_i18n!sys/attachment/mobile/js/mui-attachment","dojox/mobile/ProgressBar","sys/attachment/mobile/js/_AttachmentItem","sys/attachment/mobile/js/_AttachmentLinkItem","mui/device/adapter","sys/attachment/mobile/js/_AttachmentViewOnlineMixin","dojo/request"],function(h,f,j,i,b,k,m,d,n,e,a,l,c,g){return h("sys.attachment.mobile.js.AttachmentViewListItem",[e,a,c],{status:3,thumbUrl:"/sys/attachment/sys_att_main/sysAttMain.do?method=view&picthumb=small&fdId=!{fdId}",gennerateDownloadUrl:function(){if(!this.href&&this.fdId){this.href="/sys/attachment/sys_att_main/sysAttMain.do?method=viewDownload&fdId="+this.fdId;if(this.canDownload){this.href="/sys/attachment/sys_att_main/sysAttMain.do?method=download&fdId="+this.fdId}if(this.downLoadNoRight){this.href="/third/pda/attdownload.jsp?open=1&fdId="+this.fdId}}},buildItem:function(){this.gennerateDownloadUrl();if(!this.justDiaplayName){var r=f.create("div",{className:"muiAttachmentItemL "+this.getAttContainerType()},this.containerNode);this.attItemIcon=f.create("div",{className:"muiAttachmentItemIcon"},r);var o=this.getAttTypeClass();if(this.icon!=null&&this.icon!=""){o=this.icon}f.create("i",{className:o},this.attItemIcon)}var q=f.create("div",{className:"muiAttachmentItemC"},this.containerNode);f.create("span",{className:"muiAttachmentItemName",innerHTML:this.name},q);if(this.size!=null&&this.size!=""){f.create("span",{className:"muiAttachmentItemSize",innerHTML:this.formatFileSize()},q)}if(this.status!=3){var p=f.create("div",{className:"muiAttachmentItemProgress"},q);this.progressBar=new n({maximum:100,value:"0%",label:"0%"});p.appendChild(this.progressBar.domNode);this.progressBar.startup()}if(this.href&&this.edit==false){this.connect(q,"click",b.hitch(this._onItemClick));q.dojoClick=true}this.itemR=f.create("div",{className:"muiAttachmentItemR"},this.containerNode);if(this.edit==false){if(this.canDownload||this.canRead){f.create("i",{className:"muiAttachmentItemExpand fontmuis muis-more"},this.itemR);this.connect(this.itemR,"click",b.hitch(this._onMoreItemClick))}}else{var s={className:"muiAttachmentItemDel",innerHTML:"删除",style:{display:"none"}};if(this.status==3||this.status==2){s.style.display="block"}this.delDom=f.create("i",s,this.itemR);this.connect(this.delDom,"click",b.hitch(this,function(t){i.publish("attachmentObject_"+this.key+"_del",this,{widget:this});if(t.stopPropagation){t.stopPropagation()}if(t.cancelBubble){t.cancelBubble=true}if(t.preventDefault){t.preventDefault()}if(t.returnValue){t.returnValue=false}}))}},_downLoad:function(){if(this.canDownload){var o="/sys/attachment/sys_att_download_log/sysAttDownloadLog.do?method=addDownlodLog&downloadType=manual&fdId="+this.fdId;g.post(j.formatUrl(o,true));l.download({fdId:this.fdId,name:this.name,type:this.type,href:this.href})}else{m.tip({icon:"mui mui-warn",text:"无权限下载文件"})}},downloadToDing:function(){var t=this;var r=(new Date()).getTime();var o=l.isSuccess(this.fdId,r);if(this.size>=8*1024*1024&&!o){var s=0;var p="";if(this.size<15*1024*1024){s=Math.round(this.size/(15*1024*1024)*60);p=d["mui.sysAttMain.download.oversize.time"]+s+d["mui.sysAttMain.download.oversize.time.sec"]}else{s=Math.round(this.size/(15*1024*1024));p=d["mui.sysAttMain.download.oversize.time"]+s+d["mui.sysAttMain.download.oversize.time.min"]}m.tip({text:p});setTimeout(function(){l.downloadToDing({fdId:t.fdId,name:t.name,type:t.type,href:t.href,size:t.size,time:r},false)},50)}else{var q=m.processing();q.show();setTimeout(function(){l.downloadToDing({fdId:t.fdId,name:t.name,type:t.type,href:t.href,size:t.size,time:r},true);q.hide()},50)}},_onItemClick:function(){if(this.canRead||this.canDownload){this._onClick(arguments);if(this.inherited(arguments)){return}this._downLoad()}else{m.tip({icon:"mui mui-warn",text:"无权限查看"})}},changeProgress:function(p){if(this.progressBar){var o="";if(typeof p=="string"){o=p.indexOf("%")!=-1?""+(parseFloat(p)*100)/this.size+"%":p}else{o=""+(p*100)/this.size+"%"}this.progressBar.set("value",o);this.progressBar.set("label",o)}},uploadError:function(o){if(this.progressBar){this.progressBar.set("value","0%");this.progressBar.set("label",o)}if(this.delDom){k.set(this.delDom,{display:"block"})}},uploaded:function(){if(this.progressBar){this.progressBar.set("value","100%");this.progressBar.set("label","上传成功")}if(this.delDom){k.set(this.delDom,{display:"block"})}}})})},"sys/attachment/mobile/js/_AttachmentLinkItem":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_Contained","dijit/_Container","dojox/mobile/_ItemBase","dojo/dom-class","dojo/on"],function(e,g,d,c,b,f,a){return e("sys.attachment.mobile.js._AttachmentLinkItem",null,{_selClass:"mblListItemSelected",_selStartMethod:"touch",_setSelectedAttr:function(h){this.inherited(arguments)},handleSelection:function(h){this.set("selected",true)},makeTransition:function(h){this.defer(function(){this.set("selected",false)},100)},_onClick:function(h){this.defaultClickAction(h)}})})},"sys/attachment/mobile/js/AttachmentList":function(){define(["dojo/_base/declare","dojo/dom-construct","dojo/dom-class","dojo/dom-attr","dojo/_base/array","dojo/topic","dijit/_WidgetBase","dijit/_Contained","dijit/_Container","mui/dialog/Tip","dojox/mobile/viewRegistry","mui/form/_AutoAdaptionMixin","dojo/dom-style","dojo/query","mui/i18n/_i18n!sys/attachment/mobile/js/mui-attachment","./AttachmentOptListItem","mui/form/_AlignMixin"],function(g,d,n,l,j,h,f,p,c,o,m,e,i,k,b,a,q){return g("sys.attachment.mobile.js.AttachmentList",[f,e,p,c,q],{isForm:true,baseClass:"muiFormUploadWrap",eventPrefix:"attachmentObject_",fdKey:"",fdFiledName:"",fdModelName:"",fdModelId:"",fdMulti:true,fdAttType:"byte",editMode:"view",showStatus:"edit",delAtts:[],addAtts:[],nameAtts:[],filekeys:[],orderFiles:[],required:false,fdDisabledFileType:".js;.bat;.exe",subject:null,orient:"none",buildV:function(){d.create("div",{className:"muiFormEleTitle",innerHTML:this.subject},this.domNode);if("vertical"==this.orient){n.add(this.domNode,"muiFormVArrList")}},buildRendering:function(){if(this.fdKey==null||this.fdKey==""){var t=this.guid();this.fdKey=t;if(this.fdFiledName!=null&&this.fdFiledName!=""){var r=document.getElementsByName(this.fdFiledName)[0];if(r){r.value=t}}}this.inherited(arguments);this.showStatus=this.editMode;this.eventPrefix=this.eventPrefix+this.fdKey+"_";var s="attachmentForms."+this.fdKey+".";if(this.editMode=="edit"){d.create("input",{type:"hidden",name:s+"fdModelName",value:this.fdModelName},this.domNode);d.create("input",{type:"hidden",name:s+"fdModelId",value:this.fdModelId},this.domNode);d.create("input",{type:"hidden",name:s+"fdKey",value:this.fdKey},this.domNode);d.create("input",{type:"hidden",name:s+"fdAttType",value:this.fdAttType},this.domNode);d.create("input",{type:"hidden",name:s+"fdMulti",value:this.fdMulti},this.domNode);this.delAttNode=d.create("input",{type:"hidden",name:s+"deletedAttachmentIds"},this.domNode);this.addAttNode=d.create("input",{type:"hidden",name:s+"attachmentIds"},this.domNode);if(this.extParam){d.create("input",{type:"hidden",name:s+"extParam",value:this.extParam},this.domNode)}l.set(this.domNode,"validate","attachment_required_"+this.fdKey+" attachment_uploading_"+this.fdKey)}if(this.getAlign()=="right"){n.add(this.domNode,"muiRight")}},postCreate:function(){this.inherited(arguments);if(this.editMode=="edit"){this.subscribe(this.eventPrefix+"start","_start");this.subscribe(this.eventPrefix+"success","_success");this.subscribe(this.eventPrefix+"fail","_fail");this.subscribe(this.eventPrefix+"process","_process");this.subscribe(this.eventPrefix+"del","_del")}},startup:function(){this.inherited(arguments);if(this.orient=="vertical"){this.buildV()}this.requiredNode=d.create("div",{className:"muiFormRequired",innerHTML:"*"},this.domNode);this.set("required",this.required);if(this.editMode=="edit"){this.contentNode=d.create("div",{className:"muiFormUploadContent muiFormItem"},this.domNode);var t=this.getChildren();j.forEach(t,function(w){if(w instanceof a){d.place(w.domNode,this.contentNode,"last")}},this)}this.addAtts=[];this.delAtts=[];this.nameAtts=[];this.filekeys=[];this.orderFiles=[];var v=this.getChildren();for(var s=0;s<v.length;s++){if(v[s].fdId){this.addAtts.push(v[s].fdId)}if(v[s].name){this.nameAtts.push(v[s].name)}}this.fillAttInfo();if(window.Com_Parameter&&this.editMode=="edit"){var r=this;window.Com_Parameter.event.confirm.unshift(function(){return r.checkAttRules()});this.pView=this.getValidateView();if(this.pView){var u=b["mui.sysAttMain.msg.null"];if(this.fdAttType&&this.fdAttType=="pic"){u=b["mui.sysAttMain.pic.null"]}u=this.customWarnTipMsg||u;this.pView._validation.addValidator("attachment_required_"+this.fdKey,u,function(){return r.validateAttRequired()});this.pView._validation.addValidator("attachment_uploading_"+this.fdKey,b["mui.sysAttMain.upload"],function(){return r.validateAttUploading()})}}},getValidateView:function(s){var t=this.domNode||s;var r=m.getEnclosingView(t);while(r!=null&&!r._validation){r=m.getParentView(r)}return r},validateAttRequired:function(){var r=this.getChildren();if(this.required){if(r==null||r.length<=2){return false}}return true},_setRequiredAttr:function(r){this.required=r;this.initDisplay()},initDisplay:function(){if(this.requiredNode){n.toggle(this.requiredNode,"muiFormRequiredShow",this.required)}if(this.required==false){this.pView=this.getValidateView();if(this.pView&&this.pView._validation){this.pView._validation.hideWarnHint(this.domNode)}}},validateAttUploading:function(){var r=this.getChildren();for(var s=0;s<r.length;s++){if(r[s].status&&r[s].status<2){return false}}return true},checkAttRules:function(){if(!this.validateAttUploading()){o.tip({text:b["mui.sysAttMain.upload"]+".."});return false}if(this.filekeys.length>0){var r=this.orderFiles;var t=this.filekeys;var w=[];for(var v=0;v<r.length;v++){for(var u=0;u<t.length;u++){if(r[v]._fdId==t[u]._fdId){w.push(t[u]);continue}}}this.filekeys=w;var s=window.AttachmentList[this.fdKey];if(s!=null&&s.fileStatus!=-1){j.forEach(this.filekeys,function(x){var y=s.registFile({filekey:x.filekey,name:x.name});if(y){this.addAtts.push(y)}},this)}}this.fillAttInfo();return true},getChildByFdId:function(t){var r=this.getChildren();for(var s=0;s<r.length;s++){if(t!=null&&r[s]._fdId==t){return r[s]}}},_start:function(s,r){if(r.file){this.orderFiles.push(r.file)}h.publish(this.eventPrefix+"addItem",this,r)},_success:function(s,r){var t=this.getChildByFdId(r.file._fdId);if(t){if(r.file){t.filekey=r.file.filekey;t.status=r.file.status;t.href=r.file.href;this.filekeys.push(r.file)}if(t.uploaded){t.uploaded()}if(this.pView){this.pView._validation.validateElement(this.domNode)}}},_fail:function(s,r){if(r.file!=null){var t=this.getChildByFdId(r.file._fdId);if(t&&t.uploadError){t.status=r.file.status;t.uploadError(r.rtn.msg)}}else{o.tip({icon:"mui .mui-fail",text:r.rtn.msg})}},_process:function(s,r){var t=this.getChildByFdId(r.file._fdId);if(t&&t.changeProgress){t.status=r.file.status;t.changeProgress(r.loaded)}},_del:function(s,r){if(r){var u=r.widget;var t=u.filekey;var w=u.fdId;var v=u.name;if(t!=null){this.filekeys=j.filter(this.filekeys,function(x){return x.filekey!=t})}if(w!=null){this.addAtts=j.filter(this.addAtts,function(x){return x!=w});this.delAtts.push(w)}if(v!=null){this.nameAtts=j.filter(this.nameAtts,function(x){return x!=v})}if(s.isDing){h.publish("/third/ding/del/"+this.fdKey,{_srcObj:s,_widget:u,_this:this})}else{this.removeChild(u);u.destroy();h.publish("/mui/list/resize",this)}}},fillAttInfo:function(){if(this.addAttNode){this.addAttNode.value=this.addAtts.join(";")}if(this.delAttNode){this.delAttNode.value=this.delAtts.join(";")}},guid:(function(){var r=0;return function(u){var s=(+new Date().getTime()).toString(32),t=0;for(;t<5;t++){s+=Math.floor(Math.random()*65535).toString(32)}return(u||"att_")+s+(r++).toString(32)}})(),buildSingleRowView:function(){var v=k(this.domNode).closest("xformflag")[0];var u;if(v){u=i.get(v,"display")}if(u!=="none"){u=i.get(this.domNode,"display")}if(this.editMode!="hidden"&&u!=="none"){this.inherited(arguments);if(this.autoAdaptionViewNode){n.replace(this.autoAdaptionViewNode,"oldMui muiFormUploadWrap muiDetailTableautoAdaption",this.muiSingleRowViewClass);var s=this.getChildren();for(var t=0;t<s.length;t++){var x=s[t];if(x.name){var r=x.domNode.cloneNode(true);d.place(r,this.autoAdaptionViewNode,"last");var w=k(".muiAttachmentItemDel",r);if(w.length===1){i.set(w[0],"display","none")}}else{if(n.contains(x.domNode," muiAttachmentEditOptItem")){i.set(x.domNode,"display","block")}}}}}else{if(this.autoAdaptionViewNode){i.set(this.autoAdaptionViewNode,"display","none")}}},buildAutoAdaptionView:function(){if(this.editMode!="hidden"){var r=this.getChildren();for(var s=0;s<r.length;s++){var u=r[s];if(u.name){var t=k(".muiAttachmentItemDel",u.domNode);if(t.length===1){i.set(t[0],"display","none")}}}}}})})},"sys/attachment/mobile/js/_AttachmentItem":function(){define(["dojo/_base/declare","dojox/mobile/_ItemBase","dojo/dom-class","./_AttachmentTypeMixin"],function(b,a,c,d){return b("sys.attachment.mobile.js._AttachmentItem",[a,d],{baseClass:"muiAttachmentItem",fdId:null,filekey:null,size:0,name:"",type:"",icon:"",href:"",key:"",edit:false,justDiaplayName:false,buildRendering:function(){this.inherited(arguments);var e=this.getParent();if(e!=null){this.edit=e.editMode=="edit";this.key=e.fdKey}this.buildItem()},startup:function(){this.inherited(arguments)},formatFileSize:function(){var e="";var f;var h="";if(typeof(this.size)!="string"){h+=this.size}else{h=this.size}if(h!=null&&h!=""){var g=0;if((f=h.indexOf("E"))>0){g=parseFloat(h.substring(0,f))*Math.pow(10,parseInt(h.substring(f+1)))}else{g=parseInt(h)}if(g<1024){e=g+"B"}else{g=Math.round(g*100/1024)/100;if(g<1024){e=g+"KB"}else{g=Math.round(g*100/1024)/100;if(g<1024){e=g+"M"}else{g=Math.round(g*100/1024)/100;e=g+"G"}}}}return e},getAttTypeClass:function(){var e=this.getType();if(e!=""){return"mui-icon-"+e}return"mui-icon"},getAttContainerType:function(){var e=this.getType();if(e!=""){return"mui-files-"+e}return"mui-files"}})})},"sys/attachment/mobile/js/AttachmentViewPicItem":function(){define(["dojo/_base/declare","dojo/dom-construct","mui/util","dojo/_base/lang","dojo/dom-style","sys/attachment/mobile/js/_AttachmentItem","sys/attachment/mobile/js/_AttachmentLinkItem","sys/attachment/mobile/js/_AttachmentViewOnlineMixin","dojo/topic"],function(f,e,h,b,i,d,a,c,g){return f("sys.attachment.mobile.js.AttachmentViewPicItem",[d,a,c],{width:null,height:null,fdId:null,iconUrl:"/sys/attachment/sys_att_main/sysAttMain.do?method=view&picthumb=small&fdId=!{fdId}",mobilePicDisplaythumb:"false",baseClass:"muiAttachmentPicItem",postCreate:function(){this.inherited(arguments);this.subscribe("attachmentListItem_viewItem","_viewItem")},buildItem:function(){if(this.width!=null){i.set(this.containerNode,{width:this.width+"px"})}if(this.height!=null){i.set(this.containerNode,{height:this.height+"px"})}var j=this.mobilePicDisplaythumb=="true"?"70px":"100%";if(!this.icon){this.icon=this.iconUrl.replace("!{fdId}",this.fdId)}var o=e.create("img",{className:"muiAttachmentPicImg",src:h.formatUrl(this.icon),width:j},this.containerNode);var n=e.create("div",{className:"muiAttachmentItemB"},this.containerNode);var m=e.create("div",{className:"muiAttachmentItemName",innerHTML:this.name},n);if(this.size!=null&&this.size!=""){e.create("div",{className:"muiAttachmentItemSize",innerHTML:this.formatFileSize()},n)}if(this.hidePicName&&this.hidePicName=="true"){var k=this.id;setTimeout(function(){$("[id='"+k+"']").find(".muiAttachmentItemB").hide()},100)}var l=h.formatUrl(this.icon);this.fdId=this.getParamsFromUrl(l).fdId;this.canRead=true;this.connect(o,"click",b.hitch(this.view));o.dojoClick=true;g.publish("attachmentObject_"+this.key+"_afterView",this,{href:this.icon})},getParamsFromUrl:function(k){if(k.indexOf("?")!=-1){var j=k.indexOf("?")+1;var n=k.substr(j);var m={};arrs=n.split("&");for(var l=0;l<arrs.length;l++){m[arrs[l].split("=")[0]]=arrs[l].split("=")[1]}}return m},_viewItem:function(j,k){if(k.key&&k.key==this.key){this.view()}}})})},"sys/attachment/mobile/js/AttachmentOptSelect":function(){define(["dojo/_base/declare","mui/form/Select","dojo/dom-construct","sys/attachment/mobile/js/AttachmentOptDialog","dojo/_base/lang","dojo/topic","dojo/_base/array"],function(e,h,b,a,f,d,g){var c=e("sys.attachment.mobile.js.AttachmentOptSelect",[h],{pop:false,renderListItem:function(){g.forEach(this.values,function(j){var i=b.create("div",{className:"muiAttDialogButton",innerHTML:j.text},this.contentNode);this.connect(i,"click",f.hitch(this,function(){d.publish("/mui/form/valueChanged",this,{value:j.value})}))},this)},_onClick:function(){if(this.dialog){this.dialog.hide();this.dialog=null;return}this.contentNode=b.create("div",{className:"muiAttDialogContent"});this.renderListItem();this.dialog=a.element({element:this.contentNode,position:"bottom",showClass:"muiDialogSelect attOperationDialog",callback:f.hitch(this,function(){d.publish(this.SELECT_CALLBACK,this);this.dialog=null})})}});return c})}}});require({cache:{"sys/attachment/mobile/js/mui-attachment_zh-cn._min_":function(){define("",{"mui.sysAttMain.file.manager":"文件管理器","mui.sysAttMain.download.oversize":"下载文件过大，请稍后进入页面再试。","mui.sysAttMain.download.oversize.time":"下载文件过大，预计需要（","mui.sysAttMain.pieces":"个","mui.sysAttMain.msg.wechatDownload":"附件将随后通过微信发送给您，请注意查收!","mui.sysAttMain.photograph":"拍照","mui.sysAttMain.download.oversize.time.sec":"）秒，请稍后进入页面再试。","mui.viewContent":"阅读全文","mui.sysAttMain.comment":"添加批注","mui.viewContent.back":"返回","mui.sysAttMain.msg.null":"请至少上传一个附件","mui.sysAttMain.download":"下载","mui.sysAttMain.editfile":"编辑文件","mui.sysAttMain.upload":"附件上传中","mui.sysAttMain.pic.null":"请至少上传一张图片","mui.sysAttMain.total":"共","mui.sysAttMain.errortypefile":"文件类型不匹配","mui.sysAttMain.download.to.ding":"下载到钉盘","mui.editContent":"编辑正文","mui.sysAttMain.openfile":"打开文件","mui.sysAttMain.download.oversize.time.min":"）分钟，请稍后进入页面再试。","mui.sysAttMain.savefile":"保存文件","mui.sysAttMain.label":"附件","mui.sysAttMain.picture":"手机相册","mui.sysAttMain.button.upload":"附件上传","sysAttMain.button.cancelAll":"取消"})}}});