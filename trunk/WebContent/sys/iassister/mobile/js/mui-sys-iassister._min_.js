require({cache:{"sys/iassister/mobile/js/tabbarButton":function(){define(["dojo/_base/declare","mui/tabbar/TabBarButton","dojo/dom-construct","dojo/dom-class","dijit/registry","dojo/_base/lang","dojo/topic","dojo/dom","dojo/query","mui/device/adapter","mui/dialog/Dialog","mui/i18n/_i18n!sys/mobile/js/mui/mui-common","mui/i18n/_i18n!sys/iassister/mobile/js/mui-sys-iassister"],function(e,m,c,l,a,b,f,d,j,k,i,h,g){return e("sys.iassister.checkButton",[m],{buildRendering:function(){this.inherited(arguments)},rtnData:[],dialogs:[],fileList:[],paramsHere:{isInit:false,checkUrl:"/sys/iassister/sys_iassister_check/sysIassisterCheck.do",templateUrl:"/sys/iassister/sys_iassister_template/sysIassisterTemplate.do"},initSelf:function(){this.initParams();this.initTemplateInfos()},initParams:function(){this.paramsHere=$.extend(this.paramsHere,this.ias_params);this.paramsHere.curNode=lbpm.globals.getCurrentNodeObj();this.paramsHere.hasCheckItems="true"==this.ias_params.hasCheckItems;this.paramsHere.hasAuth="true"==this.ias_params.hasAuth;this.paramsHere.ctxPath=Com_Parameter.ContextPath;this.paramsHere.isInit=true;console.log(this.paramsHere)},onClick:function(){if(!this.paramsHere.isInit){this.initSelf()}var o=this.getCheckUrl();console.log(o);this.rtnData=this.postCheck(o);console.log(this.rtnData);var p=c.create("span",{style:{"font-size":"var(--muiFontSizeMS)"},innerHTML:g["mui.button.iassister"]}),n=this.showDatas();this.dialog=i.element({title:p.outerHTML,element:n,buttons:"",position:"bottom",parseable:false,canClose:true,callback:null})},getCheckUrl:function(){var n=this.paramsHere.ctxPath+this.paramsHere.checkUrl;n=Com_SetUrlParameter(n,"method","execCheck");n=Com_SetUrlParameter(n,"fdTmplateModelId",this.paramsHere.templateId);n=Com_SetUrlParameter(n,"fdTemplateModelName",this.paramsHere.templateModelName);n=Com_SetUrlParameter(n,"fdModelId",this.paramsHere.mainModelId);n=Com_SetUrlParameter(n,"fdModelName",this.paramsHere.mainModelName);n=Com_SetUrlParameter(n,"nodeId",this.paramsHere.curNode.id);n=Com_SetUrlParameter(n,"fdKey",this.paramsHere.fdKey);if("view"==this.paramsHere.method){n=Com_SetUrlParameter(n,"fdPageMode","view")}return n},initTemplateInfos:function(){var n=this;var o=n.paramsHere.ctxPath+n.paramsHere.templateUrl;o=Com_SetUrlParameter(o,"method","getTemplateInfo");o=Com_SetUrlParameter(o,"templateId",n.paramsHere.templateId);o=Com_SetUrlParameter(o,"templateModelName",n.paramsHere.templateModelName);o=Com_SetUrlParameter(o,"nodeId",n.paramsHere.curNode.id);$.ajax({async:false,url:o,dataType:"json",success:function(p){if(p.success){n.paramsHere.mappingFieldNames=p.mappingFields;n.paramsHere.showGroups=p.showGroups}}})},postCheck:function(n,q){var p=[];var o={};o.paramData=JSON.stringify(this.getParamData());var r={success:false};$.ajax({url:n,type:"POST",data:o,async:false,success:function(s){r=s}});if(r.success){p=r.result}else{console.log(r.error)}if("icheck"==q){showCheckResult(p)}return p},getParamData:function(){var v=[];var y=this;if(y.paramsHere.mappingFieldNames){for(var s=0,u=y.paramsHere.mappingFieldNames.length;s<u;s++){var x=y.paramsHere.mappingFieldNames[s];var w={name:x,value:""};var p=x;var t=false;if(x.indexOf("fd_")>-1){p="extendDataFormInfo.value("+x+")";if(x.indexOf(".")>-1){t=true}}var n=$("[name='"+p+"']").prop("type");var r=$("[name='"+p+"']").val();if(n=="radio"){r=$("[name='"+p+"']:checked").val()}if(!r){r=$("[name='"+p+"Id']").val()}if(t){r="";var o="TABLE_DL_"+x.split(".")[0];var q=function(){var A=$(this).attr("type");if(!A||"templateRow"==A){var z="[name^='extendDataFormInfo.value("+x.split(".")[0]+"']";r+=$(this).find(z).val()+"|"}};$("#"+o).find("tr").each(q);if(r){r=r.substring(0,r.length-1)}}if(typeof r=="undefined"){r=""}w.value=r;v.push(w)}}if(window.console){console.log("获取的表单数据：",v)}return v},showDatas:function(){var x=this.rtnData;var p=c.create("div",{className:"muiDialogIasMain"});for(var u=0;u<this.paramsHere.showGroups.length;u++){var w=this.paramsHere.showGroups[u];var n=c.create("div",{className:"muiDialogIasGroups"},p);var q=c.create("div",{className:"muiDialogIasGroupTitle",innerHTML:w.label},n);var o=c.create("ul",{className:"muiDialogIasInfo"},n);for(var r=0;r<x.length;r++){if(x[r].groups.indexOf(w.key)>=0){var t=x[r];var v=c.create("li",{className:"muiDialogIasInfoDesc",innerHTML:t.label},o);if(t.result!="success"){var s=c.create("a",{className:"muiDialogIasInfoMore",innerHTML:g["mui.dialog.more"],"data-key":t.templateId},v);l.add(v,t.result);this.connect(s,"click","_showMore")}}}}return p},_showMore:function(x){var D=x.target;var E=D.dataset.key;var n=this.getCheckInfo(E);var G=c.create("span",{style:{"font-size":"var(--muiFontSizeMS)"},innerHTML:g["mui.button.iassister"]});var F=c.create("div",{className:"muiIasInfoDialog"});var v=c.create("div",{className:"muiIasInfoDialogTab"},F);var r=c.create("ul",{className:"tabList"},v);var q=0;if(n.showInfos.pic.fileList.length>0){++q;var B=c.create("li",{className:"muiIasInfoDialog tabs"+(q==1?" active":""),innerHTML:g["mui.dialog.more.pic"],"data-index":q},r);this.connect(B,"click","switchTabs");this.fileList=n.showInfos.pic.fileList;var t=c.create("div",{className:"muiIasInfoCont imgList"+(q==1?" show":""),"data-index":q},F);for(var A=0;A<this.fileList.length;A++){var C=n.showInfos.pic.fileList[A];var o=C.url;var p=c.create("div",{className:"imgContent","data-src":o,innerHTML:'<i class="icon"></i>'},t);var H=c.create("img",{className:"",src:o,title:C.name},p);this.connect(p,"click","showImg")}}if(n.showInfos.link.linkList.length>0){++q;var y=c.create("li",{className:"muiIasInfoDialog tabs"+(q==1?" active":""),innerHTML:g["mui.dialog.more.link"],"data-index":q},r);this.connect(y,"click","switchTabs");var t=c.create("div",{className:"muiIasInfoCont linkList"+(q==1?" show":""),"data-index":q},F);var z=c.create("ul",{className:"linkContent"},t);for(var A=0;A<n.showInfos.link.linkList.length;A++){var C=n.showInfos.link.linkList[A];var u=c.create("li",{className:"linkLine"},z);var H=c.create("a",{className:"",href:C.href,innerHTML:C.title},u)}}if(n.showInfos.text.content!=""){++q;var w=c.create("li",{className:"muiIasInfoDialog tabs"+(q==1?" active":""),innerHTML:g["mui.dialog.more.text"],"data-index":q},r);this.connect(w,"click","switchTabs");var t=c.create("div",{className:"muiIasInfoCont textContent"+(q==1?" show":""),"data-index":q},F);var s=c.create("div",{className:"",innerHTML:n.showInfos.text.content},t)}this.dialogs[E]=i.element({title:g["mui.dialog.more.title"],element:F,transform:"right",buttons:"",position:"bottom",parseable:false,canClose:true,callback:null});console.log(n)},getCheckInfo:function(o){var r=this.rtnData;if(r.length<=0){return[]}var q=[];for(var n=0;n<r.length;n++){var p=r[n];if(p.templateId==o){q=p}}return q},switchTabs:function(n){n.target.parentNode.childNodes.forEach(function(p,q){if(l.contains(p,"active")){l.remove(p,"active")}});l.add(n.target,"active");var o=n.target.dataset.index;$(n.target).parents(".muiIasInfoDialog").find(".muiIasInfoCont").removeClass("show");$(n.target).parents(".muiIasInfoDialog").find(".muiIasInfoCont[data-index='"+o+"']").addClass("show")},showImg:function(n){if(this.fileList.length<=0){return}var r=[];for(var p=0;p<this.fileList.length;p++){var q=this.fileList[p];if(q.url!=""){r[p]=q.url}}var o=n.target.parentNode.dataset.src;k.imagePreview({curSrc:o,srcList:r,previewImgBgColor:""})}})})}}});